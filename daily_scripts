# post-update v37 test13

asymmetric systematics:

TT weight sys look weird (Mf, Mr, Mfr)
mu LEP
JES, TES and JER

why fit broke when one of the systematics was rate?

check goodness of the fit



DY tautau basic and 3j look strange in the distrs:
different the composition in lep pT and tau pT (more qcd, wjets in one of them).





## TT weight sys

root -l distrs/v37_test13_bunchFULLFIT2_mc.root

nom      = (TH1D*) mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_c")
mfr_up   = (TH1D*) mu_sel->Get("tt_mutau/MfrUp/mu_sel_tt_mutau_MfrUp_Mt_lep_met_c")
mfr_down = (TH1D*) mu_sel->Get("tt_mutau/MfrDown/mu_sel_tt_mutau_MfrDown_Mt_lep_met_c")

mfr_up->SetLineColor(kRed)
mfr_down->SetLineColor(kRed+2)

nom      ->Draw()
mfr_up   ->Draw("same")
mfr_down ->Draw("same")

-- looks ok

mfr_up   ->Divide(nom)
mfr_down ->Divide(nom)

mfr_up   ->Draw()
mfr_down ->Draw("same")

-- totally symmetric

check the histosel file which was used in the fit

root -l ../../fit-stuff/v37_test13_bunchFULLFIT2.root

nom      = (TH1D*) mu_sel_ljout->Get("tt_mutau/NOMINAL/mu_sel_ljout_tt_mutau_NOMINAL_Mt_lep_met_c")
mfr_up   = (TH1D*) mu_sel_ljout->Get("tt_mutau/MfrUp/mu_sel_ljout_tt_mutau_MfrUp_Mt_lep_met_c")
mfr_down = (TH1D*) mu_sel_ljout->Get("tt_mutau/MfrDown/mu_sel_ljout_tt_mutau_MfrDown_Mt_lep_met_c")


looks as if it is just normalized to the same integral and the stat variations are large this way


mfr_up   ->Integral() /nom      ->Integral()
mfr_down ->Integral() /nom      ->Integral()

1.00260
0.998200

and in the distrs file:

root -l distrs/v37_test13_bunchFULLFIT2_mc.root

(double) 0.876873
(double) 1.13379

normalize and plot:

nom      ->Scale(1. / nom     ->Integral())
mfr_up   ->Scale(1. / mfr_up  ->Integral())
mfr_down ->Scale(1. / mfr_down->Integral())

mfr_up   ->Divide(nom)
mfr_down ->Divide(nom)

mfr_up   ->Draw()
mfr_down ->Draw("same")

c1->SaveAs("v37_test13_post_update_tt-weight-systs-issue_Mfr_in-distrs-file_normalized.png")

c1->SaveAs("v37_test13_post_update_tt-weight-systs-issue_Mfr_in-fit-datafile_original_ratio.png")
c1->SaveAs("v37_test13_post_update_tt-weight-systs-issue_Mfr_in-fit-datafile_normalized.png")


-- the normalized distrs are slightly different, the fit datafile is flatter with less difference between Up and Down


reproduce the histosel sys variation

make --dry-run run_std_histos out=histosels/v37_test13_bunchFULLFIT2/ wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/v37_test13_bunchFULLFIT2_mc_1.root data_mu=distrs/v37_test13_bunchFULLFIT2/SingleMuon.root data_el=distrs/v37_test13_bunchFULLFIT2/SingleElectron.root | grep mu_sel_ljout

make --dry-run run_histos mc=distrs/v37_test13_bunchFULLFIT2_mc_1.root data=distrs/v37_test13_bunchFULLFIT2/SingleMuon.root lumi=35800 distr=Mt_lep_met_c out=histosels/v37_test13_bunchFULLFIT2/ wjets_norm=1.4 chan=mu_sel_ljout systematics="`cat syst-test.syst-list.parton_showers syst-test.syst-list.pdfs | tr '\n' ' '`" shape_opt="-x mu_selVloose_ljout"

python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc_1.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root -o histosels/v37_test13_bunchFULLFIT2_issue_w_TT_weights/ --data-nick data_other --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_c --wjet 1.4  -x mu_selVloose_ljout --sys NOMINAL
python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc_1.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root -o histosels/v37_test13_bunchFULLFIT2_issue_w_TT_weights/ --data-nick data_other --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_c --wjet 1.4  -x mu_selVloose_ljout --sys MfrUp
python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc_1.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root -o histosels/v37_test13_bunchFULLFIT2_issue_w_TT_weights/ --data-nick data_other --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_c --wjet 1.4  -x mu_selVloose_ljout --sys MfrDown



-- yeah! here the Vloose shape is used!

-- then if the Vloose and Medium variations are indeed different, is Vloose shape justified here?


and the main issue is in mc sums -- the variations are not even close to nominal, far from stat fluctuations

nom      = (TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL")
mfr_up   = (TH1D*) mu_sel_ljout->Get("sums_MfrUp/mc_sum1_MfrUp")
mfr_down = (TH1D*) mu_sel_ljout->Get("sums_MfrDown/mc_sum1_MfrDown")

mfr_up->SetLineColor(kRed)
mfr_down->SetLineColor(kRed+2)

nom      ->Draw()
mfr_up   ->Draw("same")
mfr_down ->Draw("same")

-- yep, they are off
   probably it is the missing QCD?

reproduce this issue and then remove QCD in nominal

python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc_1.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root -o histosels/v37_test13_bunchFULLFIT2_issue_w_TT_weights/ --data-nick data_other --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_c --wjet 1.4  -x mu_selVloose_ljout --sys NOMINAL --overwrite --qcd 1.05
python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc_1.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root -o histosels/v37_test13_bunchFULLFIT2_issue_w_TT_weights/ --data-nick data_other --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_c --wjet 1.4  -x mu_selVloose_ljout --sys NOMINAL --overwrite --skip-QCD
python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc_1.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root -o histosels/v37_test13_bunchFULLFIT2_issue_w_TT_weights/ --data-nick data_other --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_c --wjet 1.4  -x mu_selVloose_ljout --sys MfrUp   --overwrite --skip-QCD
python stack_plot.py distrs/v37_test13_bunchFULLFIT2_mc_1.root distrs/v37_test13_bunchFULLFIT2/SingleMuon.root -o histosels/v37_test13_bunchFULLFIT2_issue_w_TT_weights/ --data-nick data_other --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_c --wjet 1.4  -x mu_selVloose_ljout --sys MfrDown --overwrite --skip-QCD


hadd nom_w_data_qcd.root distrs,v37_test13_bunchFULLFIT2_mc_1_HISTOSEL_Mt_lep_met_c_mu_sel_ljout_NOMINAL_data-qcd_shape-mu_selVloose_ljout.root *Mfr*
hadd nom_w_no_qcd.root   distrs,v37_test13_bunchFULLFIT2_mc_1_HISTOSEL_Mt_lep_met_c_mu_sel_ljout_NOMINAL_shape-mu_selVloose_ljout.root          *Mfr*

root -l nom_w_data_qcd.root
-- exactly as in the fit

root -l nom_w_no_qcd.root
-- much better

mfr_up   ->Divide(nom)
mfr_down ->Divide(nom)

mfr_up   ->Draw()
mfr_down ->Draw("same")

-- yeah, all ok



## reproduce sys vars without QCD

histosel without QCD

mkdir histosels/v37_test13_bunchFULLFIT2_noqcd/

make run_std_histos_noqcd out=histosels/v37_test13_bunchFULLFIT2_noqcd/ wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/v37_test13_bunchFULLFIT2_mc_1.root data_mu=distrs/v37_test13_bunchFULLFIT2/SingleMuon.root data_el=distrs/v37_test13_bunchFULLFIT2/SingleElectron.root

hadd histosels/v37_test13_bunchFULLFIT2_noqcd.root histosels/v37_test13_bunchFULLFIT2_noqcd/*.root


make plot_sys_vars histosel_file=histosels/v37_test13_bunchFULLFIT2_noqcd.root outdir=plots/v37_test13_update1/sys-variations2/

also

make plot_sys_vars_tau_ID_misID mc=distrs/v37_test13_bunchFULLFIT2_mc.root data_mu=distrs/v37_test13_bunchFULLFIT2/SingleMuon.root data_el=distrs/v37_test13_bunchFULLFIT2/SingleElectron.root output=plots/v37_test13_update1/sys-variations2/


Mr, Mf and Mfr symmetric

JES OK, some jumps at 150-200GeV, similar to the data-mc disagreament
JER -- useless stat fluctuations
TES OK + stat fluctuations

LEPmu -- symmetric + a slight bent, not as the past



## check the LEPmu systematic vars

'LEPmuIDUp'   : lambda ev: ev.event_weight*ev.event_weight_LEPmuIDUp   ,
'LEPmuIDDown' : lambda ev: ev.event_weight*ev.event_weight_LEPmuIDDown ,
'LEPmuTRGUp'  : lambda ev: ev.event_weight*ev.event_weight_LEPmuTRGUp  ,
'LEPmuTRGDown': lambda ev: ev.event_weight*ev.event_weight_LEPmuTRGDown,

            event_weight_LEPmuIDUp[0]    = (weight_lep_pu_muIDUp    / weight_lep_pu) if weight_lep_pu > 0.0001 else 0.
            event_weight_LEPmuIDDown[0]  = (weight_lep_pu_muIDDown  / weight_lep_pu) if weight_lep_pu > 0.0001 else 0.
            event_weight_LEPmuTRGUp[0]   = (weight_lep_pu_muTRGUp   / weight_lep_pu) if weight_lep_pu > 0.0001 else 0.
            event_weight_LEPmuTRGDown[0] = (weight_lep_pu_muTRGDown / weight_lep_pu) if weight_lep_pu > 0.0001 else 0.

-- OK..


make --dry-run plot_sys_vars histosel_file=histosels/v37_test13_bunchFULLFIT2_noqcd.root outdir=plots/v37_test13_update1/sys-variations2/ | grep LEPmu

for sysdef in LEPmuIDUp,LEPmuIDDown LEPmuTRGUp,LEPmuTRGDown ; \
do \
python mc_per_sys.py --ratio-range 0.1 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_lj    -d Mt_lep_met_f -s $sysdef --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_lj_all_Mt_lep_met_f_$sysdef.png ; \
python mc_per_sys.py --ratio-range 0.1 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_ljout -d Mt_lep_met_f -s $sysdef --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_ljout_all_Mt_lep_met_f_$sysdef.png ; \
done


python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_lj    -d Mt_lep_met_f -s LEPmuIDUp,LEPmuIDDown   --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_lj_all_Mt_lep_met_f_LEPmuIDUp,LEPmuIDDown.png       --ratio-y-line 1.0
python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_ljout -d Mt_lep_met_f -s LEPmuIDUp,LEPmuIDDown   --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_ljout_all_Mt_lep_met_f_LEPmuIDUp,LEPmuIDDown.png    --ratio-y-line 1.0

python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_lj    -d Mt_lep_met_f -s LEPmuTRGUp,LEPmuTRGDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_lj_all_Mt_lep_met_f_LEPmuTRGUp,LEPmuTRGDown.png     --ratio-y-line 1.0
python mc_per_sys.py --ratio-range 0.05 --y-max 2500. histosels/v37_test13_bunchFULLFIT2_noqcd.root -c mu_sel_ljout -d Mt_lep_met_f -s LEPmuTRGUp,LEPmuTRGDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o plots/v37_test13_update1/sys-variations2/ --outname mu_sel_ljout_all_Mt_lep_met_f_LEPmuTRGUp,LEPmuTRGDown.png  --ratio-y-line 1.0


-- yeah, muTRG is asymmetric, especially at mu_sel_lj




# NEXT UPDATE

golden json electron channel
the b and jec reweighting in fsr, isr etc tt syst datasets
the ME weights for the acceptance -- no 3 separate parameters, use the largest variation only (the prescription of these systematics for the counting experiment)

les enquetes!

DY->tautau control region
-- not any DY tautau control region! Yuta asks for special, signal-like DY control region, with 3 jets!
   use 20GeV taus?

the muon tracking SF does not have the stat uncertainty -- TGRaph won't give it out easily and it is small, hence it is set to zero now

POSSIBLE PROBLEM: if there are 2 distinct data-taking periods and the SFs are averaged between them,
                  then all SFs must be averaged together, not separately:
                  E * SF_common * (r1 * SF1(A) * SF1(B) + r2 * SF2(A) * SF2(B))
                  -- it definitely appears in muon channel

meanwhile, let's try rising pT cut for dilepton control channels



## FINISHING:

the full fit in v37

DY with Same Sign and data-driven QCD

tt_elmu with all MC and Data


### full fit, check PU norm and launch histosel

saved:

        event_weight_PU[0]    = weight_pu
        event_weight_PU_per_epoch[0]    = ratio_bcdef*weight_pu_bcdef + ratio_gh*weight_pu_gh

-- should be correct, right?

event_weight_PU_per_epoch[0]

el_sel and mu_sel, with Vloose, in TT:

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 19 || selection_stage == 17)*event_weight_PU"                          --histo-range 5,0,5 --output v37_test13_PU_norm_el_sel_event_weight_PU_tt.root       --histo-name tt_el_sel_event_weight_PU       lstore_outdirs/v37/test13/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 19 || selection_stage == 17 || selection_stage == 15)*event_weight_PU" --histo-range 5,0,5 --output v37_test13_PU_norm_el_selVloose_event_weight_PU_tt.root --histo-name tt_el_selVloose_event_weight_PU lstore_outdirs/v37/test13/MC2016_Summer16_TTJets_powheg/*root     &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7)*event_weight_PU"                         --histo-range 5,0,5 --output v37_test13_PU_norm_mu_sel_event_weight_PU_tt.root       --histo-name tt_mu_sel_event_weight_PU       lstore_outdirs/v37/test13/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight_PU" --histo-range 5,0,5 --output v37_test13_PU_norm_mu_selVloose_event_weight_PU_tt.root --histo-name tt_mu_selVloose_event_weight_PU lstore_outdirs/v37/test13/MC2016_Summer16_TTJets_powheg/*root     &

new weights:

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 19 || selection_stage == 17)*event_weight_PU_per_epoch"                          --histo-range 5,0,5 --output v37_test13_PU_norm_el_sel_event_weight_PU_per_epoch_tt.root       --histo-name tt_el_sel_event_weight_PU_per_epoch       lstore_outdirs/v37/test13/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 19 || selection_stage == 17 || selection_stage == 15)*event_weight_PU_per_epoch" --histo-range 5,0,5 --output v37_test13_PU_norm_el_selVloose_event_weight_PU_per_epoch_tt.root --histo-name tt_el_selVloose_event_weight_PU_per_epoch lstore_outdirs/v37/test13/MC2016_Summer16_TTJets_powheg/*root     &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7)*event_weight_PU_per_epoch"                         --histo-range 5,0,5 --output v37_test13_PU_norm_mu_sel_event_weight_PU_per_epoch_tt.root       --histo-name tt_mu_sel_event_weight_PU_per_epoch       lstore_outdirs/v37/test13/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight_PU_per_epoch" --histo-range 5,0,5 --output v37_test13_PU_norm_mu_selVloose_event_weight_PU_per_epoch_tt.root --histo-name tt_mu_selVloose_event_weight_PU_per_epoch lstore_outdirs/v37/test13/MC2016_Summer16_TTJets_powheg/*root     &

in SingleTop:

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 19 || selection_stage == 17)*event_weight_PU"                          --histo-range 5,0,5 --output v37_test13_PU_norm_el_sel_event_weight_PU_singletop.root       --histo-name singletop_el_sel_event_weight_PU       lstore_outdirs/v37/test13/MC2016_Summer16_SingleT*/*root     &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 19 || selection_stage == 17 || selection_stage == 15)*event_weight_PU" --histo-range 5,0,5 --output v37_test13_PU_norm_el_selVloose_event_weight_PU_singletop.root --histo-name singletop_el_selVloose_event_weight_PU lstore_outdirs/v37/test13/MC2016_Summer16_SingleT*/*root     &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7)*event_weight_PU"                         --histo-range 5,0,5 --output v37_test13_PU_norm_mu_sel_event_weight_PU_singletop.root       --histo-name singletop_mu_sel_event_weight_PU       lstore_outdirs/v37/test13/MC2016_Summer16_SingleT*/*root     &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight_PU" --histo-range 5,0,5 --output v37_test13_PU_norm_mu_selVloose_event_weight_PU_singletop.root --histo-name singletop_mu_selVloose_event_weight_PU lstore_outdirs/v37/test13/MC2016_Summer16_SingleT*/*root     &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 19 || selection_stage == 17)*event_weight_PU_per_epoch"                          --histo-range 5,0,5 --output v37_test13_PU_norm_el_sel_event_weight_PU_per_epoch_singletop.root       --histo-name singletop_el_sel_event_weight_PU_per_epoch       lstore_outdirs/v37/test13/MC2016_Summer16_SingleT*/*root     &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 19 || selection_stage == 17 || selection_stage == 15)*event_weight_PU_per_epoch" --histo-range 5,0,5 --output v37_test13_PU_norm_el_selVloose_event_weight_PU_per_epoch_singletop.root --histo-name singletop_el_selVloose_event_weight_PU_per_epoch lstore_outdirs/v37/test13/MC2016_Summer16_SingleT*/*root     &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7)*event_weight_PU_per_epoch"                         --histo-range 5,0,5 --output v37_test13_PU_norm_mu_sel_event_weight_PU_per_epoch_singletop.root       --histo-name singletop_mu_sel_event_weight_PU_per_epoch       lstore_outdirs/v37/test13/MC2016_Summer16_SingleT*/*root     &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight_PU_per_epoch" --histo-range 5,0,5 --output v37_test13_PU_norm_mu_selVloose_event_weight_PU_per_epoch_singletop.root --histo-name singletop_mu_selVloose_event_weight_PU_per_epoch lstore_outdirs/v37/test13/MC2016_Summer16_SingleT*/*root     &

hadd v37_test13_PU_norm.root v37_test13_PU_norm_*root


correction ratios to the PU norm:

tt_el_sel_event_weight_PU        ->Integral() / tt_el_sel_event_weight_PU_per_epoch        ->Integral()
tt_el_selVloose_event_weight_PU  ->Integral() / tt_el_selVloose_event_weight_PU_per_epoch  ->Integral()
tt_mu_sel_event_weight_PU        ->Integral() / tt_mu_sel_event_weight_PU_per_epoch        ->Integral()
tt_mu_selVloose_event_weight_PU  ->Integral() / tt_mu_selVloose_event_weight_PU_per_epoch  ->Integral()

(double) 1.00005
(double) 1.00004
(double) 1.00004
(double) 1.00002

singletop_el_sel_event_weight_PU        ->Integral() / singletop_el_sel_event_weight_PU_per_epoch        ->Integral()
singletop_el_selVloose_event_weight_PU  ->Integral() / singletop_el_selVloose_event_weight_PU_per_epoch  ->Integral()
singletop_mu_sel_event_weight_PU        ->Integral() / singletop_mu_sel_event_weight_PU_per_epoch        ->Integral()
singletop_mu_selVloose_event_weight_PU  ->Integral() / singletop_mu_selVloose_event_weight_PU_per_epoch  ->Integral()

(double) 1.00005
(double) 1.00005
(double) 1.00005
(double) 1.00003

-- so all is cool already



get wjets factor!




the histosels

mkdir histosels/v37_test13_bunch1_fullfit1/

test

make run_histos out=histosels/v37_test13_bunch1_fullfit1/ wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root data_mu=distrs/v37_test13_bunchFULLFIT1/SingleMuon.root data_el=distrs/v37_test13_bunchFULLFIT1/SingleElectron.root

run:

make run_std_histos out=histosels/v37_test13_bunch1_fullfit1/ wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root data_mu=distrs/v37_test13_bunchFULLFIT1/SingleMuon.root data_el=distrs/v37_test13_bunchFULLFIT1/SingleElectron.root

hadd histosels/v37_test13_bunch1_fullfit1.root histosels/v37_test13_bunch1_fullfit1/*root
hadd histosels/v37_test13_bunch1_fullfit1_pufixed.root  histosels/v37_test13_bunch1_fullfit1/*root
hadd histosels/v37_test13_bunch1_fullfit1_pufixed2.root histosels/v37_test13_bunch1_fullfit1/*root
hadd histosels/v37_test13_bunch1_fullfit1_pufixed3.root histosels/v37_test13_bunch1_fullfit1/*root

isn't this PUUp too large?

INFO:root:data       =     6690.000000      245.655645
INFO:root:mc sum     =     7538.577809     7538.577809
INFO:root:mc sum unc =      262.191689      262.191689
INFO:root:mc sum unc =      262.191689      262.191689
INFO:root:saving root histosels/v37_test13_bunch1_fullfit1//distrs,v37_test13_bunchFULLFIT1_mc_1_wNjets_HISTOSEL_Mt_lep_met_c_el_sel_lj_PUUp_data-qcd_shape-el_selVloose_lj.root

datacard

python numbers_for_datacard.py histosels/v37_test13_bunch1_fullfit1.root -d Mt_lep_met_c -c el_sel_lj,el_sel_ljout --no-sums --data-nick data_other
python numbers_for_datacard.py histosels/v37_test13_bunch1_fullfit1.root -d Mt_lep_met_c -c mu_sel_lj,mu_sel_ljout --no-sums --data-nick data_other

-- no qcd_other/.../..qcd.. -- broken naming for data-driven qcd -- made temporary fix

bin           el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                       
rate          3287.703                 2409.503                 129.813                  188.205                  66.968                   15.402                   166.695                  23.573                   165.716                  0.964                    14.132                   176.062                  29.120                   121.251                  92.224                   
el_sel_lj/data_other/NOMINAL/el_sel_lj_data_other_NOMINAL_Mt_lep_met_c
obs 6690.000000
INFO:root:el_sel_ljout
bin           el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                       
rate          5050.191                 1578.317                 83.043                   298.770                  106.052                  35.088                   181.860                  31.621                   294.199                  1.895                    12.645                   217.598                  78.582                   220.103                  399.992                  
el_sel_ljout/data_other/NOMINAL/el_sel_ljout_data_other_NOMINAL_Mt_lep_met_c
obs 8414.000000

bin           mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          5024.145                 3672.965                 208.669                  280.097                  86.971                   22.458                   230.131                  34.987                   227.019                  0.000                    16.137                   238.209                  10.536                   192.531                  122.463                  
mu_sel_lj/data_other/NOMINAL/mu_sel_lj_data_other_NOMINAL_Mt_lep_met_c
obs 9831.000000
INFO:root:mu_sel_ljout
bin           mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          7677.854                 2442.821                 138.546                  449.153                  168.899                  55.389                   285.522                  51.646                   434.515                  0.000                    28.822                   355.412                  21.460                   388.489                  226.937                  
mu_sel_ljout/data_other/NOMINAL/mu_sel_ljout_data_other_NOMINAL_Mt_lep_met_c
obs 12855.000000



and fitting

make workspace datacard=ttxsec/datacard_v37_test13_1_el_qcdnaming

make impacts workspace=ttxsec/datacard_v37_test13_1_el_qcdnaming.root nn=el_v37_test13_1_qcdnaming

   r :    +1.028   -0.375/+0.116 (68%)

wow
insane PU

rescaled PU Up-Down and corrected el PU normalization for golden json:

python numbers_for_datacard.py histosels/v37_test13_bunch1_fullfit1_pufixed.root -d Mt_lep_met_c -c el_sel_lj,el_sel_ljout --no-sums --data-nick data_other
python numbers_for_datacard.py histosels/v37_test13_bunch1_fullfit1_pufixed.root -d Mt_lep_met_c -c mu_sel_lj,mu_sel_ljout --no-sums --data-nick data_other

make impacts workspace=ttxsec/datacard_v37_test13_1_el_qcdnaming.root nn=el_v37_test13_1_qcdnaming

   r :    +0.984   -0.291/+0.122 (68%)

-- damn....

make workspace datacard=ttxsec/datacard_v37_test13_1_el_qcdnaming_normalizedPU
make impacts  workspace=ttxsec/datacard_v37_test13_1_el_qcdnaming_normalizedPU.root nn=el_v37_test13_1_qcdnaming

   r :    +0.930   -0.082/+0.101 (68%)

-- very muon-like now

now el TRG is first, than qcd norm, then JES, finally tau ID...
...damn

qcd norm and JES are very asymmetric
qcd is pulled +1sigma
JES is -0.5sigma

el trig is also asymmetric, but not completely
it is pulled -0.5sigma

python new_impact_table.py --merge-pdf latest_impacts_el_v37_test13_1_qcdnaming.json

electron trigger efficiency  &  5.7 \\
        QCD normalization  &  5.0 \\
         jet energy scale  &  5.0 \\
$\tauh$ jet identification  &  4.6 \\
     b-tagging efficiency  &  4.5 \\
   electron ID efficiency  &  4.4 \\
       pileup uncertainty  &  2.9 \\
        top quark $p_{T}$  &  2.6 \\
$\tauh$ misidentification background  &  1.8 \\
 Single Top normalization  &  0.7 \\
     W+jets normalization  &  0.7 \\
    jet energy resolution  &  0.6 \\
         DY normalization  &  0.4 \\
     $\tauh$ Energy Scale  &  0.1 \\
   Dibosons normalization  &  0.0 \\
               Luminosity  &  0.0 \\
          b fragmentation  &  2.1 \\
  initial state radiation  &  1.8 \\
  final   state radiation  &  1.5 \\
 ME Renormalization scale  &  0.7 \\
underlying event (Pythia tune)  &  0.6 \\
ME combined scale variation  &  0.5 \\
   ME Factorization scale  &  0.3 \\
   ME-PS matching (hdamp)  &  0.2 \\
semi-leptonic b-hadron BRs  &  0.0 \\
                      PDF  &  1.3 \\
            MC statistics  &  2.9 \\

-- at least MC stats are not too bad

probably qcd just follows the other two

plot the variations

and NLL

make nll  workspace=ttxsec/datacard_v37_test13_1_el_qcdnaming_normalizedPU.root nn=el_v37_test13_1_qcdnaming

-- smooth

covariances?




### the problematic variations: el trigger and JES

muons just in case:

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleMuon.root     -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c mu_sel_lj    -x mu_selVloose_lj     --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleMuon.root     -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c mu_sel_ljout -x mu_selVloose_ljout --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05

electrons:

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_lj    -x el_selVloose_lj    --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05 --sys LEPelTRGUp
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_ljout -x el_selVloose_ljout --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05 --sys LEPelTRGUp

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_lj    -x el_selVloose_lj    --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05 --sys LEPelTRGDown
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_ljout -x el_selVloose_ljout --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05 --sys LEPelTRGDown

-- trg down does not change anything, trg up does add more MC
   but the variation is not that large

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_lj    -x el_selVloose_lj    --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05 --sys JESUp
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_ljout -x el_selVloose_ljout --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05 --sys JESUp

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_lj    -x el_selVloose_lj    --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05 --sys JESDown
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_ljout -x el_selVloose_ljout --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05 --sys JESDown

-- same, down does not change anything, up adds more MC
   the variation is not that large either

???
But it does explain the asymmetry in the fit.

So, the question is why Down variation does not show up in the plots?
Or is the Up variation too large and Down is just too small?


effect of trg and jes

LEPelTRG

'LEPelTRGUp'  : lambda ev: ev.event_weight*ev.event_weight_LEPelTRGUp  ,
'LEPelTRGDown': lambda ev: ev.event_weight*ev.event_weight_LEPelTRGDown,

JES:

'JESUp'  :  lambda ev: ev.selection_stage_JESUp  ,
'JESUp'  :  lambda ev: ev.event_weight,
'JESUp'    : lambda ev: ev.event_met_lep_mt_JESUp,


the calculation of el trg down looks ok

python sumup_ttree_draw.py "event_weight_LEPelTRGDown * event_weight_LEP_PU" --ttree ttree_out --cond-com "event_weight_LEP_PU > 0. && (selection_stage == 19 || selection_stage == 17 || selection_stage == 15)" --histo-range 100,0.,2. --output v37_test13_elTRGissue_el_selVloose_event_weight_LEPelTRGDown_per_event_weight_LEP_PU_tt.root --histo-name tt_el_selVloose_event_weight_LEPelTRGDown_per_event_weight_LEP_PU lstore_outdirs/v37/test13/MC2016_Summer16_TT*/*root   &
python sumup_ttree_draw.py "event_weight_LEPelTRGUp * event_weight_LEP_PU"   --ttree ttree_out --cond-com "event_weight_LEP_PU > 0. && (selection_stage == 19 || selection_stage == 17 || selection_stage == 15)" --histo-range 100,0.,2. --output v37_test13_elTRGissue_el_selVloose_event_weight_LEPelTRGUp_per_event_weight_LEP_PU_tt.root   --histo-name tt_el_selVloose_event_weight_LEPelTRGUp_per_event_weight_LEP_PU   lstore_outdirs/v37/test13/MC2016_Summer16_TT*/*root   &
python sumup_ttree_draw.py "event_weight_LEP_PU"                           --ttree ttree_out --cond-com "event_weight_LEP_PU > 0. && (selection_stage == 19 || selection_stage == 17 || selection_stage == 15)" --histo-range 100,0.,2. --output v37_test13_elTRGissue_el_selVloose_event_weight_LEP_PU_tt.root                                 --histo-name tt_el_selVloose_event_weight_LEP_PU                               lstore_outdirs/v37/test13/MC2016_Summer16_TT*/*root   &

hadd v37_test13_elTRGissue.root v37_test13_elTRGissue_el_selVloose_event_weight_LEPelTRGDown_per_event_weight_LEP_PU_tt.root v37_test13_elTRGissue_el_selVloose_event_weight_LEPelTRGUp_per_event_weight_LEP_PU_tt.root v37_test13_elTRGissue_el_selVloose_event_weight_LEP_PU_tt.root

root -l v37_test13_elTRGissue.root

tt_el_selVloose_event_weight_LEP_PU->SetLineColor(kRed)
tt_el_selVloose_event_weight_LEPelTRGUp_per_event_weight_LEP_PU->SetLineColor(kGreen)

tt_el_selVloose_event_weight_LEP_PU->Draw("hist")
tt_el_selVloose_event_weight_LEPelTRGUp_per_event_weight_LEP_PU->Draw("same hist")
tt_el_selVloose_event_weight_LEPelTRGDown_per_event_weight_LEP_PU->Draw("same hist")

tt_el_selVloose_event_weight_LEP_PU->GetMean()
tt_el_selVloose_event_weight_LEPelTRGUp_per_event_weight_LEP_PU->GetMean()
tt_el_selVloose_event_weight_LEPelTRGDown_per_event_weight_LEP_PU->GetMean()

0.953670
0.977181
0.930158

-- they look reasonable
   and the Integral variation is 2.5%

does QCD absorb all this Down variation?




confirm the MC changes acordingly in signal tt:

el_sel_lj->Get("tt_eltau/NOMINAL/el_sel_lj_tt_eltau_NOMINAL_Mt_lep_met_c")->Print()
el_sel_lj->Get("tt_eltau/LEPelTRGUp/el_sel_lj_tt_eltau_LEPelTRGUp_Mt_lep_met_c")->Print()
el_sel_lj->Get("tt_eltau/LEPelTRGDown/el_sel_lj_tt_eltau_LEPelTRGDown_Mt_lep_met_c")->Print()

TH1.Print Name  = el_sel_lj_tt_eltau_NOMINAL_Mt_lep_met_c, Entries= 13124, Total sum= 3343.41
TH1.Print Name  = el_sel_lj_tt_eltau_LEPelTRGUp_Mt_lep_met_c, Entries= 13124, Total sum= 3425.99
TH1.Print Name  = el_sel_lj_tt_eltau_LEPelTRGDown_Mt_lep_met_c, Entries= 13124, Total sum= 3260.84

3425.99 / 3343.41
3260.84 / 3343.41

1.0246993339135793
0.9753036570447537

-- perfect





impacts with no JES and el TRG for QCD

-- rehistosel with only NOMINAL QCD
no need for all this!
"""
make run_std_histos out=histosels/v37_test13_bunch1_fullfit1/ wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root data_mu=distrs/v37_test13_bunchFULLFIT1/SingleMuon.root data_el=distrs/v37_test13_bunchFULLFIT1/SingleElectron.root
cp ttxsec/datacard_v37_test13_1_el_qcdnaming_normalizedPU.txt ttxsec/datacard_v37_test13_1_el_normalizedPU_nomQCD.txt
make workspace datacard=ttxsec/datacard_v37_test13_1_el_normalizedPU_nomQCD
make impacts  workspace=ttxsec/datacard_v37_test13_1_el_normalizedPU_nomQCD.root nn=el_v37_test13_1_qcdnaming_NOMQCD
"""

just block the systematics for QCD process

make workspace datacard=ttxsec/datacard_v37_test13_1_el_qcdnaming_normalizedPU_qcdNOM
make impacts  workspace=ttxsec/datacard_v37_test13_1_el_qcdnaming_normalizedPU_qcdNOM.root nn=el_v37_test13_1_qcdnaming_qcdNOM

   r :    +0.914   -0.079/+0.086 (68%)

-- uncertainties are much smaller, but so is the signal..?

-- looks ok, but
   PU is second largest systematic
   tau fakes are way below and asymmetric

check PU variation

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_lj    -x el_selVloose_lj    --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05 --sys PUUp
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_ljout -x el_selVloose_ljout --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05 --sys PUUp

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_lj    -x el_selVloose_lj    --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05 --sys PUDown
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_ljout -x el_selVloose_ljout --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05 --sys PUDown

eog plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/distrs,v37_test13_bunchFULLFIT1_mc_1_wNjets_distrs,v37_test13_bunchFULLFIT1,SingleElectron_Mt_lep_met_c_el_sel_lj_NOMINAL_stack_ratio_x_el_selVloose_lj_dataqcd.png plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/distrs,v37_test13_bunchFULLFIT1_mc_1_wNjets_distrs,v37_test13_bunchFULLFIT1,SingleElectron_Mt_lep_met_c_el_sel_ljout_NOMINAL_stack_ratio_x_el_selVloose_ljout_dataqcd.png &
eog plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/*PU* &

-- PU down no effect, PU up significant effect due to data-driven qcd...

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_lj    -x el_selVloose_lj    --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001  --ratio-range 0.2
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_ljout -x el_selVloose_ljout --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001  --ratio-range 0.2

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_lj    -x el_selVloose_lj    --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001 --sys PUUp  --ratio-range 0.2
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_ljout -x el_selVloose_ljout --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001 --sys PUUp  --ratio-range 0.2

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_lj    -x el_selVloose_lj    --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001 --sys PUDown  --ratio-range 0.2
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_ljout -x el_selVloose_ljout --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001 --sys PUDown  --ratio-range 0.2

eog plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/distrs,v37_test13_bunchFULLFIT1_mc_1_wNjets_distrs,v37_test13_bunchFULLFIT1,SingleElectron_Mt_lep_met_c_el_sel_lj_NOMINAL_stack_ratio_x_el_selVloose_lj.png plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/distrs,v37_test13_bunchFULLFIT1_mc_1_wNjets_distrs,v37_test13_bunchFULLFIT1,SingleElectron_Mt_lep_met_c_el_sel_ljout_NOMINAL_stack_ratio_x_el_selVloose_ljout.png &
eog plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/*PU*lj.png plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/*PU*ljout.png

-- anyway PUUp has larger effect, especially in signal, at large mT
   and on its' own it does not improve the shape

normalizations:

el_sel_lj_NOMINAL
INFO:root:data       =     6690.000000      245.655645
INFO:root:mc sum     =     6843.599315     6843.599315

el_sel_lj_PUUp
INFO:root:data       =     6690.000000      245.655645
INFO:root:mc sum     =     6983.795919     6983.795919

el_sel_lj_PUDown
INFO:root:data       =     6690.000000      245.655645
INFO:root:mc sum     =     6709.152111     6709.152111


el_sel_ljout_NOMINAL
INFO:root:data       =     8414.000000      281.672210
INFO:root:mc sum     =     8247.864327     8247.864327

el_sel_ljout_PUUp
INFO:root:data       =     8414.000000      281.672210
INFO:root:mc sum     =     8434.038310     8434.038310

el_sel_ljout_PUDown
INFO:root:data       =     8414.000000      281.672210
INFO:root:mc sum     =     8097.136922     8097.136922

-- kind of consistent

compare shapes

python mc_per_sys.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root --no-data -p tt_eltau -c el_sel_lj    -d Mt_lep_met_c -s PUUp,PUDown --y-range 0.,0.03
python mc_per_sys.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root --no-data -p tt_eltau -c el_sel_ljout -d Mt_lep_met_c -s PUUp,PUDown --y-range 0.,0.03

-- looks ok

python mc_per_sys.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root --no-data -p tt_lj -c el_sel_lj    -d Mt_lep_met_c -s PUUp,PUDown --y-range 0.,0.03
python mc_per_sys.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root --no-data -p tt_lj -c el_sel_ljout -d Mt_lep_met_c -s PUUp,PUDown --y-range 0.,0.03

-- also ok

el_sel_lj->Get("sums_NOMINAL")

compare sums:

python mc_per_sys.py histosels/v37_test13_bunch1_fullfit1_pufixed2_nominalqcd.root --no-data -c el_sel_lj    -d Mt_lep_met_c -s PUUp,PUDown --y-range 0.,1600.
python mc_per_sys.py histosels/v37_test13_bunch1_fullfit1_pufixed2_nominalqcd.root --no-data -c el_sel_ljout -d Mt_lep_met_c -s PUUp,PUDown --y-range 0.,1600.

-- nom qcd VS no qcd in pu vars?

mkdir plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue/

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue/ -c el_sel_lj    -x el_selVloose_lj    --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue/ -c el_sel_ljout -x el_selVloose_ljout --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue/ -c el_sel_lj    -x el_selVloose_lj    --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001 --sys PUUp
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue/ -c el_sel_ljout -x el_selVloose_ljout --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001 --sys PUUp

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue/ -c el_sel_lj    -x el_selVloose_lj    --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001 --sys PUDown
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue/ -c el_sel_ljout -x el_selVloose_ljout --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001 --sys PUDown

hadd plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue/pu_vars_with_no_qcd.root  plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue/*root

python mc_per_sys.py plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue/pu_vars_with_no_qcd.root --no-data -c el_sel_lj    -d Mt_lep_met_c -s PUUp,PUDown
python mc_per_sys.py plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue/pu_vars_with_no_qcd.root --no-data -c el_sel_ljout -d Mt_lep_met_c -s PUUp,PUDown

-- in one bin both variations go in the same dirrection from nominal, but otherwise ok
   how come the visible difference then? the plots have 10% difference in bins 100-150 of lj
   the Vloose shape?

eog plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/distrs,v37_test13_bunchFULLFIT1_mc_1_wNjets_distrs,v37_test13_bunchFULLFIT1,SingleElectron_Mt_lep_met_c_el_sel_lj_NOMINAL_stack_ratio_x_el_selVloose_lj.png &
eog plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/*PU*lj.png

root -l plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue/pu_vars_with_no_qcd.root

el_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL")->Print()
el_sel_ljout->Get("sums_PUUp/mc_sum1_PUUp")->Print()
el_sel_ljout->Get("sums_PUDown/mc_sum1_PUDown")->Print()

TH1.Print Name  = mc_sum1_NOMINAL, Entries= 52537, Total sum= 8247.86
TH1.Print Name  = mc_sum1_PUUp, Entries= 52537, Total sum= 8434.04
TH1.Print Name  = mc_sum1_PUDown, Entries= 52537, Total sum= 8097.14

-- all ok

((TH1D*) el_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL")) ->GetBinContent(((TH1D*) el_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL")) ->FindBin(120))
((TH1D*) el_sel_ljout->Get("sums_PUUp/mc_sum1_PUUp")      ) ->GetBinContent(((TH1D*) el_sel_ljout->Get("sums_PUUp/mc_sum1_PUUp")      ) ->FindBin(120))
((TH1D*) el_sel_ljout->Get("sums_PUDown/mc_sum1_PUDown")  ) ->GetBinContent(((TH1D*) el_sel_ljout->Get("sums_PUDown/mc_sum1_PUDown")  ) ->FindBin(120))

(Double_t) 1269.99
(Double_t) 1325.57
(Double_t) 1242.32

-- indeed a shape difference

1325.57 / 1269.99
1.0437641241269615

((TH1D*) el_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL")) ->GetBinContent(((TH1D*) el_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL")) ->FindBin(140))
((TH1D*) el_sel_ljout->Get("sums_PUUp/mc_sum1_PUUp")      ) ->GetBinContent(((TH1D*) el_sel_ljout->Get("sums_PUUp/mc_sum1_PUUp")      ) ->FindBin(140))
((TH1D*) el_sel_ljout->Get("sums_PUDown/mc_sum1_PUDown")  ) ->GetBinContent(((TH1D*) el_sel_ljout->Get("sums_PUDown/mc_sum1_PUDown")  ) ->FindBin(140))

(Double_t) 686.530
(Double_t) 719.250
(Double_t) 673.606

719.250 / 686.530
1.0476599711593084

-- but it is not 10%

need to compare to old PU vars

python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root --no-data -c el_sel_lj    -d Mt_lep_met_c -s PUUp,PUDown --y-range 0.,1600.
python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root --no-data -c el_sel_ljout -d Mt_lep_met_c -s PUUp,PUDown --y-range 0.,1600.

eog .//MC-systs_histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root_el_sel_lj_None_Mt_lep_met_c_PUUp,PUDown.png .//MC-systs_histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root_el_sel_ljout_None_Mt_lep_met_c_PUUp,PUDown.png

-- much smaller variation overall
   not sure which qcd is here

check yields:

root -l histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root

el_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL")->Print()
el_sel_ljout->Get("sums_PUUp/mc_sum1_PUUp")->Print()
el_sel_ljout->Get("sums_PUDown/mc_sum1_PUDown")->Print()

el_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL")->Print()
el_sel_lj->Get("sums_PUUp/mc_sum1_PUUp")->Print()
el_sel_lj->Get("sums_PUDown/mc_sum1_PUDown")->Print()

TH1.Print Name  = mc_sum1_NOMINAL, Entries= 55613, Total sum= 7980.71
TH1.Print Name  = mc_sum1_PUUp, Entries= 55588, Total sum= 8074.58
TH1.Print Name  = mc_sum1_PUDown, Entries= 55643, Total sum= 7871.36

TH1.Print Name  = mc_sum1_NOMINAL, Entries= 47966, Total sum= 6383.36
TH1.Print Name  = mc_sum1_PUUp, Entries= 47953, Total sum= 6456.15
TH1.Print Name  = mc_sum1_PUDown, Entries= 47982, Total sum= 6294.47

8074.58 / 7980.71
7871.36 / 7980.71

6456.15 / 6383.36
6294.47 / 6383.36

(double) 1.01176
(double) 0.986298

(double) 1.01140
(double) 0.986075

less than 2% deviation in norm

without possible contribution of QCD:
let's compare signal only

root -l histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root

el_sel_ljout->Get("tt_eltau/NOMINAL")->ls()

el_sel_ljout->Get("tt_eltau/NOMINAL/el_sel_ljout_tt_eltau_NOMINAL_Mt_lep_met_f")->Print()
el_sel_ljout->Get("tt_eltau/PUUp/el_sel_ljout_tt_eltau_PUUp_Mt_lep_met_f")->Print()
el_sel_ljout->Get("tt_eltau/PUDown/el_sel_ljout_tt_eltau_PUDown_Mt_lep_met_f")->Print()

el_sel_lj->Get("tt_eltau/NOMINAL/el_sel_lj_tt_eltau_NOMINAL_Mt_lep_met_f")->Print()
el_sel_lj->Get("tt_eltau/PUUp/el_sel_lj_tt_eltau_PUUp_Mt_lep_met_f")->Print()
el_sel_lj->Get("tt_eltau/PUDown/el_sel_lj_tt_eltau_PUDown_Mt_lep_met_f")->Print()

TH1.Print Name  = el_sel_ljout_tt_eltau_NOMINAL_Mt_lep_met_f, Entries= 21282, Total sum= 4691.49
TH1.Print Name  = el_sel_ljout_tt_eltau_PUUp_Mt_lep_met_f, Entries= 21282, Total sum= 4748.38
TH1.Print Name  = el_sel_ljout_tt_eltau_PUDown_Mt_lep_met_f, Entries= 21282, Total sum= 4620.67

TH1.Print Name  = el_sel_lj_tt_eltau_NOMINAL_Mt_lep_met_f, Entries= 13403, Total sum= 3009.63
TH1.Print Name  = el_sel_lj_tt_eltau_PUUp_Mt_lep_met_f, Entries= 13403, Total sum= 3054.96
TH1.Print Name  = el_sel_lj_tt_eltau_PUDown_Mt_lep_met_f, Entries= 13403, Total sum= 2955.45

3054.96 / 3009.63
2955.45 / 3009.63

4748.38 / 4691.49
4620.67 / 4691.49

1.0150616520967692
0.981997787103398

1.0121262115021028
0.9849045825526646


and now:

root -l histosels/v37_test13_bunch1_fullfit1_pufixed2_nominalqcd.root

el_sel_ljout->Get("tt_eltau/NOMINAL/el_sel_ljout_tt_eltau_NOMINAL_Mt_lep_met_c")->Print()
el_sel_ljout->Get("tt_eltau/PUUp/el_sel_ljout_tt_eltau_PUUp_Mt_lep_met_c")->Print()
el_sel_ljout->Get("tt_eltau/PUDown/el_sel_ljout_tt_eltau_PUDown_Mt_lep_met_c")->Print()

el_sel_lj->Get("tt_eltau/NOMINAL/el_sel_lj_tt_eltau_NOMINAL_Mt_lep_met_c")->Print()
el_sel_lj->Get("tt_eltau/PUUp/el_sel_lj_tt_eltau_PUUp_Mt_lep_met_c")->Print()
el_sel_lj->Get("tt_eltau/PUDown/el_sel_lj_tt_eltau_PUDown_Mt_lep_met_c")->Print()

TH1.Print Name  = el_sel_ljout_tt_eltau_NOMINAL_Mt_lep_met_c, Entries= 20649, Total sum= 5135.77
TH1.Print Name  = el_sel_ljout_tt_eltau_PUUp_Mt_lep_met_c, Entries= 20649, Total sum= 5194.84
TH1.Print Name  = el_sel_ljout_tt_eltau_PUDown_Mt_lep_met_c, Entries= 20649, Total sum= 5040.33

TH1.Print Name  = el_sel_lj_tt_eltau_NOMINAL_Mt_lep_met_c, Entries= 13124, Total sum= 3343.41
TH1.Print Name  = el_sel_lj_tt_eltau_PUUp_Mt_lep_met_c, Entries= 13124, Total sum= 3373.04
TH1.Print Name  = el_sel_lj_tt_eltau_PUDown_Mt_lep_met_c, Entries= 13124, Total sum= 3275.5

5194.84 / 5135.77
5040.33 / 5135.77

3373.04 / 3343.41
3275.5  / 3343.41

1.011501683291892
0.9814166132829156

1.0088622095405588
0.9796884019608724

-- so it is normalized after all

and the shapes:

python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -r --no-data -c el_sel_lj    -p tt_eltau -d Mt_lep_met_f -s PUUp,PUDown --y-range 0.,800.
python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -r --no-data -c el_sel_ljout -p tt_eltau -d Mt_lep_met_f -s PUUp,PUDown --y-range 0.,800.

eog .//MC-systs_histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root_el_sel_lj_tt_eltau_Mt_lep_met_f_PUUp,PUDown.png .//MC-systs_histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root_el_sel_ljout_tt_eltau_Mt_lep_met_f_PUUp,PUDown.png

python mc_per_sys.py histosels/v37_test13_bunch1_fullfit1_pufixed2_nominalqcd.root -r --no-data -c el_sel_lj    -p tt_eltau -d Mt_lep_met_c -s PUUp,PUDown --y-range 0.,800.
python mc_per_sys.py histosels/v37_test13_bunch1_fullfit1_pufixed2_nominalqcd.root -r --no-data -c el_sel_ljout -p tt_eltau -d Mt_lep_met_c -s PUUp,PUDown --y-range 0.,800.

eog .//MC-systs_histosels/v37_test13_bunch1_fullfit1_pufixed2_nominalqcd.root_el_sel_lj_tt_eltau_Mt_lep_met_c_PUUp,PUDown.png .//MC-systs_histosels/v37_test13_bunch1_fullfit1_pufixed2_nominalqcd.root_el_sel_ljout_tt_eltau_Mt_lep_met_c_PUUp,PUDown.png

-- it was within stat uncertainties,
   now PUUp is weird bin-by-bin, especially at high mT







try the latest histosel? -- if any PU corrections changed?

v37_test13_bunch1_fullfit1_pufixed2_nominalqcd.root

make workspace datacard=ttxsec/datacard_v37_test13_bunch1_fullfit1_pufixed2_nominalqcd
-- passed ok without changes, PU correction (at least nominal) is the same

make impacts  workspace=ttxsec/datacard_v37_test13_bunch1_fullfit1_pufixed2_nominalqcd.root nn=el_v37_test13_1_qcdnaming_qcdNOM

   r :    +0.920   -0.078/+0.085 (68%)

-- slightly shifted? but still close to before
   and PU is 3rd after TOPPT

returned PU 1sigma to 1.0 variation

   r :    +0.965   -0.277/+0.087 (68%)

and magic is back

PU is shifted to -0.5sigma (where it should be)
and varied from -1 to +2





if PUUp is corrected to something normal, than it should be ok



what's with PUUp shape?

python mc_per_sys.py plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue/pu_vars_with_no_qcd.root -r --no-data -c el_sel_lj    -d Mt_lep_met_c -s PUUp,PUDown
python mc_per_sys.py plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue/pu_vars_with_no_qcd.root -r --no-data -c el_sel_ljout -d Mt_lep_met_c -s PUUp,PUDown

eog .//MC-systs_plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue/pu_vars_with_no_qcd.root_el_sel_lj_None_Mt_lep_met_c_PUUp,PUDown.png .//MC-systs_plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue/pu_vars_with_no_qcd.root_el_sel_ljout_None_Mt_lep_met_c_PUUp,PUDown.png

-- this is worse than the process in histosel

python mc_per_sys.py plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue/pu_vars_with_no_qcd.root -r --no-data -c el_sel_lj    -p tt_eltau -d Mt_lep_met_c -s PUUp,PUDown
python mc_per_sys.py plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue/pu_vars_with_no_qcd.root -r --no-data -c el_sel_ljout -p tt_eltau -d Mt_lep_met_c -s PUUp,PUDown

eog .//MC-systs_plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue/pu_vars_with_no_qcd.root_el_sel_lj_tt_eltau_Mt_lep_met_c_PUUp,PUDown.png .//MC-systs_plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue/pu_vars_with_no_qcd.root_el_sel_ljout_tt_eltau_Mt_lep_met_c_PUUp,PUDown.png

-- same

so, whu PUUp changes the shape so much, even in the signal process?

without the shape corrections:

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/ -c el_sel_lj     --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/ -c el_sel_ljout  --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/ -c el_sel_lj     --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001 --sys PUUp
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/ -c el_sel_ljout  --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001 --sys PUUp

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/ -c el_sel_lj     --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001 --sys PUDown
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/ -c el_sel_ljout  --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001 --sys PUDown

hadd plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/pu_vars_with_no_qcd_no_shape_cor.root plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor//distrs,*.root

python mc_per_sys.py plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/pu_vars_with_no_qcd_no_shape_cor.root -r --no-data -c el_sel_lj    -p tt_eltau -d Mt_lep_met_c -s PUUp,PUDown
python mc_per_sys.py plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/pu_vars_with_no_qcd_no_shape_cor.root -r --no-data -c el_sel_ljout -p tt_eltau -d Mt_lep_met_c -s PUUp,PUDown

eog .//MC-systs_plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/pu_vars_with_no_qcd_no_shape_cor.root_el_sel_ljout_tt_eltau_Mt_lep_met_c_PUUp,PUDown.png .//MC-systs_plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/pu_vars_with_no_qcd_no_shape_cor.root_el_sel_lj_tt_eltau_Mt_lep_met_c_PUUp,PUDown.png

-- same crap


in Vloose

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/ -c el_selVloose_lj     --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/ -c el_selVloose_ljout  --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001
                                                                                                                                                                                                                   Vloose
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/ -c el_selVloose_lj     --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001 --sys PUUp
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/ -c el_selVloose_ljout  --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001 --sys PUUp
                                                                                                                                                                                                                   Vloose
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/ -c el_selVloose_lj     --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001 --sys PUDown
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/ -c el_selVloose_ljout  --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 0.0001 --sys PUDown

python mc_per_sys.py plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/pu_vars_with_no_qcd_no_shape_cor.root -r --no-data -c el_selVloose_lj    -p tt_eltau -d Mt_lep_met_c -s PUUp,PUDown
python mc_per_sys.py plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/pu_vars_with_no_qcd_no_shape_cor.root -r --no-data -c el_selVloose_ljout -p tt_eltau -d Mt_lep_met_c -s PUUp,PUDown

eog .//MC-systs_plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/pu_vars_with_no_qcd_no_shape_cor.root_el_selVloose_lj_tt_eltau_Mt_lep_met_c_PUUp,PUDown.png .//MC-systs_plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/large_pu_impact_issue_noshapecor/pu_vars_with_no_qcd_no_shape_cor.root_el_selVloose_ljout_tt_eltau_Mt_lep_met_c_PUUp,PUDown.png

-- same crap, maybe slightly better then in main sel

distrs of PU Up and Down:

python sumup_ttree_draw.py "event_weight_PUUp   * event_weight_LEP_PU" --ttree ttree_out --cond-com "event_weight_LEP_PU > 0. && (selection_stage == 19 || selection_stage == 17 || selection_stage == 15)" --histo-range 100,0.,2. --output v37_test13_elPUUpissue_el_selVloose_event_weight_PUUp_per_LEP_PU_tt.root     --histo-name tt_el_selVloose_event_weight_PUUp    lstore_outdirs/v37/test13/MC2016_Summer16_TT*/*root   &
python sumup_ttree_draw.py "event_weight_PUDown * event_weight_LEP_PU" --ttree ttree_out --cond-com "event_weight_LEP_PU > 0. && (selection_stage == 19 || selection_stage == 17 || selection_stage == 15)" --histo-range 100,0.,2. --output v37_test13_elPUUpissue_el_selVloose_event_weight_PUDown_per_LEP_PU_tt.root   --histo-name tt_el_selVloose_event_weight_PUDown  lstore_outdirs/v37/test13/MC2016_Summer16_TT*/*root   &
python sumup_ttree_draw.py "event_weight_LEP_PU"                       --ttree ttree_out --cond-com "event_weight_LEP_PU > 0. && (selection_stage == 19 || selection_stage == 17 || selection_stage == 15)" --histo-range 100,0.,2. --output v37_test13_elPUUpissue_el_selVloose_event_weight_LEP_PU_tt.root              --histo-name tt_el_selVloose_event_weight_LEP_PU  lstore_outdirs/v37/test13/MC2016_Summer16_TT*/*root   &

hadd v37_test13_elPUUpissue_el_selVloose.root v37_test13_elPUUpissue_el_selVloose_event_weig*root

root -l v37_test13_elPUUpissue_el_selVloose.root

tt_el_selVloose_event_weight_LEP_PU->SetLineColor(kRed)
tt_el_selVloose_event_weight_PUDown->SetLineColor(kGreen)

tt_el_selVloose_event_weight_LEP_PU->Draw("hist")
tt_el_selVloose_event_weight_PUDown->Draw("hist same")
tt_el_selVloose_event_weight_PUUp  ->Draw("hist same")

PU Down looks weird
PU Up is kind of ok

tt_el_selVloose_event_weight_LEP_PU->GetMean()
tt_el_selVloose_event_weight_PUDown->GetMean()
tt_el_selVloose_event_weight_PUUp  ->GetMean()

(Double_t) 0.953670
(Double_t) 0.960277
(Double_t) 0.947078

wait!
in drawing def-s:

'PUUp'   : lambda ev: ev.event_weight*ev.event_weight_PUUp    / ev.event_weight_PU  if ev.event_weight_PU  > 0. else 0.,
'PUDown' : lambda ev: ev.event_weight*ev.event_weight_PUDown  / ev.event_weight_PU  if ev.event_weight_PU  > 0. else 0.,

when leptons are:

'LEPelIDUp'   : lambda ev: ev.event_weight*ev.event_weight_LEPelIDUp   ,
'LEPelIDDown' : lambda ev: ev.event_weight*ev.event_weight_LEPelIDDown ,

-- damn!
   rebunch

check shapes

python mc_per_sys.py distrs/v37_test13_bunchFULLFIT2_mc_1.root -r --no-data -c el_sel_lj    -p tt_eltau -d Mt_lep_met_c -s PUUp,PUDown
python mc_per_sys.py distrs/v37_test13_bunchFULLFIT2_mc_1.root -r --no-data -c el_sel_ljout -p tt_eltau -d Mt_lep_met_c -s PUUp,PUDown

eog .//MC-systs_distrs/v37_test13_bunchFULLFIT2_mc_1.root_el_sel_lj_tt_eltau_Mt_lep_met_c_PUUp,PUDown.png .//MC-systs_distrs/v37_test13_bunchFULLFIT2_mc_1.root_el_sel_ljout_tt_eltau_Mt_lep_met_c_PUUp,PUDown.png

-- looks perfect (without the norm corrections!)

make histosels with dd qcd
corrected the list of systematics in the Makefile

make run_std_histos out=histosels/v37_test13_bunchFULLFIT2/ wjets_norm=1.4 lumi_mu=35800 lumi_el=35800 mc=distrs/v37_test13_bunchFULLFIT2_mc_1.root data_mu=distrs/v37_test13_bunchFULLFIT2/SingleMuon.root data_el=distrs/v37_test13_bunchFULLFIT2/SingleElectron.root


python numbers_for_datacard.py histosels/v37_test13_bunchFULLFIT2.root -d Mt_lep_met_c -c el_sel_lj,el_sel_ljout --no-sums --data-nick data_other
python numbers_for_datacard.py histosels/v37_test13_bunchFULLFIT2.root -d Mt_lep_met_c -c mu_sel_lj,mu_sel_ljout --no-sums --data-nick data_other

bin           el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                el_sel_lj                
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                       
rate          3343.413                 2450.332                 132.013                  191.394                  68.102                   15.663                   169.520                  23.972                   168.524                  0.981                    14.372                   179.046                  29.613                   123.305                  71.244                   
el_sel_lj/data_other/NOMINAL/el_sel_lj_data_other_NOMINAL_Mt_lep_met_c
obs 6690.000000
INFO:root:el_sel_ljout
bin           el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             el_sel_ljout             
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_eltau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       13                       14                       15                       16                       17                       18                       
rate          5135.765                 1605.061                 84.450                   303.832                  107.849                  35.683                   184.941                  32.157                   299.184                  1.928                    12.859                   221.285                  79.913                   223.832                  378.588                  
el_sel_ljout/data_other/NOMINAL/el_sel_ljout_data_other_NOMINAL_Mt_lep_met_c
obs 8414.000000

bin           mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                mu_sel_lj                
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          5024.145                 3672.965                 208.669                  280.097                  86.971                   22.458                   230.131                  34.987                   227.019                  0.000                    16.137                   238.209                  10.536                   192.531                  122.463                  
mu_sel_lj/data_other/NOMINAL/mu_sel_lj_data_other_NOMINAL_Mt_lep_met_c
obs 9831.000000
INFO:root:mu_sel_ljout
bin           mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             mu_sel_ljout             
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons_other           s_top_lj                 s_top_other              s_top_mutau              wjets_tauh               wjets_taul               wjets_other              dy_other                 dy_tautau                qcd_other                
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       13                       14                       15                       16                       17                       18                       
rate          7677.854                 2442.821                 138.546                  449.153                  168.899                  55.389                   285.522                  51.646                   434.515                  0.000                    28.822                   355.412                  21.460                   388.489                  226.937                  
mu_sel_ljout/data_other/NOMINAL/mu_sel_ljout_data_other_NOMINAL_Mt_lep_met_c
obs 12855.000000

cp ttxsec/datacard_v37_test13_bunch1_fullfit1_pufixed2_nominalqcd.txt ttxsec/datacard_v37_test13_bunchFULLFIT2_el.txt
make workspace datacard=ttxsec/datacard_v37_test13_bunchFULLFIT2_el
make impacts  workspace=ttxsec/datacard_v37_test13_bunchFULLFIT2_el.root nn=el_v37_test13_2

   r :    +0.941   -0.079/+0.086 (68%)

-- perfect, PU third after TOPPT and tau ID

make workspace datacard=ttxsec/datacard_v37_test13_bunchFULLFIT2_mu
make impacts  workspace=ttxsec/datacard_v37_test13_bunchFULLFIT2_mu.root nn=mu_v37_test13_2

   r :    +0.938   -0.068/+0.076 (68%)

-- ok too, PU is second, ust above TOPPT

python new_impact_table.py --merge-pdf ./latest_impacts_el_v37_test13_2.json ./latest_impacts_mu_v37_test13_2.json

make both elcard=ttxsec/datacard_v37_test13_bunchFULLFIT2_el mucard=ttxsec/datacard_v37_test13_bunchFULLFIT2_mu bothcard=ttxsec/datacard_v37_test13_bunchFULLFIT2_both

make workspace datacard=ttxsec/datacard_v37_test13_bunchFULLFIT2_both
make impacts  workspace=ttxsec/datacard_v37_test13_bunchFULLFIT2_both.root nn=both_v37_test13_2

   r :    +0.950   -0.070/+0.072 (68%)

-- higher than both of them..
   yep, looks ok,
   but PU is the scond largest systematic, and it is pulled slightly up
   fakes third and TOPPT after that
   but PU is pulled down in separate channels, as it should be (and from the sys variation plots -- it should improve the shape well)

how come PU is so large?

python new_impact_table.py --merge-pdf ./latest_impacts_el_v37_test13_2.json ./latest_impacts_mu_v37_test13_2.json ./latest_impacts_both_v37_test13_2.json


and try the full fit:

make full_three_card_fit mucard=ttxsec/datacard_v37_test13_bunchFULLFIT2_mu elcard=ttxsec/datacard_v37_test13_bunchFULLFIT2_el bothcard=ttxsec/datacard_v37_test13_bunchFULLFIT2_both muname=mu_v37_test13_2 elname=el_v37_test13_2 bothname=both_v37_test13_2


missing shorter pulls:

make pre_pulls_short workspace=ttxsec/datacard_v37_test13_bunchFULLFIT2_mu.root   nn=mu_v37_test13_2
make pre_pulls_short workspace=ttxsec/datacard_v37_test13_bunchFULLFIT2_el.root   nn=el_v37_test13_2
make pre_pulls_short workspace=ttxsec/datacard_v37_test13_bunchFULLFIT2_both.root nn=both_v37_test13_2

head -n-2 ttxsec/datacard_v37_test13_bunchFULLFIT2_el.txt >  ttxsec/datacard_v37_test13_bunchFULLFIT2_el_noMCstat.txt
head -n-2 ttxsec/datacard_v37_test13_bunchFULLFIT2_mu.txt >  ttxsec/datacard_v37_test13_bunchFULLFIT2_mu_noMCstat.txt
make both mucard=ttxsec/datacard_v37_test13_bunchFULLFIT2_mu_noMCstat elcard=ttxsec/datacard_v37_test13_bunchFULLFIT2_el_noMCstat bothcard=ttxsec/datacard_v37_test13_bunchFULLFIT2_both_noMCstat
make workspace datacard=ttxsec/datacard_v37_test13_bunchFULLFIT2_mu_noMCstat
make workspace datacard=ttxsec/datacard_v37_test13_bunchFULLFIT2_el_noMCstat
make workspace datacard=ttxsec/datacard_v37_test13_bunchFULLFIT2_both_noMCstat

make pre_pulls_short workspace=ttxsec/datacard_v37_test13_bunchFULLFIT2_mu_noMCstat.root   nn=mu_v37_test13_bunchFULLFIT2_noMCstat
make pre_pulls_short workspace=ttxsec/datacard_v37_test13_bunchFULLFIT2_el_noMCstat.root   nn=el_v37_test13_bunchFULLFIT2_noMCstat
make pre_pulls_short workspace=ttxsec/datacard_v37_test13_bunchFULLFIT2_both_noMCstat.root nn=both_v37_test13_bunchFULLFIT2_noMCstat

need to automate label size here:

root -l pulls_of_nuisances_mu_shape.root
gStyle->SetOptStat(0)
nuisancs->Draw()

TPaveText *pt = new TPaveText(.5, 1.5, 3.5, 2.5)
pt->AddText("muon-tau channel")
pt->Draw("same")

nuisancs->SaveAs("postfit_mu_nuisances.png")

root -l pulls_of_nuisances_both_shape.root
gStyle->SetOptStat(0)
nuisancs->Draw()

TPaveText *pt = new TPaveText(.5, 1.5, 3.5, 2.5)
pt->AddText("both channels")
pt->Draw("same")

nuisancs->SaveAs("postfit_both_nuisances.png")

python ttxsec/fit-stuff/diffNuisances.py fitDiagnosticsElShape.root -g pulls_of_nuisances_el_shape.root -o
root -l pulls_of_nuisances_el_shape.root

TPaveText *pt = new TPaveText(.5, 1.5, 3.5, 2.5)
pt->AddText("electron-tau channel")
pt->Draw("same")

nuisancs->SaveAs("postfit_el_nuisances.png")

-- into this:

python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_both_v37_test13_bunchFULLFIT2_noMCstat_shapeshort.root
python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_mu_v37_test13_bunchFULLFIT2_noMCstat_shapeshort.root
python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_el_v37_test13_bunchFULLFIT2_noMCstat_shapeshort.root

python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_both_v37_test13_bunchFULLFIT2_shape.root --label-width 22.5
python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_mu_v37_test13_bunchFULLFIT2_shape.root   --label-width 22.5
python ttxsec/fit-stuff/pulls_plot.py pulls_of_nuisances_el_v37_test13_bunchFULLFIT2_shape.root   --label-width 22.5

python ttxsec/fit-stuff/stack_postfit.py fitDiagnosticsv37_test13_bunchFULLFIT2_MuShapes.root mu_sel_lj    --mu --ratio --ratio-range 0.5 --custom-bins --y-max 150
python ttxsec/fit-stuff/stack_postfit.py fitDiagnosticsv37_test13_bunchFULLFIT2_MuShapes.root mu_sel_ljout --mu --ratio --ratio-range 0.5 --custom-bins --y-max 150
python ttxsec/fit-stuff/stack_postfit.py fitDiagnosticsv37_test13_bunchFULLFIT2_ElShapes.root el_sel_lj    --lumi 35.8 --ratio --custom-bins --ratio-range 0.5 --y-max 100
python ttxsec/fit-stuff/stack_postfit.py fitDiagnosticsv37_test13_bunchFULLFIT2_ElShapes.root el_sel_ljout --lumi 35.8 --ratio --custom-bins --ratio-range 0.5 --y-max 100


also:
covariances and
goodness of fit


#### extracting and renaming all fitting plots

make impacts_toys workspace=ttxsec/datacard_v37_test13_bunchFULLFIT2_mu.root   nn=mu_v37_test13_2
make impacts_toys workspace=ttxsec/datacard_v37_test13_bunchFULLFIT2_el.root   nn=el_v37_test13_2
make impacts_toys workspace=ttxsec/datacard_v37_test13_bunchFULLFIT2_both.root nn=both_v37_test13_2

make fit_unc_toys workspace=ttxsec/datacard_v37_test13_bunchFULLFIT2_el.root   nn=el_v37_test13_2

make plots_for_export



### sys variations

make plot_sys_vars histosel_file=histosels/v37_test13_bunchFULLFIT2.root outdir=plots/v37_test13_update1/sys-variations/

also:

make plot_sys_vars_tau_ID_misID mc=distrs/v37_test13_bunchFULLFIT2_mc.root data_mu=distrs/v37_test13_bunchFULLFIT2/SingleMuon.root data_el=distrs/v37_test13_bunchFULLFIT2/SingleElectron.root output=plots/v37_test13_update1/sys-variations/



### corrections to JES in PS datasets


gStyle->SetOptStat(0)

fsrup     = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_fsrup_jes_cor_1d_gen_reco_barrel_b
fsrdown   = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_fsrdown_jes_cor_1d_gen_reco_barrel_b
isrup     = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_isrup_jes_cor_1d_gen_reco_barrel_b
isrdown   = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_isrdown_jes_cor_1d_gen_reco_barrel_b
hdampup   = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_hdampUP_jes_cor_1d_gen_reco_barrel_b
hdampdown = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_hdampDOWN_jes_cor_1d_gen_reco_barrel_b

fsrup     = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_fsrup_jes_cor_1d_gen_reco_endcap_b
fsrdown   = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_fsrdown_jes_cor_1d_gen_reco_endcap_b
isrup     = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_isrup_jes_cor_1d_gen_reco_endcap_b
isrdown   = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_isrdown_jes_cor_1d_gen_reco_endcap_b
hdampup   = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_hdampUP_jes_cor_1d_gen_reco_endcap_b
hdampdown = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_hdampDOWN_jes_cor_1d_gen_reco_endcap_b

fsrup     = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_fsrup_jes_cor_1d_gen_reco_barrel_c
fsrdown   = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_fsrdown_jes_cor_1d_gen_reco_barrel_c
isrup     = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_isrup_jes_cor_1d_gen_reco_barrel_c
isrdown   = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_isrdown_jes_cor_1d_gen_reco_barrel_c
hdampup   = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_hdampUP_jes_cor_1d_gen_reco_barrel_c
hdampdown = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_hdampDOWN_jes_cor_1d_gen_reco_barrel_c

fsrup     = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_fsrup_jes_cor_1d_gen_reco_endcap_c
fsrdown   = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_fsrdown_jes_cor_1d_gen_reco_endcap_c
isrup     = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_isrup_jes_cor_1d_gen_reco_endcap_c
isrdown   = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_isrdown_jes_cor_1d_gen_reco_endcap_c
hdampup   = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_hdampUP_jes_cor_1d_gen_reco_endcap_c
hdampdown = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_hdampDOWN_jes_cor_1d_gen_reco_endcap_c

fsrup     = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_fsrup_jes_cor_1d_gen_reco_barrel_udsg
fsrdown   = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_fsrdown_jes_cor_1d_gen_reco_barrel_udsg
isrup     = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_isrup_jes_cor_1d_gen_reco_barrel_udsg
isrdown   = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_isrdown_jes_cor_1d_gen_reco_barrel_udsg
hdampup   = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_hdampUP_jes_cor_1d_gen_reco_barrel_udsg
hdampdown = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_hdampDOWN_jes_cor_1d_gen_reco_barrel_udsg

fsrup     = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_fsrup_jes_cor_1d_gen_reco_endcap_udsg
fsrdown   = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_fsrdown_jes_cor_1d_gen_reco_endcap_udsg
isrup     = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_isrup_jes_cor_1d_gen_reco_endcap_udsg
isrdown   = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_isrdown_jes_cor_1d_gen_reco_endcap_udsg
hdampup   = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_hdampUP_jes_cor_1d_gen_reco_endcap_udsg
hdampdown = (TH1D*) correction_MC2016_Summer16_TTJets_powheg_hdampDOWN_jes_cor_1d_gen_reco_endcap_udsg


fsrup     ->SetLineColor(kRed)
fsrdown   ->SetLineColor(kRed+1)
isrup     ->SetLineColor(kBlue)
isrdown   ->SetLineColor(kBlue+1)
hdampup   ->SetLineColor(kGreen)
hdampdown ->SetLineColor(kGreen+1)

fsrup->GetYaxis()->SetTitleFont(63)
fsrup->GetYaxis()->SetTitleSize(20)
fsrup->GetXaxis()->SetTitleFont(63)
fsrup->GetXaxis()->SetTitleSize(20)
fsrup->GetYaxis()->SetLabelSize(0.02)
fsrup->GetXaxis()->SetLabelSize(0.02)


gPad->SetLeftMargin(0.15);
gPad->SetBottomMargin(0.15);
fsrup     ->GetYaxis()->SetRangeUser(0.97, 1.03)
fsrup     ->GetYaxis()->SetTitleOffset(3.0)
fsrup     ->GetXaxis()->SetTitleOffset(2.0)
fsrup     ->SetXTitle("p^{gen}_{T} [GeV]")
fsrup     ->SetYTitle("#frac{<p^{reco NOMINAL}_{T}>/<p^{gen NOMINAL}_{T}>}{<p^{reco PS systematic}_{T}>/<p^{gen PS systematic}_{T}>}")

leg = new TLegend(0.6,0.7, 0.9,0.9)
leg->AddEntry(fsrup,   "FSR Up",   "l")
leg->AddEntry(fsrdown, "FSR Down", "l")
leg->AddEntry(isrup,   "ISR Up",   "l")
leg->AddEntry(isrdown, "ISR Down", "l")
leg->AddEntry(hdampup,   "HDAMP Up",   "l")
leg->AddEntry(hdampdown, "HDAMP Down", "l")

fsrup     ->Draw("hist")
fsrdown   ->Draw("hist same")
isrup     ->Draw("hist same")
isrdown   ->Draw("hist same")
hdampup   ->Draw("hist same")
hdampdown ->Draw("hist same")

leg->Draw("same")

c1->SaveAs("JES_corrections_barrel_b.png")
c1->SaveAs("JES_corrections_endcap_b.png")

c1->SaveAs("JES_corrections_barrel_c.png")
c1->SaveAs("JES_corrections_endcap_c.png")

c1->SaveAs("JES_corrections_barrel_udsg.png")
c1->SaveAs("JES_corrections_endcap_udsg.png")

no Tune:

correction_MC2016_Summer16_TTJets_powheg_isrup_jes_cor_1d_gen_reco_barrel_b
correction_MC2016_Summer16_TTJets_powheg_isrdown_jes_cor_1d_gen_reco_barrel_b




### debugging the segfault in stack_plot with data-driven qcd

problem:
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/tests/ -c el_sel_lj    -x el_selVloose_lj    --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05

python -m pdb stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/tests/ -c el_sel_lj    -x el_selVloose_lj    --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05

-- crashes after The program finished and will be restarted

gdb python
run stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -o plots/tests/ -c el_sel_lj    -x el_selVloose_lj    --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05

-- stops at segfault

info args
No symbol table info available.



### fixing PU Up Down

old weight

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 19 || selection_stage == 17)*event_weight_PUUp"                          --histo-range 5,0,5 --output v37_test13_PU_norm_el_sel_event_weight_PUUp_tt.root       --histo-name tt_el_sel_event_weight_PUUp       lstore_outdirs/v37/test13/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 19 || selection_stage == 17 || selection_stage == 15)*event_weight_PUUp" --histo-range 5,0,5 --output v37_test13_PU_norm_el_selVloose_event_weight_PUUp_tt.root --histo-name tt_el_selVloose_event_weight_PUUp lstore_outdirs/v37/test13/MC2016_Summer16_TTJets_powheg/*root     &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7)*event_weight_PUUp"                         --histo-range 5,0,5 --output v37_test13_PU_norm_mu_sel_event_weight_PUUp_tt.root       --histo-name tt_mu_sel_event_weight_PUUp       lstore_outdirs/v37/test13/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight_PUUp" --histo-range 5,0,5 --output v37_test13_PU_norm_mu_selVloose_event_weight_PUUp_tt.root --histo-name tt_mu_selVloose_event_weight_PUUp lstore_outdirs/v37/test13/MC2016_Summer16_TTJets_powheg/*root     &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 19 || selection_stage == 17)*event_weight_PUDown"                          --histo-range 5,0,5 --output v37_test13_PU_norm_el_sel_event_weight_PUDown_tt.root       --histo-name tt_el_sel_event_weight_PUDown       lstore_outdirs/v37/test13/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 19 || selection_stage == 17 || selection_stage == 15)*event_weight_PUDown" --histo-range 5,0,5 --output v37_test13_PU_norm_el_selVloose_event_weight_PUDown_tt.root --histo-name tt_el_selVloose_event_weight_PUDown lstore_outdirs/v37/test13/MC2016_Summer16_TTJets_powheg/*root     &

python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7)*event_weight_PUDown"                         --histo-range 5,0,5 --output v37_test13_PU_norm_mu_sel_event_weight_PUDown_tt.root       --histo-name tt_mu_sel_event_weight_PUDown       lstore_outdirs/v37/test13/MC2016_Summer16_TTJets_powheg/*root     &
python sumup_ttree_draw.py "3" --ttree ttree_out --cond-com "(selection_stage == 9 || selection_stage == 7 || selection_stage == 5)*event_weight_PUDown" --histo-range 5,0,5 --output v37_test13_PU_norm_mu_selVloose_event_weight_PUDown_tt.root --histo-name tt_mu_selVloose_event_weight_PUDown lstore_outdirs/v37/test13/MC2016_Summer16_TTJets_powheg/*root     &

hadd v37_test13_PU_norm.root v37_test13_PU_norm_*root

root -l v37_test13_PU_norm.root

tt_el_sel_event_weight_PUUp        ->Integral() / tt_el_sel_event_weight_PU        ->Integral()
tt_mu_sel_event_weight_PUUp        ->Integral() / tt_mu_sel_event_weight_PU        ->Integral()

tt_el_sel_event_weight_PUDown      ->Integral() / tt_el_sel_event_weight_PU        ->Integral()
tt_mu_sel_event_weight_PUDown      ->Integral() / tt_mu_sel_event_weight_PU        ->Integral()

(double) 1.07082
(double) 1.06297
(double) 0.948327
(double) 0.947503

looks ok?

yield numbers

python numbers_for_datacard.py histosels/v37_test13_bunch1_fullfit1.root -d Mt_lep_met_c -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --no-sums -y --data-nick data_other
python numbers_for_datacard.py histosels/v37_test13_bunch1_fullfit1.root -d Mt_lep_met_c -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --no-sums -y --data-nick data_other --sys PUUp
python numbers_for_datacard.py histosels/v37_test13_bunch1_fullfit1.root -d Mt_lep_met_c -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --no-sums -y --data-nick data_other --sys PUDown

mc sum and signal:

>>> 7538.578 / 6887.332
1.0945570795774038
>>> 3601. / 3288.
1.0951946472019465

mc_sum over all channels

mc_resum_nom    = [6887.332   8589.957   10367.319   12725.466]
mc_resum_puup   = [7538.578   9211.933   11087.660   13482.983]
mc_resum_pudown = [6471.942   8072.127    9765.201   11951.999]

 1.09456  1.07241  1.06948  1.05953
 0.939688  0.939717  0.941922  0.939219



I saved new and old nominal PU to compare and renormalize.
But the variations are only new... how to renormalize them?

find PU yield variation in old datacard

datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_bFrag.txt
datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_bFrag.txt

HISTOSELS_v25v25redo_PUnormFix.root

python numbers_for_datacard.py ../../fit-stuff/HISTOSELS_v25v25redo_PUnormFix.root -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --no-sums -y
INFO:root:import ROOT
INFO:root:el_sel_lj
INFO:root:el_sel_ljout
INFO:root:mu_sel_lj
INFO:root:mu_sel_ljout
                                 process   el_sel_lj   el_sel_ljout   mu_sel_lj   mu_sel_ljout
                                tt_mutau   $  5136 \pm    116 $   $  7926 \pm    144 $
                                tt_eltau   $  3010 \pm     88 $   $  4691 \pm    111 $
                             tt_taultauh   $   170 \pm     20 $   $   280 \pm     26 $   $   328 \pm     27 $   $   517 \pm     34 $
                                   tt_lj   $  2215 \pm     43 $   $  1457 \pm     34 $   $  3757 \pm     57 $   $  2532 \pm     46 $
                                tt_taulj   $   118 \pm      8 $   $    76 \pm      7 $   $   240 \pm     13 $   $   161 \pm     10 $
                                tt_other   $    60 \pm      9 $   $   100 \pm     11 $   $   104 \pm     12 $   $   181 \pm     15 $
                             s_top_eltau   $   152 \pm     14 $   $   274 \pm     19 $
                             s_top_mutau   $   232 \pm     17 $   $   450 \pm     25 $
                             s_top_other   $    21 \pm      3 $   $    31 \pm      5 $   $    40 \pm      5 $   $    61 \pm      7 $
                                s_top_lj   $   151 \pm      8 $   $   169 \pm      8 $   $   235 \pm     10 $   $   296 \pm     11 $
                               dy_tautau   $   103 \pm     28 $   $   190 \pm     29 $   $   200 \pm     32 $   $   424 \pm     52 $
                                dy_other   $    34 \pm     14 $   $   103 \pm     25 $   $    22 \pm     14 $   $    62 \pm     18 $
                             wjets_other   $   194 \pm     22 $   $   241 \pm     15 $   $   303 \pm     22 $   $   434 \pm     22 $
                              wjets_taul   $     7 \pm      3 $   $     7 \pm      3 $   $    11 \pm      3 $   $    16 \pm      4 $
                              wjets_tauh   $     0 \pm      0 $   $     1 \pm      1 $   $     0 \pm      0 $   $     0 \pm      0 $
                                dibosons   $    13 \pm      4 $   $    31 \pm      6 $   $    25 \pm      5 $   $    58 \pm     10 $
                                     qcd   $   136 \pm     57 $   $   327 \pm     68 $   $   173 \pm     42 $   $   258 \pm     53 $
aaa!
                                mc_resum   6383.362   7980.707   10805.584   13376.781
                                    data   $  6190 \pm    236 $   $  7906 \pm    273 $   $ 10251 \pm    298 $   $ 13550 \pm    352 $


python numbers_for_datacard.py ../../fit-stuff/HISTOSELS_v25v25redo_PUnormFix.root -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --no-sums -y --sys PUUp

python numbers_for_datacard.py ../../fit-stuff/HISTOSELS_v25v25redo_PUnormFix.root -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --no-sums -y --sys PUUp
INFO:root:import ROOT
INFO:root:el_sel_lj
INFO:root:el_sel_ljout
INFO:root:mu_sel_lj
INFO:root:mu_sel_ljout
                                 process   el_sel_lj   el_sel_ljout   mu_sel_lj   mu_sel_ljout
                                tt_mutau   $  5183 \pm    116 $   $  8006 \pm    144 $
                                tt_eltau   $  3055 \pm     88 $   $  4748 \pm    110 $
                             tt_taultauh   $   173 \pm     19 $   $   283 \pm     25 $   $   331 \pm     27 $   $   521 \pm     34 $
                                   tt_lj   $  2246 \pm     43 $   $  1484 \pm     34 $   $  3809 \pm     57 $   $  2565 \pm     46 $
                                tt_taulj   $   121 \pm      8 $   $    79 \pm      7 $   $   245 \pm     13 $   $   164 \pm     10 $
                                tt_other   $    61 \pm      9 $   $   101 \pm     11 $   $   107 \pm     12 $   $   184 \pm     15 $
                             s_top_eltau   $   154 \pm     14 $   $   278 \pm     19 $
                             s_top_mutau   $   235 \pm     17 $   $   450 \pm     25 $
                             s_top_other   $    21 \pm      3 $   $    31 \pm      5 $   $    40 \pm      5 $   $    62 \pm      7 $
                                s_top_lj   $   152 \pm      8 $   $   171 \pm      8 $   $   238 \pm     10 $   $   300 \pm     11 $
                               dy_tautau   $   104 \pm     28 $   $   194 \pm     29 $   $   203 \pm     33 $   $   432 \pm     53 $
                                dy_other   $    33 \pm     13 $   $   106 \pm     25 $   $    18 \pm     12 $   $    67 \pm     19 $
                             wjets_other   $   203 \pm     22 $   $   245 \pm     15 $   $   307 \pm     22 $   $   445 \pm     23 $
                              wjets_taul   $     6 \pm      2 $   $     7 \pm      3 $   $    11 \pm      3 $   $    16 \pm      4 $
                              wjets_tauh   $     1 \pm      1 $   $     1 \pm      1 $   $     1 \pm      1 $   $     0 \pm      0 $
                                dibosons   $    13 \pm      4 $   $    32 \pm      7 $   $    26 \pm      5 $   $    59 \pm     10 $
                                     qcd   $   114 \pm     57 $   $   314 \pm     71 $   $   136 \pm     37 $   $   224 \pm     51 $
aaa!
                                mc_resum   6456.150   8074.579   10888.322   13495.677
                                    data   $  6190 \pm    236 $   $  7906 \pm    273 $   $ 10251 \pm    298 $   $ 13550 \pm    352 $


python numbers_for_datacard.py ../../fit-stuff/HISTOSELS_v25v25redo_PUnormFix.root -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --no-sums -y --sys PUDown
INFO:root:import ROOT


INFO:root:el_sel_lj
INFO:root:el_sel_ljout
INFO:root:mu_sel_lj
INFO:root:mu_sel_ljout
                                 process   el_sel_lj   el_sel_ljout   mu_sel_lj   mu_sel_ljout
                                tt_mutau   $  5072 \pm    117 $   $  7819 \pm    145 $
                                tt_eltau   $  2955 \pm     90 $   $  4621 \pm    114 $
                             tt_taultauh   $   167 \pm     20 $   $   277 \pm     26 $   $   324 \pm     27 $   $   512 \pm     34 $
                                   tt_lj   $  2177 \pm     43 $   $  1428 \pm     35 $   $  3690 \pm     57 $   $  2489 \pm     46 $
                                tt_taulj   $   114 \pm      8 $   $    74 \pm      7 $   $   233 \pm     13 $   $   158 \pm     10 $
                                tt_other   $    58 \pm      9 $   $    99 \pm     12 $   $   101 \pm     12 $   $   177 \pm     15 $
                             s_top_eltau   $   150 \pm     15 $   $   270 \pm     20 $
                             s_top_mutau   $   228 \pm     17 $   $   448 \pm     25 $
                             s_top_other   $    21 \pm      3 $   $    31 \pm      5 $   $    39 \pm      5 $   $    60 \pm      7 $
                                s_top_lj   $   149 \pm      8 $   $   165 \pm      8 $   $   232 \pm     10 $   $   291 \pm     11 $
                               dy_tautau   $   101 \pm     27 $   $   187 \pm     29 $   $   198 \pm     32 $   $   415 \pm     52 $
                                dy_other   $    36 \pm     16 $   $   102 \pm     25 $   $    27 \pm     16 $   $    56 \pm     17 $
                             wjets_other   $   185 \pm     21 $   $   237 \pm     16 $   $   299 \pm     22 $   $   423 \pm     22 $
                              wjets_taul   $     8 \pm      3 $   $     7 \pm      3 $   $    11 \pm      3 $   $    15 \pm      4 $
                              wjets_tauh   $     0 \pm      0 $   $     1 \pm      1 $   $     0 \pm      0 $   $     0 \pm      0 $
                                dibosons   $    12 \pm      4 $   $    30 \pm      6 $   $    25 \pm      5 $   $    57 \pm     10 $
                                     qcd   $   160 \pm     58 $   $   343 \pm     67 $   $   217 \pm     47 $   $   297 \pm     55 $
aaa!
                                mc_resum   6294.473   7871.364   10695.074   13218.491
                                    data   $  6190 \pm    236 $   $  7906 \pm    273 $   $ 10251 \pm    298 $   $ 13550 \pm    352 $

mc_resum_nom  = [ 6383.362   7980.707   10805.584   13376.781 ]
mc_resum_puup = [ 6456.150   8074.579   10888.322   13495.677 ]
mc_resum_pudown = [ 6294.473   7871.364   10695.074   13218.491 ]

mc_resum_puup ./ mc_resum_nom
mc_resum_pudown ./ mc_resum_nom

 1.0114  1.01176  1.00766  1.00889
 0.986075  0.986299  0.989773  0.988167

VS:

 1.09456  1.07241  1.06948  1.05953
 0.939688  0.939717  0.941922  0.939219

old_ratio_down ./ new_ratio_down
 1.04936  1.04957  1.0508  1.05212

old_ratio_up ./ new_ratio_up
 0.924027  0.943447  0.942195  0.952207

-- damn, the change in Up is not linear
   and it affects el! damn
   -- it affects el, because el norma is corrected for old el PU!

correct by 0.95 Up and 1.05 Down

again

python numbers_for_datacard.py histosels/v37_test13_bunch1_fullfit1_pufixed.root -d Mt_lep_met_c -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --no-sums -y --data-nick data_other
python numbers_for_datacard.py histosels/v37_test13_bunch1_fullfit1_pufixed.root -d Mt_lep_met_c -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --no-sums -y --data-nick data_other --sys PUUp
python numbers_for_datacard.py histosels/v37_test13_bunch1_fullfit1_pufixed.root -d Mt_lep_met_c -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --no-sums -y --data-nick data_other --sys PUDown

data   $  6690 \pm    246 $   $  8414 \pm    282 $   $  9831 \pm    292 $   $ 12855 \pm    343 $

mc_resum_new_nom = [  6981.494   8707.329   10367.319   12725.466 ]
mc_resum_new_pup = [  7262.964   8935.948   10581.536   12913.886 ]
mc_resum_new_pdn = [  6836.363   8526.372   10154.236   12444.546 ]

old:

mc_resum_nom = [ 6383.362   7980.707   10805.584   13376.781 ]
mc_resum_pup = [ 6456.150   8074.579   10888.322   13495.677 ]
mc_resum_pdn = [ 6294.473   7871.364   10695.074   13218.491 ]

mc_resum_new_pup ./ mc_resum_new_nom
mc_resum_new_pdn ./ mc_resum_new_nom

mc_resum_pup ./ mc_resum_nom
mc_resum_pdn ./ mc_resum_nom

 1.04032  1.02626  1.02066  1.01481
 0.979212  0.979218  0.979447  0.977925

 1.0114  1.01176  1.00766  1.00889
 0.986075  0.986299  0.989773  0.988167

so, does this matter??

why so different effect in lj and ljout?
used to be no effect at all

(mc_resum_pup ./ mc_resum_nom) ./ (mc_resum_new_pup ./ mc_resum_new_nom)
(mc_resum_pdn ./ mc_resum_nom) ./ (mc_resum_new_pdn ./ mc_resum_new_nom)

 0.972207  0.985877  0.987258  0.994168
 1.00701   1.00723   1.01054   1.01047

-- hardcoded these normalizations

meanwhile try including them in datacard?

(mc_resum_pup ./ mc_resum_nom - ones(4)') ./ (mc_resum_new_pup ./ mc_resum_new_nom - ones(4)')
(mc_resum_pdn ./ mc_resum_nom - ones(4)') ./ (mc_resum_new_pdn ./ mc_resum_new_nom - ones(4)')

 0.282831  0.447989  0.370569  0.600292
 0.669864  0.659264  0.497589  0.536035

for shape the deviations cannot be asymmetric
use the lowest:

el: 0.3 0.4    mu: 0.4 0.6

cp ttxsec/datacard_v37_test13_1_el_qcdnaming.txt ttxsec/datacard_v37_test13_1_el_qcdnaming_normalizedPU.txt

PU              shape          1.0    1.0   1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -                  1.0    1.0   1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -

PU              shape          0.3    0.3   0.3   0.3   0.3        0.3      0.3   0.3   0.3      0.3   0.3      0.3   0.3      -                  0.4    0.4   0.4   0.4   0.4        0.4      0.4   0.4   0.4      0.4   0.4      0.4   0.4      -





### check the wjets factor

python stack_plot.py distrs/v37_test13_bunchCONTROLS1_mc_1.root distrs/v37_test13_bunchCONTROLS1/SingleMuon.root     -p -r -o plots/v37_test13_bunchCONTROLS1_mc_1/ -c wjets_mu --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 2.5
python stack_plot.py distrs/v37_test13_bunchCONTROLS1_mc_1.root distrs/v37_test13_bunchCONTROLS1/SingleElectron.root -p -r -o plots/v37_test13_bunchCONTROLS1_mc_1/ -c wjets_el --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 1.4 --qcd-factor 2.5

-- factor 1.4 fits (?)
   the shape is ok, same trend at high mT in both channels
   MC QCD is ok


### yields

data driven qcd

mu data channels

foreach chan (mu_sel wjets_mu)
make run_histos mc=distrs/v37_test13_bunch1YIELDS_mc_1.root data=distrs/v37_test13_bunch1YIELDS/SingleMuon.root out=histosels/v37_test13_bunch1_yields1/ wjets_norm=1.4 lumi=35800 distr=yield chan=$chan qcd_opt="--qcd 1.05"
end

el data channels

foreach chan (el_sel wjets_el)
make run_histos mc=distrs/v37_test13_bunch1YIELDS_mc_1.root data=distrs/v37_test13_bunch1YIELDS/SingleMuon.root out=histosels/v37_test13_bunch1_yields1/ wjets_norm=1.4 lumi=35800 distr=yield chan=$chan qcd_opt="--qcd 1.05"
end

-- add the remaining channels and MC QCD



python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root     -p -r -o plots/v25v26redo_more-info --lumi 35800 -c mu_sel -x mu_selVloose -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --y-max 250.

and getting these:

run_all_yields

                                 process & mu_preselCand & mu_sel & mu_sel_lj & mu_sel_ljout \\
$\text{DY}\rightarrow{\tau_{\ell}\tau_{h}}+ {\rm jets}$ & $  2623 \pm     68 $ & $   581 \pm     31 $ & $   193 \pm     18 $ & $   388 \pm     26 $ \\
       $\text{DY}\rightarrow{\rm other}$ & $  8236 \pm    190 $ & $    32 \pm     14 $ & $    11 \pm      9 $ & $    21 \pm     10 $ \\
                            $\text{QCD}$ & $ 51245 \pm   1019 $ & $   354 \pm     79 $ & $   122 \pm     56 $ & $   231 \pm     57 $ \\
$\text{single top}\rightarrow{{\rm \ell} \tau}+X$ & $  2001 \pm     19 $ & $   691 \pm     11 $ & $   235 \pm      6 $ & $   456 \pm      9 $ \\
$\text{single top}\rightarrow{\ell j}+X$ & $ 45690 \pm     90 $ & $   516 \pm      9 $ & $   230 \pm      6 $ & $   286 \pm      7 $ \\
$\text{single top}\rightarrow{\rm other}$ & $  3968 \pm     26 $ & $    87 \pm      4 $ & $    35 \pm      3 $ & $    52 \pm      3 $ \\
$\ttbar\rightarrow{\ell\tau}\nu\nu b\bar{b}$ ($\ell=e,\mu$) & $ 45855 \pm    130 $ & $ 13029 \pm     67 $ & $  5137 \pm     43 $ & $  7892 \pm     52 $ \\
$\ttbar\rightarrow{\ell\nu jj b\bar{b}}$ & $496455 \pm    427 $ & $  6117 \pm     47 $ & $  3674 \pm     37 $ & $  2443 \pm     30 $ \\
$\ttbar\rightarrow{\tau_{\ell}\tau_{h} \nu\nu b\bar{b} }$ & $  2628 \pm     31 $ & $   731 \pm     16 $ & $   280 \pm     10 $ & $   451 \pm     12 $ \\
$\ttbar\rightarrow{\tau_{\ell}\nu jj b\bar{b}}$ & $ 28227 \pm    102 $ & $   347 \pm     11 $ & $   209 \pm      9 $ & $   139 \pm      7 $ \\
          $\ttbar\rightarrow{\rm other}$ & $ 32780 \pm    110 $ & $   259 \pm     10 $ & $    88 \pm      6 $ & $   171 \pm      8 $ \\
$\text{W+jets} \rightarrow\tau_{\ell}\nu + {\rm jets}$ & $  4771 \pm     66 $ & $    45 \pm      7 $ & $    16 \pm      4 $ & $    29 \pm      5 $ \\
$\text{W+jets} \rightarrow\tau_{h}\nu + {\rm jets}$ & $     3 \pm      2 $ & $     0 \pm      0 $ & $     0 \pm      0 $ & $     0 \pm      0 $ \\
$\text{W+jets} \rightarrow\ell\nu+ {\rm jets}$ & $ 81338 \pm    318 $ & $   594 \pm     28 $ & $   238 \pm     21 $ & $   355 \pm     18 $ \\
                       $\text{dibosons}$ & $  3254 \pm     38 $ & $    80 \pm      5 $ & $    23 \pm      2 $ & $    57 \pm      4 $ \\
aaa!
                                mc_resum & 809074.892 & 23462.464 & 10490.427 & 12972.037 \\
                                   total & $809075 \pm   1191 $ & $ 23462 \pm    126 $ & $ 10490 \pm     86 $ & $ 12972 \pm     92 $ \\
                                    data & $799953 \pm    894 $ & $ 23016 \pm    152 $ & $  9931 \pm    100 $ & $ 13085 \pm    114 $ \\
INFO:root:import ROOT
INFO:root:el_preselCand
INFO:root:no sums_NOMINAL/NOMINAL/el_preselCand_sums_NOMINAL_NOMINAL_yield in <ROOT.TDirectoryFile object ("el_preselCand") at 0x3baeeb0>
INFO:root:el_sel
INFO:root:no sums_NOMINAL/NOMINAL/el_sel_sums_NOMINAL_NOMINAL_yield in <ROOT.TDirectoryFile object ("el_sel") at 0x3d929c0>
INFO:root:el_sel_lj
INFO:root:no sums_NOMINAL/NOMINAL/el_sel_lj_sums_NOMINAL_NOMINAL_yield in <ROOT.TDirectoryFile object ("el_sel_lj") at 0x3defe30>
INFO:root:el_sel_ljout
INFO:root:no sums_NOMINAL/NOMINAL/el_sel_ljout_sums_NOMINAL_NOMINAL_yield in <ROOT.TDirectoryFile object ("el_sel_ljout") at 0x3e0efd0>
                                 process & el_preselCand & el_sel & el_sel_lj & el_sel_ljout \\
$\text{DY}\rightarrow{\tau_{\ell}\tau_{h}}+ {\rm jets}$ & $  1834 \pm     58 $ & $   347 \pm     25 $ & $   123 \pm     15 $ & $   224 \pm     19 $ \\
       $\text{DY}\rightarrow{\rm other}$ & $ 10211 \pm    184 $ & $   111 \pm     14 $ & $    30 \pm      7 $ & $    82 \pm     12 $ \\
                            $\text{QCD}$ & $ 33277 \pm    853 $ & $   447 \pm     66 $ & $    71 \pm     45 $ & $   376 \pm     49 $ \\
$\text{single top}\rightarrow{{\rm \ell} \tau}+X$ & $  1437 \pm     16 $ & $   498 \pm      9 $ & $   178 \pm      5 $ & $   320 \pm      7 $ \\
$\text{single top}\rightarrow{\ell j}+X$ & $ 31525 \pm     76 $ & $   355 \pm      8 $ & $   170 \pm      6 $ & $   185 \pm      5 $ \\
$\text{single top}\rightarrow{\rm other}$ & $  2784 \pm     22 $ & $    58 \pm      3 $ & $    24 \pm      2 $ & $    34 \pm      2 $ \\
$\ttbar\rightarrow{\ell\tau}\nu\nu b\bar{b}$ ($\ell=e,\mu$) & $ 31065 \pm    108 $ & $  8759 \pm     56 $ & $  3439 \pm     35 $ & $  5319 \pm     43 $ \\
$\ttbar\rightarrow{\ell\nu jj b\bar{b}}$ & $339925 \pm    356 $ & $  4059 \pm     39 $ & $  2451 \pm     30 $ & $  1607 \pm     24 $ \\
$\ttbar\rightarrow{\tau_{\ell}\tau_{h} \nu\nu b\bar{b} }$ & $  1774 \pm     26 $ & $   500 \pm     13 $ & $   192 \pm      8 $ & $   308 \pm     10 $ \\
$\ttbar\rightarrow{\tau_{\ell}\nu jj b\bar{b}}$ & $ 18893 \pm     84 $ & $   216 \pm      9 $ & $   132 \pm      7 $ & $    84 \pm      6 $ \\
          $\ttbar\rightarrow{\rm other}$ & $ 22620 \pm     92 $ & $   181 \pm      8 $ & $    69 \pm      5 $ & $   113 \pm      6 $ \\
$\text{W+jets} \rightarrow\tau_{\ell}\nu + {\rm jets}$ & $  3360 \pm     62 $ & $    27 \pm      6 $ & $    14 \pm      5 $ & $    13 \pm      3 $ \\
$\text{W+jets} \rightarrow\tau_{h}\nu + {\rm jets}$ & $    41 \pm      6 $ & $     3 \pm      2 $ & $     1 \pm      1 $ & $     2 \pm      1 $ \\
$\text{W+jets} \rightarrow\ell\nu+ {\rm jets}$ & $ 55568 \pm    260 $ & $   400 \pm     34 $ & $   179 \pm     31 $ & $   221 \pm     14 $ \\
                       $\text{dibosons}$ & $  2461 \pm     33 $ & $    53 \pm      4 $ & $    16 \pm      2 $ & $    37 \pm      3 $ \\
aaa!
                                mc_resum & 556775.067 & 16015.297 & 7090.165 & 8925.132 \\
                                   total & $556775 \pm    999 $ & $ 16015 \pm    107 $ & $  7090 \pm     75 $ & $  8925 \pm     77 $ \\
                                    data & $548107 \pm    740 $ & $ 15420 \pm    124 $ & $  6787 \pm     82 $ & $  8633 \pm     93 $ \\
INFO:root:import ROOT
INFO:root:mu_preselCand
INFO:root:no sums_NOMINAL/NOMINAL/mu_preselCand_sums_NOMINAL_NOMINAL_yield in <ROOT.TDirectoryFile object ("mu_preselCand") at 0x3d70160>
INFO:root:mu_sel
INFO:root:no sums_NOMINAL/NOMINAL/mu_sel_sums_NOMINAL_NOMINAL_yield in <ROOT.TDirectoryFile object ("mu_sel") at 0x3fc6b60>
INFO:root:mu_sel_lj
INFO:root:no sums_NOMINAL/NOMINAL/mu_sel_lj_sums_NOMINAL_NOMINAL_yield in <ROOT.TDirectoryFile object ("mu_sel_lj") at 0x3fdb970>
INFO:root:mu_sel_ljout
INFO:root:no sums_NOMINAL/NOMINAL/mu_sel_ljout_sums_NOMINAL_NOMINAL_yield in <ROOT.TDirectoryFile object ("mu_sel_ljout") at 0x3fbc160>
                                 process & mu_preselCand & mu_sel & mu_sel_lj & mu_sel_ljout \\
                       $\text{dibosons}$ & $  3254 \pm     38 $ & $    80 \pm      5 $ & $    23 \pm      2 $ & $    57 \pm      4 $ \\
$\ttbar\rightarrow{\ell\nu jj b\bar{b}}$ & $496455 \pm    427 $ & $  6117 \pm     47 $ & $  3674 \pm     37 $ & $  2443 \pm     30 $ \\
$\ttbar\rightarrow{\ell\tau}\nu\nu b\bar{b}$ ($\ell=e,\mu$) & $ 45855 \pm    130 $ & $ 13029 \pm     67 $ & $  5137 \pm     43 $ & $  7892 \pm     52 $ \\
                     $\text{single top}$ & $ 51659 \pm     96 $ & $  1294 \pm     15 $ & $   500 \pm      9 $ & $   794 \pm     12 $ \\
                             $\text{DY}$ & $ 10858 \pm    202 $ & $   613 \pm     34 $ & $   203 \pm     20 $ & $   410 \pm     28 $ \\
                            $\text{QCD}$ & $ 51245 \pm   1019 $ & $   354 \pm     79 $ & $   122 \pm     56 $ & $   231 \pm     57 $ \\
$\text{W+jets} \rightarrow\ell\nu+ {\rm jets}$ & $ 86112 \pm    325 $ & $   639 \pm     28 $ & $   254 \pm     21 $ & $   384 \pm     19 $ \\
          $\ttbar\rightarrow{\rm other}$ & $ 63636 \pm    153 $ & $  1337 \pm     22 $ & $   577 \pm     14 $ & $   760 \pm     16 $ \\
aaa!
                                mc_resum & 809074.892 & 23462.464 & 10490.427 & 12972.037 \\
                                   total & $809075 \pm   1191 $ & $ 23462 \pm    126 $ & $ 10490 \pm     86 $ & $ 12972 \pm     92 $ \\
                                    data & $799953 \pm    894 $ & $ 23016 \pm    152 $ & $  9931 \pm    100 $ & $ 13085 \pm    114 $ \\
INFO:root:import ROOT
INFO:root:el_preselCand
INFO:root:no sums_NOMINAL/NOMINAL/el_preselCand_sums_NOMINAL_NOMINAL_yield in <ROOT.TDirectoryFile object ("el_preselCand") at 0x4677530>
INFO:root:el_sel
INFO:root:no sums_NOMINAL/NOMINAL/el_sel_sums_NOMINAL_NOMINAL_yield in <ROOT.TDirectoryFile object ("el_sel") at 0x4841f00>
INFO:root:el_sel_lj
INFO:root:no sums_NOMINAL/NOMINAL/el_sel_lj_sums_NOMINAL_NOMINAL_yield in <ROOT.TDirectoryFile object ("el_sel_lj") at 0x48adc50>
INFO:root:el_sel_ljout
INFO:root:no sums_NOMINAL/NOMINAL/el_sel_ljout_sums_NOMINAL_NOMINAL_yield in <ROOT.TDirectoryFile object ("el_sel_ljout") at 0x48a3370>
                                 process & el_preselCand & el_sel & el_sel_lj & el_sel_ljout \\
                       $\text{dibosons}$ & $  2461 \pm     33 $ & $    53 \pm      4 $ & $    16 \pm      2 $ & $    37 \pm      3 $ \\
$\ttbar\rightarrow{\ell\nu jj b\bar{b}}$ & $339925 \pm    356 $ & $  4059 \pm     39 $ & $  2451 \pm     30 $ & $  1607 \pm     24 $ \\
                     $\text{single top}$ & $ 35747 \pm     80 $ & $   910 \pm     12 $ & $   372 \pm      8 $ & $   538 \pm      9 $ \\
$\ttbar\rightarrow{\ell\tau}\nu\nu b\bar{b}$ ($\ell=e,\mu$) & $ 31065 \pm    108 $ & $  8759 \pm     56 $ & $  3439 \pm     35 $ & $  5319 \pm     43 $ \\
                             $\text{DY}$ & $ 12045 \pm    193 $ & $   459 \pm     29 $ & $   153 \pm     16 $ & $   306 \pm     23 $ \\
                            $\text{QCD}$ & $ 33277 \pm    853 $ & $   447 \pm     66 $ & $    71 \pm     45 $ & $   376 \pm     49 $ \\
$\text{W+jets} \rightarrow\ell\nu+ {\rm jets}$ & $ 58969 \pm    267 $ & $   430 \pm     35 $ & $   194 \pm     32 $ & $   236 \pm     15 $ \\
          $\ttbar\rightarrow{\rm other}$ & $ 43287 \pm    127 $ & $   898 \pm     18 $ & $   393 \pm     12 $ & $   505 \pm     13 $ \\
aaa!
                                mc_resum & 556775.067 & 16015.297 & 7090.165 & 8925.132 \\
                                   total & $556775 \pm    999 $ & $ 16015 \pm    107 $ & $  7090 \pm     75 $ & $  8925 \pm     77 $ \\
                                    data & $548107 \pm    740 $ & $ 15420 \pm    124 $ & $  6787 \pm     82 $ & $  8633 \pm     93 $ \\
INFO:root:import ROOT
INFO:root:dy_elel
INFO:root:no sums_NOMINAL/NOMINAL/dy_elel_sums_NOMINAL_NOMINAL_yield in <ROOT.TDirectoryFile object ("dy_elel") at 0x3ab2260>
INFO:root:dy_mumu
INFO:root:no sums_NOMINAL/NOMINAL/dy_mumu_sums_NOMINAL_NOMINAL_yield in <ROOT.TDirectoryFile object ("dy_mumu") at 0x3d4aac0>
                                 process & dy_elel & dy_mumu \\
                       $\text{dibosons}$ & $ 17963 \pm     39 $ & $ 32620 \pm     51 $ \\
                     $\text{single top}$ & $  5787 \pm     32 $ & $  9604 \pm     41 $ \\
$\text{DY}\rightarrow{\tau_{\ell}\tau_{h}}+ {\rm jets}$ & $  3765 \pm     76 $ & $  6785 \pm    101 $ \\
                            $\text{QCD}$ & $102389 \pm  55549 $ & $ 15575 \pm   8805 $ \\
$\text{W+jets} \rightarrow\ell\nu+ {\rm jets}$ & $  1039 \pm    118 $ & $   437 \pm     48 $ \\
       $\text{DY}\rightarrow{\rm other}$ & $7297917 \pm   3303 $ & $15090721 \pm   4702 $ \\
                                $\ttbar$ & $ 57084 \pm    146 $ & $ 97463 \pm    188 $ \\
aaa!
                                mc_resum & 7485943.606 & 15253206.448 \\
                                   total & $7485944 \pm  55647 $ & $15253206 \pm   9984 $ \\
                                    data & $7095254 \pm   2664 $ & $16254370 \pm   4032 $ \\
INFO:root:import ROOT
INFO:root:tt_elmu
INFO:root:no sums_NOMINAL/NOMINAL/tt_elmu_sums_NOMINAL_NOMINAL_yield in <ROOT.TDirectoryFile object ("tt_elmu") at 0x3bda520>
                                 process & tt_elmu \\
                       $\text{dibosons}$ & $ 12166 \pm     49 $ \\
          $\ttbar\rightarrow{\rm other}$ & $   161 \pm      8 $ \\
                     $\text{single top}$ & $ 11410 \pm     44 $ \\
$\text{DY}\rightarrow{\tau_{\ell}\tau_{h}}+ {\rm jets}$ & $  5241 \pm     89 $ \\
                            $\text{QCD}$ & $     0 \pm      0 $ \\
$\text{W+jets} \rightarrow\ell\nu+ {\rm jets}$ & $   538 \pm     54 $ \\
       $\text{DY}\rightarrow{\rm other}$ & $   426 \pm     28 $ \\
          $\ttbar\rightarrow{\rm other}$ & $112889 \pm    202 $ \\
aaa!
                                mc_resum & 142830.717 \\
                                   total & $142831 \pm    239 $ \\
                                    data & $143096 \pm    378 $ \\
INFO:root:import ROOT
INFO:root:wjets_el
INFO:root:no sums_NOMINAL/NOMINAL/wjets_el_sums_NOMINAL_NOMINAL_yield in <ROOT.TDirectoryFile object ("wjets_el") at 0x32b5460>
INFO:root:wjets_mu
INFO:root:no sums_NOMINAL/NOMINAL/wjets_mu_sums_NOMINAL_NOMINAL_yield in <ROOT.TDirectoryFile object ("wjets_mu") at 0x34e5820>
                                 process & wjets_el & wjets_mu \\
                       $\text{dibosons}$ & $ 49336 \pm    173 $ & $ 71732 \pm    210 $ \\
                                $\ttbar$ & $165555 \pm    260 $ & $239504 \pm    310 $ \\
$\text{W+jets} \rightarrow\tau_{h}\nu + {\rm jets}$ & $  1756 \pm    102 $ & $   254 \pm     44 $ \\
$\text{W+jets} \rightarrow\tau_{\ell}\nu + {\rm jets}$ & $205426 \pm   1073 $ & $342420 \pm   1463 $ \\
                     $\text{single top}$ & $ 39701 \pm     82 $ & $ 58978 \pm     99 $ \\
                            $\text{QCD}$ & $1641522 \pm 171568 $ & $879317 \pm 127706 $ \\
$\text{W+jets} \rightarrow\ell\nu+ {\rm jets}$ & $4402035 \pm   5504 $ & $7162457 \pm   7376 $ \\
                             $\text{DY}$ & $531004 \pm   1312 $ & $651180 \pm   1494 $ \\
aaa!
                                mc_resum & 7036335.175 & 9405841.628 \\
                                   total & $7036335 \pm 171665 $ & $9405842 \pm 127936 $ \\
                                    data & $7048070 \pm   2655 $ & $9461244 \pm   3076 $ \\


-- only the dy tautau are missing

make run_all_yields_dy_tautau

mc qcd norm:

INFO:root:data       =    13456.000000      116.000000
INFO:root:mc sum     =    16802.591552    16802.591552

-- try factor 3.

python stack_plot.py distrs/v37_test13_bunch1YIELDS_mc_2.root distrs/v37_test13_bunch1YIELDS/SingleMuon.root -o histosels/v37_test13_bunch1_yields1_dy_tautau/ --data-nick data_other --lumi 35800 -d yield --wjet 1.4 -c dy_mutau    --qcd-factor 2.5 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.s_top_mutau,s_top_lj,s_top_other:s_top.tt_mutau,tt_taultauh,tt_taulj,tt_other,tt_lj:tt

-- no, the error was due to hadding in wjets amcatnlo

finally with the usual mc qcd 2.5:

                                 process & dy_mutau & dy_mutau_3j & dy_eltau & dy_eltau_3j \\
                       $\text{dibosons}$ & $  1618 \pm     25 $ & $   421 \pm     13 $ & $  1073 \pm     21 $ & $   301 \pm     11 $ \\
                                $\ttbar$ & $  4786 \pm     43 $ & $  3261 \pm     36 $ & $  3286 \pm     36 $ & $  2252 \pm     30 $ \\
                     $\text{single top}$ & $  1045 \pm     13 $ & $   360 \pm      8 $ & $   686 \pm     11 $ & $   249 \pm      7 $ \\
$\text{DY}\rightarrow{\tau_{\ell}\tau_{h}}+ {\rm jets}$ & $ 72416 \pm    325 $ & $  4906 \pm     88 $ & $ 31084 \pm    220 $ & $  3136 \pm     74 $ \\
                            $\text{QCD}$ & $ 32953 \pm    537 $ & $  2592 \pm    122 $ & $ 40777 \pm    453 $ & $  3116 \pm    115 $ \\
$\text{W+jets} \rightarrow\ell\nu+ {\rm jets}$ & $ 72509 \pm    705 $ & $  5344 \pm     81 $ & $ 43304 \pm    529 $ & $  3648 \pm     69 $ \\
       $\text{DY}\rightarrow{\rm other}$ & $  9485 \pm    208 $ & $   685 \pm     38 $ & $ 13906 \pm    192 $ & $  1065 \pm     45 $ \\
aaa!
                                mc_resum & 194812.295 & 17569.271 & 134115.626 & 13767.060 \\
                                   total & $194812 \pm    969 $ & $ 17569 \pm    179 $ & $134116 \pm    756 $ & $ 13767 \pm    163 $ \\
                                    data & $197473 \pm    444 $ & $ 17721 \pm    133 $ & $132629 \pm    364 $ & $ 13456 \pm    116 $ \\


                                 process & dy_mutau & dy_mutau_3j & dy_eltau & dy_eltau_3j \\
                       $\text{dibosons}$ & $  1618 \pm     25 $ & $   421 \pm     13 $ & $  1073 \pm     21 $ & $   301 \pm     11 $ \\
                                $\ttbar$ & $  4786 \pm     43 $ & $  3261 \pm     36 $ & $  3286 \pm     36 $ & $  2252 \pm     30 $ \\
                     $\text{single top}$ & $  1045 \pm     13 $ & $   360 \pm      8 $ & $   686 \pm     11 $ & $   249 \pm      7 $ \\
$\text{DY}\rightarrow{\tau_{\ell}\tau_{h}}+ {\rm jets}$ & $ 72416 \pm    325 $ & $  4906 \pm     88 $ & $ 31084 \pm    220 $ & $  3136 \pm     74 $ \\
                            $\text{QCD}$ & $ 16268 \pm   6989 $ & $  9188 \pm   5333 $ & $ 38411 \pm  29786 $ & $   185 \pm     90 $ \\
$\text{W+jets} \rightarrow\ell\nu+ {\rm jets}$ & $ 72509 \pm    705 $ & $  5344 \pm     81 $ & $ 43304 \pm    529 $ & $  3648 \pm     69 $ \\
       $\text{DY}\rightarrow{\rm other}$ & $  9485 \pm    208 $ & $   685 \pm     38 $ & $ 13906 \pm    192 $ & $  1065 \pm     45 $ \\
aaa!
                                mc_resum & 178127.683 & 24165.154 & 131749.626 & 10835.602 \\
                                   total & $178128 \pm   7035 $ & $ 24165 \pm   5335 $ & $131750 \pm  29793 $ & $ 10836 \pm    147 $ \\
                                    data & $197473 \pm    444 $ & $ 17721 \pm    133 $ & $132629 \pm    364 $ & $ 13456 \pm    116 $ \\

flip to electron,muon:

python numbers_for_datacard.py histosels/v37_test13_bunch1_yields1_dy_tautau//dy_tautau_yields_data-qcd.root -y -d yield -c dy_eltau,dy_eltau_3j,dy_mutau,dy_mutau_3j --latex
python numbers_for_datacard.py histosels/v37_test13_bunch1_yields1_dy_tautau//dy_tautau_yields_mc-qcd.root   -y -d yield -c dy_eltau,dy_eltau_3j,dy_mutau,dy_mutau_3j --latex

                                 process & dy_eltau & dy_eltau_3j & dy_mutau & dy_mutau_3j \\
                       $\text{dibosons}$ & $  1073 \pm     21 $ & $   301 \pm     11 $ & $  1618 \pm     25 $ & $   421 \pm     13 $ \\
                                $\ttbar$ & $  3286 \pm     36 $ & $  2252 \pm     30 $ & $  4786 \pm     43 $ & $  3261 \pm     36 $ \\
                     $\text{single top}$ & $   686 \pm     11 $ & $   249 \pm      7 $ & $  1045 \pm     13 $ & $   360 \pm      8 $ \\
$\text{DY}\rightarrow{\tau_{\ell}\tau_{h}}+ {\rm jets}$ & $ 31084 \pm    220 $ & $  3136 \pm     74 $ & $ 72416 \pm    325 $ & $  4906 \pm     88 $ \\
                            $\text{QCD}$ & $ 40777 \pm    453 $ & $  3116 \pm    115 $ & $ 32953 \pm    537 $ & $  2592 \pm    122 $ \\
$\text{W+jets} \rightarrow\ell\nu+ {\rm jets}$ & $ 43304 \pm    529 $ & $  3648 \pm     69 $ & $ 72509 \pm    705 $ & $  5344 \pm     81 $ \\
       $\text{DY}\rightarrow{\rm other}$ & $ 13906 \pm    192 $ & $  1065 \pm     45 $ & $  9485 \pm    208 $ & $   685 \pm     38 $ \\
aaa!
                                mc_resum & 134115.626 & 13767.060 & 194812.295 & 17569.271 \\
                                   total & $134116 \pm    756 $ & $ 13767 \pm    163 $ & $194812 \pm    969 $ & $ 17569 \pm    179 $ \\
                                    data & $132629 \pm    364 $ & $ 13456 \pm    116 $ & $197473 \pm    444 $ & $ 17721 \pm    133 $ \\

                                 process & dy_eltau & dy_eltau_3j & dy_mutau & dy_mutau_3j \\
                       $\text{dibosons}$ & $  1073 \pm     21 $ & $   301 \pm     11 $ & $  1618 \pm     25 $ & $   421 \pm     13 $ \\
                                $\ttbar$ & $  3286 \pm     36 $ & $  2252 \pm     30 $ & $  4786 \pm     43 $ & $  3261 \pm     36 $ \\
                     $\text{single top}$ & $   686 \pm     11 $ & $   249 \pm      7 $ & $  1045 \pm     13 $ & $   360 \pm      8 $ \\
$\text{DY}\rightarrow{\tau_{\ell}\tau_{h}}+ {\rm jets}$ & $ 31084 \pm    220 $ & $  3136 \pm     74 $ & $ 72416 \pm    325 $ & $  4906 \pm     88 $ \\
                            $\text{QCD}$ & $ 38411 \pm  29786 $ & $   185 \pm     90 $ & $ 16268 \pm   6989 $ & $  9188 \pm   5333 $ \\
$\text{W+jets} \rightarrow\ell\nu+ {\rm jets}$ & $ 43304 \pm    529 $ & $  3648 \pm     69 $ & $ 72509 \pm    705 $ & $  5344 \pm     81 $ \\
       $\text{DY}\rightarrow{\rm other}$ & $ 13906 \pm    192 $ & $  1065 \pm     45 $ & $  9485 \pm    208 $ & $   685 \pm     38 $ \\
aaa!
                                mc_resum & 131749.626 & 10835.602 & 178127.683 & 24165.154 \\
                                   total & $131750 \pm  29793 $ & $ 10836 \pm    147 $ & $178128 \pm   7035 $ & $ 24165 \pm   5335 $ \\
                                    data & $132629 \pm    364 $ & $ 13456 \pm    116 $ & $197473 \pm    444 $ & $ 17721 \pm    133 $ \\


and use this:

                                 process & pre-$DY\rightarrow\tau_{e}\tau_{h}$ & $DY\rightarrow\tau_{e}\tau_{h}$ &  pre-$DY\rightarrow\tau_{\mu}\tau_{h}$ & $DY\rightarrow\tau_{\mu}\tau_{h}$ \\

                       $\text{dibosons}$ & $  1073 \pm     21 $ & $   301 \pm     11 $ & $  1618 \pm     25 $ & $   421 \pm     13 $ \\
                                $\ttbar$ & $  3286 \pm     36 $ & $  2252 \pm     30 $ & $  4786 \pm     43 $ & $  3261 \pm     36 $ \\
                     $\text{single top}$ & $   686 \pm     11 $ & $   249 \pm      7 $ & $  1045 \pm     13 $ & $   360 \pm      8 $ \\
$\text{DY}\rightarrow{\tau_{\ell}\tau_{h}}+ {\rm jets}$ & $ 31084 \pm    220 $ & $  3136 \pm     74 $ & $ 72416 \pm    325 $ & $  4906 \pm     88 $ \\
                            $\text{QCD}$ & $ 40777 \pm    453 $ & $  3116 \pm    115 $ & $ 32953 \pm    537 $ & $  2592 \pm    122 $ \\
                       ($\text{QCD MC}$) & ($ 38411 \pm  29786 $) & ($   185 \pm     90 $) & ($ 16268 \pm   6989 $) & ($  9188 \pm   5333 $) \\
$\text{W+jets} \rightarrow\ell\nu+ {\rm jets}$ & $ 43304 \pm    529 $ & $  3648 \pm     69 $ & $ 72509 \pm    705 $ & $  5344 \pm     81 $ \\
       $\text{DY}\rightarrow{\rm other}$ & $ 13906 \pm    192 $ & $  1065 \pm     45 $ & $  9485 \pm    208 $ & $   685 \pm     38 $ \\

                                   total & $134116 \pm    756 $ & $ 13767 \pm    163 $ & $194812 \pm    969 $ & $ 17569 \pm    179 $ \\
                                    data & $132629 \pm    364 $ & $ 13456 \pm    116 $ & $197473 \pm    444 $ & $ 17721 \pm    133 $ \\




### launch control distrs





### control distrs check if to add any more

add nvtx, rjets, all jets, dijet-trijet parameters, Mt tau-met

files:

v37_test13_bunchFULLFIT2
v37_test13_bunchFULLFIT2_mc_1.root
v37_test13_bunch1YIELDS
v37_test13_bunch1YIELDS_mc_1.root
v37_test13_bunchCONTROLS1
v37_test13_bunchCONTROLS1_mc_1.root
v37_test13_bunchFULLFIT1_mc_1_wNjets.root
v37_test13_bunchFULLFIT1
v37_test13_bunchDILEP1
v37_test13_bunchDILEP1_mc_2_wNjets.root
v37_test13_bunchDILEP1_mc_1_wNjets.root

ln -s v37_test13_bunchCONTROLS1_mc_1.root     v37_test13_bunchCONTROLS1_mc.root
ln -s v37_test13_bunchFULLFIT2_mc_1.root      v37_test13_bunchFULLFIT2_mc.root
ln -s v37_test13_bunchDILEP1_mc_2_wNjets.root v37_test13_bunchDILEP1_mc.root

-- no need for this step


make plot_tt_dilep         nt=v37 proc=test13 distrs=bunchDILEP1 lumi=35800 datafile=SingleMuon       options="--overwrite --factor-dy 1.05"
make plot_control_dy_mumu  nt=v37 proc=test13 distrs=bunchDILEP1 lumi=35800 datafile=SingleMuon       options="--overwrite --factor-dy 1.05"
make plot_control_dy_elel  nt=v37 proc=test13 distrs=bunchDILEP1 lumi=35800 datafile=SingleElectron   options="--overwrite --factor-dy 0.98"

make plot_control_dy_mutau nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 datafile=SingleMuon      options=--overwrite
make plot_control_dy_eltau nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 datafile=SingleElectron  options=--overwrite

make plot_control_wjets_mu nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 datafile=SingleMuon      options=--overwrite
make plot_control_wjets_el nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 datafile=SingleElectron  options=--overwrite

make plot_lj_1 nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 chan_tag=mu datafile=SingleMuon      options=--overwrite
make plot_lj_1 nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 chan_tag=el datafile=SingleElectron  options=--overwrite

make plot_presel_1  nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 presel_lev=Cand chan_tag=mu datafile=SingleMuon     title_lep=muon     options=--overwrite
make plot_presel_1  nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 presel_lev=Cand chan_tag=el datafile=SingleElectron title_lep=electron options=--overwrite

in presel dijet mass was not saved
-- and in wjets?


main selection:
make plot_sel_1  nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 chan_tag=mu datafile=SingleMuon     title_lep=muon
make plot_sel_1  nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 chan_tag=el datafile=SingleElectron title_lep=electron

-- missing bjet kinematics in MC, but present in data

make plot_sel_fit_1  nt=v37 proc=test13 distrs=bunchFULLFIT2 lumi=35800 chan_tag=el datafile=SingleElectron title_lep=electron  options="--data-nick data_other --overwrite"
make plot_sel_fit_1  nt=v37 proc=test13 distrs=bunchFULLFIT2 lumi=35800 chan_tag=mu datafile=SingleMuon     title_lep=muon      options="--data-nick data_other --overwrite"

also plots for paper:
make plot_sel_paper_1  nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 chan_tag=mu datafile=SingleMuon     title_lep=#mu
make plot_sel_paper_1  nt=v37 proc=test13 distrs=bunchCONTROLS1 lumi=35800 chan_tag=el datafile=SingleElectron title_lep=e



the plots for AN:

mkdir plots/v37_test13_update1/
cp plots/v37_test13_bunchDILEP1/* plots/v37_test13_update1/
cp plots/v37_test13_bunchCONTROLS1/* plots/v37_test13_update1/
cp plots/v37_test13_bunchFULLFIT2/*png plots/v37_test13_update1/
make --keep-going rename_for_update up=update1

make --keep-going up=update1 rename_for_update_mu_sel
make --keep-going up=update1 rename_for_update_el_sel

make --keep-going up=update1 rename_for_update_dileptons
make --keep-going up=update1 rename_for_update_wjets




## the question on BR-s

python sumup_ttree_draw.py "abs(gen_t_w_decay_id)" --cond-com "" --histo-range 1000,0.,1000 --output test_v37_tt_t_w_decay_id.root --histo-name test_v37_tt_t_w_decay_id gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root &

root -l test_v37_tt_t_w_decay_id.root
test_v37_tt_t_w_decay_id->Print()

TH1.Print Name  = test_v37_tt_t_w_decay_id, Entries= 17241154, Total sum= 1.72412e+07

test_v37_tt_t_w_decay_id->GetBinContent(0)
test_v37_tt_t_w_decay_id->GetBinContent(1)

test_v37_tt_t_w_decay_id->GetBinContent(test_v37_tt_t_w_decay_id->FindBin(1))
test_v37_tt_t_w_decay_id->GetBinContent(test_v37_tt_t_w_decay_id->FindBin(11))
test_v37_tt_t_w_decay_id->GetBinContent(test_v37_tt_t_w_decay_id->FindBin(13))


root [2] test_v37_tt_t_w_decay_id->GetBinContent(0)
(Double_t) 0.00000
root [3] test_v37_tt_t_w_decay_id->GetBinContent(1)
(Double_t) 0.00000
root [4] 
root [4] test_v37_tt_t_w_decay_id->GetBinContent(test_v37_tt_t_w_decay_id->FindBin(1))
(Double_t) 6.72204e+06
root [5] test_v37_tt_t_w_decay_id->GetBinContent(test_v37_tt_t_w_decay_id->FindBin(11))
(Double_t) 3.83131e+06
root [6] test_v37_tt_t_w_decay_id->GetBinContent(test_v37_tt_t_w_decay_id->FindBin(13))
(Double_t) 5.23046e+06

-- damn.. I need the record-all of at least 1 file

cd ~/work/private/16/CMSSW_8_0_29/src/UserCode/NtuplerAnalyzer
root -l NtuplerAnalyzer_test_METfiltersOFF_TTJets_test_signal_recordAll.root                                                                                                                                                                                                

((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(gen_t_w_decay_id) == 1")

((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(gen_t_w_decay_id) == 11")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(gen_t_w_decay_id) == 13")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(gen_t_w_decay_id) >  14")

((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(gen_tb_w_decay_id) == 11")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(gen_tb_w_decay_id) == 13")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(gen_tb_w_decay_id) >  14")

((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "")


86508
root [4] ((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(gen_t_w_decay_id) == 1")
(Long64_t) 58366
root [5] ((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(gen_t_w_decay_id) == 11")
(Long64_t) 9261
root [6] ((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(gen_t_w_decay_id) == 13")
(Long64_t) 9306
root [7] ((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(gen_t_w_decay_id) >  14")
(Long64_t) 9575

>>> 9261. / 86508.
0.10705368289637952
>>> 9306. / 86508.
0.1075738660008323
>>> 9575. / 86508.
0.1106834050030055

and I got in the past:

t_w_el = 9261
tb_w_el = 9368
t_w_mu = 9306
tb_w_mu = 9220
tb_w_tau = 9275
t_w_tau = 9575

N = 86508.

(t_w_el  + tb_w_el)  / (2 * N)
(t_w_mu  + tb_w_mu)  / (2 * N)
(t_w_tau + tb_w_tau) / (2 * N)

stat uncertainty

sqrt(t_w_el  + tb_w_el)  / (2 * N)
sqrt(t_w_mu  + tb_w_mu)  / (2 * N)
sqrt(t_w_tau + tb_w_tau) / (2 * N)

0.10767212280945115
0.10707680214546632
0.10894946132149627

0.0007888755647969944
0.0007866916899615009
0.000793541072371687

-- still significant stat fluctuations
   need at least 4 times more data to be sure about 3rd digit

-- but can use PS systematics


((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(gen_t_w_decay_id) == 11")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(gen_t_w_decay_id) == 13")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(gen_t_w_decay_id) >  14")

((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(gen_tb_w_decay_id) == 11")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(gen_tb_w_decay_id) == 13")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(gen_tb_w_decay_id) >  14")

((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "")


root -l NtuplerAnalyzer_test_METfiltersOFF_TTJets2_signal_recordAll.root
-- the used file

root -l NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrdown_signal_recordAll.root
-- practicallu empty, 1k test run

root -l NtuplerAnalyzer_test_METfiltersOFF_TTJets_1_signal_recordAll.root
root -l NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_HDAMPDown_2_signal_recordAll.root
root -l NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_HDAMPUp_2_signal_recordAll.root
root -l NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_signal_recordAll.root
root -l NtuplerAnalyzer_test_METfiltersOFF_TTJets_FSRDown_signal_recordAll.root

root -l NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneDown_2_signal_recordAll.root
root -l NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneDown_signal_recordAll.root
root -l NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneUp_2_signal_recordAll.root
root -l NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneUp_signal_recordAll.root
root -l NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrDown_2_signal_recordAll.root
root -l NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrUp_2_signal_recordAll.root
root -l NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrup_signal_recordAll.root

                                                     TuneUp_2 TuneUp       fsrUp_2  
N = [86508 57672 51546 54108 68886 53280 54432 80136 51930    58990  56980 90668    75736]

t_w_el   = [9261 6198 5485 5777 7509 5770 5808 8651 5423 6411 6078 9731  8253 ]
t_w_mu   = [9306 6327 5580 5986 7447 5621 5951 8565 5569 6322 6227 9844  8130 ]
t_w_tau  = [9575 6179 5464 5868 7588 5832 5903 8642 5603 6375 6108 9948  8196 ]
tb_w_el  = [9368 6013 5456 5852 7418 5850 5949 8423 5533 6469 6091 9680  8146 ]
tb_w_mu  = [9220 6387 5620 5877 7510 5784 5837 8742 5728 6172 6205 9784  8257 ]
tb_w_tau = [9275 6222 5496 5752 7468 5691 5791 8697 5514 6417 6085 9868  8088 ]

-- some tilt to muon decay in HDAMP?

sum(t_w_el  + tb_w_el)  / sum(2 * N)
sum(t_w_mu  + tb_w_mu)  / sum(2 * N)
sum(t_w_tau + tb_w_tau) / sum(2 * N)

sqrt(sum(t_w_el  + tb_w_el) ) / sum(2 * N)
sqrt(sum(t_w_mu  + tb_w_mu) ) / sum(2 * N)
sqrt(sum(t_w_tau + tb_w_tau)) / sum(2 * N)

0.10739030435072164

julia> sum(t_w_mu  + tb_w_mu)  / sum(2 * N)
0.1082198003976824

julia> sum(t_w_tau + tb_w_tau) / sum(2 * N)
0.10800989924744789

julia> sqrt(sum(t_w_el  + tb_w_el) ) / sum(2 * N)
0.00025269845877785066

julia> sqrt(sum(t_w_mu  + tb_w_mu) ) / sum(2 * N)
0.00025367251859464724

julia> sqrt(sum(t_w_tau + tb_w_tau)) / sum(2 * N)
0.0002534263898958033

they are close to
const double W_lep_br = 0.108;
but not perfect, some files show clear bias to some channels:
both t and tb decay more into muon in HDAMP datasets etc
and the deviations between channels in a given dataset are larger than the possible statistical fluctuations



and parameters on MCM?

/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/RunIISummer16MiniAODv2-PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/MINIAODSIM : {LumiMask: '', dtag: MC2016_Summer16_TTJets_powheg, isMC: true, xsec: 831.75999999999999}



## after v37 issues, full fit

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleMuon.root     -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c mu_sel --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleMuon.root     -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c mu_sel --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleMuon.root     -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c mu_sel_lj --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_lj --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleMuon.root     -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c mu_sel_ljout --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_ljout --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleMuon.root     -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c mu_sel_lj    -x mu_selVloose_lj     --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_lj    -x el_selVloose_lj     --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleMuon.root     -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c mu_sel_ljout -x mu_selVloose_ljout --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel_ljout -x el_selVloose_ljout --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05

-- overall similar as before, mu lacks in normalization, the pre-last bin lack data in both channels now
   check new PU normalization

wjets 1.4 factor:

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleMuon.root     -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets_wjets1.4/ -c mu_sel_lj    -x mu_selVloose_lj     --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets_wjets1.4/ -c el_sel_lj    -x el_selVloose_lj     --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleMuon.root     -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets_wjets1.4/ -c mu_sel_ljout -x mu_selVloose_ljout --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets_wjets1.4/ -c el_sel_ljout -x el_selVloose_ljout --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05

mu_lj is worst normalization

INFO:root:data       =     9831.000000      292.381342
INFO:root:mc sum     =    10325.577599    10325.577599

el_lj is ok:

INFO:root:data       =     6690.000000      245.655645
INFO:root:mc sum     =     6841.523967     6841.523967

-- strange



### new PU normalization


## after v37 issues, selection and preselection

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleMuon.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c mu_sel --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleMuon.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c mu_sel --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleMuon.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c mu_sel --data-nick data_other -d met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05

python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
python stack_plot.py distrs/v37_test13_bunchFULLFIT1_mc_1_wNjets.root distrs/v37_test13_bunchFULLFIT1/SingleElectron.root -p -r -o plots/v37_test13_bunchFULLFIT1_mc_1_wNjets/ -c el_sel --data-nick data_other -d met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05





## after v37 issues, wjets






## after v37 issues, dilepton control plots

tt_elmu:

python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_2_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root -p -r -o plots/v37_test13_bunchDILEP1_mc_2_wNjets/ -c tt_elmu --data-nick data_other -d elmu_el_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_2_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root -p -r -o plots/v37_test13_bunchDILEP1_mc_2_wNjets/ -c tt_elmu --data-nick data_other -d elmu_el_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5 --sys TOPPTUp

python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_2_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root -p -r -o plots/v37_test13_bunchDILEP1_mc_2_wNjets/ -c tt_elmu --data-nick data_other -d elmu_mu_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_2_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root -p -r -o plots/v37_test13_bunchDILEP1_mc_2_wNjets/ -c tt_elmu --data-nick data_other -d elmu_mu_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5 --sys TOPPTUp

python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_2_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root -p -r -o plots/v37_test13_bunchDILEP1_mc_2_wNjets/ -c tt_elmu --data-nick data_other -d elmu_el_eta  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_2_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root -p -r -o plots/v37_test13_bunchDILEP1_mc_2_wNjets/ -c tt_elmu --data-nick data_other -d elmu_mu_eta  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_2_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root -p -r -o plots/v37_test13_bunchDILEP1_mc_2_wNjets/ -c tt_elmu --data-nick data_other -d Mt_lep_met_c  --lumi 35800 --overwrite --wjets 0.92 --bin-norm --qcd-factor 2.5
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_2_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root -p -r -o plots/v37_test13_bunchDILEP1_mc_2_wNjets/ -c tt_elmu --data-nick data_other -d Mt_lep_met_c  --lumi 35800 --overwrite --wjets 0.92 --bin-norm --qcd-factor 2.5 --sys TOPPTUp

eog plots/v37_test13_bunchDILEP1_mc_2_wNjets//dist*elmu_??_pt*
eog plots/v37_test13_bunchDILEP1_mc_2_wNjets//dist*elmu_??_eta*
eog plots/v37_test13_bunchDILEP1_mc_2_wNjets//dist*Mt_lep_met*

-- Mt ok!
   eta -- same bin-by-bin strangeness
   pT  -- same slight kink in el and even slighter in mu
          due to BCDEF or just that SF jump at 85GeV?


dy_mumu

python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_2_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root -p -r -o plots/v37_test13_bunchDILEP1_mc_2_wNjets/ -c dy_mumu --data-nick data_other -d Mt_lep_met_c  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_2_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root -p -r -o plots/v37_test13_bunchDILEP1_mc_2_wNjets/ -c dy_mumu --data-nick data_other -d lep_pt   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_2_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root -p -r -o plots/v37_test13_bunchDILEP1_mc_2_wNjets/ -c dy_mumu --data-nick data_other -d lep_eta  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_2_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root -p -r -o plots/v37_test13_bunchDILEP1_mc_2_wNjets/ -c dy_mumu --data-nick data_other -d met_c    --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_2_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root -p -r -o plots/v37_test13_bunchDILEP1_mc_2_wNjets/ -c dy_mumu --data-nick data_other -d dilep_mass_dy    --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_2_wNjets.root distrs/v37_test13_bunchDILEP1/SingleElectron.root -p -r -o plots/v37_test13_bunchDILEP1_mc_2_wNjets/ -c dy_elel --data-nick data_other -d Mt_lep_met_c  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 0.001
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_2_wNjets.root distrs/v37_test13_bunchDILEP1/SingleElectron.root -p -r -o plots/v37_test13_bunchDILEP1_mc_2_wNjets/ -c dy_elel --data-nick data_other -d lep_pt   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 0.001
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_2_wNjets.root distrs/v37_test13_bunchDILEP1/SingleElectron.root -p -r -o plots/v37_test13_bunchDILEP1_mc_2_wNjets/ -c dy_elel --data-nick data_other -d lep_eta  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 0.001
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_2_wNjets.root distrs/v37_test13_bunchDILEP1/SingleElectron.root -p -r -o plots/v37_test13_bunchDILEP1_mc_2_wNjets/ -c dy_elel --data-nick data_other -d met_c    --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 0.001
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_2_wNjets.root distrs/v37_test13_bunchDILEP1/SingleElectron.root -p -r -o plots/v37_test13_bunchDILEP1_mc_2_wNjets/ -c dy_elel --data-nick data_other -d dilep_mass_dy    --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 0.001

eog plots/v37_test13_bunchDILEP1_mc_2_wNjets//dist*_dy_*

-- Mt is ok, but same issues as before:
   the deviations in lep eta endcaps, more so in elel
   the bend in mumu met_c
   the difference in normalizations: mumu not enough MC, elel too much MC
   -- maybe Madgraph has wrong Z branching ratios? or PU normalizations are so different?

normalizations

elel:

INFO:root:data       =  6387979.000000    15430.844912
INFO:root:mc sum     =  6672197.586828  6672197.586828

mumu:

INFO:root:data       = 14649695.000000    22946.804093
INFO:root:mc sum     = 13831187.875497 13831187.875497





## v37 issues, round4 with dileptons

**eta in DY elel**
1) was it always there?
   YES, in test5, test6
   also dy_mumu has a bit more MC in eta endcaps, the deviation is smaller than in elel
2) can it be due to Z mass?
   why so sharp transition between barrel and endcaps then?

   yeah, Z mass has noticeable effect, larger Z mass produces less events in endcaps,
   but comparing to data we need to make the opposite re-weighting:
   shift MC to smaller Z masses, which will make even more endcap events in MC,
   and the second-order effect from lep SFs remains second order:
   the eta distrs with lep SF corrections are close to the original ones in small and large Z mass

   + can there be an opposite effect:
     less large Z mass means less events in barrel, which flattens the eta distribution?

3) b SF weight is included?
   yeap, but it does not matter

**weird trend in DY mumu met**
1) and mT is worse than before? (test5, test6 are flat, now there is a bend at 100-150, like in w+jets)

**get correct BCDEF and GH PU**
-- got them, the result is the same as in test5 before the averaging of PU with muon SFs......

**allso split the b tagging SF per BCDEF and GH?**

**deviation in elmu**:
strange kink in lep pT (seen well in separated el and mu pT),
slight bin-by-bin deviation in lep eta, dip at eta = -0.3
deviation in met and small deviation on edges of mT
1) TOPPT?
   -- does correct things well, especially in mT, but not completely
2) due to the deviation at large met?
   -- might be a problem in met propagation?
      but why the slight deviation in leading lepton eta and in lep pT?
   -- might be just correlation with lepton pT
      + check separate electron and muon kinametics in test7
        yeap, they show the deviations better
      + run tests on TT with met variations -- how it propagates to mT?
       (won't solve eta and pT though)
        check MC cumulative fractions to confirm the largest met is from TT
3) which is due to the remaining MC processes at small lep pT?
   -- looks like not much changed with full MC
   + check in fixed remaining files, including single-top s channel and dibosons
     yeap, with all files correctly processed the problems are clearly seen
     in the separated electron and muon pTs
5) check the effect of bSF weight
   -- negligible
or)
    1) produce tight TT elmu to get rid of DY, single-top and dibosons?
	   -- better, but even this is not perfect
    2) implement muon-trigger elmu as the old one?
	   -- as bad
    3) try to find how the very old and good elmu and mumu were produced with those .C scripts?
	   v12.7_dilep/QuickNtupleDistr_test_elmu_MTlep.png
	   the problem is:
	       what can there be except PU and lepton SFs?
	       No cuts on N jets are made,
		   b SF is applied, but I checked it is negligible and flat in mT
	   --- found

So, again something is wrong with lepton SFs?
Incorrect average of BCDEF and GH for PU and muon ID?
+ compare to separate epochs data
  -- more visible in muons, kind of the same in electrons,
     the curve of the kink is a bit different



### finding the old files

perfect elmu:

	   v12.7_dilep/QuickNtupleDistr_test_elmu_MTlep.png

made with test/ntuple_distr.cc

some production is still in:

~/work/private/16/CMSSW_8_0_25/src/UserCode/ttbar-leptons-80X

last_jobs:ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f f 19094 16079 "MTlep" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(25,0,250)" INVESTIGATION-test_elmu_Mt-lep-met " Mt " " Events " outdir/v12.7_dilep/merged-sets `cat v12.7_dilep_dtags`

/eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets
/eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_test_elmu_MTlep.png

-- the file

the arguments should mean this:

const char usage_string[256] = " [--verbose] [--normalize] sig global_scale withZPtMass tau_ID_SF with_b_SF with_lep_SF with_lep_trig_SF with_PU_weight SYS_shift set_logy unstack writeRootFile lumi_bcdef lumi_gh distr distr_cond range out_name distr_name Y_name dir dtags";

-- so, b, both lepton SFs and PU are ON

and dxy, dz are checked


in the script:

        // lepton SF
        if (with_lep_SF)
            {
            TString lepton_SF_call("");
            if (sig == TString("mu") || sig == TString("elmu") || sig == TString("tt"))
                {
                lepton_SF_call.Form("(lepton_muon_SF(abs(lep_p4[0].eta()), lep_p4[0].pt(), %f, %f))*", lumi_bcdef/lumi, lumi_gh/lumi);
                }
            else // assume single-electron as only alternative
                {
                lepton_SF_call.Form("(lepton_electron_SF(lep_p4[0].eta(), lep_p4[0].pt()))*");
                }
            weight_cond += lepton_SF_call;
            }

        if (with_lep_trig_SF)                                                                                                                                      
            {
            TString lepton_trig_SF_call("");
            if (sig == TString("mu") || sig == TString("elmu") || sig == TString("tt"))
                {
                lepton_trig_SF_call.Form("(lepton_muon_trigger_SF(abs(lep_p4[0].eta()), lep_p4[0].pt(), %f, %f))*", lumi_bcdef/lumi, lumi_gh/lumi);
                }
            else
                {
                lepton_trig_SF_call.Form("(lepton_electron_trigger_SF(lep_p4[0].eta(), lep_p4[0].pt()))*");
                }
            weight_cond += lepton_trig_SF_call;
            }

-- primitiv stuff



#### check dxy, dz

root -l gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/MC2016_Summer16_TTJets_powheg_1.root

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_dxy[0]", "leps_ID==-11*13")
5543

std dev 0.0033
but might be non-gaussian

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_dz[0]", "leps_ID==-11*13 && lep_dxy[0] < 0.01 && lep_dz[0] < 0.02")

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_dxy[0]", "leps_ID==-11*13 && lep_dxy[0] < 0.01 && lep_dz[0] < 0.02")
5419

0.9776294425401407

-- smaller than the problem?

dxy and dz are not abs now!

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_dxy[0]", "leps_ID==-11*13 && abs(lep_dxy[0]) < 0.01 && abs(lep_dz[0]) < 0.02")
5337

0.9628360093812015
sqrt(5543.) / 5543.
0.013431594151495127

the limits for muons:
dxy, dz = 0.01 and 0.02 (0.2 and 0.5 actually)
and electrons:
barrel -
 		passStdImpactParameter = dxy < 0.05 && dz < 0.1;
endcap -
 		passStdImpactParameter = dxy < 0.1 && dz < 0.2;

-- and for electrons they are applied at selection in ntuples!

test11 with the old impacts on muon in elmu




### correct PU per epochs

added the comparison of nominals in NtuplerAnalyser/studies/pilep-per-epoch

indeed the calculated PU are weird

also included the Golden Json separated into BCDEF and GH

-- to produce the Up Down variations on lxplus


#### result in tt_elmu

python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_1_amcatnlo.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_el_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_1_amcatnlo.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_el_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5 --sys TOPPTUp

python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_1_amcatnlo.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_mu_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_1_amcatnlo.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_mu_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5 --sys TOPPTUp

compare with old:
plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/

elmu_el_pt no difference
elmu_mu_pt no difference, only normalization


how do eta look like:

python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_1_amcatnlo.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_el_eta --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_1_amcatnlo.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_mu_eta --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

eog plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu//distrs,v37_test8_bunchDILEP3_mc_1_amcatnlo_distrs,v37_test5_bunchDILEP3,,SingleElectron_elmu_el_eta_tt_elmu_NOMINAL_stack_ratio.png    plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/distrs,v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu_distrs,v37_test5_bunchDILEP3,,SingleElectron_elmu_el_eta_tt_elmu_NOMINAL_stack_ratio.png
eog plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu//distrs,v37_test8_bunchDILEP3_mc_1_amcatnlo_distrs,v37_test5_bunchDILEP3,,SingleElectron_elmu_mu_eta_tt_elmu_NOMINAL_stack_ratio.png    plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/distrs,v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu_distrs,v37_test5_bunchDILEP3,,SingleElectron_elmu_mu_eta_tt_elmu_NOMINAL_stack_ratio.png

-- same deviations, plus a bit of normalization issue

So, what is it?

Check no weight histos:

v37_test8_bunchDILEP3_INITIAL_mc_1_amcatnlo.root

python stack_plot.py distrs/v37_test8_bunchDILEP3_INITIAL_mc_1_amcatnlo.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_el_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5 --sys INITIAL --normalize
python stack_plot.py distrs/v37_test8_bunchDILEP3_INITIAL_mc_1_amcatnlo.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_mu_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5 --sys INITIAL --normalize

eog plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu//distrs,v37_test8_bunchDILEP3_INITIAL_mc_1_amcatnlo_distrs,v37_test5_bunchDILEP3,,SingleElectron_elmu_el_pt_tt_elmu_INITIAL_stack_ratio_normalize.png plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/distrs,v37_test8_bunchDILEP3_mc_1_amcatnlo_distrs,v37_test5_bunchDILEP3,,SingleElectron_elmu_el_pt_tt_elmu_NOMINAL_stack_ratio.png

eog plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu//distrs,v37_test8_bunchDILEP3_INITIAL_mc_1_amcatnlo_distrs,v37_test5_bunchDILEP3,,SingleElectron_elmu_mu_pt_tt_elmu_INITIAL_stack_ratio_normalize.png plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/distrs,v37_test8_bunchDILEP3_mc_1_amcatnlo_distrs,v37_test5_bunchDILEP3,,SingleElectron_elmu_mu_pt_tt_elmu_NOMINAL_stack_ratio.png

looks like weights make it worse

without normalization to data you see the Data-MC difference is smaller at low pT
and the SFs are larger there -- hence the stronger bend after the weights

redo Data in test6 to be sure about the pT cut

or:

root -l lstore_outdirs/v37/test5/Data13TeV_SingleMuon2016G_03Feb2017_v1/Data13TeV_SingleMuon2016G_03Feb2017_v1_1.root

ttree_out->Draw("event_leptons[0].pt()>>h(100,0,50)", "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_bSF")
ttree_out->Draw("event_leptons[1].pt()>>h(100,0,50)", "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_bSF")

-- clearly 26GeV cut in lep0 and 30GeV in lep1!

root -l lstore_outdirs/v37/test6/Data13TeV_SingleMuon2016G_03Feb2017_v1/Data13TeV_SingleMuon2016G_03Feb2017_v1_1.root

-- both 32GeV

run full script

python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210)" --histo-range 100,0,50 --output test_tt_elmu_Data_test5_lep_pt_edge.root --histo-name test_tt_elmu_Data_test5_lep_pt_edge lstore_outdirs/v37/test5/Data13TeV_SingleEle*/Data13TeV*.root &
python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210)" --histo-range 100,0,50 --output test_tt_elmu_Data_test6_lep_pt_edge.root --histo-name test_tt_elmu_Data_test6_lep_pt_edge lstore_outdirs/v37/test6/Data13TeV_SingleEle*/Data13TeV*.root &

root -l test_tt_elmu_Data_test5_lep_pt_edge.root
root -l test_tt_elmu_Data_test6_lep_pt_edge.root

test_tt_elmu_Data_test5_lep_pt_edge->Draw("hist")
test_tt_elmu_Data_test5_lep_pt_edge->Print()
test_tt_elmu_Data_test6_lep_pt_edge->Draw("hist")
test_tt_elmu_Data_test6_lep_pt_edge->Print()

-- test5 at 26, Entries= 200051, Total sum= 97561
   test6 at 32, Entries= 164236, Total sum= 64657

rm `cat batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_104.root batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_30.root batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_36.root batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_43.root batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_46.root batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_52.root batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_66.root batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_69.root batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_77.root batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_80.root batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_81.root | sed '/^time.*tt_dilep/ s,.*\(jobsums.*Data[^.]*.root\).*,\1, p' -n`

grep -l Data13TeV_SingleMuon2016B_03Feb2017_ver2_104 queue_dir/v37/test6/jobs_dir/job_*
grep -l Data13TeV_SingleMuon2016B_03Feb2017_ver2_30  queue_dir/v37/test6/jobs_dir/job_*
grep -l Data13TeV_SingleMuon2016B_03Feb2017_ver2_36  queue_dir/v37/test6/jobs_dir/job_*
grep -l Data13TeV_SingleMuon2016B_03Feb2017_ver2_43  queue_dir/v37/test6/jobs_dir/job_*
grep -l Data13TeV_SingleMuon2016B_03Feb2017_ver2_46  queue_dir/v37/test6/jobs_dir/job_*
grep -l Data13TeV_SingleMuon2016B_03Feb2017_ver2_52  queue_dir/v37/test6/jobs_dir/job_*
grep -l Data13TeV_SingleMuon2016B_03Feb2017_ver2_66  queue_dir/v37/test6/jobs_dir/job_*
grep -l Data13TeV_SingleMuon2016B_03Feb2017_ver2_69  queue_dir/v37/test6/jobs_dir/job_*
grep -l Data13TeV_SingleMuon2016B_03Feb2017_ver2_77  queue_dir/v37/test6/jobs_dir/job_*
grep -l Data13TeV_SingleMuon2016B_03Feb2017_ver2_80  queue_dir/v37/test6/jobs_dir/job_*
grep -l Data13TeV_SingleMuon2016B_03Feb2017_ver2_81  queue_dir/v37/test6/jobs_dir/job_*

grep queue_dir/v37/test6/jobs_dir/job_00813 queue_dir/v37/test6/jobs_dir/submit
grep queue_dir/v37/test6/jobs_dir/job_00817 queue_dir/v37/test6/jobs_dir/submit
grep queue_dir/v37/test6/jobs_dir/job_00816 queue_dir/v37/test6/jobs_dir/submit
grep queue_dir/v37/test6/jobs_dir/job_00814 queue_dir/v37/test6/jobs_dir/submit
grep queue_dir/v37/test6/jobs_dir/job_00810 queue_dir/v37/test6/jobs_dir/submit
grep queue_dir/v37/test6/jobs_dir/job_00820 queue_dir/v37/test6/jobs_dir/submit
grep queue_dir/v37/test6/jobs_dir/job_00818 queue_dir/v37/test6/jobs_dir/submit
grep queue_dir/v37/test6/jobs_dir/job_00811 queue_dir/v37/test6/jobs_dir/submit
grep queue_dir/v37/test6/jobs_dir/job_00819 queue_dir/v37/test6/jobs_dir/submit
grep queue_dir/v37/test6/jobs_dir/job_00812 queue_dir/v37/test6/jobs_dir/submit
grep queue_dir/v37/test6/jobs_dir/job_00815 queue_dir/v37/test6/jobs_dir/submit

qsub -l h_vmem=1G '/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/./queue_dir/v37/test6/jobs_dir/job_00813' 
qsub -l h_vmem=1G '/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/./queue_dir/v37/test6/jobs_dir/job_00817' 
qsub -l h_vmem=1G '/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/./queue_dir/v37/test6/jobs_dir/job_00816' 
qsub -l h_vmem=1G '/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/./queue_dir/v37/test6/jobs_dir/job_00814' 
qsub -l h_vmem=1G '/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/./queue_dir/v37/test6/jobs_dir/job_00810' 
qsub -l h_vmem=1G '/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/./queue_dir/v37/test6/jobs_dir/job_00820' 
qsub -l h_vmem=1G '/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/./queue_dir/v37/test6/jobs_dir/job_00818' 
qsub -l h_vmem=1G '/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/./queue_dir/v37/test6/jobs_dir/job_00811' 
qsub -l h_vmem=1G '/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/./queue_dir/v37/test6/jobs_dir/job_00819' 
qsub -l h_vmem=1G '/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/./queue_dir/v37/test6/jobs_dir/job_00812' 
qsub -l h_vmem=1G '/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/./queue_dir/v37/test6/jobs_dir/job_00815' 


grep Data13TeV_SingleMuon2016B_03Feb2017_ver2_104 batch_jobs/submit
grep Data13TeV_SingleMuon2016B_03Feb2017_ver2_30  batch_jobs/submit
grep Data13TeV_SingleMuon2016B_03Feb2017_ver2_36  batch_jobs/submit
grep Data13TeV_SingleMuon2016B_03Feb2017_ver2_43  batch_jobs/submit
grep Data13TeV_SingleMuon2016B_03Feb2017_ver2_46  batch_jobs/submit
grep Data13TeV_SingleMuon2016B_03Feb2017_ver2_52  batch_jobs/submit
grep Data13TeV_SingleMuon2016B_03Feb2017_ver2_66  batch_jobs/submit
grep Data13TeV_SingleMuon2016B_03Feb2017_ver2_69  batch_jobs/submit
grep Data13TeV_SingleMuon2016B_03Feb2017_ver2_77  batch_jobs/submit
grep Data13TeV_SingleMuon2016B_03Feb2017_ver2_80  batch_jobs/submit
grep Data13TeV_SingleMuon2016B_03Feb2017_ver2_81  batch_jobs/submit

qsub -l h_vmem=512M "/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_104.root"
qsub -l h_vmem=512M "/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_30.root"
qsub -l h_vmem=512M "/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_36.root"
qsub -l h_vmem=512M "/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_43.root"
qsub -l h_vmem=512M "/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_46.root"
qsub -l h_vmem=512M "/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_52.root"
qsub -l h_vmem=512M "/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_66.root"
qsub -l h_vmem=512M "/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_69.root"
qsub -l h_vmem=512M "/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_77.root"
qsub -l h_vmem=512M "/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_80.root"
qsub -l h_vmem=512M "/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/batch_jobs/j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_81.root"


find jobsums/distrs/v37_test6_bunchDILEP3/all/ -name Data13TeV_SingleMuon2016B_03Feb2017_ver2_104.root -delete
find jobsums/distrs/v37_test6_bunchDILEP3/all/ -name Data13TeV_SingleMuon2016B_03Feb2017_ver2_30.root  -delete
find jobsums/distrs/v37_test6_bunchDILEP3/all/ -name Data13TeV_SingleMuon2016B_03Feb2017_ver2_36.root  -delete
find jobsums/distrs/v37_test6_bunchDILEP3/all/ -name Data13TeV_SingleMuon2016B_03Feb2017_ver2_43.root  -delete
find jobsums/distrs/v37_test6_bunchDILEP3/all/ -name Data13TeV_SingleMuon2016B_03Feb2017_ver2_46.root  -delete
find jobsums/distrs/v37_test6_bunchDILEP3/all/ -name Data13TeV_SingleMuon2016B_03Feb2017_ver2_52.root  -delete
find jobsums/distrs/v37_test6_bunchDILEP3/all/ -name Data13TeV_SingleMuon2016B_03Feb2017_ver2_66.root  -delete
find jobsums/distrs/v37_test6_bunchDILEP3/all/ -name Data13TeV_SingleMuon2016B_03Feb2017_ver2_69.root  -delete
find jobsums/distrs/v37_test6_bunchDILEP3/all/ -name Data13TeV_SingleMuon2016B_03Feb2017_ver2_77.root  -delete
find jobsums/distrs/v37_test6_bunchDILEP3/all/ -name Data13TeV_SingleMuon2016B_03Feb2017_ver2_80.root  -delete
find jobsums/distrs/v37_test6_bunchDILEP3/all/ -name Data13TeV_SingleMuon2016B_03Feb2017_ver2_81.root  -delete

wc -l j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_81.root.e42214 j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_69.root.e42211 j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_80.root.e42213 j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_77.root.e42212 j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_52.root.e42209 j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_66.root.e42210 j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_46.root.e42208 j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_43.root.e42207 j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_36.root.e42206 j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_30.root.e42205 j_Data13TeV_SingleMuon2016B_03Feb2017_ver2_104.root.e42204


python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_1_amcatnlo.root distrs/v37_test6_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_el_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_1_amcatnlo.root distrs/v37_test6_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_mu_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

eog plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu//distrs,v37_test8_bunchDILEP3_mc_1_amcatnlo_distrs,v37_test5_bunchDILEP3,,SingleElectron_elmu_el_pt_tt_elmu_NOMINAL_stack_ratio.png plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu//distrs,v37_test8_bunchDILEP3_mc_1_amcatnlo_distrs,v37_test6_bunchDILEP3,,SingleElectron_elmu_el_pt_tt_elmu_NOMINAL_stack_ratio.png

eog plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu//distrs,v37_test8_bunchDILEP3_mc_1_amcatnlo_distrs,v37_test5_bunchDILEP3,,SingleElectron_elmu_mu_pt_tt_elmu_NOMINAL_stack_ratio.png plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu//distrs,v37_test8_bunchDILEP3_mc_1_amcatnlo_distrs,v37_test6_bunchDILEP3,,SingleElectron_elmu_mu_pt_tt_elmu_NOMINAL_stack_ratio.png

-- no difference????????
   6GeV muon and 2GeV electron
   the tests showed them different in test5 and test6

python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_1_amcatnlo.root distrs/v37_test6_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_el_eta --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_1_amcatnlo.root distrs/v37_test6_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_mu_eta --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

test the same distr with sumut draw script:

python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210)" --histo-range 40,0,200 --output test_tt_elmu_Data_test5_lep_pt.root --histo-name test_tt_elmu_Data_test5_lep_pt lstore_outdirs/v37/test5/Data13TeV_SingleEle*/Data13TeV*.root &
python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210)" --histo-range 40,0,200 --output test_tt_elmu_Data_test6_lep_pt.root --histo-name test_tt_elmu_Data_test6_lep_pt lstore_outdirs/v37/test6/Data13TeV_SingleEle*/Data13TeV*.root &


root -l test_tt_elmu_Data_test5_lep_pt.root
test_tt_elmu_Data_test5_lep_pt->Draw("hist")
test_tt_elmu_Data_test5_lep_pt->Print()

root -l test_tt_elmu_Data_test6_lep_pt.root
test_tt_elmu_Data_test6_lep_pt->Draw("hist")
test_tt_elmu_Data_test6_lep_pt->Print()

-- (test5 at 26, Entries= 200051, Total sum= 97561)
    now Entries= 200051, Total sum= 197990
   (test6 at 32, Entries= 164236, Total sum= 64657)
    now Entries= 164236, Total sum= 162194

hadd test_tt_elmu_Data_test_5_6_lep_pt.root test_tt_elmu_Data_test5_lep_pt.root test_tt_elmu_Data_test6_lep_pt.root

root -l test_tt_elmu_Data_test_5_6_lep_pt.root

test_tt_elmu_Data_test6_lep_pt->SetLineColor(kRed)

test_tt_elmu_Data_test5_lep_pt->Draw("hist")
test_tt_elmu_Data_test6_lep_pt->Draw("hist same")

-- different by a whole bin
   the reproduced test5 is not from test5 then?

compare these to the processed in the loop

python jobsums/get_shapes.py --formula "test5_loop:test5_scr" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj test5_loop:jobsums/distrs/v37_test5_bunchDILEP3/SingleElectron.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_lep_pt test5_scr:test_tt_elmu_Data_test_5_6_lep_pt.root:test_tt_elmu_Data_test5_lep_pt

-- different distrs

python jobsums/get_shapes.py --formula "test6_loop:test6_scr" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj test6_loop:jobsums/distrs/v37_test6_bunchDILEP3/SingleElectron.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_lep_pt test6_scr:test_tt_elmu_Data_test_5_6_lep_pt.root:test_tt_elmu_Data_test6_lep_pt

-- perfect match

python jobsums/get_shapes.py --formula "test5_loop:test5_scr:test6_loop:test6_scr" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj test5_loop:jobsums/distrs/v37_test5_bunchDILEP3/SingleElectron.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_lep_pt test5_scr:test_tt_elmu_Data_test_5_6_lep_pt.root:test_tt_elmu_Data_test5_lep_pt test6_loop:jobsums/distrs/v37_test6_bunchDILEP3/SingleElectron.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_lep_pt test6_scr:test_tt_elmu_Data_test_5_6_lep_pt.root:test_tt_elmu_Data_test6_lep_pt

python jobsums/get_shapes.py --formula "test5_loop:test5_scr:0.95 test6_loop:1.05 test6_scr" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj test5_loop:jobsums/distrs/v37_test5_bunchDILEP3/SingleElectron.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_lep_pt test5_scr:test_tt_elmu_Data_test_5_6_lep_pt.root:test_tt_elmu_Data_test5_lep_pt test6_loop:jobsums/distrs/v37_test6_bunchDILEP3/SingleElectron.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_lep_pt test6_scr:test_tt_elmu_Data_test_5_6_lep_pt.root:test_tt_elmu_Data_test6_lep_pt

-- yeap, only test5 sumup script is different from the rest

So, what on Earth is this kink?????????


python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_1_amcatnlo.root distrs/v37_test6_bunchDILEP3//SingleMuon.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_el_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_1_amcatnlo.root distrs/v37_test6_bunchDILEP3//SingleMuon.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_mu_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

eog plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu//distrs,v37_test8_bunchDILEP3_mc_1_amcatnlo_distrs,v37_test6_bunchDILEP3,,SingleMuon_elmu_el_pt_tt_elmu_NOMINAL_stack_ratio.png plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu//distrs,v37_test8_bunchDILEP3_mc_1_amcatnlo_distrs,v37_test6_bunchDILEP3,,SingleMuon_elmu_mu_pt_tt_elmu_NOMINAL_stack_ratio.png

-- kind of same kinks


python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210)"                      --histo-range 40,0,200 --output test_tt_elmu_TT_test5_lep_pt.root       --histo-name test_tt_elmu_TT_test5_lep_pt        lstore_outdirs/v37/test8/MC2016_Summer16_TTJets_powheg/MC*root &
python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight"       --histo-range 40,0,200 --output test_tt_elmu_TT_test5_lep_pt_nom.root   --histo-name test_tt_elmu_TT_test5_lep_pt_nom    lstore_outdirs/v37/test8/MC2016_Summer16_TTJets_powheg/MC*root &
python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_init"  --histo-range 40,0,200 --output test_tt_elmu_TT_test5_lep_pt_init.root  --histo-name test_tt_elmu_TT_test5_lep_pt_init   lstore_outdirs/v37/test8/MC2016_Summer16_TTJets_powheg/MC*root &
python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_PU"    --histo-range 40,0,200 --output test_tt_elmu_TT_test5_lep_pt_PU.root    --histo-name test_tt_elmu_TT_test5_lep_pt_PU     lstore_outdirs/v37/test8/MC2016_Summer16_TTJets_powheg/MC*root &
python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_PU_el" --histo-range 40,0,200 --output test_tt_elmu_TT_test5_lep_pt_PU_el.root --histo-name test_tt_elmu_TT_test5_lep_pt_PU_el  lstore_outdirs/v37/test8/MC2016_Summer16_TTJets_powheg/MC*root &
python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_PU_mu" --histo-range 40,0,200 --output test_tt_elmu_TT_test5_lep_pt_PU_mu.root --histo-name test_tt_elmu_TT_test5_lep_pt_PU_mu  lstore_outdirs/v37/test8/MC2016_Summer16_TTJets_powheg/MC*root &
python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_PU_bcdef" --histo-range 40,0,200 --output test_tt_elmu_TT_test5_lep_pt_PU_bcdef.root --histo-name test_tt_elmu_TT_test5_lep_pt_PU_bcdef  lstore_outdirs/v37/test8/MC2016_Summer16_TTJets_powheg/MC*root &
python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_PU_gh"    --histo-range 40,0,200 --output test_tt_elmu_TT_test5_lep_pt_PU_gh.root    --histo-name test_tt_elmu_TT_test5_lep_pt_PU_gh  lstore_outdirs/v37/test8/MC2016_Summer16_TTJets_powheg/MC*root &

python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_bSF"    --histo-range 40,0,200 --output test_tt_elmu_TT_test5_lep_pt_bSF.root    --histo-name test_tt_elmu_TT_test5_lep_pt_bSF  lstore_outdirs/v37/test8/MC2016_Summer16_TTJets_powheg/MC*root &
python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_th"    --histo-range 40,0,200 --output test_tt_elmu_TT_test5_lep_pt_th.root    --histo-name test_tt_elmu_TT_test5_lep_pt_th  lstore_outdirs/v37/test8/MC2016_Summer16_TTJets_powheg/MC*root &



python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_LEPelTRG"    --histo-range 40,0,200 --output test_tt_elmu_TT_test5_lep_pt_elTRG.root   --histo-name test_tt_elmu_TT_test5_lep_pt_elTRG  lstore_outdirs/v37/test8/MC2016_Summer16_TTJets_powheg/MC*root &
python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_LEPelID"     --histo-range 40,0,200 --output test_tt_elmu_TT_test5_lep_pt_elID.root    --histo-name test_tt_elmu_TT_test5_lep_pt_elID   lstore_outdirs/v37/test8/MC2016_Summer16_TTJets_powheg/MC*root &

python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_LEPmuBTRG"    --histo-range 40,0,200 --output test_tt_elmu_TT_test5_lep_pt_muBTRG.root   --histo-name test_tt_elmu_TT_test5_lep_pt_muBTRG  lstore_outdirs/v37/test8/MC2016_Summer16_TTJets_powheg/MC*root &
python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_LEPmuBID"     --histo-range 40,0,200 --output test_tt_elmu_TT_test5_lep_pt_muBID.root    --histo-name test_tt_elmu_TT_test5_lep_pt_muBID   lstore_outdirs/v37/test8/MC2016_Summer16_TTJets_powheg/MC*root &

python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_LEPmuHTRG"    --histo-range 40,0,200 --output test_tt_elmu_TT_test5_lep_pt_muHTRG.root   --histo-name test_tt_elmu_TT_test5_lep_pt_muHTRG  lstore_outdirs/v37/test8/MC2016_Summer16_TTJets_powheg/MC*root &
python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_LEPmuHID"     --histo-range 40,0,200 --output test_tt_elmu_TT_test5_lep_pt_muHID.root    --histo-name test_tt_elmu_TT_test5_lep_pt_muHID   lstore_outdirs/v37/test8/MC2016_Summer16_TTJets_powheg/MC*root &



hadd test_tt_elmu_TT_test5_all.root test_tt_elmu_TT_test5_lep_pt*.root

root -l test_tt_elmu_TT_test5_all.root

test_tt_elmu_TT_test5_lep_pt        

test_tt_elmu_TT_test5_lep_pt_nom       ->Divide(test_tt_elmu_TT_test5_lep_pt)
test_tt_elmu_TT_test5_lep_pt_init      ->Divide(test_tt_elmu_TT_test5_lep_pt)
test_tt_elmu_TT_test5_lep_pt_PU        ->Divide(test_tt_elmu_TT_test5_lep_pt)
test_tt_elmu_TT_test5_lep_pt_PU_el     ->Divide(test_tt_elmu_TT_test5_lep_pt)
test_tt_elmu_TT_test5_lep_pt_PU_mu     ->Divide(test_tt_elmu_TT_test5_lep_pt)
test_tt_elmu_TT_test5_lep_pt_PU_bcdef  ->Divide(test_tt_elmu_TT_test5_lep_pt)
test_tt_elmu_TT_test5_lep_pt_PU_gh     ->Divide(test_tt_elmu_TT_test5_lep_pt)
test_tt_elmu_TT_test5_lep_pt_bSF       ->Divide(test_tt_elmu_TT_test5_lep_pt)
test_tt_elmu_TT_test5_lep_pt_th        ->Divide(test_tt_elmu_TT_test5_lep_pt)

test_tt_elmu_TT_test5_lep_pt_elTRG       ->Divide(test_tt_elmu_TT_test5_lep_pt)
test_tt_elmu_TT_test5_lep_pt_elID        ->Divide(test_tt_elmu_TT_test5_lep_pt)

test_tt_elmu_TT_test5_lep_pt_muBTRG       ->Divide(test_tt_elmu_TT_test5_lep_pt)
test_tt_elmu_TT_test5_lep_pt_muBID        ->Divide(test_tt_elmu_TT_test5_lep_pt)
test_tt_elmu_TT_test5_lep_pt_muHTRG       ->Divide(test_tt_elmu_TT_test5_lep_pt)
test_tt_elmu_TT_test5_lep_pt_muHID        ->Divide(test_tt_elmu_TT_test5_lep_pt)

test_tt_elmu_TT_test5_lep_pt_nom       ->Draw()
test_tt_elmu_TT_test5_lep_pt_init      ->Draw()
test_tt_elmu_TT_test5_lep_pt_PU        ->Draw()
test_tt_elmu_TT_test5_lep_pt_PU_el     ->Draw()
test_tt_elmu_TT_test5_lep_pt_PU_mu     ->Draw()
test_tt_elmu_TT_test5_lep_pt_PU_bcdef  ->Draw()
test_tt_elmu_TT_test5_lep_pt_PU_gh     ->Draw("same")
test_tt_elmu_TT_test5_lep_pt_bSF       ->Draw()
test_tt_elmu_TT_test5_lep_pt_th        ->Draw()

most of effect is from lep in init weight

test_tt_elmu_TT_test5_lep_pt_nom       ->SetLineColor(kRed)
test_tt_elmu_TT_test5_lep_pt_nom       ->Draw()

test_tt_elmu_TT_test5_lep_pt_elTRG       ->Draw("same")
test_tt_elmu_TT_test5_lep_pt_elID        ->Draw("same")

test_tt_elmu_TT_test5_lep_pt_muBTRG      ->Draw("same")
test_tt_elmu_TT_test5_lep_pt_muBID       ->Draw("same")
test_tt_elmu_TT_test5_lep_pt_muHTRG      ->Draw("same")
test_tt_elmu_TT_test5_lep_pt_muHID       ->Draw("same")

most effect is from mu B ID
muon trig = 1
el trig is flat at 0.98
el ID linearly tilts smoothly to small pT from 0.97 to 0.96
mu H ID jumps irregularly around 0.96, and there is a jump down at 60GeV in 2 bins
mu B ID has the jump down at 60GeV, from 0.92 at high pT to 0.91 at low


root -l ../analysis/muon-effs//2016_23Sep_MuonID_EfficienciesAndSF_BCDEF.root
MC_NUM_TightID_DEN_genTracks_PAR_pt_eta->Get("pt_abseta_ratio")->Draw("colz")

-- has the jump at 60GeV in eta < 1.
   the pT distr also has this weird jump
   the 2D histo is symetric in eta, the 1D eta is not!

MC_NUM_TightID_DEN_genTracks_PAR_vtx   -> Get("tag_nVertices_ratio")->Draw()
TightISO_TightID_vtx -> Get("tag_nVertices_ratio")->Draw()

for ID and ISO I use the reco vtx...




muon reco (tracking) uses number of vertices
check the reco VS gen nvtx

root -l gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/MC2016_Summer16_TTJets_powheg_1.root

ntupler->Get("reduced_ttree")->Draw("nvtx")
ntupler->Get("reduced_ttree")->Draw("nvtx_gen")

-- average = 20 and 24

((TTree*) ntupler->Get("reduced_ttree"))->Draw("nvtx_gen", "", "same")



compare the tt_elmu pT kinks per data epoch

python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_1_amcatnlo.root distrs/v37_test5_bunchDILEP3//SingleElectron_BCDEF.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_el_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5 --normalize
python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_1_amcatnlo.root distrs/v37_test5_bunchDILEP3//SingleElectron_GH.root    -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_el_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5 --normalize

python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_1_amcatnlo.root distrs/v37_test5_bunchDILEP3//SingleElectron_BCDEF.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_mu_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5 --normalize
python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_1_amcatnlo.root distrs/v37_test5_bunchDILEP3//SingleElectron_GH.root    -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_mu_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5 --normalize

eog plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/*_BCDEF_*
eog plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/*_GH_*

-- it looks like el pT is somewhat worse in B and mu pT is worse in H
   and mu pT is better than el in both epochs
daaaammmmmmmmmmmmmmmmnnnn

anyway I have to try gen nvtx for this.........
test9
and
test10 is elmu_mu?


test8 tight tt_elmu

python stack_plot.py distrs/v37_test8_bunchDILEP3tight_mc_1_amcatnlo.root distrs/v37_test6_bunchDILEP3tight//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu_tight --data-nick data_other -d elmu_el_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5 --normalize
python stack_plot.py distrs/v37_test8_bunchDILEP3tight_mc_1_amcatnlo.root distrs/v37_test6_bunchDILEP3tight//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu_tight --data-nick data_other -d elmu_mu_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5 --normalize

-- 1-2% deviations, close to stat uncertainty, not perfect, but practically no kink

python stack_plot.py distrs/v37_test8_bunchDILEP3tight_mc_1_amcatnlo.root distrs/v37_test6_bunchDILEP3tight//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu_tight --data-nick data_other -d elmu_el_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test8_bunchDILEP3tight_mc_1_amcatnlo.root distrs/v37_test6_bunchDILEP3tight//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu_tight --data-nick data_other -d elmu_mu_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

INFO:root:data       =    77143.000000     1437.506418
INFO:root:mc sum     =    75482.014048    75482.014048

.... can it all be due to that weird DY mass problem alone?

test11 -> test12 -- DY mass correction?


the test9:

python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_2_amcatnlo_tt_from_test9.root distrs/v37_test6_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_el_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5 --normalize
python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_2_amcatnlo_tt_from_test9.root distrs/v37_test6_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_mu_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5 --normalize

python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_2_amcatnlo_tt_from_test9.root distrs/v37_test6_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_el_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_2_amcatnlo_tt_from_test9.root distrs/v37_test6_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_mu_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu//distrs,v37_test8_bunchDILEP3_mc_2_amcatnlo_tt_from_test9_distrs,v37_test6_bunchDILEP3,,SingleElectron_elmu_el_pt_tt_elmu_NOMINAL_stack_ratio_normalize.png
plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu//distrs,v37_test8_bunchDILEP3_mc_2_amcatnlo_tt_from_test9_distrs,v37_test6_bunchDILEP3,,SingleElectron_elmu_mu_pt_tt_elmu_NOMINAL_stack_ratio_normalize.png

eog plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu//distrs,v37_test8_bunchDILEP3_mc_2_amcatnlo_tt_from_test9_distrs,v37_test6_bunchDILEP3,,SingleElectron_elmu_el_pt_tt_elmu_NOMINAL_stack_ratio_normalize.png plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/distrs,v37_test8_bunchDILEP3_mc_1_amcatnlo_distrs,v37_test6_bunchDILEP3,,SingleElectron_elmu_el_pt_tt_elmu_NOMINAL_stack_ratio.png
eog plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu//distrs,v37_test8_bunchDILEP3_mc_2_amcatnlo_tt_from_test9_distrs,v37_test6_bunchDILEP3,,SingleElectron_elmu_mu_pt_tt_elmu_NOMINAL_stack_ratio_normalize.png plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/distrs,v37_test8_bunchDILEP3_mc_1_amcatnlo_distrs,v37_test6_bunchDILEP3,,SingleElectron_elmu_mu_pt_tt_elmu_NOMINAL_stack_ratio.png

eog plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu//distrs,v37_test8_bunchDILEP3_mc_2_amcatnlo_tt_from_test9_distrs,v37_test6_bunchDILEP3,,SingleElectron_elmu_el_pt_tt_elmu_NOMINAL_stack_ratio.png plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/distrs,v37_test8_bunchDILEP3_mc_1_amcatnlo_distrs,v37_test6_bunchDILEP3,,SingleElectron_elmu_el_pt_tt_elmu_NOMINAL_stack_ratio.png &
eog plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu//distrs,v37_test8_bunchDILEP3_mc_2_amcatnlo_tt_from_test9_distrs,v37_test6_bunchDILEP3,,SingleElectron_elmu_mu_pt_tt_elmu_NOMINAL_stack_ratio.png plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/distrs,v37_test8_bunchDILEP3_mc_1_amcatnlo_distrs,v37_test6_bunchDILEP3,,SingleElectron_elmu_mu_pt_tt_elmu_NOMINAL_stack_ratio.png

-- as expected not much difference, only bin-by-bin fluctuations



test10 mu HLT elmu

python stack_plot.py distrs/v37_test10_bunchDILEP3_mc_1_wNjets.root distrs/v37_test10_bunchDILEP3//SingleElectron.root -p -r -o plots/v37_test10_bunchDILEP3_mc_1_wNjets_tt_elmu/ -c tt_elmu --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
INFO:root:data       =   155730.000000     1190.925277
INFO:root:mc sum     =   162470.530911   162470.530911

python stack_plot.py distrs/v37_test10_bunchDILEP3_mc_1_wNjets.root distrs/v37_test10_bunchDILEP3//SingleMuon.root     -p -r -o plots/v37_test10_bunchDILEP3_mc_1_wNjets_tt_elmu/ -c tt_elmu --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
INFO:root:data       =   167476.000000     1233.920597
INFO:root:mc sum     =   162470.530911   162470.530911

worse than before or just the 0.2 ratio range?



pt-s:

python stack_plot.py distrs/v37_test10_bunchDILEP3_mc_1_wNjets.root distrs/v37_test10_bunchDILEP3//SingleMuon.root     -p -r -o plots/v37_test10_bunchDILEP3_mc_1_wNjets_tt_elmu/ -c tt_elmu --data-nick data_other -d elmu_mu_pt --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test10_bunchDILEP3_mc_1_wNjets.root distrs/v37_test10_bunchDILEP3//SingleMuon.root     -p -r -o plots/v37_test10_bunchDILEP3_mc_1_wNjets_tt_elmu/ -c tt_elmu --data-nick data_other -d elmu_el_pt --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

eog plots/v37_test10_bunchDILEP3_mc_1_wNjets_tt_elmu//distrs,v37_test10_bunchDILEP3_mc_1_wNjets_distrs,v37_test10_bunchDILEP3,,SingleMuon_elmu_mu_pt_tt_elmu_NOMINAL_stack_ratio.png plots/v37_test10_bunchDILEP3_mc_1_wNjets_tt_elmu//distrs,v37_test10_bunchDILEP3_mc_1_wNjets_distrs,v37_test10_bunchDILEP3,,SingleMuon_elmu_el_pt_tt_elmu_NOMINAL_stack_ratio.png

-- same stuff

tight selection:

python stack_plot.py distrs/v37_test10_bunchDILEP3_mc_1_wNjets.root distrs/v37_test10_bunchDILEP3//SingleMuon.root     -p -r -o plots/v37_test10_bunchDILEP3_mc_1_wNjets_tt_elmu/ -c tt_elmu_tight --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

INFO:root:data       =    79384.000000      851.239346
INFO:root:mc sum     =    77289.634927    77289.634927

-- bad shape, though better than simple selection

old one:

python stack_plot.py distrs/v37_test8_bunchDILEP3tight_mc_1_amcatnlo.root distrs/v37_test6_bunchDILEP3tight//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu_tight --data-nick data_other -d Mt_lep_met_c  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

eog plots/v37_test10_bunchDILEP3_mc_1_wNjets_tt_elmu//distrs,v37_test10_bunchDILEP3_mc_1_wNjets_distrs,v37_test10_bunchDILEP3,,SingleMuon_Mt_lep_met_c_tt_elmu_tight_NOMINAL_stack_ratio.png plots/v37_test8_bunchDILEP3_mc1_amcatnlo_tt_elmu//distrs,v37_test8_bunchDILEP3tight_mc_1_amcatnlo_distrs,v37_test6_bunchDILEP3tight,,SingleElectron_Mt_lep_met_c_tt_elmu_tight_NOMINAL_stack_ratio.png

-- as bad

1) if tight is bad, it is not normalization of dibosons or single top
2) also DY normalization does not help pT in simple elmu
3) and reduction of DY mass will worsen the pT too
4) strange thing is the pT without any weights: it has more MC at high lepton pT than Data
   -- lep SFs don't fix this, they could pull down a large range of low pT and flatten the Data-MC,
      but they just bend the very tip of the distr down at low pT and make the kink

python stack_plot.py distrs/v37_test10_bunchDILEP3_mc_1_wNjets.root distrs/v37_test10_bunchDILEP3//SingleMuon.root     -p -r -o plots/v37_test10_bunchDILEP3_mc_1_wNjets_tt_elmu/ -c tt_elmu_tight --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

-- same linear trend


#### test11

python stack_plot.py distrs/v37_test11_bunchDILEP3_mc_1_limited.root distrs/v37_test11_bunchDILEP3//SingleMuon.root     -p -r -o plots/v37_test11_bunchDILEP3_mc_1_limited/ -c tt_elmu --data-nick data_other -d Mt_lep_met_f --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

python stack_plot.py distrs/v37_test11_bunchDILEP3_mc_1_limited.root distrs/v37_test11_bunchDILEP3//SingleMuon.root     -p -r -o plots/v37_test11_bunchDILEP3_mc_1_limited/ -c tt_elmu --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

INFO:root:data       =   161067.000000     1211.056630
INFO:root:mc sum     =   156082.885530   156082.885530

eog plots/v37_test10_bunchDILEP3_mc_1_wNjets_tt_elmu/distrs,v37_test10_bunchDILEP3_mc_1_wNjets_distrs,v37_test10_bunchDILEP3,,SingleMuon_Mt_lep_met_c_tt_elmu_NOMINAL_stack_ratio.png plots/v37_test11_bunchDILEP3_mc_1_limited//distrs,v37_test11_bunchDILEP3_mc_1_limited_distrs,v37_test11_bunchDILEP3,,SingleMuon_Mt_lep_met_c_tt_elmu_NOMINAL_stack_ratio.png

--- very minor difference

pt-s:

python stack_plot.py distrs/v37_test11_bunchDILEP3_mc_1_limited.root distrs/v37_test11_bunchDILEP3//SingleMuon.root     -p -r -o plots/v37_test11_bunchDILEP3_mc_1_limited/ -c tt_elmu --data-nick data_other -d elmu_mu_pt --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test11_bunchDILEP3_mc_1_limited.root distrs/v37_test11_bunchDILEP3//SingleMuon.root     -p -r -o plots/v37_test11_bunchDILEP3_mc_1_limited/ -c tt_elmu --data-nick data_other -d elmu_el_pt --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

-- mu pT is linear, and el pT has kind of less of a kink

comparing to v12.7 DY used to be larger, maybe dibosons peaked more
the overall amount of events seems quite different


#### comparison to the old v12.7 results

questions:

1) how MT was calculated from ntuples in v12.7?
2) reproduce old plots with old code
2) save separate old shapes, compare with new ones with get_shapes
3) run sumup draw script on v37 ntuples -- compare to loop selection plots
4) reproduce old selection and weights in draw script
5) compare old and new TT and Data ntuples

debugging space
ntuples - code - plots

debugging binary-search-plan:

1) Y reproduce old plots from old ntuples with old code
   Y and check how MTlep is calculated
2) Y get the old shapes and compare with the new ones -- problem in TT MC, it passes less and peaks less
3) run sumup draw on TT with old selection to check the yield and shape with comparison to stage2
4) Y run new code (sumup draw) on old ntuples with the old .C weights -- must reproduce the old procedure in the new SW
   -- does reproduce it well, there is some mystery of very few additional events in ntuple_distr, which apear in normalizations and post-processing of the Draw, but they are very close
5) run new code (sumup draw) on new ntuples -- since it is the same as ntuple_distr
   check which new ntuples are the same as the old ones
   -- the old Data was not completely finished,
      what's with TT?
6) run old code on new ntuples -- check if the difference is in the ntuples?


forgotten big question:

1) how lepton pT-s are different from back then? where the pT trends come from now?



##### reproduce old plots from old ntuples with old code

ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f f 19094 16079 "MTlep" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(25,0,250)" INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets `cat v12.7_dilep_dtags`

/eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets

perfect match
the output is written to
/eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums

-- moved the original plots to
/eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/original_jobsums

strangely it contains only 1 Data dataset...
Data13TeV_SingleMuon2016H_03Feb2017_ver2.root

-- MC is normalized to Data
   it explains the normalization difference with v37 elmu tests
   v12.7 SingleMuonH integral
   36508 summing data-stack 3650.8 creating data histo

for data the drawing command is:

command: transverse_mass(lep_p4[0].pt(), met_corrected.pt(), lep_p4[0].phi(), met_corrected.phi())>>h(25,0,250)	HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02

for TT
transverse_mass(lep_p4[0].pt(), met_corrected.pt(), lep_p4[0].phi(), met_corrected.phi())	(pu_weight(nvtx_gen, 0))*0.986*(lepton_muon_SF(abs(lep_p4[0].eta()), lep_p4[0].pt(), 0.542860, 0.457140))*(lepton_muon_trigger_SF(abs(lep_p4[0].eta()), lep_p4[0].pt(), 0.542860, 0.457140))*(ttbar_pT_SF(gen_t_pt, gen_tb_pt))*	HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02


the MTlep calculation

test/pu_weight.C:

double transverse_mass(LorentzVector v1, LorentzVector v2)
    {
    return sqrt(2*v1.pt()*v2.pt()*(1 - cos(v1.phi() - v2.phi())));
    }

it turns out there is already an option for writing root file: the T right before lumi-s

ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "MTlep" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(25,0,250)" INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets `cat v12.7_dilep_dtags`

root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root
root [3] _file0->Get("tt_{em}")->Print()
TH1.Print Name  = tt_{em}, Entries= 365755, Total sum= 2533.74

scp "otoldaie@lxplus.cern.ch:/eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root" debugging_v37tests_w_comparison_to_v12.7_dilep/

debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root

python get_shapes.py --formula "tt_v37test11:tt_v12_7" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_v37test11:distrs/v37_test11_bunchDILEP3_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f "tt_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{em}"

-- different binning
correct to the new one:
    'Mt_lep_met_f':  (systs_objects_mt_variation,  ('histo-range',  [20,0,250])),
(used to be 25 bins)

ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "MTlep" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(20,0,250)" INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets `cat v12.7_dilep_dtags`

python get_shapes.py --formula "tt_v37test11:tt_v12_7" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_v37test11:distrs/v37_test11_bunchDILEP3_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f "tt_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{em}"

-- slightly different, v12 peaks better
   add all tt in v12?

python get_shapes.py --formula "tt_v37test11:tt_v12_7:tt_v127other" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_v37test11:distrs/v37_test11_bunchDILEP3_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f "tt_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{em}" "tt_v127other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{other}"

-- yeap, tt_{other} has lower mT and will smear the peak

python get_shapes.py --debug --no-norm --norm-formulas --formula "tt_v37test11:tt_v12_7 + tt_v127other" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_v37test11:distrs/v37_test11_bunchDILEP3_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f "tt_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{em}" "tt_v127other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{other}"

-- still v12 peaks slightly better

integrals of both:

root -l debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root
root [3] _file0->Get("tt_{em}")->Print()
TH1.Print Name  = tt_{em}, Entries= 365750, Total sum= 2027
root [4] _file0->Get("tt_{other}")->Print()
TH1.Print Name  = tt_{other}, Entries= 43043, Total sum= 234.567

365750 + 43043 = 408793

root -l distrs/v37_test11_bunchDILEP3/MC2016_Summer16_TTJets_powheg.root
tt_elmu->Get("tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = tt_elmu_tt_other_NOMINAL_Mt_lep_met_f, Entries= 372824, Total sum= 328574
tt_elmu->Get("tt_mutau/NOMINAL/tt_elmu_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
tt_elmu->Get("tt_lj/NOMINAL/tt_elmu_tt_lj_NOMINAL_Mt_lep_met_f")->Print()
tt_elmu->Get("tt_taultauh/NOMINAL/tt_elmu_tt_taultauh_NOMINAL_Mt_lep_met_f")->Print()
tt_elmu->Get("tt_taulj/NOMINAL/tt_elmu_tt_taulj_NOMINAL_Mt_lep_met_f")->Print()

TH1.Print Name  = tt_elmu_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 248, Total sum= 203.8
root [9] tt_elmu->Get("tt_lj/NOMINAL/tt_elmu_tt_lj_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = tt_elmu_tt_lj_NOMINAL_Mt_lep_met_f, Entries= 645, Total sum= 548.322
root [10] tt_elmu->Get("tt_taultauh/NOMINAL/tt_elmu_tt_taultauh_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = tt_elmu_tt_taultauh_NOMINAL_Mt_lep_met_f, Entries= 17, Total sum= 14.7115
root [11] tt_elmu->Get("tt_taulj/NOMINAL/tt_elmu_tt_taulj_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = tt_elmu_tt_taulj_NOMINAL_Mt_lep_met_f, Entries= 28, Total sum= 23.415

-- less TT passes now in v37 tests

now Data H and all Data

v12.7 data:

root -l debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root
root [2] h->Print()
TH1.Print Name  = h, Entries= 37061, Total sum= 2920.64

root -l distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root
root [4] tt_elmu->Get("data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = tt_elmu_data_other_NOMINAL_Mt_lep_met_f, Entries= 39245, Total sum= 38710

-- close, but more Data passes in v37

shapes

python get_shapes.py --debug --no-norm --norm-formulas --formula "data_v37test11_H:data_v12_7:data_v37test11_all" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj data_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h data_v37test11_all:distrs/v37_test11_bunchDILEP3/SingleMuon.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_v37test11_H:distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f

-- all within stats, H now differs from the old in some bins, bu all Data now matches the old H in those bins..

Conclusions:
1) the yields are different in v37 and v12:
   more data passes in v37, but less TT MC than in v12
   less TT can be due to 32GeV pT cut
   why more Data?
   -- from events_counter v12 shows less processed events,
      but the difference with TT persists: instead of 20% data is by 3% larger in v37 and TT is larger by 1.5%
2) shapes of TT are different -- v12 peaks more
3) data shapes are the same
   again, why the same when the pT cut is 32GeV instead of 30GeV?
   draw with 32GeV looks different from v37test11



##### sumup draw with old selection on new ntuples -- does it reproduce stage2 yields, shapes?

met_corrected VS met_init

no weights

v12 items:

    return sqrt(2*v1.pt()*v2.pt()*(1 - cos(v1.phi() - v2.phi())));

ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "MTlep" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(25,0,250)" INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets `cat v12.7_dilep_dtags`

MT now:

sqrt(2*lep_p4[0].pt()*met_corrected.pt()*(1 - cos(lep_p4[0].phi() - met_corrected.phi())))

selection:
"HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02"

and command:

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_corrected.pt()*(1 - cos(lep_p4[0].phi() - met_corrected.phi())))" --cond-com "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_tt_elmu_Mt.root --histo-name test_v37_v12_tt_elmu_Mt gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root &

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_corrected.pt()*(1 - cos(lep_p4[0].phi() - met_corrected.phi())))" --cond-com "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_data_tt_elmu_Mt.root --histo-name test_v37_v12_data_tt_elmu_Mt gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/*root &

yields:

[olek@fermi05 proc]$ root -l test_v37_v12_tt_elmu_Mt.root
root [1] test_v37_v12_tt_elmu_Mt->Print()
TH1.Print Name  = test_v37_v12_tt_elmu_Mt, Entries= 413695, Total sum= 406623

VS old
408793

1.012

[olek@fermi05 proc]$ root -l test_v37_v12_data_tt_elmu_Mt.root
root [1] test_v37_v12_data_tt_elmu_Mt->Print()
TH1.Print Name  = test_v37_v12_data_tt_elmu_Mt, Entries= 44765, Total sum= 44124

VS old
37061
1.2078735058417205

it's like an effect from golden json..?
check counters in Data files -- were all jobs processed in v12.7?

v12

root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root

root [5] ((TH1D*) ntupler->Get("events_counter"))->GetBinContent(1)
(Double_t) 1.41775e+08
root [6] ((TH1D*) ntupler->Get("events_counter"))->GetBinContent(2)
(Double_t) 1.41775e+08
root [7] ((TH1D*) ntupler->Get("events_counter"))->GetBinContent(3)
(Double_t) 9.48301e+07
root [8] ((TH1D*) ntupler->Get("events_counter"))->GetBinContent(4)
(Double_t) 7.30986e+07
root [9] ((TH1D*) ntupler->Get("events_counter"))->GetBinContent(5)
(Double_t) 4.58659e+06

v37

time python sumup_weights.py --overwrite --debug temp/test_weight_v37_Data_SingleMuon_H_ver2_events_counter.root -t ntupler/events_counter gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/*root

root [4] events_counter->GetBinContent(1)
(Double_t) 1.66591e+08
root [5] events_counter->GetBinContent(2)
(Double_t) 0.00000
root [6] events_counter->GetBinContent(3)
(Double_t) 1.66591e+08
root [7] events_counter->GetBinContent(4)
(Double_t) 0.00000
root [8] events_counter->GetBinContent(5)
(Double_t) 0.00000
root [9] events_counter->GetBinContent(6)
(Double_t) 121612.

root [10] 1.66591e+08 / 1.41775e+08
(double) 1.17504

-- still 3% more data and only 1.5% more MC



shapes:

1) Y met_corrected VS met_init in Data and TT now   --- no difference in Data, very small difference in TT
2) Y draw with 30GeV cut TT and Data VS v12         --- does it reproduce v12?        -- yes, it seems so, both data and tt
3) Y draw with 32GeV cut TT and Data VS v37test11   --- does it reproduce v37test11?  -- no, seems like there is a deviation in data and in tt!!
                                                                                       but in both data and tt test11 deviates in similar way: towards smaller mT
4) Y draw with 32GeV cut VS 30 GeV cut              --- data changes shape, tt does not, only yield changes



python get_shapes.py --no-norm --norm-formulas --formula "tt_v37test11:tt_v12_7 + tt_v127other:tt_v37draw" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_v37test11:distrs/v37_test11_bunchDILEP3_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f "tt_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{em}" "tt_v127other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{other}" tt_v37draw:../test_v37_v12_tt_elmu_Mt.root:test_v37_v12_tt_elmu_Mt

-- in tt with minor differences the draw is very close to the v12.7 distr (can be due weights)
   but test11 diverges from them

python get_shapes.py --no-norm --norm-formulas --formula "data_v37test11_H:data_v12_7:data_v37test11draw" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj data_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h data_v37test11_H:distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_v37test11draw:../test_v37_v12_data_tt_elmu_Mt.root:test_v37_v12_data_tt_elmu_Mt

-- in data draw is very close to v12.7


draw Data with 32GeV, compare to test11

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_corrected.pt()*(1 - cos(lep_p4[0].phi() - met_corrected.phi())))" --cond-com "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>32 && lep_p4[1].pt()>32 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_data_tt_elmu_Mt_32GeVpT.root --histo-name test_v37_v12_data_tt_elmu_Mt_32GeVpT gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/*root &

data_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h
data_v37test11_H:distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f
data_v37test11draw:../test_v37_v12_data_tt_elmu_Mt.root:test_v37_v12_data_tt_elmu_Mt
data_v37test11draw32GeV:../test_v37_v12_data_tt_elmu_Mt_32GeVpT.root:test_v37_v12_data_tt_elmu_Mt_32GeVpT

python get_shapes.py --no-norm --norm-formulas --formula "data_v37test11_H:data_v12_7:data_v37test11draw:data_v37test11draw32GeV" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj data_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h data_v37test11_H:distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_v37test11draw:../test_v37_v12_data_tt_elmu_Mt.root:test_v37_v12_data_tt_elmu_Mt data_v37test11draw32GeV:../test_v37_v12_data_tt_elmu_Mt_32GeVpT.root:test_v37_v12_data_tt_elmu_Mt_32GeVpT

-- the deviations are small, but it seems draw32GeV is further from v37test11_H file than the draw with 30GeV..?

TT draw 32GeV VS test11

python get_shapes.py --no-norm --norm-formulas --formula "tt_v37test11:tt_v12_7 + tt_v127other:tt_v37draw" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj
tt_v37test11:distrs/v37_test11_bunchDILEP3_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f
"tt_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{em}"
"tt_v127other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{other}"
tt_v37draw:../test_v37_v12_tt_elmu_Mt.root:test_v37_v12_tt_elmu_Mt

python get_shapes.py --no-norm --norm-formulas --formula "tt_v37test11:tt_met_cor_d32g:tt_met_ini_d32g" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_met_cor_d30g:../test_v37_v12_tt_elmu_Mt_30GeVpT.root:test_v37_v12_tt_elmu_Mt_30GeVpT tt_met_cor_d32g:../test_v37_v12_tt_elmu_Mt_32GeVpT.root:test_v37_v12_tt_elmu_Mt_32GeVpT tt_met_ini_d30g:../test_v37_v12_tt_elmu_Mt_30GeVpT_met_init.root:test_v37_v12_tt_elmu_Mt_30GeVpT_met_init tt_met_ini_d32g:../test_v37_v12_tt_elmu_Mt_32GeVpT_met_init.root:test_v37_v12_tt_elmu_Mt_32GeVpT_met_init tt_v37test11:distrs/v37_test11_bunchDILEP3_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f

-- test11 diverges!



I used met_init.. Does it change anything?

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_init.pt()*(1 - cos(lep_p4[0].phi() - met_init.phi())))" --cond-com "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>32 && lep_p4[1].pt()>32 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT.root --histo-name test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/*root &

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_init.pt()*(1 - cos(lep_p4[0].phi() - met_init.phi())))" --cond-com "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT.root --histo-name test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/*root &


python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_init.pt()*(1 - cos(lep_p4[0].phi() - met_init.phi())))" --cond-com "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_tt_elmu_Mt_met_init_30GeV.root --histo-name test_v37_v12_tt_elmu_Mt_met_init_30GeV gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root &

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_init.pt()*(1 - cos(lep_p4[0].phi() - met_init.phi())))" --cond-com "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>32 && lep_p4[1].pt()>32 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_tt_elmu_Mt_met_init_32GeV.root --histo-name test_v37_v12_tt_elmu_Mt_met_init_32GeV gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root &

no veto:

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_init.pt()*(1 - cos(lep_p4[0].phi() - met_init.phi())))" --cond-com "HLT_mu && no_iso_veto_leps && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_tt_elmu_Mt_met_init_30GeV_no_veto.root --histo-name test_v37_v12_tt_elmu_Mt_met_init_30GeV_no_veto gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root &


python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_init.pt()*(1 - cos(lep_p4[0].phi() - met_init.phi())))" --cond-com "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>32 && lep_p4[1].pt()>32 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_tt_elmu_Mt_met_init_32GeV.root --histo-name test_v37_v12_tt_elmu_Mt_met_init_32GeV gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root &

python get_shapes.py --no-norm --norm-formulas --formula "data_v37test11_H:data_v12_7:data_v37test11draw:data_v37test11draw32GeV" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj
data_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h
data_v37test11_H:distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f
data_v37test11draw:../test_v37_v12_data_tt_elmu_Mt.root:test_v37_v12_data_tt_elmu_Mt
data_v37test11draw32GeV:../test_v37_v12_data_tt_elmu_Mt_32GeVpT.root:test_v37_v12_data_tt_elmu_Mt_32GeVpT

python get_shapes.py --no-norm --norm-formulas --formula "data_v37test11draw:data_v37test11draw32GeV:0.99 data_met_init_d30g:0.99 data_met_init_d32g" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj data_v37test11draw:../test_v37_v12_data_tt_elmu_Mt.root:test_v37_v12_data_tt_elmu_Mt data_v37test11draw32GeV:../test_v37_v12_data_tt_elmu_Mt_32GeVpT.root:test_v37_v12_data_tt_elmu_Mt_32GeVpT data_met_init_d30g:../test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT.root:test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT data_met_init_d32g:../test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT.root:test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT

-- 30GeV has slightly lower mT

python get_shapes.py --no-norm --formula "data_v37test11draw:data_v37test11draw32GeV:0.99 data_met_init_d30g:0.99 data_met_init_d32g" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj data_v37test11draw:../test_v37_v12_data_tt_elmu_Mt.root:test_v37_v12_data_tt_elmu_Mt data_v37test11draw32GeV:../test_v37_v12_data_tt_elmu_Mt_32GeVpT.root:test_v37_v12_data_tt_elmu_Mt_32GeVpT data_met_init_d30g:../test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT.root:test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT data_met_init_d32g:../test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT.root:test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT

-- init and corrected are identical


in tt:

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_corrected.pt()*(1 - cos(lep_p4[0].phi() - met_corrected.phi())))" --cond-com "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_tt_elmu_Mt_30GeVpT.root --histo-name test_v37_v12_tt_elmu_Mt_30GeVpT gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root &

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_corrected.pt()*(1 - cos(lep_p4[0].phi() - met_corrected.phi())))" --cond-com "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>32 && lep_p4[1].pt()>32 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_tt_elmu_Mt_32GeVpT.root --histo-name test_v37_v12_tt_elmu_Mt_32GeVpT gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root &


python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_init.pt()*(1 - cos(lep_p4[0].phi() - met_init.phi())))" --cond-com "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_tt_elmu_Mt_30GeVpT_met_init.root --histo-name test_v37_v12_tt_elmu_Mt_30GeVpT_met_init gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root &

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_init.pt()*(1 - cos(lep_p4[0].phi() - met_init.phi())))" --cond-com "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>32 && lep_p4[1].pt()>32 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_tt_elmu_Mt_32GeVpT_met_init.root --histo-name test_v37_v12_tt_elmu_Mt_32GeVpT_met_init gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root &


python get_shapes.py --no-norm --norm-formulas --formula "tt_met_cor_d30g:tt_met_cor_d32g:0.99 tt_met_ini_d30g:0.99 tt_met_ini_d32g" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_met_cor_d30g:../test_v37_v12_tt_elmu_Mt_30GeVpT.root:test_v37_v12_tt_elmu_Mt_30GeVpT tt_met_cor_d32g:../test_v37_v12_tt_elmu_Mt_32GeVpT.root:test_v37_v12_tt_elmu_Mt_32GeVpT tt_met_ini_d30g:../test_v37_v12_tt_elmu_Mt_30GeVpT_met_init.root:test_v37_v12_tt_elmu_Mt_30GeVpT_met_init tt_met_ini_d32g:../test_v37_v12_tt_elmu_Mt_32GeVpT_met_init.root:test_v37_v12_tt_elmu_Mt_32GeVpT_met_init

python get_shapes.py --no-norm --norm-formulas --formula "tt_met_cor_d30g:tt_met_cor_d32g:tt_met_ini_d30g:tt_met_ini_d32g" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_met_cor_d30g:../test_v37_v12_tt_elmu_Mt_30GeVpT.root:test_v37_v12_tt_elmu_Mt_30GeVpT tt_met_cor_d32g:../test_v37_v12_tt_elmu_Mt_32GeVpT.root:test_v37_v12_tt_elmu_Mt_32GeVpT tt_met_ini_d30g:../test_v37_v12_tt_elmu_Mt_30GeVpT_met_init.root:test_v37_v12_tt_elmu_Mt_30GeVpT_met_init tt_met_ini_d32g:../test_v37_v12_tt_elmu_Mt_32GeVpT_met_init.root:test_v37_v12_tt_elmu_Mt_32GeVpT_met_init

python get_shapes.py --no-norm --formula "tt_met_cor_d30g:tt_met_cor_d32g:tt_met_ini_d30g:tt_met_ini_d32g" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_met_cor_d30g:../test_v37_v12_tt_elmu_Mt_30GeVpT.root:test_v37_v12_tt_elmu_Mt_30GeVpT tt_met_cor_d32g:../test_v37_v12_tt_elmu_Mt_32GeVpT.root:test_v37_v12_tt_elmu_Mt_32GeVpT tt_met_ini_d30g:../test_v37_v12_tt_elmu_Mt_30GeVpT_met_init.root:test_v37_v12_tt_elmu_Mt_30GeVpT_met_init tt_met_ini_d32g:../test_v37_v12_tt_elmu_Mt_32GeVpT_met_init.root:test_v37_v12_tt_elmu_Mt_32GeVpT_met_init

-- very slight difference between cor and init
   no noticeable shape difference in 30 and 32 GeV cuts!



##### sumup draw on old ntuples -- sumup draw must do exactly what the old script did, confirm it

old numbers:

root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root                                              

_file0->Get("tt_{em}")->Print()
TH1.Print Name  = tt_{em}, Entries= 365750, Total sum= 2027
_file0->Get("tt_{other}")->Print()
TH1.Print Name  = tt_{other}, Entries= 43043, Total sum= 234.567

root [3] 365750 + 43043
(int) 408793


h->Print()
TH1.Print Name  = h, Entries= 37061, Total sum= 2920.64

old command:
ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "MTlep" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(20,0,250)" INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets `cat v12.7_dilep_dtags`

met_init

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_init.pt()*(1 - cos(lep_p4[0].phi() - met_init.phi())))" --cond-com "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_tt_elmu_Mt_30GeVpT_met_init_draw_on_v12ntuples.root --histo-name test_v37_v12_tt_elmu_Mt_30GeVpT_met_init_draw_on_v12ntuples /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/MC2016_Summer16_TTJets_powheg.root &

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_init.pt()*(1 - cos(lep_p4[0].phi() - met_init.phi())))" --cond-com "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_tt_elmu_Mt_30GeVpT_met_init_draw_on_v12ntuples_dataH.root --histo-name test_v37_v12_tt_elmu_Mt_30GeVpT_met_init_draw_on_v12ntuples_dataH /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root &


root -l test_v37_v12_tt_elmu_Mt_30GeVpT_met_init_draw_on_v12ntuples.root
test_v37_v12_tt_elmu_Mt_30GeVpT_met_init_draw_on_v12ntuples->Print()

TH1.Print Name  = test_v37_v12_tt_elmu_Mt_30GeVpT_met_init_draw_on_v12ntuples, Entries= 408753, Total sum= 401927
-- a bit less TT events than v12.7
408793

root -l test_v37_v12_tt_elmu_Mt_30GeVpT_met_init_draw_on_v12ntuples_dataH.root
test_v37_v12_tt_elmu_Mt_30GeVpT_met_init_draw_on_v12ntuples_dataH->Print()

TH1.Print Name  = test_v37_v12_tt_elmu_Mt_30GeVpT_met_init_draw_on_v12ntuples_dataH, Entries= 37353, Total sum= 36818
-- a bit more events than v12.7
37061



with met_corrected

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_corrected.pt()*(1 - cos(lep_p4[0].phi() - met_corrected.phi())))" --cond-com "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_tt_elmu_Mt_30GeVpT_met_corrected_draw_on_v12ntuples.root --histo-name test_v37_v12_tt_elmu_Mt_30GeVpT_met_corrected_draw_on_v12ntuples /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/MC2016_Summer16_TTJets_powheg.root &

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_corrected.pt()*(1 - cos(lep_p4[0].phi() - met_corrected.phi())))" --cond-com "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_tt_elmu_Mt_30GeVpT_met_corrected_draw_on_v12ntuples_dataH.root --histo-name test_v37_v12_tt_elmu_Mt_30GeVpT_met_corrected_draw_on_v12ntuples_dataH /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root &

root -l test_v37_v12_tt_elmu_Mt_30GeVpT_met_corrected_draw_on_v12ntuples.root
test_v37_v12_tt_elmu_Mt_30GeVpT_met_corrected_draw_on_v12ntuples->Print()
TH1.Print Name  = test_v37_v12_tt_elmu_Mt_30GeVpT_met_corrected_draw_on_v12ntuples, Entries= 408753, Total sum= 401872

root -l test_v37_v12_tt_elmu_Mt_30GeVpT_met_corrected_draw_on_v12ntuples_dataH.root
test_v37_v12_tt_elmu_Mt_30GeVpT_met_corrected_draw_on_v12ntuples_dataH->Print()
TH1.Print Name  = test_v37_v12_tt_elmu_Mt_30GeVpT_met_corrected_draw_on_v12ntuples_dataH, Entries= 37353, Total sum= 36818

-- same number of events, as must be

why ntuple_distr gets different number of events?

try interactiv:

root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/MC2016_Summer16_TTJets_powheg.root
root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root

((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02")

408753
37353

-- like from draw, more data and slightly less TT
   so what does ntuple_distr do differently in both TT and Data?



search:

ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "MTlep" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(20,0,250)" INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets MC2016_Summer16_TTJets_powheg Data13TeV_SingleMuon2016H_03Feb2017_ver2

ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "5" "HLT_mu" "(10,0,10)" INVESTIGATION-v37tests-v12.7-test_elmu_HLT " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets MC2016_Summer16_TTJets_powheg Data13TeV_SingleMuon2016H_03Feb2017_ver2     &
ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "5" "HLT_mu && leps_ID == -11*13" "(10,0,10)" INVESTIGATION-v37tests-v12.7-test_elmu_HLTID " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets MC2016_Summer16_TTJets_powheg Data13TeV_SingleMuon2016H_03Feb2017_ver2     &
ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "5" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4" "(10,0,10)" INVESTIGATION-v37tests-v12.7-test_elmu_HLTIDleps " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets MC2016_Summer16_TTJets_powheg Data13TeV_SingleMuon2016H_03Feb2017_ver2     &
ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "5" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(10,0,10)" INVESTIGATION-v37tests-v12.7-test_elmu_HLTIDlepsImpacts " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets MC2016_Summer16_TTJets_powheg Data13TeV_SingleMuon2016H_03Feb2017_ver2     &

root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_HLT_TOP_PT.root
root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_HLTID_TOP_PT.root
root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_HLTIDleps_TOP_PT.root
root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_HLTIDlepsImpacts_TOP_PT.root

((TH1D*) _file0->Get("tt_{em}"))->GetEntries() + ((TH1D*) _file0->Get("tt_{other}"))->GetEntries()
printf("%f", h->GetEntries())

(double) 891824.
(double) 478972.
(double) 415979.

4578581.000000(int) 14
47983.000000(int) 12
37913.000000(int) 12

with impacts:

(double) 408773.
root [2] printf("%f", h->GetEntries())
37051.000000(int) 12


but it was:
408793
37061
????????????????

$ root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_HLTIDlepsImpacts_TOP_PT.root                                        
h->Prroot [0] 
Attaching file /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_HLTIDlepsImpacts_TOP_PT.root as _file0...
in(TFile *) 0x335e1d0
root [1] h->Print()
TH1.Print Name  = h, Entries= 37051, Total sum= 37038
root [2] .q

$ root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root
^[[A^[[A^[[Aroot [0] 
Attaching file /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root as _file0...
(TFile *) 0x3f71ab0
root [1] h->Print()
TH1.Print Name  = h, Entries= 37061, Total sum= 2920.64
root [2] 

ok, but they are close, is the difference with online there?



VS online:

root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/MC2016_Summer16_TTJets_powheg.root

((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02")

((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "HLT_mu")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "HLT_mu && leps_ID == -11*13")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4")

910191   > 891824.
496524   > 478972.
415959   < 415979.

w impacts:
408753   < 408773. (ntuple_distr)

root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root

4584551   > 4578581.000000
48352     < 47983.000000
38220     < 37913.000000

w impacts:
37353     > 37051.000000 (ntuple_distr)

?????

even HLT_mu is weirdly different

ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "5" "HLT_mu" "(10,0,10)" INVESTIGATION-v37tests-v12.7-test_elmu_HLT_inv " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets Data13TeV_SingleMuon2016H_03Feb2017_ver2 MC2016_Summer16_QCD_HT-100-200

-- how does this work? what is different from online?

got ttree, 4586588 drawing:
command: 5>>h(10,0,10)	HLT_mu
4.57857e+06 summing data-stack 4.57857e+06 creating data histo


root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_HLT_inv_TOP_PT.root

  KEY: TH1F	h;1	5 {( HLT_mu && pass_basic_METfilters)}


-- damn!

root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root

((TTree*) ntupler->Get("reduced_ttree"))->Draw("5 >> h(10,0,10", "pass_basic_METfilters && HLT_mu")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("5 >> h(10,0,10", "pass_basic_METfilters && HLT_mu && leps_ID == -11*13")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("5 >> h(10,0,10", "pass_basic_METfilters && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("5 >> h(10,0,10", "pass_basic_METfilters && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02")

SingleMuonH data
online   VS ntuple_distr
4578568   < 4578581.000000
47970     < 47983.000000
37900     < 37913.000000
37038     < 37051.000000

-- so, what are these last differences? floating point comparisons etc? in HLT_mu and met filters?

why the data is called "h" in the output? it is renamed to "data" on saving
-- renaming is done after Write() call

now:

root [2] data->Print()
TH1.Print Name  = data, Entries= 4578581, Total sum= 4.57857e+06

ok!

do basic MET filters deviate?

((TTree*) ntupler->Get("reduced_ttree"))->Draw("5 >> h(10,0,10", "pass_basic_METfilters")

ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "5" "1" "(10,0,10)" INVESTIGATION-v37tests-v12.7-test_elmu_basicMET_inv2 " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets Data13TeV_SingleMuon2016H_03Feb2017_ver2 MC2016_Summer16_QCD_HT-100-200

4580569 (out of 4586588)

VS ntuple_distr
root [2] data->Print()
TH1.Print Name  = data, Entries= 4580582, Total sum= 4.58057e+06

-- also different

maybe interactive Draw shows some nonsense?

root [1] ((TTree*) ntupler->Get("reduced_ttree"))->Draw("5 >> h(10,0,10", "pass_basic_METfilters")
Info in <TCanvas::MakeDefCanvas>:  created default TCanvas with name c1
(Long64_t) 4580569
root [2] 
root [2] ttree = ((TTree*) ntupler->Get("reduced_ttree"))
(TTree *) 0x2db3390
root [3] ttree->GetHistogram()->Print()
TH1.Print Name  = h, Entries= 4580569, Total sum= 4.58057e+06

-- all correct

get data integrals right after drawing:
drew Data 4.58057e+06 4.58057e+06
drew Data 4580569.000000 4580569.000000

-- all perfectly the same!!!!


TODO: OK, it's a mystery of ntuple_distr -- it is different from interactive Draw. The difference is added somewhere in normalizations.
      By they are close enough. Solve it later and now move on to debugging v37 VS v12.



##### check events counters in TT -- if the same jobs were processed in v12 and v37, if so run selections on them -- compare to ntuple_distr and test11

and stage2 runs the met filters:

        if not isMC:
            if not (ev.pass_basic_METfilters and ev.METfilterbadChCand and ev.METfilterbadPFMuon):
                continue

anyhow

root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/MC2016_Summer16_TTJets_powheg.root

root [6] ((TH1D*) ntupler->Get("events_counter"))->GetBinContent(1)
(Double_t) 7.72293e+07
root [7] ((TH1D*) ntupler->Get("events_counter"))->GetBinContent(2)
(Double_t) 7.72293e+07
root [8] ((TH1D*) ntupler->Get("events_counter"))->GetBinContent(3)
(Double_t) 3.48781e+07
root [9] ((TH1D*) ntupler->Get("events_counter"))->GetBinContent(4)
(Double_t) 1.50597e+07
root [10] ((TH1D*) ntupler->Get("events_counter"))->GetBinContent(5)
(Double_t) 1.14491e+06
root [11] ((TH1D*) ntupler->Get("events_counter"))->GetBinContent(6)
(Double_t) 0.00000

time python sumup_weights.py --overwrite --debug temp/test_weight_v37_TT_events_counter.root -t ntupler/events_counter gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root

root [2] events_counter->GetBinContent(1)
(Double_t) 7.70812e+07

damn

7.72293e+07 / 7.70812e+07
1.0019213504719697

not too bad though


but let's select something

python sumup_ttree_draw.py "5" --cond-com "no_iso_veto_leps && leps_ID == -11*13" --histo-range 10,0,10 --output test_tt_elmu_yield_TT_v37_lepsID.root --histo-name test_tt_elmu_yield_TT_v37_lepsID gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root

python sumup_ttree_draw.py "5" --cond-com "leps_ID == -11*13" --histo-range 10,0,10 --output test_tt_elmu_yield_TT_v37_lepsID.root --histo-name test_tt_elmu_yield_TT_v37_lepsID /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/MC2016_Summer16_TTJets_powheg.root

root -l test_tt_elmu_yield_TT_v37_lepsID.root
test_tt_elmu_yield_TT_v37_lepsID->Print()
TH1.Print Name  = test_tt_elmu_yield_TT_v37_lepsID, Entries= 546142, Total sum= 546142
TH1.Print Name  = test_tt_elmu_yield_TT_v37_lepsID, Entries= 543129, Total sum= 543129

546142 / 543129
1.0055474850357835

sqrt(543129) / 543129
0.001356902066467291

-- some selection is still missing in the v37
   impacts of muons and electrons could be different?
   but it is a sub-percent difference


"HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02"

python sumup_ttree_draw.py "5" --cond-com "no_iso_veto_leps && leps_ID == -11*13" --histo-range 10,0,10 --output test_tt_elmu_yield_TT_v37_lepsID.root --histo-name test_tt_elmu_yield_TT_v37_lepsID gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root
python sumup_ttree_draw.py "5" --cond-com "no_iso_veto_leps && leps_ID == -11*13 && HLT_mu" --histo-range 10,0,10 --output test_tt_elmu_yield_TT_v37_lepsIDHLT.root --histo-name test_tt_elmu_yield_TT_v37_lepsIDHLT gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root
python sumup_ttree_draw.py "5" --cond-com "no_iso_veto_leps && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 10,0,10 --output test_tt_elmu_yield_TT_v37_Full.root --histo-name test_tt_elmu_yield_TT_v37_Full gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root

python sumup_ttree_draw.py "5" --cond-com                     "leps_ID == -11*13" --histo-range 10,0,10 --output test_tt_elmu_yield_TT_v37_lepsID.root --histo-name test_tt_elmu_yield_TT_v37_lepsID /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/MC2016_Summer16_TTJets_powheg.root
python sumup_ttree_draw.py "5" --cond-com                     "leps_ID == -11*13 && HLT_mu" --histo-range 10,0,10 --output test_tt_elmu_yield_TT_v37_lepsIDHLT.root --histo-name test_tt_elmu_yield_TT_v37_lepsIDHLT /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/MC2016_Summer16_TTJets_powheg.root
python sumup_ttree_draw.py "5" --cond-com                     "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 10,0,10 --output test_tt_elmu_yield_TT_v37_Full.root --histo-name test_tt_elmu_yield_TT_v37_Full /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/MC2016_Summer16_TTJets_powheg.root

root -l test_tt_elmu_yield_TT_v37_lepsIDHLT.root
test_tt_elmu_yield_TT_v37_lepsIDHLT->Print()
.q

root -l test_tt_elmu_yield_TT_v37_Full.root
test_tt_elmu_yield_TT_v37_Full->Print()
.q


draw on v37   ID-HLT and Full:
TH1.Print Name  = test_tt_elmu_yield_TT_v37_lepsIDHLT, Entries= 499382, Total sum= 499382
TH1.Print Name  = test_tt_elmu_yield_TT_v37_Full, Entries= 410848, Total sum= 410848

draw on v12.7 ID-HLT and Full:
TH1.Print Name  = test_tt_elmu_yield_TT_v37_lepsIDHLT, Entries= 496524, Total sum= 496524
TH1.Print Name  = test_tt_elmu_yield_TT_v37_Full, Entries= 408753, Total sum= 408753

499382 / 496524
1.0057560158219945

410848 / 408753
1.0051253446457886

-- same difference



ok, TT is close enough -> confirm the shapes are close and compare them to test11
Data has significant difference in number of processed jobs, but still compare the shapes

from the shape study:

1) Y met_corrected VS met_init in Data and TT now --- no difference in Data, very small difference in TT
2) Y draw with 30GeV cut TT and Data VS v12       --- does it reproduce v12?        -- yes, it seems so, both data and tt
3) Y draw with 32GeV cut TT and Data              --- does it reproduce v37test11?  -- no, seems like there is a deviation in data and in tt!!
                                                                                       but in both data and tt test11 deviates in similar way: towards smaller mT
4) Y draw with 32GeV cut VS 30 GeV cut            --- data changes shape, tt does not, only yield changes

the scripts and plots:

test11        v12
v37 draw 32   v37 draw 30

TT and Data

python get_shapes.py --no-norm --formula "tt_met_cor_d30g:tt_met_cor_d32g:tt_met_ini_d30g:tt_met_ini_d32g" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_met_cor_d30g:../test_v37_v12_tt_elmu_Mt_30GeVpT.root:test_v37_v12_tt_elmu_Mt_30GeVpT tt_met_cor_d32g:../test_v37_v12_tt_elmu_Mt_32GeVpT.root:test_v37_v12_tt_elmu_Mt_32GeVpT tt_met_ini_d30g:../test_v37_v12_tt_elmu_Mt_30GeVpT_met_init.root:test_v37_v12_tt_elmu_Mt_30GeVpT_met_init tt_met_ini_d32g:../test_v37_v12_tt_elmu_Mt_32GeVpT_met_init.root:test_v37_v12_tt_elmu_Mt_32GeVpT_met_init

all the files:

tt_v37test11:distrs/v37_test11_bunchDILEP3_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f
"tt_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{em}"
"tt_v127other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{other}"
tt_v37draw:../test_v37_v12_tt_elmu_Mt.root:test_v37_v12_tt_elmu_Mt
tt_met_cor_d30g:../test_v37_v12_tt_elmu_Mt_30GeVpT.root:test_v37_v12_tt_elmu_Mt_30GeVpT
tt_met_cor_d32g:../test_v37_v12_tt_elmu_Mt_32GeVpT.root:test_v37_v12_tt_elmu_Mt_32GeVpT
tt_met_ini_d30g:../test_v37_v12_tt_elmu_Mt_30GeVpT_met_init.root:test_v37_v12_tt_elmu_Mt_30GeVpT_met_init
tt_met_ini_d32g:../test_v37_v12_tt_elmu_Mt_32GeVpT_met_init.root:test_v37_v12_tt_elmu_Mt_32GeVpT_met_init

tt_v37test11:distrs/v37_test11_bunchDILEP3_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f
"tt_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{em}"
"tt_v127other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{other}"
tt_met_cor_d30g:../test_v37_v12_tt_elmu_Mt_30GeVpT.root:test_v37_v12_tt_elmu_Mt_30GeVpT
tt_met_cor_d32g:../test_v37_v12_tt_elmu_Mt_32GeVpT.root:test_v37_v12_tt_elmu_Mt_32GeVpT

python get_shapes.py --no-norm --norm-formulas --formula "tt_v37test11:tt_v12_7 + tt_v127other:tt_met_cor_d30g:tt_met_cor_d32g" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_v37test11:distrs/v37_test11_bunchDILEP3_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f "tt_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{em}" "tt_v127other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{other}" tt_met_cor_d30g:../test_v37_v12_tt_elmu_Mt_30GeVpT.root:test_v37_v12_tt_elmu_Mt_30GeVpT tt_met_cor_d32g:../test_v37_v12_tt_elmu_Mt_32GeVpT.root:test_v37_v12_tt_elmu_Mt_32GeVpT

eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_tt_v127other,tt_met_cor_d30g,tt_v12_7,tt_met_cor_d32g,tt_v37test11_formula_nonorm.png

--- shape of test11 differs from the rest

yields --- ?


data

all the files

python get_shapes.py --no-norm --norm-formulas --formula "data_v37test11_H:data_v12_7:data_v37test11draw" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj data_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h data_v37test11_H:distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_v37test11draw:../test_v37_v12_data_tt_elmu_Mt.root:test_v37_v12_data_tt_elmu_Mt

python get_shapes.py --no-norm --norm-formulas --formula "data_v37test11_H:data_v12_7:data_v37test11draw" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj
data_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h
data_v37test11_H:distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f
data_v37test11draw:../test_v37_v12_data_tt_elmu_Mt.root:test_v37_v12_data_tt_elmu_Mt
data_v37test11draw:../test_v37_v12_data_tt_elmu_Mt.root:test_v37_v12_data_tt_elmu_Mt
data_v37test11draw32GeV:../test_v37_v12_data_tt_elmu_Mt_32GeVpT.root:test_v37_v12_data_tt_elmu_Mt_32GeVpT
data_met_init_d30g:../test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT.root:test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT
data_met_init_d32g:../test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT.root:test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT

python get_shapes.py --no-norm --norm-formulas --formula "data_v37test11_H:data_v12_7:data_met_init_d30g:data_met_init_d32g" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj data_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h data_v37test11_H:distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_met_init_d30g:../test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT.root:test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT data_met_init_d32g:../test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT.root:test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT

eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_data_v37test11_H,data_met_init_d32g,data_met_init_d30g,data_v12_7_formula_nonorm.png

draw met_init 32GeV deviates from the rest the most..

so the weights of v37test11 are wrong?
but Data is also a bit wrong, test11 is not reproduced with draw 32GeV?

-- try the MET filters

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_init.pt()*(1 - cos(lep_p4[0].phi() - met_init.phi())))" --cond-com "pass_basic_METfilters && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>32 && lep_p4[1].pt()>32 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT_basicMETfilters.root --histo-name test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT_basicMETfilters gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/*root &

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_corrected.pt()*(1 - cos(lep_p4[0].phi() - met_corrected.phi())))" --cond-com "pass_basic_METfilters && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>32 && lep_p4[1].pt()>32 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_data_tt_elmu_Mt_met_corrected_32GeVpT_basicMETfilters.root --histo-name test_v37_v12_data_tt_elmu_Mt_met_corrected_32GeVpT_basicMETfilters gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/*root &


python get_shapes.py --no-norm --norm-formulas --formula "data_v37test11_H:data_v12_7:data_met_init_d30g:data_met_cor_d32g_MET" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj data_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h data_v37test11_H:distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_met_init_d30g:../test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT.root:test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT data_met_cor_d32g_MET:../test_v37_v12_data_tt_elmu_Mt_met_corrected_32GeVpT_basicMETfilters.root:test_v37_v12_data_tt_elmu_Mt_met_corrected_32GeVpT_basicMETfilters

eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_data_met_cor_d32g_MET,data_v37test11_H,data_met_init_d30g,data_v12_7_formula_nonorm.png


python get_shapes.py --no-norm --norm-formulas --formula "data_v37test11_H:data_met_cor_Filt_d32g:data_met_cor_d32g" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj data_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h data_v37test11_H:distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_met_init_d30g:../test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT.root:test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT data_met_cor_Filt_d32g:../test_v37_v12_data_tt_elmu_Mt_met_corrected_32GeVpT_basicMETfilters.root:test_v37_v12_data_tt_elmu_Mt_met_corrected_32GeVpT_basicMETfilters data_met_cor_d32g:../test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT.root:test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT

eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_data_met_cor_d32g,data_met_cor_Filt_d32g,data_v37test11_H,data_met_init_d30g,data_v12_7_formula_nonorm.png

-- yeah, test11 Data is different bin-by-bin from both of those Draw results

python get_shapes.py --no-norm --norm-formulas --formula "data_v37test11_H:data_v12_7:data_met_init_d30g:data_met_init_d32g_MET" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj data_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h data_v37test11_H:distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_met_init_d30g:../test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT.root:test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT data_met_init_d32g_MET:../test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT_basicMETfilters.root:test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT_basicMETfilters

python get_shapes.py --no-norm --norm-formulas --formula "data_met_init_d32g_MET:data_met_corrected_d32g_MET" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj data_met_init_d32g_MET:../test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT_basicMETfilters.root:test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT_basicMETfilters data_met_corrected_d32g_MET:../test_v37_v12_data_tt_elmu_Mt_met_corrected_32GeVpT_basicMETfilters.root:test_v37_v12_data_tt_elmu_Mt_met_corrected_32GeVpT_basicMETfilters

eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_data_met_init_d32g_MET,data_met_corrected_d32g_MET_formula_nonorm.png

-- again, identical init and corrected


So:
it seems draw reproduces v12, but test11 is off
test11 tt   has slightly smaller mT than the v12 and draw reproduction with 32GeV cut
test11 data also has slightly smaller mT in some bins
(they kind of should converge then?)
-- something is off in stage2?



##### how 32GeV draw reproductions are different from test11 stage2?

check event yields
   -- less data in test11, maybe due to dR check between dileptons -- remove and run test12

check data first, since it is weight-less?


root -l distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root
tt_elmu->Get("data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f")->Print()
.q

root -l ../test_v37_v12_data_tt_elmu_Mt_met_corrected_32GeVpT_basicMETfilters.root
test_v37_v12_data_tt_elmu_Mt_met_corrected_32GeVpT_basicMETfilters->Print()
.q

TH1.Print Name  = tt_elmu_data_other_NOMINAL_Mt_lep_met_f, Entries= 39245, Total sum= 38710

root [1] test_v37_v12_data_tt_elmu_Mt_met_corrected_32GeVpT_basicMETfilters->Print()
TH1.Print Name  = test_v37_v12_data_tt_elmu_Mt_met_corrected_32GeVpT_basicMETfilters, Entries= 40385, Total sum= 39769

0.9717716974124055

test11 has all jobs processed: 93

maybe the useless filters suddenly work here:

ev.pass_basic_METfilters and ev.METfilterbadChCand and ev.METfilterbadPFMuon

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_corrected.pt()*(1 - cos(lep_p4[0].phi() - met_corrected.phi())))" --cond-com "pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>32 && lep_p4[1].pt()>32 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_data_tt_elmu_Mt_met_corrected_32GeVpT_allMETfilters.root --histo-name test_v37_v12_data_tt_elmu_Mt_met_corrected_32GeVpT_allMETfilters gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/*root &

root -l test_v37_v12_data_tt_elmu_Mt_met_corrected_32GeVpT_allMETfilters.root
test_v37_v12_data_tt_elmu_Mt_met_corrected_32GeVpT_allMETfilters->Print()
TH1.Print Name  = test_v37_v12_data_tt_elmu_Mt_met_corrected_32GeVpT_allMETfilters, Entries= 40385, Total sum= 39769

-- no difference. as expected


also there is this:

        if pass_elmu or pass_elmu_el or pass_mumu or pass_elel:
            # check dR of leptons
            tlep0_p4 = TLorentzVector(ev.lep_p4[0].X(), ev.lep_p4[0].Y(), ev.lep_p4[0].Z(), ev.lep_p4[0].T())
            tlep1_p4 = TLorentzVector(ev.lep_p4[1].X(), ev.lep_p4[1].Y(), ev.lep_p4[1].Z(), ev.lep_p4[1].T())
            if not tlep0_p4.DeltaR(tlep1_p4) > 0.3:
                continue

-- probably that's the difference for Data

and pass_elmu is this:

        pass_elmu_id = ev.leps_ID == -11*13 and ev.HLT_mu and ev.no_iso_veto_leps and \
            ((ev.lep_matched_HLT[0] and abs(ev.lep_dxy[0]) < 0.01 and abs(ev.lep_dz[0]) < 0.02) if abs(ev.lep_id[0]) == 13 else (ev.lep_matched_HLT[1] and abs(ev.lep_dxy[1]) < 0.01 and abs(ev.lep_dz[1]) < 0.02)) and \
            (ev.lep_p4[0].pt() > 30 and abs(ev.lep_p4[0].eta()) < 2.4) and \
            (ev.lep_p4[1].pt() > 30 and abs(ev.lep_p4[1].eta()) < 2.4)

        #   (ev.lep_matched_HLT[0] if abs(ev.lep_id[0]) == 13 else ev.lep_matched_HLT[1]) and \
        #pass_elmu = pass_elmu_id and ((ev.lep_relIso[0] < 0.15 and ev.lep_relIso[1] < 0.0588) if abs(ev.lep_id[0]) == 13 else (ev.lep_relIso[1] < 0.15 and ev.lep_relIso[0] < 0.0588))

        # these are done in NT
        pass_elmu = pass_elmu_id
        # both HLTs
        #pass_elmu = pass_elmu_id and ev.lep_matched_HLT[0] and ev.HLT_el and ev.lep_matched_HLT[1]

-- the same




meanwhile compare TT to weight-less TT

distrs/v37_test11_bunchDILEP3WeightLess/all/MC2016_Summer16_TTJets_powheg.root

python get_shapes.py --no-norm --norm-formulas --formula "tt_v37test11:tt_v12_7 + tt_v127other:tt_met_cor_d30g:tt_met_cor_d32g" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_v37test11:distrs/v37_test11_bunchDILEP3_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f "tt_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{em}" "tt_v127other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{other}" tt_met_cor_d30g:../test_v37_v12_tt_elmu_Mt_30GeVpT.root:test_v37_v12_tt_elmu_Mt_30GeVpT tt_met_cor_d32g:../test_v37_v12_tt_elmu_Mt_32GeVpT.root:test_v37_v12_tt_elmu_Mt_32GeVpT

the NOMINAL test11 to weightless:

python get_shapes.py --no-norm --norm-formulas --formula "tt_v37test11:tt_noweight_v37test11" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_v37test11:distrs/v37_test11_bunchDILEP3_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f tt_noweight_v37test11:distrs/v37_test11_bunchDILEP3WeightLess/all/MC2016_Summer16_TTJets_powheg.root:tt_elmu/tt_other/INITIAL/tt_elmu_tt_other_INITIAL_Mt_lep_met_f

eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_tt_noweight_v37test11,tt_v37test11_formula_nonorm.png

-- shapes are identical, the weight is flat

their yields:

root -l distrs/v37_test11_bunchDILEP3WeightLess/all/MC2016_Summer16_TTJets_powheg.root
root -l distrs/v37_test11_bunchDILEP3/MC2016_Summer16_TTJets_powheg.root

tt_elmu->Get("tt_other/INITIAL/tt_elmu_tt_other_INITIAL_Mt_lep_met_f")->Print()
TH1.Print Name  = tt_elmu_tt_other_INITIAL_Mt_lep_met_f, Entries= 372824, Total sum= 366864

tt_elmu->Get("tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = tt_elmu_tt_other_NOMINAL_Mt_lep_met_f, Entries= 372824, Total sum= 328574

-- aha





try test12 on data and TT without dR check

python get_shapes.py --no-norm --norm-formulas --formula "data_v37test11_H:data_v12_7:data_test12_H:data_met_init_d32g_MET" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj data_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h data_v37test11_H:distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_test12_H:distrs/v37_test12_bunchDILEP3/all/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_met_init_d32g_MET:../test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT_basicMETfilters.root:test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT_basicMETfilters

python get_shapes.py --no-norm --norm-formulas --formula "data_v37test11_H:data_test12_H" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj data_v37test11_H:distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_test12_H:distrs/v37_test12_bunchDILEP3/all/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f

-- test11 and test12 are identical in data

their yields:

root -l distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root
root -l distrs/v37_test12_bunchDILEP3/all/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root
tt_elmu->Get("data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f")->Print()

TH1.Print Name  = tt_elmu_data_other_NOMINAL_Mt_lep_met_f, Entries= 39245, Total sum= 38710
TH1.Print Name  = tt_elmu_data_other_NOMINAL_Mt_lep_met_f, Entries= 39262, Total sum= 38727

aha...

and draw:

TH1.Print Name  = test_v37_v12_data_tt_elmu_Mt_met_init_32GeVpT_basicMETfilters, Entries= 40385, Total sum= 39769



so, why?
MC chas continue if PU weight fails...

try draw on stage2 output?


python sumup_ttree_draw.py --ttree ttree_out "5" --cond-com "selection_stage_em > 200 && selection_stage_em < 210" --histo-range 10,0.,10 --output test_v37_v12_data_tt_elmu_data_stage2_sele.root --histo-name test_v37_v12_data_tt_elmu_data_stage2_sele lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/*.root

root -l test_v37_v12_data_tt_elmu_data_stage2_sele.root
test_v37_v12_data_tt_elmu_data_stage2_sele->Print()
.q

TH1.Print Name  = test_v37_v12_data_tt_elmu_data_stage2_sele, Entries= 43104, Total sum= 43104

forgot these

            (ev.lep_p4[0].pt() > 30 and abs(ev.lep_p4[0].eta()) < 2.4) and \
            (ev.lep_p4[1].pt() > 30 and abs(ev.lep_p4[1].eta()) < 2.4)

comparing with test11 and test12 which have 32GeV cuts

python sumup_ttree_draw.py --ttree ttree_out "5" --cond-com "selection_stage_em > 200 && selection_stage_em < 210 && event_leptons[0].pt() > 32. && event_leptons[1].pt() > 32." --histo-range 10,0.,10 --output test_v37_v12_data_tt_elmu_data_stage2_sele_32GeV.root --histo-name test_v37_v12_data_tt_elmu_data_stage2_sele_32GeV lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/*.root

root -l test_v37_v12_data_tt_elmu_data_stage2_sele_32GeV.root
test_v37_v12_data_tt_elmu_data_stage2_sele_32GeV->Print()
.q

TH1.Print Name  = test_v37_v12_data_tt_elmu_data_stage2_sele_32GeV, Entries= 39262, Total sum= 39262

-- full match
   so loop_selections work ok!


compare with draw cut 30!

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_corrected.pt()*(1 - cos(lep_p4[0].phi() - met_corrected.phi())))" --cond-com "pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters.root --histo-name test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/*root &

root -l test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters.root
test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters->Print()
.q

TH1.Print Name  = test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters, Entries= 44385, Total sum= 43750

-- still 1k off 43104 (almost 3%)



shapes:

python get_shapes.py --no-norm --norm-formulas --formula "data_v37test11_H:data_v12_7:data_test12_H:data_met_init_d30g_MET" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj data_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h data_v37test11_H:distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_test12_H:distrs/v37_test12_bunchDILEP3/all/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_met_init_d30g_MET:../test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters.root:test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters

-- all very close

python get_shapes.py --no-norm --norm-formulas --formula "data_test12_H:data_met_init_d30g_MET" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj data_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h data_v37test11_H:distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_test12_H:distrs/v37_test12_bunchDILEP3/all/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_met_init_d30g_MET:../test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters.root:test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters

-- within stats, on peak bins (larger stat fluctuations) and on the slope bins (horizontal movements)
python get_shapes.py --no-norm --norm-formulas --formula "data_v12_7:data_met_init_d30g_MET" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj data_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h data_v37test11_H:distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_test12_H:distrs/v37_test12_bunchDILEP3/all/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_met_init_d30g_MET:../test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters.root:test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters

-- very close, only very few bins within stats
yields:

root -l debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root
h->Print()
.q

root -l ../test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters.root
test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters->Print()
.q

TH1.Print Name  = h, Entries= 37061, Total sum= 2920.64
root [2] .q
[olek@fermi04 jobsums]$ root -l ../test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters.root
root [1] test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters->Print()
TH1.Print Name  = test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters, Entries= 44385, Total sum= 43750

-- difference in number of processed jobs



python sumup_ttree_draw.py --ttree ttree_out "5" --cond-com "selection_stage_em > 200 && selection_stage_em < 210" --histo-range 10,0.,10 --output test_v37_v12_data_tt_elmu_data_stage2_sele.root --histo-name test_v37_v12_data_tt_elmu_data_stage2_sele lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/*.root



##### sumup draw cannot reproduce stage2 elmu in data -- fixed the N events, but not shape

stage 2 results:

python sumup_ttree_draw.py --ttree ttree_out "5" --cond-com "selection_stage_em > 200 && selection_stage_em < 210" --histo-range 10,0.,10 --output test_v37_v12_data_tt_elmu_data_stage2_sele.root --histo-name test_v37_v12_data_tt_elmu_data_stage2_sele lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/*.root

root -l test_v37_v12_data_tt_elmu_data_stage2_sele.root
test_v37_v12_data_tt_elmu_data_stage2_sele->Print()
.q

TH1.Print Name  = test_v37_v12_data_tt_elmu_data_stage2_sele, Entries= 43104, Total sum= 43104


reproduction:

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_corrected.pt()*(1 - cos(lep_p4[0].phi() - met_corrected.phi())))" --cond-com "pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters.root --histo-name test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/*root &

root -l test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters.root
test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters->Print()
.q

TH1.Print Name  = test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters, Entries= 44385, Total sum= 43750


        pass_elmu_id = ev.leps_ID == -11*13 and ev.HLT_mu and ev.no_iso_veto_leps and \
            ((ev.lep_matched_HLT[0] and abs(ev.lep_dxy[0]) < 0.01 and abs(ev.lep_dz[0]) < 0.02) if abs(ev.lep_id[0]) == 13 else (ev.lep_matched_HLT[1] and abs(ev.lep_dxy[1]) < 0.01 and abs(ev.lep_dz[1]) < 0.02)) and \
            (ev.lep_p4[0].pt() > 30 and abs(ev.lep_p4[0].eta()) < 2.4) and \
            (ev.lep_p4[1].pt() > 30 and abs(ev.lep_p4[1].eta()) < 2.4)

veto leps:

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_corrected.pt()*(1 - cos(lep_p4[0].phi() - met_corrected.phi())))" --cond-com "no_iso_veto_leps && pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters.root --histo-name test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/*root

root -l test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters.root
test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters->Print()
.q

TH1.Print Name  = test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters, Entries= 43922, Total sum= 43290

still not 43104

lep0 must always be muon

but ok, let's confirm:

python sumup_ttree_draw.py "5" --cond-com "no_iso_veto_leps && pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0] && lep_dxy[0] <0.01 && lep_dz[0]<0.02) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1] && lep_dxy[1] <0.01 && lep_dz[1]<0.02)) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4" --histo-range 10,0.,10 --output test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters.root --histo-name test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/*root

TH1.Print Name  = test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters, Entries= 43922, Total sum= 43922

ok

the pass elmu is stored in counters -- check it

python sumup_weights.py v37test12_Data_MuonHver2_control_counters.root --target-histos control_counters lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/Da*root
root -l v37test12_Data_MuonHver2_control_counters.root
control_counters->GetBinContent(1+19)
control_counters->GetBinContent(1+20)
control_counters->GetBinContent(1+21)
control_counters->GetBinContent(1+22)

(Double_t) 1.12955e+07
root [2] control_counters->GetBinContent(1+20)
(Double_t) 0.00000
root [3] control_counters->GetBinContent(1+21)
(Double_t) 43104.0
root [4] control_counters->GetBinContent(1+22)
(Double_t) 3.94077e+06

-- OK full match with stage2 selection

TT just in case:

python sumup_weights.py v37test12_MC_TT_control_counters.root --target-histos control_counters lstore_outdirs/v37/test12/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_*.root
root -l v37test12_MC_TT_control_counters.root
control_counters->GetBinContent(1+19)
control_counters->GetBinContent(1+20)
control_counters->GetBinContent(1+21)
control_counters->GetBinContent(1+22)

(Double_t) 7.33774e+06
root [2] control_counters->GetBinContent(1+20)
(Double_t) 0.00000
root [3] control_counters->GetBinContent(1+21)
(Double_t) 404642.
root [4] control_counters->GetBinContent(1+22)
(Double_t) 290823.

.....


back to data

inspect only 1 file
root -l lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/Data13TeV_SingleMuon2016H_03Feb2017_ver2_1.root
ttree_out->Draw("5", "selection_stage_em > 200 && selection_stage_em < 210")
(Long64_t) 154

root -l gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/Data13TeV_SingleMuon2016H_03Feb2017_ver2_1.root
((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "no_iso_veto_leps && pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0] && lep_dxy[0] <0.01 && lep_dz[0]<0.02) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1] && lep_dxy[1] <0.01 && lep_dz[1]<0.02)) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4")
(Long64_t) 154

root -l lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/Data13TeV_SingleMuon2016H_03Feb2017_ver2_2.root
ttree_out->Draw("5", "selection_stage_em > 200 && selection_stage_em < 210")
.q
root -l lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/Data13TeV_SingleMuon2016H_03Feb2017_ver2_3.root
ttree_out->Draw("5", "selection_stage_em > 200 && selection_stage_em < 210")
.q
root -l lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/Data13TeV_SingleMuon2016H_03Feb2017_ver2_4.root
ttree_out->Draw("5", "selection_stage_em > 200 && selection_stage_em < 210")
.q
root -l lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/Data13TeV_SingleMuon2016H_03Feb2017_ver2_5.root
ttree_out->Draw("5", "selection_stage_em > 200 && selection_stage_em < 210")
.q

root -l gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/Data13TeV_SingleMuon2016H_03Feb2017_ver2_2.root
((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "no_iso_veto_leps && pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0] && lep_dxy[0] <0.01 && lep_dz[0]<0.02) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1] && lep_dxy[1] <0.01 && lep_dz[1]<0.02)) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4")
.q
root -l gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/Data13TeV_SingleMuon2016H_03Feb2017_ver2_3.root
((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "no_iso_veto_leps && pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0] && lep_dxy[0] <0.01 && lep_dz[0]<0.02) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1] && lep_dxy[1] <0.01 && lep_dz[1]<0.02)) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4")
.q
root -l gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/Data13TeV_SingleMuon2016H_03Feb2017_ver2_4.root
((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "no_iso_veto_leps && pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0] && lep_dxy[0] <0.01 && lep_dz[0]<0.02) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1] && lep_dxy[1] <0.01 && lep_dz[1]<0.02)) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4")
.q
root -l gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/Data13TeV_SingleMuon2016H_03Feb2017_ver2_5.root
((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "no_iso_veto_leps && pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0] && lep_dxy[0] <0.01 && lep_dz[0]<0.02) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1] && lep_dxy[1] <0.01 && lep_dz[1]<0.02)) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4")
.q

[olek@fermi04 proc]$ root -l lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/Data13TeV_SingleMuon2016H_03Feb2017_ver2_2.root
(Long64_t) 232
[olek@fermi04 proc]$ root -l lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/Data13TeV_SingleMuon2016H_03Feb2017_ver2_3.root
(Long64_t) 384
[olek@fermi04 proc]$ root -l lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/Data13TeV_SingleMuon2016H_03Feb2017_ver2_4.root
(Long64_t) 454
[olek@fermi04 proc]$ root -l lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/Data13TeV_SingleMuon2016H_03Feb2017_ver2_5.root
(Long64_t) 487

[olek@fermi04 proc]$ root -l gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/Data13TeV_SingleMuon2016H_03Feb2017_ver2_2.root
(Long64_t) 237
[olek@fermi04 proc]$ root -l gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/Data13TeV_SingleMuon2016H_03Feb2017_ver2_3.root
(Long64_t) 391
[olek@fermi04 proc]$ root -l gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/Data13TeV_SingleMuon2016H_03Feb2017_ver2_4.root
(Long64_t) 469
[olek@fermi04 proc]$ root -l gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/Data13TeV_SingleMuon2016H_03Feb2017_ver2_5.root
(Long64_t) 493

interesting luck

pick shortest

root -l lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/Data13TeV_SingleMuon2016H_03Feb2017_ver2_2.root
ttree_out->Scan("indexevents", "selection_stage_em > 200 && selection_stage_em < 210")

root -l gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/Data13TeV_SingleMuon2016H_03Feb2017_ver2_2.root
((TTree*) ntupler->Get("reduced_ttree"))->Scan("indexevents", "no_iso_veto_leps && pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0] && lep_dxy[0] <0.01 && lep_dz[0]<0.02) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1] && lep_dxy[1] <0.01 && lep_dz[1]<0.02)) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4")

diff scan_data_file_draw_indexevents scan_data_file_stage2_indexevents

27d26
<  154396695 
69d67
<  440108883 
108d105
<  2.353e+09 
121d117
<   14879868 
211d206
<  107205678 


((TTree*) ntupler->Get("reduced_ttree"))->Scan("5", "no_iso_veto_leps && pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0] && lep_dxy[0] <0.01 && lep_dz[0]<0.02) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1] && lep_dxy[1] <0.01 && lep_dz[1]<0.02)) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && indexevents==154396695")

((TTree*) ntupler->Get("reduced_ttree"))->Scan("indexevents", "no_iso_veto_leps && pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0] && lep_dxy[0] <0.01 && lep_dz[0]<0.02) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1] && lep_dxy[1] <0.01 && lep_dz[1]<0.02)) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 ")

let's catch it with pdb

queue_dir/v37/test12/jobs_dir/job_00108:python channel_distrs_full_loop.py --do-W-stitching --metmuegclean false --options no_prop_lepjets  -l logss temp/jobs//v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/ channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/Data13TeV_SingleMuon2016H_03Feb2017_ver2_2.root

python -m pdb channel_distrs_full_loop.py --do-W-stitching --metmuegclean false --options no_prop_lepjets  -l logss temp/jobs//v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/ channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/Data13TeV_SingleMuon2016H_03Feb2017_ver2_2.root

154396695
fails due to impacts
(Pdb) p abs(ev.lep_dxy[0]), abs(ev.lep_dz[0])       
(0.0016044905642047524, 0.03507344424724579)

but

root -l gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/Data13TeV_SingleMuon2016H_03Feb2017_ver2_2.root
((TTree*) ntupler->Get("reduced_ttree"))->Scan("5", "no_iso_veto_leps && pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0] && lep_dxy[0] <0.01 && lep_dz[0]<0.02) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1] && lep_dxy[1] <0.01 && lep_dz[1]<0.02)) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && indexevents==154396695")
************************
*    Row   *         5 *
************************
*    14672 *         5 *
************************
==> 1 selected entry
(Long64_t) 1

((TTree*) ntupler->Get("reduced_ttree"))->Scan("no_iso_veto_leps && pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13:lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4:abs(lep_id[0]): lep_matched_HLT[0]: lep_dxy[0] <0.01 && lep_dz[0]<0.02) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1] && lep_dxy[1] <0.01 && lep_dz[1]<0.02)) && ", "indexevents==154396695")

-- it's not abs!
fuck


with abs:

python sumup_ttree_draw.py "5" --cond-com "no_iso_veto_leps && pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0] && abs(lep_dxy[0]) <0.01 && abs(lep_dz[0])<0.02) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1] && abs(lep_dxy[1]) <0.01 && abs(lep_dz[1])<0.02)) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4" --histo-range 10,0.,10 --output test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters.root --histo-name test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/*root

root -l test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters.root
test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters->Print()

TH1.Print Name  = test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters, Entries= 43104, Total sum= 43104
VS
TH1.Print Name  = test_v37_v12_data_tt_elmu_data_stage2_sele, Entries= 43104, Total sum= 43104

-- perfect

and shapes:

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_corrected.pt()*(1 - cos(lep_p4[0].phi() - met_corrected.phi())))" --cond-com "no_iso_veto_leps && pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0] && abs(lep_dxy[0]) <0.01 && abs(lep_dz[0])<0.02) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1] && abs(lep_dxy[1]) <0.01 && abs(lep_dz[1])<0.02)) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4" --histo-range 20,0.,250. --output test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters.root --histo-name test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/*root &

python sumup_ttree_draw.py --ttree ttree_out "event_met_lep_mt" --cond-com "selection_stage_em > 200 && selection_stage_em < 210" --histo-range 20,0.,250. --output test_v37_v12_data_tt_elmu_data_stage2_sele.root --histo-name test_v37_v12_data_tt_elmu_data_stage2_sele lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/*.root &

python get_shapes.py --no-norm --norm-formulas --formula "dataH_stage2:dataH_draw" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj dataH_stage2:../test_v37_v12_data_tt_elmu_data_stage2_sele.root:test_v37_v12_data_tt_elmu_data_stage2_sele dataH_draw:../test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters.root:test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters

eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_dataH_draw,dataH_stage2_formula_nonorm.png

-- shapes are different! in separate bins and in the low mT bins

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_init.pt()*(1 - cos(lep_p4[0].phi() - met_init.phi())))" --cond-com "no_iso_veto_leps && pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0] && abs(lep_dxy[0]) <0.01 && abs(lep_dz[0])<0.02) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1] && abs(lep_dxy[1]) <0.01 && abs(lep_dz[1])<0.02)) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4" --histo-range 20,0.,250. --output test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT_allMETfilters.root --histo-name test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT_allMETfilters gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/*root

python get_shapes.py --no-norm --norm-formulas --formula "dataH_stage2:dataH_draw_met_init" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj dataH_stage2:../test_v37_v12_data_tt_elmu_data_stage2_sele.root:test_v37_v12_data_tt_elmu_data_stage2_sele dataH_draw_met_init:../test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT_allMETfilters.root:test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT_allMETfilters

-- same difference (as usual init and corrected are identical)

[olek@fermi04 jobsums]$ root -l ../test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT_allMETfilters.root
root [1] test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT_allMETfilters->Print()
TH1.Print Name  = test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT_allMETfilters, Entries= 43104, Total sum= 42479

[olek@fermi04 jobsums]$ root -l ../test_v37_v12_data_tt_elmu_data_stage2_sele.root
root [1] test_v37_v12_data_tt_elmu_data_stage2_sele->Print()
TH1.Print Name  = test_v37_v12_data_tt_elmu_data_stage2_sele, Entries= 43104, Total sum= 42553

use the stage2 function

def transverse_mass_pts(v1_x, v1_y, v2_x, v2_y):
    v1v2 = TMath.Sqrt((v1_x*v1_x + v1_y*v1_y)*(v2_x*v2_x + v2_y*v2_y))
    return TMath.Sqrt(2*(v1v2 - (v1_x*v2_x + v1_y*v2_y)))

sqrt(2*
      (
        sqrt(
           (met_init.X()*met_init.X() + met_init.Y()*met_init.Y())*
           (lep_p4[0].X()*lep_p4[0].X() + lep_p4[0].Y()*lep_p4[0].Y())
           )
        -
        (met_init.X()*lep_p4[0].X() + met_init.Y()*lep_p4[0].Y())
      )
    )

"sqrt(2* ( sqrt( (met_init.X()*met_init.X() + met_init.Y()*met_init.Y())* (lep_p4[0].X()*lep_p4[0].X() + lep_p4[0].Y()*lep_p4[0].Y())) - (met_init.X()*lep_p4[0].X() + met_init.Y()*lep_p4[0].Y())))"

python sumup_ttree_draw.py "sqrt(2* ( sqrt( (met_init.X()*met_init.X() + met_init.Y()*met_init.Y())* (lep_p4[0].X()*lep_p4[0].X() + lep_p4[0].Y()*lep_p4[0].Y())) - (met_init.X()*lep_p4[0].X() + met_init.Y()*lep_p4[0].Y())))" --cond-com "no_iso_veto_leps && pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0] && abs(lep_dxy[0]) <0.01 && abs(lep_dz[0])<0.02) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1] && abs(lep_dxy[1]) <0.01 && abs(lep_dz[1])<0.02)) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4" --histo-range 20,0.,250. --output test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT_allMETfilters_mTformStage2.root --histo-name test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT_allMETfilters_mTformStage2 gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/*root

cd -
python get_shapes.py --no-norm --norm-formulas --formula "dataH_stage2:dataH_draw_met_init_mTstage2" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj dataH_stage2:../test_v37_v12_data_tt_elmu_data_stage2_sele.root:test_v37_v12_data_tt_elmu_data_stage2_sele dataH_draw_met_init_mTstage2:../test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT_allMETfilters_mTformStage2.root:test_v37_v12_data_tt_elmu_Mt_met_init_30GeVpT_allMETfilters_mTformStage2

-- again, same difference



Conclusion:
the draw selection reproduces stage in Data!
but the shape does not work for some reason



##### sumup draw VS stage2 mT calculation - found the difference due to propagation in met

confirm they are really different

root -l gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/Data13TeV_SingleMuon2016H_03Feb2017_ver2_2.root
((TTree*) ntupler->Get("reduced_ttree"))->Scan("indexevents:sqrt(2*lep_p4[0].pt()*met_corrected.pt()*(1 - cos(lep_p4[0].phi() - met_corrected.phi())))", "no_iso_veto_leps && pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0] && abs(lep_dxy[0]) <0.01 && abs(lep_dz[0])<0.02) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1] && abs(lep_dxy[1]) <0.01 && abs(lep_dz[1])<0.02)) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4")
.q

root -l lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/Data13TeV_SingleMuon2016H_03Feb2017_ver2_2.root
ttree_out->Scan("indexevents:event_met_lep_mt", "selection_stage_em > 200 && selection_stage_em < 210")
.q

************************************
*    Row   * indexeven * sqrt(2*le *
************************************
*      619 * 573252531 * 33.133809 *
*     1075 * 168613661 * 62.346427 *
*     1617 * 540929843 * 80.560987 *
*     2148 * 542768740 * 56.150252 *
*     2239 * 541907518 * 131.48998 *
*     2887 * 706316614 * 63.189824 *

************************************
*    Row   * indexeven * event_met *
************************************
*        0 * 573252531 * 36.672164 *
*        1 * 168613661 * 61.980712 *
*        2 * 540929843 * 81.129409 *
*        3 * 542768740 * 56.369651 *
*        4 * 541907518 * 132.19923 *
*        5 * 706316614 * 61.342762 *

aha!

1) recalculate with the formula in stage2

sqrt(2*event_leptons[0].pt()*event_met.pt()*(1 - cos(event_leptons[0].phi() - event_met.phi())))

root -l lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/Data13TeV_SingleMuon2016H_03Feb2017_ver2_2.root
ttree_out->Scan("indexevents:event_met_lep_mt:sqrt(2*event_leptons[0].pt()*event_met.pt()*(1 - cos(event_leptons[0].phi() - event_met.phi())))", "selection_stage_em > 200 && selection_stage_em < 210")

*    Row   * indexeven * event_met * sqrt(2*ev *
************************************************
*        0 * 573252531 * 36.672164 * 36.672165 *
*        1 * 168613661 * 61.980712 * 61.980713 *
*        2 * 540929843 * 81.129409 * 81.129407 *
*        3 * 542768740 * 56.369651 * 56.369652 *
*        4 * 541907518 * 132.19923 * 132.19923 *
*        5 * 706316614 * 61.342762 * 61.342760 *

-- ok

2) compare the parameters of mT

root -l gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/Data13TeV_SingleMuon2016H_03Feb2017_ver2_2.root
((TTree*) ntupler->Get("reduced_ttree"))->Scan("indexevents:lep_p4[0].pt():met_corrected.pt():lep_p4[0].phi():met_corrected.phi()", "no_iso_veto_leps && pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0] && abs(lep_dxy[0]) <0.01 && abs(lep_dz[0])<0.02) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1] && abs(lep_dxy[1]) <0.01 && abs(lep_dz[1])<0.02)) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4")

root -l lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/Data13TeV_SingleMuon2016H_03Feb2017_ver2_2.root
ttree_out->Scan("indexevents:event_leptons[0].pt():event_met.pt():event_leptons[0].phi():event_met.phi()", "selection_stage_em > 200 && selection_stage_em < 210")

*    Row   * indexeven * lep_p4[0] * met_corre * lep_p4[0] * met_corre *
************************************************************************
*      619 * 573252531 * 105.02864 * 61.278871 * 2.7719678 * -3.095212 *
*     1075 * 168613661 * 37.258724 * 58.412322 * 1.0833890 * -0.380221 *
*     1617 * 540929843 * 38.791694 * 99.997258 * -2.766596 * 2.1099775 *
*     2148 * 542768740 * 35.598461 * 60.212456 * 1.0383691 *  2.341433 *
*     2239 * 541907518 * 88.542724 * 48.823328 * 2.1606855 * -0.958420 *
*     2887 * 706316614 * 116.11275 * 32.271781 * -0.752298 * -1.836970 *


*    Row   * indexeven * event_lep * event_met * event_lep * event_met *
************************************************************************
*        0 * 573252531 * 105.02864 * 56.443907 * 2.7719678 * -3.030303 *
*        1 * 168613661 * 37.258724 * 58.486072 * 1.0833890 * -0.368588 *
*        2 * 540929843 * 38.791694 * 101.46744 * -2.766596 * 2.1104295 *
*        3 * 542768740 * 35.598461 * 58.731686 * 1.0383691 * 2.3666976 *
*        4 * 541907518 * 88.542724 * 49.443032 * 2.1606855 * -1.069896 *
*        5 * 706316614 * 116.11275 * 33.774188 * -0.752298 * -1.775973 *

-- met is different, both pT and phi!

3) compare met with all the init mets

    event_met_init  = LorentzVector_Class(0., 0., 0., 0.)
    event_met_init2 = LorentzVector_Class(0., 0., 0., 0.)

ntuple mets:

root -l gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/Data13TeV_SingleMuon2016H_03Feb2017_ver2_2.root
((TTree*) ntupler->Get("reduced_ttree"))->Scan("indexevents:met_corrected.pt():met_corrected.phi():met_init.pt():met_init.phi()", "no_iso_veto_leps && pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0] && abs(lep_dxy[0]) <0.01 && abs(lep_dz[0])<0.02) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1] && abs(lep_dxy[1]) <0.01 && abs(lep_dz[1])<0.02)) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4")

*    Row   * indexeven * met_corre * met_corre * met_init. * met_init. *
************************************************************************
*      619 * 573252531 * 61.278871 * -3.095212 * 61.278873 * -3.095212 *
*     1075 * 168613661 * 58.412322 * -0.380221 * 58.412323 * -0.380221 *
*     1617 * 540929843 * 99.997258 * 2.1099775 * 99.997261 * 2.1099774 *
*     2148 * 542768740 * 60.212456 *  2.341433 * 60.212459 * 2.3414330 *
*     2239 * 541907518 * 48.823328 * -0.958420 * 48.823326 * -0.958420 *
*     2887 * 706316614 * 32.271781 * -1.836970 * 32.271781 * -1.836970 *

-- identical

stage2 mets:

root -l lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/Data13TeV_SingleMuon2016H_03Feb2017_ver2_2.root
ttree_out->Scan("indexevents:event_met.pt():event_met.phi():event_met_init.pt():event_met_init.phi():event_met_init2.pt():event_met_init2.phi()", "selection_stage_em > 200 && selection_stage_em < 210")

*    Row   * indexeven * event_met * event_met * event_met * event_met * event_met * event_met *
************************************************************************************************
*        0 * 573252531 * 56.443907 * -3.030303 * 61.278873 * -3.095212 * 61.278873 * -3.095212 *
*        1 * 168613661 * 58.486072 * -0.368588 * 58.412323 * -0.380221 * 58.412323 * -0.380221 *
*        2 * 540929843 * 101.46744 * 2.1104295 * 99.997261 * 2.1099774 * 99.997261 * 2.1099774 *
*        3 * 542768740 * 58.731686 * 2.3666976 * 60.212459 * 2.3414330 * 60.212459 * 2.3414330 *
*        4 * 541907518 * 49.443032 * -1.069896 * 48.823326 * -0.958420 * 48.823326 * -0.958420 *
*        5 * 706316614 * 33.774188 * -1.775973 * 32.271781 * -1.836970 * 32.271781 * -1.836970 *

-- the init mets are ok

root -l lstore_outdirs/v37/test12/Data13TeV_SingleMuon2016H_03Feb2017_ver2/Data13TeV_SingleMuon2016H_03Feb2017_ver2_2.root
ttree_out->Scan("indexevents:event_met_lep_mt:sqrt(2*event_leptons[0].pt()*event_met.pt()*(1 - cos(event_leptons[0].phi() - event_met.phi()))):sqrt(2*event_leptons[0].pt()*event_met_init.pt()*(1 - cos(event_leptons[0].phi() - event_met_init.phi())))", "selection_stage_em > 200 && selection_stage_em < 210")

*    Row   * indexeven * event_met * sqrt(2*ev * sqrt(2*ev *
************************************************************
*        0 * 573252531 * 36.672164 * 36.672165 * 33.133809 *
*        1 * 168613661 * 61.980712 * 61.980713 * 62.346427 *
*        2 * 540929843 * 81.129409 * 81.129407 * 80.560989 *
*        3 * 542768740 * 56.369651 * 56.369652 * 56.150255 *
*        4 * 541907518 * 132.19923 * 132.19923 * 131.48998 *
*        5 * 706316614 * 61.342762 * 61.342760 * 63.189829 *

VS ntuple mT:

************************************
*    Row   * indexeven * sqrt(2*le *
************************************
*      619 * 573252531 * 33.133809 *
*     1075 * 168613661 * 62.346427 *
*     1617 * 540929843 * 80.560987 *
*     2148 * 542768740 * 56.150252 *
*     2239 * 541907518 * 131.48998 *
*     2887 * 706316614 * 63.189824 *

4) launch loop selection with these mets: test11 (it has all MC) bunchDILEP3recalc

5) disassemble the met propagation?
   why is it in Data?

for data:

taus are propagated, but TES factor = 1 for Data

            if PROP_TAU and tau_pt > TAUS_PT_CUT:
                proc_met         -= p4 * (TES_factor - 1.)

same for lep-matched and regular jets

also

                  if PROP_LEPJET_UNCLUSTER:
                    # return jes_cor to met
                    # in both data and MC
                    jes_uncorFactor = ev.jet_uncorrected_jecFactor[i]
                    if jet_pt > JETS_PT_CUT:
                        proc_met -= p4 * (jes_uncorFactor - 1.)

-- what is this factor for data?

-- confirm the factors == 1 for data
   and remove the procedures with if isMC

in file Data13TeV_SingleMuon2016H_03Feb2017_ver2_61.root
python channel_distrs_full_loop.py --do-W-stitching --metmuegclean false --options no_prop_lepjets -l logss temp/ channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/Data13TeV_SingleMuon2016H_03Feb2017_ver2_61.root

break stage2:2571
b stage2:3324
b stage2:3765
b stage2:3781
b stage2:3797
b stage2:3811

c

p ev.indexevents
580363142L

(Pdb) met_x
30.07923225935527
(Pdb) met_y
-61.59484003049502

proc_met.pt()
proc_met.phi()
68.54695129394531
-1.1165200471878052
p TES_factor
1.0
:w

proc_met.pt()
proc_met.phi()
68.54695129394531
-1.1165200471878052

then jets

PROP_LEPJET_UNCLUSTER passes

jes_uncorFactor
0.8821249604225159

then

3793 	                if not match_lep:
3794 	
3795 	                  # correct the met from all not lep-matched jets
3796 	                  if PROP_JETS:
3797B->	                      if jet_pt > JETS_PT_CUT:
3798 	                          proc_met -= p4 * (en_factor - 1.)

en_factor
1.0

proc_met.pt()
proc_met.phi()
80.81556388460609
-1.0500094890349883

then commented out?

3811B->	                  if jet_pt > JETS_PT_CUT:
3812 	                      #proc_met -= p4 * (en_factor - 1.)
3813 	                      weight_bSF     *= jet_weight_bSF_nom

and the same
jes_uncorFactor
0.9932722449302673

until 3900

2571B->	        proc_met         = LorentzVector('ROOT::Math::PxPyPzE4D<double>')(met_x, met_y, 0., 0.)
ev.indexevents
579336885L

ok, so what is PROP_LEPJET_UNCLUSTER and should it be there?


but big question remains: what's with the pT trends?


##### the stage2 mT distr with met_init, test11 bunchDILEP3recalc

this is not needed:

python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3_mc_1_limited/  -c dy_mumu --data-nick data_other -d met_c  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3_mc_1_limited/  -c dy_mumu --data-nick data_other -d Mt_lep_met_f  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

-- only elmu passed in test11


python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d met_c  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d Mt_lep_met_f  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d Mt_lep_met_c  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

INFO:root:data       =   163282.000000     1152.454343
INFO:root:mc sum     =   158483.247879   158483.247879

met_c        -- linear trend
Mt_lep_met_f -- still not enough at peak

eog plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_1_limited_distrs,v37_test11_bunchDILEP3recalc,SingleMuon_Mt_lep_met_c_tt_elmu_NOMINAL_stack_ratio.png plots/v37_test10_bunchDILEP3_mc_1_wNjets_tt_elmu/distrs,v37_test10_bunchDILEP3_mc_1_wNjets_distrs,v37_test10_bunchDILEP3,,SingleMuon_Mt_lep_met_c_tt_elmu_NOMINAL_stack_ratio.png

-- better in separate bins, the deviation is smooth, only at peak

python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d elmu_mu_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d elmu_el_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d elmu_mu_eta --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d elmu_el_eta --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

eog plots/v37_test11_bunchDILEP3recalc_mc_1_limited/*png

-- same trends in pT,
   both electron and muon eta are insane



##### mT difference with v12 and v37 with met_init -- with 30GeV cut the shapes match perfectly Data and TT!

debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root

python get_shapes.py --no-norm --norm-formulas --formula "data_v12_7:data_met_init_d30g_MET" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj data_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h data_v37test11_H:distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_test12_H:distrs/v37_test12_bunchDILEP3/all/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_met_init_d30g_MET:../test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters.root:test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters

python get_shapes.py --no-norm --norm-formulas --formula "tt_v37test11_METinit:tt_v12_7 + tt_v127other" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj

tt_v37test11:distrs/v37_test11_bunchDILEP3_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f
"tt_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{em}"
"tt_v127other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{other}"
tt_met_cor_d30g:../test_v37_v12_tt_elmu_Mt_30GeVpT.root:test_v37_v12_tt_elmu_Mt_30GeVpT
tt_met_cor_d32g:../test_v37_v12_tt_elmu_Mt_32GeVpT.root:test_v37_v12_tt_elmu_Mt_32GeVpT
tt_v37test11_METinit:distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f

python get_shapes.py --no-norm --norm-formulas --formula "tt_v37test11_METinit:tt_v12_7 + tt_v127other" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_v37test11_METinit:distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f "tt_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{em}" "tt_v127other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{other}"

-- slight, but noticeable and consistent, deviation in shape
   v12 peaks more, exactly how it would fix the trend in test11

yields? 32GeV?

data:

python get_shapes.py --no-norm --norm-formulas --formula "data_v37test11_METinit:data_v12_7" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj data_v37test11_METinit:distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f "data_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h"

-- noticeable deviation, v12 is shifted to smaller mT (also would fix the trend)

1) draw the distrs with 30GeV
2) and compare yields in TT

Data13TeV_SingleMuon2016H_03Feb2017_ver2.root  MC2016_Summer16_TTJets_powheg.root

python get_shapes.py --no-norm --norm-formulas --formula "data_v37test11_METinit:data_30GeV:data_v12_7" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj data_v37test11_METinit:distrs/v37_test11_bunchDILEP3recalc/1_32GeV/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f "data_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h" data_30GeV:distrs/v37_test11_bunchDILEP3recalc/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f

-- 30GeV is very close to v12

in TT:

python get_shapes.py --no-norm --norm-formulas --formula "tt_v37test11_METinit:tt_30GeV:tt_v12_7 + tt_v127other" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_v37test11_METinit:distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f "tt_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{em}" "tt_v127other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{other}" tt_30GeV:distrs/v37_test11_bunchDILEP3recalc/MC2016_Summer16_TTJets_powheg.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f

-- 30GeV perfectly matches v12

yields:

root -l distrs/v37_test11_bunchDILEP3recalc/MC2016_Summer16_TTJets_powheg.root
tt_elmu->Get("tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f")->Print()
.q

root -l debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root
((TH1D*) _file0->Get("tt_{em}"))->GetEntries() + ((TH1D*) _file0->Get("tt_{other}"))->GetEntries()
.q

TH1.Print Name  = tt_elmu_tt_other_NOMINAL_Mt_lep_met_f, Entries= 403533, Total sum= 355106
root [1] ((TH1D*) _file0->Get("tt_{em}"))->GetEntries() + ((TH1D*) _file0->Get("tt_{other}"))->GetEntries()
(double) 408793.

-- maybe it's the remaining not "other" tt?

root -l distrs/v37_test11_bunchDILEP3recalc/MC2016_Summer16_TTJets_powheg.root
tt_elmu->Get("tt_mutau/NOMINAL/tt_elmu_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
tt_elmu->Get("tt_lj/NOMINAL/tt_elmu_tt_lj_NOMINAL_Mt_lep_met_f")->Print()
tt_elmu->Get("tt_taulj/NOMINAL/tt_elmu_tt_taulj_NOMINAL_Mt_lep_met_f")->Print()
tt_elmu->Get("tt_taultauh/NOMINAL/tt_elmu_tt_taultauh_NOMINAL_Mt_lep_met_f")->Print()

TH1.Print Name  = tt_elmu_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 276, Total sum= 228.871
TH1.Print Name  = tt_elmu_tt_lj_NOMINAL_Mt_lep_met_f, Entries= 741, Total sum= 627.926
TH1.Print Name  = tt_elmu_tt_taulj_NOMINAL_Mt_lep_met_f, Entries= 39, Total sum= 33.031
TH1.Print Name  = tt_elmu_tt_taultauh_NOMINAL_Mt_lep_met_f, Entries= 21, Total sum= 18.5013

TODO: not enough, still 4k/400k events are missing in v37 TT?

...but the shapes perfectly agree with v12? and the stack still does not match the data?
-- compare shapes of other processes?


##### compare mT shapes in other processes

check old cross sections:

test/dtag_xsecs.h

const double ttbar_xsec = 831.76;

{"MC2016_Summer16_DYJetsToLL_10to50_amcatnlo", 18610},
{"MC2016_Summer16_DYJetsToLL_50toInf_madgraph", 5765.4}, // but McM shows 4970
{"MC2016_Summer16_DYJetsToTauTau_50toInf_amcatnlo", 1867}, // from McM TODO: check

{ "MC2016_Summer16_ZZTo2L2Q_amcatnlo_madspin"      , 3.22   },
//{ "MC2016_Summer16_ZZTo2L2Nu_powheg"               , 0.564  },
{ "MC2016_Summer16_ZZTo2L2Nu_powheg"               , 1.256  },
{ "MC2016_Summer16_WZTo2L2Q_amcatnlo_madspin"      , 5.595  },
{ "MC2016_Summer16_WZTo1L3Nu_amcatnlo_madspin"     , 3.033  },
{ "MC2016_Summer16_WZTo1L1Nu2Q_amcatnlo_madspin"   , 10.71  },
{ "MC2016_Summer16_WZTo3LNu_powheg"                , 4.42965  },
{ "MC2016_Summer16_WWToLNuQQ_powheg"               ,  49.997  },
{ "MC2016_Summer16_WWTo2L2Nu_powheg"               ,  12.178  },

{"MC2016_Summer16_SingleT_tW_5FS_powheg",    35.6},
{"MC2016_Summer16_SingleTbar_tW_5FS_powheg", 35.6},
{"MC2016_Summer16_schannel_4FS_leptonicDecays_amcatnlo", 10.11}, //3.36},
{"MC2016_Summer16_tchannel_antitop_4f_leptonicDecays_powheg", 80.95}, //70.69/2},
{"MC2016_Summer16_tchannel_top_4f_leptonicDecays_powheg", 136.02}, //70.69/2},

and now:

"MC2016_Summer16_DYJetsToLL_10to50_amcatnlo":  18610,
"MC2016_Summer16_DYJetsToLL_10to50_amcatnlo_": 18610,
"MC2016_Summer16_DYJetsToLL_50toInf_madgraph": 6225.42, #5765.4, # but McM shows 4970

 "MC2016_Summer16_ZZTo2L2Q_amcatnlo_madspin"      : 3.22   ,
 "MC2016_Summer16_ZZTo2L2Nu_powheg"               : 0.564  ,
 "MC2016_Summer16_ZZTo2L2Nu_powheg"               : 1.256  ,

 "MC2016_Summer16_WZTo2L2Q_amcatnlo_madspin"      : 5.595  ,
 "MC2016_Summer16_WZTo1L3Nu_amcatnlo_madspin"     : 3.033  ,
 "MC2016_Summer16_WZTo1L1Nu2Q_amcatnlo_madspin"   : 10.71  ,
 "MC2016_Summer16_WZTo3LNu_powheg"                : 4.42965  ,

 "MC2016_Summer16_WWToLNuQQ_powheg"               : 49.997  ,
 "MC2016_Summer16_WWTo2L2Nu_powheg"               : 12.178  ,

"MC2016_Summer16_SingleT_tW_5FS_powheg_":    35.6,
"MC2016_Summer16_SingleT_tW_5FS_powheg":    35.6,
"MC2016_Summer16_SingleTbar_tW_5FS_powheg_": 35.6,
"MC2016_Summer16_SingleTbar_tW_5FS_powheg": 35.6,

"MC2016_Summer16_schannel_4FS_leptonicDecays_amcatnlo_": 10.11, #3.36},
"MC2016_Summer16_schannel_4FS_leptonicDecays_amcatnlo": 10.11, #3.36},
"MC2016_Summer16_tchannel_antitop_4f_leptonicDecays_powheg_": 80.95, #70.69/2},
"MC2016_Summer16_tchannel_antitop_4f_leptonicDecays_powheg": 80.95, #70.69/2},
"MC2016_Summer16_tchannel_top_4f_leptonicDecays_powheg_": 136.02, #70.69/2},
"MC2016_Summer16_tchannel_top_4f_leptonicDecays_powheg": 136.02, #70.69/2},
}

-- only MC2016_Summer16_DYJetsToLL_50toInf_madgraph is different


python get_shapes.py --no-norm --norm-formulas --formula "dy_v12:dy_30GeV" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj 

produce other processes with 30GeV in tt_elmu

python get_shapes.py --no-norm --norm-formulas --formula "tt_v37test11_METinit:tt_30GeV:tt_v12_7 + tt_v127other" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_v37test11_METinit:distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f "tt_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{em}" "tt_v127other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{other}" tt_30GeV:distrs/v37_test11_bunchDILEP3recalc/MC2016_Summer16_TTJets_powheg.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f

files:

tt_v37test11_METinit:distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f
"tt_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{em}"
"tt_v127other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{other}"
tt_30GeV:distrs/v37_test11_bunchDILEP3recalc/shapes_mc2.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f
dy_30GeV:distrs/v37_test11_bunchDILEP3recalc/shapes_mc2.root:tt_elmu/dy_tautau/NOMINAL/tt_elmu_dy_tautau_NOMINAL_Mt_lep_met_f
dibosons_30GeV:distrs/v37_test11_bunchDILEP3recalc/shapes_mc2.root:tt_elmu/dibosons_other/NOMINAL/tt_elmu_dibosons_other_NOMINAL_Mt_lep_met_f
stop_30GeV:distrs/v37_test11_bunchDILEP3recalc/shapes_mc2.root:tt_elmu/s_top_other/NOMINAL/tt_elmu_s_top_other_NOMINAL_Mt_lep_met_f

dy_v12:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:dyjets
dibosons_v12:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:dibosons
"stop_v12:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:single top"


dy

python get_shapes.py --no-norm --norm-formulas --formula "dy_v12:dy_30GeV" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj dy_v12:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:dyjets dy_30GeV:distrs/v37_test11_bunchDILEP3recalc/shapes_mc2.root:tt_elmu/dy_tautau/NOMINAL/tt_elmu_dy_tautau_NOMINAL_Mt_lep_met_f

-- within stat unc


dibosons

python get_shapes.py --no-norm --norm-formulas --formula "dibosons_v12:dibosons_30GeV" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj dibosons_v12:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:dibosons dibosons_30GeV:distrs/v37_test11_bunchDILEP3recalc/shapes_mc2.root:tt_elmu/dibosons_other/NOMINAL/tt_elmu_dibosons_other_NOMINAL_Mt_lep_met_f

-- v12 has larger mT, thus peaks more


single top

python get_shapes.py --no-norm --norm-formulas --formula "stop_v12:stop_30GeV" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj stop_30GeV:distrs/v37_test11_bunchDILEP3recalc/shapes_mc2.root:tt_elmu/s_top_other/NOMINAL/tt_elmu_s_top_other_NOMINAL_Mt_lep_met_f "stop_v12:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:single top"

-- match well, within stats


check tt again

python get_shapes.py --no-norm --norm-formulas --formula "tt_30GeV:tt_v12_7 + tt_v127other" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj "tt_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{em}" "tt_v127other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:tt_{other}" tt_30GeV:distrs/v37_test11_bunchDILEP3recalc/shapes_mc2.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f

-- perfect match



So, dibosons are off?
What's with them?

-- dibosons must be xsec-normalized first!

python get_shapes.py --no-norm --norm-formulas --formula "dibosons_v12:dibosons_30GeV" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj dibosons_v12:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:dibosons dibosons_30GeV:distrs/v37_test11_bunchDILEP3recalc_mc_2_limited.root:tt_elmu/dibosons_other/NOMINAL/tt_elmu_dibosons_other_NOMINAL_Mt_lep_met_f

-- perfect match within stat uncertainties



##### the fractions of yields of processes in v12 and in v37, also their normalizations

root -l distrs/v37_test11_bunchDILEP3recalc_mc_2_limited.root

((TH1D*) tt_elmu->Get("dibosons_other/NOMINAL/tt_elmu_dibosons_other_NOMINAL_Mt_lep_met_f")) ->GetEntries()
((TH1D*) tt_elmu->Get("tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f"))             ->GetEntries()
((TH1D*) tt_elmu->Get("s_top_other/NOMINAL/tt_elmu_s_top_other_NOMINAL_Mt_lep_met_f"))       ->GetEntries()
((TH1D*) tt_elmu->Get("dy_tautau/NOMINAL/tt_elmu_dy_tautau_NOMINAL_Mt_lep_met_f"))           ->GetEntries()

(Double_t) 92578.0
(Double_t) 403533.
(Double_t) 85242.0
(Double_t) 1895.00

((TH1D*) tt_elmu->Get("dibosons_other/NOMINAL/tt_elmu_dibosons_other_NOMINAL_Mt_lep_met_f"))->Integral()
((TH1D*) tt_elmu->Get("tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f"))->Integral()
((TH1D*) tt_elmu->Get("s_top_other/NOMINAL/tt_elmu_s_top_other_NOMINAL_Mt_lep_met_f"))->Integral()
((TH1D*) tt_elmu->Get("dy_tautau/NOMINAL/tt_elmu_dy_tautau_NOMINAL_Mt_lep_met_f"))->Integral()

(Double_t) 0.418866
(Double_t) 3.77753
(Double_t) 0.375054
(Double_t) 0.254597

and test10:

root -l distrs/v37_test10_bunchDILEP3_mc_1_wNjets.root

(Double_t) 0.396523
(Double_t) 3.59690
(Double_t) 0.358366
(Double_t) 0.192929

-- similar

yields_v37 = [ 0.418866 3.77753 0.375054 0.254597 ]
yields_v37 ./ sum(yields_v37)

 0.0867928  0.782738  0.0777145  0.0527548




root -l debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root

((TH1D*) _file0->Get("dibosons"))->GetEntries()
((TH1D*) _file0->Get("tt_{em}"))->GetEntries() + ((TH1D*) _file0->Get("tt_{other}"))->GetEntries()
((TH1D*) _file0->Get("single top"))->GetEntries()
((TH1D*) _file0->Get("dyjets"))->GetEntries()

93720.0
408793.
86916.0
2397.00

((TH1D*) _file0->Get("dibosons"))->Integral()
((TH1D*) _file0->Get("tt_{em}"))->Integral() + ((TH1D*) _file0->Get("tt_{other}"))->Integral()
((TH1D*) _file0->Get("single top"))->Integral()
((TH1D*) _file0->Get("dyjets"))->Integral()

(Double_t) 250.865
(double) 2261.56
(Double_t) 226.424
(Double_t) 161.656


yields_v12 = [ 93720.0 408793. 86916.0 2397.00 ]
yields_v12 ./ sum(yields_v12)

 0.158357  0.690732  0.146861  0.00405018

yields_v12 = [ 250.865 2261.56 226.424 161.656 ]

 0.0864901  0.779712  0.0780636  0.0557337

-- exactly the same fractions...

   so, shapes and normalizations are the same?
   how does this happen?




compare MC stacks

python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root distrs/v37_test11_bunchDILEP3recalc/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d Mt_lep_met_f  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

python get_shapes.py --no-norm --norm-formulas --formula "dibosons_v12:dibosons_30GeV" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj dibosons_v12:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:dibosons dibosons_30GeV:distrs/v37_test11_bunchDILEP3recalc/shapes_mc2.root:tt_elmu/dibosons_other/NOMINAL/tt_elmu_dibosons_other_NOMINAL_Mt_lep_met_f

python get_shapes.py --no-norm --norm-formulas --formula "mc_v37:mc_v12" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj mc_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_1_limited_HISTOSEL_Mt_lep_met_f_tt_elmu_NOMINAL.root:tt_elmu/sums_NOMINAL/mc_sum1_NOMINAL mc_v12:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h_0

v12 has smaller mT-s!

damn

MC sum yields:

root -l plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_1_limited_HISTOSEL_Mt_lep_met_f_tt_elmu_NOMINAL.root
tt_elmu->Get("sums_NOMINAL/mc_sum1_NOMINAL")->Print()
.q

root -l debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root
TH1.Print Name  = mc_sum1_NOMINAL, Entries= 538525, Total sum= 155818

yields_v37 ./ ( 155818 / 35800)

[olek@fermi04 jobsums]$ root -l debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root
TH1.Print Name  = h_0, Entries= 592404, Total sum= 2920.64

yields_v12 ./ 2920.64

 0.0962367  0.867907  0.0861706  0.058495
 0.0858938  0.774337  0.0775255  0.0553495

(sum(yields_v37) * 35800) ./ 155818
sum(yields_v12) ./ 2920.64

1.1088095252153154
0.993105963076586

1.1088??


((TH1D*) tt_elmu->Get("dibosons_other/NOMINAL/tt_elmu_dibosons_other_NOMINAL_Mt_lep_met_f"))->Integral()
((TH1D*) tt_elmu->Get("tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f"))->Integral()
((TH1D*) tt_elmu->Get("s_top_other/NOMINAL/tt_elmu_s_top_other_NOMINAL_Mt_lep_met_f"))->Integral()
((TH1D*) tt_elmu->Get("dy_tautau/NOMINAL/tt_elmu_dy_tautau_NOMINAL_Mt_lep_met_f"))->Integral()
((TH1D*) tt_elmu->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->Integral()

 13482.0
 123209.
 12262.0
 5882.36

 155818.

yields_v37_lumi = [ 13482.0 123209.  12262.0 5882.36 ]

sum(yields_v37_lumi) / 155818.

0.9936936682539885

which deviate then?

julia> yields_v37_lumi ./ 35800
1x4 Array{Float64,2}:
 0.376592  3.44159  0.342514  0.164312

julia> yields_v37 ./ (yields_v37_lumi ./ 35800)
1x4 Array{Float64,2}:
 1.11225  1.09761  1.095  1.54948


python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root distrs/v37_test11_bunchDILEP3recalc/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d Mt_lep_met_f  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5 | grep "^final factor"

final factor            dy_tautau         35800.000000   1.000000 0.986310 1.000000             35309.898607
final factor             dy_other         35800.000000   1.000000 0.986310 1.000000             35309.898607
final factor          s_top_mutau         35800.000000   1.000000 0.986310 1.000000             35309.898607
final factor             s_top_lj         35800.000000   1.000000 0.986310 1.000000             35309.898607
final factor          s_top_other         35800.000000   1.000000 0.986310 1.000000             35309.898607
final factor             tt_mutau         35800.000000   1.000000 0.986310 1.000000             35309.898607
final factor                tt_lj         35800.000000   1.000000 0.986310 1.000000             35309.898607
final factor          tt_taultauh         35800.000000   1.000000 0.986310 1.000000             35309.898607
final factor             tt_taulj         35800.000000   1.000000 0.986310 1.000000             35309.898607
final factor             tt_other         35800.000000   1.000000 0.986310 1.000000             35309.898607
final factor       dibosons_other         35800.000000   1.000000 0.986310 1.000000             35309.898607

-- same factor!

final factor            dy_tautau         35800.000000   1.000000 0.986310 1.000000             35309.898607 =    5882.36 /   0.166592
final factor             dy_other         35800.000000   1.000000 0.986310 1.000000             35309.898607 =     626.60 /   0.017746
final factor          s_top_mutau         35800.000000   1.000000 0.986310 1.000000             35309.898607 =       9.73 /   0.000275
final factor             s_top_lj         35800.000000   1.000000 0.986310 1.000000             35309.898607 =      49.47 /   0.001401
final factor          s_top_other         35800.000000   1.000000 0.986310 1.000000             35309.898607 =   12262.04 /   0.347269
final factor             tt_mutau         35800.000000   1.000000 0.986310 1.000000             35309.898607 =      76.10 /   0.002155
final factor                tt_lj         35800.000000   1.000000 0.986310 1.000000             35309.898607 =     205.96 /   0.005833
final factor          tt_taultauh         35800.000000   1.000000 0.986310 1.000000             35309.898607 =       5.53 /   0.000156
final factor             tt_taulj         35800.000000   1.000000 0.986310 1.000000             35309.898607 =       8.80 /   0.000249
final factor             tt_other         35800.000000   1.000000 0.986310 1.000000             35309.898607 =  123209.39 /   3.489373
final factor       dibosons_other         35800.000000   1.000000 0.986310 1.000000             35309.898607 =   13482.04 /   0.381820

VS the integrals in the output:

dibosons_other     13482.0    SAME
tt_other          123209.     SAME
s_top_other        12262.0    SAME
dy_tautau           5882.36   SAME


wait

root -l distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root

tt_elmu->Get("dibosons_other/NOMINAL/tt_elmu_dibosons_other_NOMINAL_Mt_lep_met_f"))->Integral()
tt_elmu->Get("tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f"))->Integral()
tt_elmu->Get("s_top_other/NOMINAL/tt_elmu_s_top_other_NOMINAL_Mt_lep_met_f"))->Integral()
tt_elmu->Get("dy_tautau/NOMINAL/tt_elmu_dy_tautau_NOMINAL_Mt_lep_met_f"))->Integral()

 0.381820
 3.48937
 0.347269
 0.166592

-- different from the mc_2_limited
   distrs/v37_test11_bunchDILEP3recalc_mc_2_limited.root

yields_v37_limited_1_mc = [ 0.381820 3.48937 0.347269 0.166592 ]

yields_v37_limited_1_mc ./ (yields_v37_lumi ./ 35800)
 1.01388  1.01388  1.01388  1.01388

julia> sum(yields_v37_limited_1_mc) ./ sum(yields_v37_lumi ./ 35800)
1.0138822669447083

-- PU norm
   ok


yields_v37_limited_1_mc ./ sum(yields_v37_limited_1_mc)
 0.0870731  0.795742  0.0791938  0.0379909

VS

yields_v12 ./ sum(yields_v12)
 0.0864901  0.779712  0.0780636  0.0557337

small deviations
is this the issue?

python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_2_limited.root distrs/v37_test11_bunchDILEP3recalc/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d Mt_lep_met_f  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --normalize

eog plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_2_limited_distrs,v37_test11_bunchDILEP3recalc,Data13TeV_SingleMuon2016H_03Feb2017_ver2_Mt_lep_met_f_tt_elmu_NOMINAL_stack_ratio_normalize.png

-- within stats, but overall looks worse than v12?
   no! except some bin-by-bin variation it is identical to v12

where was the difference?
directly in v37_test11_bunchDILEP3recalc_mc_1_limited

plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_1_limited_distrs,v37_test11_bunchDILEP3recalc,SingleMuon_Mt_lep_met_c_tt_elmu_NOMINAL_stack_ratio.png

is Data in sync by pT here?

cp Data13TeV_SingleMuon2016H_03Feb2017_ver2.root Data13TeV_SingleMuon2016H_03Feb2017_ver2_matched_v12.root <--- the matched data

run plots with full data now & reproduce the Muon H too

python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d Mt_lep_met_f  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --normalize

-- much better than before, within stats!
   still there could some slight trend, maybe it would be fixed by smaller DY, or by some systematic, or by eta-pT fix
   but otherwise, perfect!
   the small trend at peak might be due to w+jets!

python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d Mt_lep_met_f  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5

python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d Mt_lep_met_f  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.2
python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d Mt_lep_met_f  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.2 --normalize

-- within stats and normalization
   there are noticeable bin-by-bin deviations less than 5%
   they must be due to pT and eta

INFO:root:data       =   177076.000000     1766.266038
INFO:root:mc sum     =   171574.665872   171574.665872

python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d elmu_mu_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.2
python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d elmu_mu_eta --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.2

python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d elmu_el_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.2
python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d elmu_el_eta --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.2

-- small trends in pT, looks ok with ratio-range 0.5
   visible at 0.2: strange jumps and 5% data>mc in low pT

eog plots/v37_test11_bunchDILEP3recalc_mc_1_limited/*_mc_3_*

python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d met_c  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.2

-- linear trend from 7% of low met to 0% at 100-150 to -10% at 500
   low met cannot be filled with w+jets




##### insane etas

reproduce:

python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d elmu_mu_eta --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.5
python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d elmu_el_eta --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.5

eog plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_distrs,v37_test11_bunchDILEP3recalc,SingleMuon_elmu_mu_eta_tt_elmu_NOMINAL_stack_ratio.png plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_distrs,v37_test11_bunchDILEP3recalc,SingleMuon_elmu_el_eta_tt_elmu_NOMINAL_stack_ratio.png

-- not too bad, but does look like random trends


produce v12 distrs

    'lep_pt':        ({'NOMINAL': lambda ev: ev.event_leptons[0].pt()},  ('histo-range',  [40,0,200])),
    'lep_eta':       ({'NOMINAL': lambda ev: ev.event_leptons[0].eta()}, ('histo-range',  [26,-2.6,2.6])),

lep0 -- must be muon
lep1 -- must be electron
-- confirm

in stage2:

python get_shapes.py --no-norm --norm-formulas --formula "stage2_lep_pt:stage2_elmu_mu_pt" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj stage2_lep_pt:distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_lep_pt stage2_elmu_mu_pt:distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_elmu_mu_pt
python get_shapes.py --no-norm --norm-formulas --formula "stage2_lep_eta:stage2_elmu_mu_eta" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj stage2_lep_eta:distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_lep_eta stage2_elmu_mu_eta:distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_elmu_mu_eta

-- full match

ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "lep_p4[0].pt()"  "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(40,0,200)"    INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt  " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets `cat v12.7_dilep_dtags` &
ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "lep_p4[0].eta()" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(26,-2.6,2.6)" INVESTIGATION-v37tests-v12.7-test_elmu_lep0_eta " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets `cat v12.7_dilep_dtags` &

ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "lep_p4[1].pt()"  "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(40,0,200)"    INVESTIGATION-v37tests-v12.7-test_elmu_lep1_pt  " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets `cat v12.7_dilep_dtags` &
ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "lep_p4[1].eta()" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(26,-2.6,2.6)" INVESTIGATION-v37tests-v12.7-test_elmu_lep1_eta " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets `cat v12.7_dilep_dtags` &

ls -t /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/

scp "otoldaie@lxplus.cern.ch:/eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/*.root" debugging_v37tests_w_comparison_to_v12.7_dilep/

python get_shapes.py --no-norm --norm-formulas --formula "data_v12_7:data_met_init_d30g_MET" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj data_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h data_v37test11_H:distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_test12_H:distrs/v37_test12_bunchDILEP3/all/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f data_met_init_d30g_MET:../test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters.root:test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters

debugging_v37tests_w_comparison_to_v12.7_dilep/

debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_eta_TOP_PT.root
debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root
debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_eta_TOP_PT.root
debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_pt_TOP_PT.root


stage2_elmu_mu_pt:distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_elmu_mu_pt
stage2_elmu_el_pt:distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_elmu_el_pt

stage2_elmu_mu_eta:distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_elmu_mu_eta
stage2_elmu_el_eta:distrs/v37_test11_bunchDILEP3recalc_mc_1_limited.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_elmu_el_eta


stage2_elmu_mu_pt:distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_elmu_mu_pt
stage2_elmu_el_pt:distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_elmu_el_pt

stage2_elmu_mu_eta:distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_elmu_mu_eta
stage2_elmu_el_eta:distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_elmu_el_eta

python get_shapes.py --no-norm --norm-formulas --formula "data_v12_7:data_met_init_d30g_MET" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj
data_v12_7:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_Mt-lep-met_TOP_PT.root:h
data_v37test11_H:distrs/v37_test11_bunchDILEP3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f
data_test12_H:distrs/v37_test12_bunchDILEP3/all/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f
data_met_init_d30g_MET:../test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters.root:test_v37_v12_data_tt_elmu_Mt_met_corrected_30GeVpT_allMETfilters

python get_shapes.py --no-norm --norm-formulas --formula "stage2_elmu_mu_eta/data_v12_lep0_eta" --y-range 0,2. --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj stage2_elmu_mu_eta:distrs/v37_test11_bunchDILEP3recalc/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_elmu_mu_eta data_v12_lep0_eta:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_eta_TOP_PT.root:data
python get_shapes.py --no-norm --norm-formulas --formula "stage2_elmu_el_eta/data_v12_lep1_eta" --y-range 0,2. --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj stage2_elmu_el_eta:distrs/v37_test11_bunchDILEP3recalc/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_elmu_el_eta data_v12_lep1_eta:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_eta_TOP_PT.root:data

eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_data_v12_lep0_eta,stage2_elmu_mu_eta_formula_nonorm.png ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_stage2_elmu_el_eta,data_v12_lep1_eta_formula_nonorm.png

-- shows v37 has slightly more electrons in high eta and less muons in high eta

TODO: if in v12 data has _more_ electrons/muons in endcaps (surplus of some events)
      v12 data must have some events, which are not present in v37
      --- find them by indexevents
          if not found, then the v12 data has _less_ events in barrel (lack of events)

what's with pT:

python get_shapes.py --no-norm --norm-formulas --formula "stage2_elmu_mu_pt/data_v12_lep0_pt" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj stage2_elmu_mu_pt:distrs/v37_test11_bunchDILEP3recalc/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_elmu_mu_pt data_v12_lep0_pt:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:data
python get_shapes.py --no-norm --norm-formulas --formula "stage2_elmu_el_pt/data_v12_lep1_pt" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj stage2_elmu_el_pt:distrs/v37_test11_bunchDILEP3recalc/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_elmu_el_pt data_v12_lep1_pt:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_pt_TOP_PT.root:data

eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_data_v12_lep0_pt,stage2_elmu_mu_pt_formula_nonorm.png ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_stage2_elmu_el_pt,data_v12_lep1_pt_formula_nonorm.png

--- 2% less muons in lowest pT in v37 stage2, but it is within stats,
    all the rest is around 1, fluctuations within stats
    no kink or step at 30-60 GeV


python get_shapes.py --no-norm --norm-formulas --formula "stage2_elmu_mu_eta:tt_other_v12_lep0_eta+tt_em_v12_lep0_eta" --y-range 0,0.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj stage2_elmu_mu_eta:distrs/v37_test11_bunchDILEP3recalc/MC2016_Summer16_TTJets_powheg.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_elmu_mu_eta "tt_em_v12_lep0_eta:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_eta_TOP_PT.root:tt_{em}" "tt_other_v12_lep0_eta:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_eta_TOP_PT.root:tt_{other}"
python get_shapes.py --no-norm --norm-formulas --formula "stage2_elmu_el_eta:tt_other_v12_lep1_eta+tt_em_v12_lep1_eta" --y-range 0,0.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj stage2_elmu_el_eta:distrs/v37_test11_bunchDILEP3recalc/MC2016_Summer16_TTJets_powheg.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_elmu_el_eta "tt_em_v12_lep1_eta:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_eta_TOP_PT.root:tt_{em}" "tt_other_v12_lep1_eta:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_eta_TOP_PT.root:tt_{other}"

eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_tt_em_v12_lep0_eta,stage2_elmu_mu_eta,tt_other_v12_lep0_eta_formula_nonorm.png ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_tt_other_v12_lep1_eta,stage2_elmu_el_eta,tt_em_v12_lep1_eta_formula_nonorm.png

-- the same




maybe v12 has all leptons ordered by pT after all?
check the IDs

ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "abs(lep_id[0]) == 13" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(5,-1,4)" INVESTIGATION-v37tests-v12.7-test_elmu_lep0_id " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets Data13TeV_SingleMuon2016H_03Feb2017_ver2 MC2016_Summer16_QCD_HT-100-200 &

-- shows all pass
((TTree*) ntupler->Get("reduced_ttree"))->Draw("abs(lep_id[0])", "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02")

((TTree*) ntupler->Get("reduced_ttree"))->Draw("abs(lep_id[0])", "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02")
37353 entries
all id == 13
((TTree*) ntupler->Get("reduced_ttree"))->Draw("abs(lep_id[0])", "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02 && no_iso_veto_leps")

-- does not find the no_iso_veto_leps

((TTree*) ntupler->Get("reduced_ttree"))->Draw("abs(lep_id[0])", "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02 && pass_basic_METfilters")

37038
-1% events

ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "lep_p4[0].eta()" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02 && pass_basic_METfilters" "(26,-2.6,2.6)" INVESTIGATION-v37tests-v12.7-test_elmu_lep0_eta_dataH " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets Data13TeV_SingleMuon2016H_03Feb2017_ver2 MC2016_Summer16_QCD_HT-100-200 &
ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "lep_p4[1].eta()" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02 && pass_basic_METfilters" "(26,-2.6,2.6)" INVESTIGATION-v37tests-v12.7-test_elmu_lep1_eta_dataH " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets Data13TeV_SingleMuon2016H_03Feb2017_ver2 MC2016_Summer16_QCD_HT-100-200 &

-- crashes
   no pass_basic_METfilters in QCD?



ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "(abs(lep_id[0]) == 11 ? lep_p4[0].eta() : lep_p4[1].eta())" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(26,-2.6,2.6)" INVESTIGATION-v37tests-v12.7-test_elmu_el_eta " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets `cat v12.7_dilep_dtags`    &
ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "(abs(lep_id[0]) == 13 ? lep_p4[0].eta() : lep_p4[1].eta())" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(26,-2.6,2.6)" INVESTIGATION-v37tests-v12.7-test_elmu_mu_eta " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets `cat v12.7_dilep_dtags`    &

ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "(abs(lep_id[0]) == 11 ? lep_p4[0].pt() : lep_p4[1].pt())" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(40,0,200)" INVESTIGATION-v37tests-v12.7-test_elmu_el_pt " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets `cat v12.7_dilep_dtags`    &
ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "(abs(lep_id[0]) == 13 ? lep_p4[0].pt() : lep_p4[1].pt())" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(40,0,200)" INVESTIGATION-v37tests-v12.7-test_elmu_mu_pt " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets `cat v12.7_dilep_dtags`    &

eog /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_mu_pt_TOP_PT.png /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_mu_eta_TOP_PT.png /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_el_pt_TOP_PT.png

-- the binning is much narrower than the input?????

command: (abs(lep_id[0]) == 13 ? lep_p4[0].eta() : lep_p4[1].eta())>>h(26,-2.6,2.6)	HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02

(abs(lep_id[0]) == 13 ? lep_p4[0].eta() : lep_p4[1].eta())
(26,-2.6,2.6)

root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_mu_eta_TOP_PT.root
data->Priroot [0] 
Attaching file /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_mu_eta_TOP_PT.root as _file0...
nt(TFile *) 0x2e86fe0
root [1] data->Print()
TH1.Print Name  = data, Entries= 37141, Total sum= 712269
root [2] data->GetEntries()
(Double_t) 37141.0
root [3] data->GetSize()
(Int_t) 102

root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_mu_pt_TOP_PT.root
root [0] 
Attaching file /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_mu_pt_TOP_PT.root as _file0...
(TFile *) 0x424c550
root [1] data->GetSize()
(Int_t) 102
root [2] .q

this is sick




##### insane ranges in ntuple_distr - happens when conditional parameter (?:) is ploted

ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "(abs(lep_id[0]) == 13 ? lep_p4[0].eta() : lep_p4[1].eta())" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(26,-2.6,2.6)" INVESTIGATION-v37tests-v12.7-test_elmu_mu_eta " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets `cat cat v12.7_dilep_dtags`

produces histos with 102 bins:

root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_mu_eta_TOP_PT.root
data->GetSize()
(Int_t) 102

ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "lep_p4[0].eta()" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(26,-2.6,2.6)" INVESTIGATION-v37tests-v12.7-test_elmu_mu_eta_RANGETEST " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets Data13TeV_SingleMuon2016H_03Feb2017_ver2 MC2016_Summer16_QCD_HT-100-200 &
ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "(abs(lep_id[0]) == 13 ? lep_p4[0].eta() : lep_p4[1].eta())" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(26,-2.6,2.6)" INVESTIGATION-v37tests-v12.7-test_elmu_mu_eta_RANGETEST2 " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets Data13TeV_SingleMuon2016H_03Feb2017_ver2 MC2016_Summer16_QCD_HT-100-200 &

ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "lep_p4[0].eta()" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(26,0.,2.6)" INVESTIGATION-v37tests-v12.7-test_elmu_mu_eta_RANGETEST3 " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets Data13TeV_SingleMuon2016H_03Feb2017_ver2 MC2016_Summer16_QCD_HT-100-200 &

ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "lep_p4[0].eta()" "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(100,0.,2.6)" INVESTIGATION-v37tests-v12.7-test_elmu_mu_eta_RANGETEST4 " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets Data13TeV_SingleMuon2016H_03Feb2017_ver2 MC2016_Summer16_QCD_HT-100-200 &

-- 102 bins happen with the conditional parameter...



##### deviation in data eta distrs: indexevents of v12 and v37 data events -- any v12 events missing in v37?

root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root

tree->SetScanField(0);
root [1] .> tree.log
tree->Scan("*");
.>


((TTree*) ntupler->Get("reduced_ttree"))->SetScanField(0);

.> v12_7_dilep_merged_sets_Data13TeV_SingleMuon2016H_03Feb2017_ver2.indexevents
((TTree*) ntupler->Get("reduced_ttree"))->Scan("indexevents", "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02 && pass_basic_METfilters");
.> v12_7_dilep_merged_sets_Data13TeV_SingleMuon2016H_03Feb2017_ver2.indexevents

and py script for per-job ntuples?





##### pT trends, in v12 and now

reproduce with ratio range 0.2:

python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d elmu_mu_pt --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.2
python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d elmu_el_pt --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.2

eog plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_distrs,v37_test11_bunchDILEP3recalc,SingleMuon_elmu_mu_pt_tt_elmu_NOMINAL_stack_ratio.png plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_distrs,v37_test11_bunchDILEP3recalc,SingleMuon_elmu_el_pt_tt_elmu_NOMINAL_stack_ratio.png

VS

ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "lep_p4[0].pt()"  "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(40,0,200)"    INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt  " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets `cat v12.7_dilep_dtags` &
ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "lep_p4[1].pt()"  "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(40,0,200)"    INVESTIGATION-v37tests-v12.7-test_elmu_lep1_pt  " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets `cat v12.7_dilep_dtags` &

scp "otoldaie@lxplus.cern.ch:/eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/*.png" debugging_v37tests_w_comparison_to_v12.7_dilep/

eog debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.png debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_pt_TOP_PT.png

-- no pT trends in v12, clear trend in v37, it looks like a MC contribution (like tt_{other} of v12) is missing
   the MC processes seem the same
   can be due to too much data in low pT

also check DY norm to the old one -- no, now DY has larger xsec!
or rearrange processes order to see better?
--- but it does look smaller now...
    I checked norm-s in mT, it was ok there..?



python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d elmu_mu_pt --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.5
python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -p -r  -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d elmu_el_pt --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.5



shape pT in data

python get_shapes.py --no-norm --norm-formulas --formula "stage2_elmu_mu_pt/data_v12_lep0_pt" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj stage2_elmu_mu_pt:distrs/v37_test11_bunchDILEP3recalc/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_elmu_mu_pt data_v12_lep0_pt:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:data
python get_shapes.py --no-norm --norm-formulas --formula "stage2_elmu_el_pt/data_v12_lep1_pt" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj stage2_elmu_el_pt:distrs/v37_test11_bunchDILEP3recalc/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_elmu_el_pt data_v12_lep1_pt:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_pt_TOP_PT.root:data

eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_data_v12_lep0_pt,stage2_elmu_mu_pt_formula_nonorm.png ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_stage2_elmu_el_pt,data_v12_lep1_pt_formula_nonorm.png

-- yeah, around 1
   maybe v37 stage2 has less low pT muons and more large values (which agrees with less muons in high eta)
   but it happens only in lowest pT bin (or two) and less than 5% deviation
   definitely no step 30-60GeV of 5% deviation


So:
1) data looks ok
2) DY of v37 looks smaller than in v12, even though I checked the fraction of DY before?





##### check the MC process fractions again

in 37:

python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d elmu_mu_pt --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.2
python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d elmu_el_pt --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.2

root -l plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_mu_pt_tt_elmu_NOMINAL.root
root -l plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_el_pt_tt_elmu_NOMINAL.root

root [11] tt_elmu->Get("sums_NOMINAL/mc_sum2_NOMINAL")->Print()
TH1.Print Name  = mc_sum2_NOMINAL, Entries= 585274, Total sum= 171988

tt_elmu->Get("dy_other/NOMINAL/tt_elmu_dy_other_NOMINAL_elmu_mu_pt")->Print()
tt_elmu->Get("dy_tautau/NOMINAL/tt_elmu_dy_tautau_NOMINAL_elmu_mu_pt")->Print()
tt_elmu->Get("tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_elmu_mu_pt")->Print()
tt_elmu->Get("dibosons_other/NOMINAL/tt_elmu_dibosons_other_NOMINAL_elmu_mu_pt")->Print()
tt_elmu->Get("s_top_other/NOMINAL/tt_elmu_s_top_other_NOMINAL_elmu_mu_pt")->Print()

TH1.Print Name  = tt_elmu_dy_other_NOMINAL_elmu_mu_pt, Entries= 166, Total sum= 756.019
TH1.Print Name  = tt_elmu_dy_tautau_NOMINAL_elmu_mu_pt, Entries= 1895, Total sum= 8979.21
TH1.Print Name  = tt_elmu_tt_other_NOMINAL_elmu_mu_pt, Entries= 403533, Total sum= 133912
TH1.Print Name  = tt_elmu_dibosons_other_NOMINAL_elmu_mu_pt, Entries= 92578, Total sum= 14723.6
TH1.Print Name  = tt_elmu_s_top_other_NOMINAL_elmu_mu_pt, Entries= 85242, Total sum= 13206.6


((TH1D*) tt_elmu->Get("dy_other/NOMINAL/tt_elmu_dy_other_NOMINAL_elmu_mu_pt"))->Integral() + ((TH1D*) tt_elmu->Get("dy_tautau/NOMINAL/tt_elmu_dy_tautau_NOMINAL_elmu_mu_pt"))->Integral() + ((TH1D*) tt_elmu->Get("tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_elmu_mu_pt"))->Integral() + ((TH1D*) tt_elmu->Get("dibosons_other/NOMINAL/tt_elmu_dibosons_other_NOMINAL_elmu_mu_pt"))->Integral() + ((TH1D*) tt_elmu->Get("s_top_other/NOMINAL/tt_elmu_s_top_other_NOMINAL_elmu_mu_pt"))->Integral()

(double) 171577.
       dy_tautau tt     dibosons  s_top_other
v37 = [ 8979.21  133912 14723.6   13206.6 ]
v37 ./ 171988
 0.0522084  0.778612  0.0856083  0.0767879

v12

root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root

((TH1D*) _file0->Get("h_0"))->Integral()
7319.00

((TH1D*) _file0->Get("dyjets"))->Integral()
((TH1D*) _file0->Get("tt_{em}"))->Integral() + ((TH1D*) _file0->Get("tt_{other}"))->Integral()
((TH1D*) _file0->Get("dibosons"))->Integral()
((TH1D*) _file0->Get("single top"))->Integral()

v12 = [ 403.938 5675.99 624.430 564.482 ]
v12 / 7319.00
 0.0551903  0.775514  0.0853163  0.0771256

-- very small deviations, in 3rd digit
   dy v37 / v12 = 0.0522084 / 0.0551903 = 0.94597
   -- opposite to the cross-section change: 6225.42, #5765.4,
      6225.42 / 5765.4 = 1.0798
      more than 10% of DY deviation
      why?

how many these pass in v12:
MC2016_Summer16_DYJetsToLL_10to50_amcatnlo.root

root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/MC2016_Summer16_DYJetsToLL_10to50_amcatnlo.root

((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02")
3

but lets' just increase DY by 10% -- how pT shape changes?

python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d elmu_mu_pt --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.2 --factor-dy 1.1 -p -r
python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d elmu_el_pt --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.2 --factor-dy 1.1 -p -r

eog plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_distrs,v37_test11_bunchDILEP3recalc,SingleMuon_elmu_mu_pt_tt_elmu_NOMINAL_stack_ratio.png plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_distrs,v37_test11_bunchDILEP3recalc,SingleMuon_elmu_el_pt_tt_elmu_NOMINAL_stack_ratio.png

-- the step is not fixed, just the smallest pT bin bends to data-mc agreement

what if even more:

python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d elmu_mu_pt --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.2 --factor-dy 1.3 -p -r
python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/  -c tt_elmu --data-nick data_other -d elmu_el_pt --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.2 --factor-dy 1.3 -p -r

-- now it's a clear bent, 30-40 is ok agreement, 40-60 5% more data, than back to agreement and less data than MC

So:
1) it cannot be only due to DY normalization
2) neither to the yields of other processes -- they all are close to v12
2) and data shape v12-v37 seems to agree well
-- it's due shapes in some other MC processes?



##### comparison of v12-v37 shapes of all MC processes - seems like source of pT kinks in v37

first, compare v12-v37 MC sum shapes -- if data agrees, than this must disagree

v37 mc sum:
root -l plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_el_pt_tt_elmu_NOMINAL.root

root [11] tt_elmu->Get("sums_NOMINAL/mc_sum2_NOMINAL")->Print()
TH1.Print Name  = mc_sum2_NOMINAL, Entries= 585274, Total sum= 171988

also there is:
mc_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_1_limited_HISTOSEL_Mt_lep_met_f_tt_elmu_NOMINAL.root:tt_elmu/sums_NOMINAL/mc_sum1_NOMINAL


files:

mc_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_el_pt_tt_elmu_NOMINAL.root:tt_elmu/sums_NOMINAL/mc_sum1_NOMINAL
mc_v12:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:h_0


python get_shapes.py --no-norm --norm-formulas --formula "mc_v37:mc_v12_lep0_pt" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj mc_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_mu_pt_tt_elmu_NOMINAL.root:tt_elmu/sums_NOMINAL/mc_sum1_NOMINAL mc_v12_lep0_pt:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:h_0

python get_shapes.py --no-norm --norm-formulas --formula "mc_v37/mc_v12_lep0_pt" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj mc_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_mu_pt_tt_elmu_NOMINAL.root:tt_elmu/sums_NOMINAL/mc_sum1_NOMINAL mc_v12_lep0_pt:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:h_0

eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_mc_v12_lep0_pt,mc_v37_formula_nonorm.png

-- clear linear trend from 0.98 at 30GeV to 1.08 at 200GeV

check the el:

python get_shapes.py --no-norm --norm-formulas --formula "mc_v37/mc_v12_lep1_pt" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj mc_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_el_pt_tt_elmu_NOMINAL.root:tt_elmu/sums_NOMINAL/mc_sum1_NOMINAL mc_v12_lep1_pt:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_pt_TOP_PT.root:h_0

eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_mc_v12_lep1_pt,mc_v37_formula_nonorm.png

-- the same clear trend + a distinct 4% step up at around 85GeV


which process is this?


tt

tt_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_mu_pt_tt_elmu_NOMINAL.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_elmu_mu_pt
"tt_v12_mu_pT_em:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:tt_{em}"
"tt_v12_mu_pT_other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:tt_{other}"

python get_shapes.py --no-norm --norm-formulas --formula "tt_v37/tt_v12_mu_pT_em +tt_v12_mu_pT_other" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_mu_pt_tt_elmu_NOMINAL.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_elmu_mu_pt "tt_v12_mu_pT_em:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:tt_{em}" "tt_v12_mu_pT_other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:tt_{other}"

python get_shapes.py --no-norm --norm-formulas --formula "tt_v37/tt_v12_el_pT_em +tt_v12_el_pT_other" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_el_pt_tt_elmu_NOMINAL.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_elmu_el_pt "tt_v12_el_pT_em:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_pt_TOP_PT.root:tt_{em}" "tt_v12_el_pT_other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_pt_TOP_PT.root:tt_{other}"

eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_tt_v12_mu_pT_other,tt_v12_mu_pT_em,tt_v37_formula_nonorm.png
eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_tt_v12_el_pT_other,tt_v12_el_pT_em,tt_v37_formula_nonorm.png

-- very clear linear trend from 0.98 to 1.10
   with the step in el pT



single top

stop_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_mu_pt_tt_elmu_NOMINAL.root:tt_elmu/s_top_other/NOMINAL/tt_elmu_s_top_other_NOMINAL_elmu_mu_pt
"stop_v12_mu_pT:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:single top"

python get_shapes.py --no-norm --norm-formulas --formula "stop_v37/stop_v12_mu_pT" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj stop_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_mu_pt_tt_elmu_NOMINAL.root:tt_elmu/s_top_other/NOMINAL/tt_elmu_s_top_other_NOMINAL_elmu_mu_pt "stop_v12_mu_pT:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:single top"
python get_shapes.py --no-norm --norm-formulas --formula "stop_v37/stop_v12_el_pT" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj stop_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_el_pt_tt_elmu_NOMINAL.root:tt_elmu/s_top_other/NOMINAL/tt_elmu_s_top_other_NOMINAL_elmu_el_pt "stop_v12_el_pT:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_pt_TOP_PT.root:single top"

eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_stop_v12_mu_pT,stop_v37_formula_nonorm.png ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_stop_v37,stop_v12_el_pT_formula_nonorm.png

-- very slight trend, about from 0.99 to 1.01
   but with clear step in el pT



dibosons

dibosons_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_mu_pt_tt_elmu_NOMINAL.root:tt_elmu/dibosons_other/NOMINAL/tt_elmu_dibosons_other_NOMINAL_elmu_mu_pt
dibosons_v12_mu_pT:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:dibosons

python get_shapes.py --no-norm --norm-formulas --formula "dibosons_v37/dibosons_v12_mu_pT" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj dibosons_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_mu_pt_tt_elmu_NOMINAL.root:tt_elmu/dibosons_other/NOMINAL/tt_elmu_dibosons_other_NOMINAL_elmu_mu_pt dibosons_v12_mu_pT:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:dibosons
python get_shapes.py --no-norm --norm-formulas --formula "dibosons_v37/dibosons_v12_el_pT" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj dibosons_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_el_pt_tt_elmu_NOMINAL.root:tt_elmu/dibosons_other/NOMINAL/tt_elmu_dibosons_other_NOMINAL_elmu_el_pt dibosons_v12_el_pT:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_pt_TOP_PT.root:dibosons

eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_dibosons_v37,dibosons_v12_mu_pT_formula_nonorm.png ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_dibosons_v37,dibosons_v12_el_pT_formula_nonorm.png

-- same very slight trend and the step in el pT



dy

dy_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_mu_pt_tt_elmu_NOMINAL.root:tt_elmu/dy_tautau/NOMINAL/tt_elmu_dy_tautau_NOMINAL_elmu_mu_pt
"dy_v12_mu_pT:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:dyjets"

python get_shapes.py --no-norm --norm-formulas --formula "dy_v37/dy_v12_mu_pT" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj dy_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_mu_pt_tt_elmu_NOMINAL.root:tt_elmu/dy_tautau/NOMINAL/tt_elmu_dy_tautau_NOMINAL_elmu_mu_pt dy_v12_mu_pT:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:dyjets
python get_shapes.py --no-norm --norm-formulas --formula "dy_v37/dy_v12_el_pT" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj dy_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_el_pt_tt_elmu_NOMINAL.root:tt_elmu/dy_tautau/NOMINAL/tt_elmu_dy_tautau_NOMINAL_elmu_el_pt dy_v12_el_pT:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_pt_TOP_PT.root:dyjets

eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_dy_v37,dy_v12_mu_pT_formula_nonorm.png ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_dy_v37,dy_v12_el_pT_formula_nonorm.png

-- very large fluctuation, nothing is visible




##### DY yields in v37: 10% less than expected - due to double ID SFs? - not the largest effect now, not solving it




##### v12-v37 MC processes pT: linear trend and the step in el pT

in TT it's the clearest:

python get_shapes.py --no-norm --norm-formulas --formula "tt_v37/tt_v12_mu_pT_em +tt_v12_mu_pT_other" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_mu_pt_tt_elmu_NOMINAL.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_elmu_mu_pt "tt_v12_mu_pT_em:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:tt_{em}" "tt_v12_mu_pT_other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:tt_{other}"

python get_shapes.py --no-norm --norm-formulas --formula "tt_v37/tt_v12_el_pT_em +tt_v12_el_pT_other" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_el_pt_tt_elmu_NOMINAL.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_elmu_el_pt "tt_v12_el_pT_em:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_pt_TOP_PT.root:tt_{em}" "tt_v12_el_pT_other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_pt_TOP_PT.root:tt_{other}"

eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_tt_v12_mu_pT_other,tt_v12_mu_pT_em,tt_v37_formula_nonorm.png ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_tt_v12_el_pT_other,tt_v12_el_pT_em,tt_v37_formula_nonorm.png

the step must be easier to find? (el SFs, which are not applied in v12)
the trend might be due to double-SFs in v37 (v12 applies only the muon SF, no electron SF)
should I check non-weighted distrs first?
for tests would be nice to reproduce weights in sumup_ttree_draw.py script... -- link the code to ROOT system and use in Draw

let's make weight-less distrs with draw
then implement the weights for draw and run tests on the weights


draw:

python sumup_ttree_draw.py "lep_p4[0].pt()" --cond-com "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 40,0.,200 --output testv37v12_pTtrends_TT_mu_pt.root --histo-name mu_pt gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/MC2016_Summer16_TTJets_powheg_*.root

python sumup_ttree_draw.py "lep_p4[1].pt()" --cond-com "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 40,0.,200 --output testv37v12_pTtrends_TT_el_pt.root --histo-name el_pt gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/MC2016_Summer16_TTJets_powheg_*.root



python jobsums/get_shapes.py --no-norm --norm-formulas --formula "tt_v37_dr_wless/tt_v12_mu_pT_em +tt_v12_mu_pT_other" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj  "tt_v12_mu_pT_em:jobsums/debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:tt_{em}" "tt_v12_mu_pT_other:jobsums/debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:tt_{other}" tt_v37_dr_wless:testv37v12_pTtrends_TT_mu_pt.root:mu_pt

python jobsums/get_shapes.py --no-norm --norm-formulas --formula "tt_v37_dr_wless/tt_v12_el_pT_em +tt_v12_el_pT_other" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj  "tt_v12_el_pT_em:jobsums/debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_pt_TOP_PT.root:tt_{em}" "tt_v12_el_pT_other:jobsums/debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_pt_TOP_PT.root:tt_{other}" tt_v37_dr_wless:testv37v12_pTtrends_TT_el_pt.root:el_pt

eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_tt_v12_el_pT_other,tt_v12_el_pT_em,tt_v37_dr_wless_formula_nonorm.png ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_tt_v37_dr_wless,tt_v12_mu_pT_other,tt_v12_mu_pT_em_formula_nonorm.png

-- both have the linear trend 0.98 - 1.10 with slight variation and no step


also compare to the stage2 output -- to see the effect of weights there

python get_shapes.py --no-norm --norm-formulas --formula "tt_v37/tt_v12_mu_pT_em +tt_v12_mu_pT_other" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_mu_pt_tt_elmu_NOMINAL.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_elmu_mu_pt "tt_v12_mu_pT_em:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:tt_{em}" "tt_v12_mu_pT_other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root:tt_{other}"

python get_shapes.py --no-norm --norm-formulas --formula "tt_v37/tt_v12_el_pT_em +tt_v12_el_pT_other" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj tt_v37:plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_el_pt_tt_elmu_NOMINAL.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_elmu_el_pt "tt_v12_el_pT_em:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_pt_TOP_PT.root:tt_{em}" "tt_v12_el_pT_other:debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_pt_TOP_PT.root:tt_{other}"


python jobsums/get_shapes.py --no-norm --norm-formulas --formula "tt_v37_mu/tt_v37_dr_wless" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj  tt_v37_mu:jobsums/plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_mu_pt_tt_elmu_NOMINAL.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_elmu_mu_pt tt_v37_dr_wless:testv37v12_pTtrends_TT_mu_pt.root:mu_pt

python jobsums/get_shapes.py --no-norm --norm-formulas --formula "tt_v37_el/tt_v37_dr_wless" --y-range 0.8,1.2 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj  tt_v37_el:jobsums/plots/v37_test11_bunchDILEP3recalc_mc_1_limited//distrs,v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd_HISTOSEL_elmu_el_pt_tt_elmu_NOMINAL.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_elmu_el_pt tt_v37_dr_wless:testv37v12_pTtrends_TT_el_pt.root:el_pt

eog ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_tt_v37_dr_wless,tt_v37_mu_formula_nonorm.png ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_tt_v37_dr_wless,tt_v37_el_formula_nonorm.png

-- close to 1, clearly seen step in el and slight turn from the SFs
   1) draw reproduces the stage2 correctly
   2) and even wighout weights it shows the same deviation from v12



So:
1) the trend appears before weights
2) the draw weightless is ok for fixing the linear trend
3) the step is probably to one of the electron SFs (was it the trigger?)


How do you catch this?
In TT:
1) number of processed jobs was the same or really close
2) overall number of passing events was really close
3) then indexevents should show the events which differ



Check 1) and 2):

root -l testv37v12_pTtrends_TT_el_pt.root
el_pt->Print()
TH1.Print Name  = el_pt, Entries= 413695, Total sum= 408213
.q

root -l jobsums/debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep1_pt_TOP_PT.root
((TH1D*) _file0->Get("tt_{em}"))->Print()
((TH1D*) _file0->Get("tt_{other}"))->Print()
((TH1D*) _file0->Get("tt_{em}"))->Integral() + ((TH1D*) _file0->Get("tt_{other}"))->Integral()
((TH1D*) _file0->Get("tt_{em}"))->GetEntries() + ((TH1D*) _file0->Get("tt_{other}"))->GetEntries()

TH1.Print Name  = tt_{em}, Entries= 365770, Total sum= 5082.48
TH1.Print Name  = tt_{other}, Entries= 43063, Total sum= 593.393

(double) 5675.87
(double) 408833.

julia> 413695 / 408833.
1.011892386377812

-- does not seem like enough events

are lep_pt the same?

root -l gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/MC2016_Summer16_TTJets_powheg_1.root

((TTree*) ntupler->Get("reduced_ttree"))->Scan("indexevents:lep_p4[0].pt()", "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02")

*    Row   * indexeven * lep_p4[0] *
************************************
*       38 *    315755 * 33.079643 *
*       92 *    315997 * 90.502739 *
*      194 *   3113568 * 32.927860 *
*      271 *   3113890 * 71.510147 *
*      273 *   3113904 * 61.967418 *
*      358 *  24691657 * 94.471923 *
*      537 *  24692420 * 34.975883 *
*      547 *  36804373 * 53.525840 *
*      712 *  36805096 * 162.30715 *
*      762 *  47247118 * 61.515632 *
*      764 *  47247124 * 47.857421 *


root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/MC2016_Summer16_TTJets_powheg.root

*    Row   * indexeven * lep_p4[0] *
************************************
*        2 *    315755 * 33.079643 *
*        6 *    315997 * 90.502739 *
*       11 *   3113568 * 32.927860 *
*       12 *   3113890 * 71.510147 *
*       13 *   3113904 * 61.967418 *
*       16 *  24691657 * 94.471923 *
*       24 *  24692420 * 34.975883 *
*       25 *  36804373 * 53.525840 *
*       32 *  36805096 * 162.30715 *
*       34 *  47247118 * 61.515632 *
*       35 *  47247124 * 47.857421 *

-- identical
   so, also draw gets the same pT-s according to Scan?


csv output of all events

((TTree*) ntupler->Get("reduced_ttree"))->SetScanField(0);
.> v12_7_dilep_merged_sets_TT.indexevents
((TTree*) ntupler->Get("reduced_ttree"))->Scan("indexevents:lep_p4[0].pt()", "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02");


-- how to run this on all TT jobs in v37?

with 
https://root.cern.ch/root/roottalk/roottalk07/0418.html
((TTreePlayer*)(T->GetPlayer()))->SetScanRedirect(true);
((TTreePlayer*)(T->GetPlayer()))->SetScanFileName("toto.txt"); 

root -l -q 'scan_dump.C("gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/MC2016_Summer16_TTJets_powheg_1.root", "test_tt")'

ls gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/ | grep "\.root" | xargs -I INFILE ls gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/INFILE

ls gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/ | grep "\.root" | xargs --max-procs=12 -I INFILE root -l -q 'scan_dump.C("gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/INFILE", "studies/pt-trends-in-v37-v12/test_INFILE")'

cd studies/pt-trends-in-v37-v12/

cat test*root > all_MC2016_Summer16_TTJets_powheg

% g/[*][*][*]*/d
% g/Row/d
% s,^[*][ ]*[0-9][0-9]*[ ]*[*],,


wc -l all_MC2016_Summer16_TTJets_powheg
413696 all_MC2016_Summer16_TTJets_powheg

-- exactly 413695
   + 1 header line



same in v12

sort v12_7_dilep_merged_sets_TT.indexevents > v12_7_dilep_merged_sets_TT.indexevents_sorted

$ wc -l v12_7_dilep_merged_sets_TT.indexevents_sorted                                                                                                                                                                                                                         
408754 v12_7_dilep_merged_sets_TT.indexevents_sorted

-- why less than 408833.?



sort all_MC2016_Summer16_TTJets_powheg > all_MC2016_Summer16_TTJets_powheg_sorted

scp "otoldaie@lxplus.cern.ch:~/work/private/16/CMSSW_8_0_25/src/UserCode/ttbar-leptons-80X/v12_7_dilep_merged_sets_TT.indexevents_sorted" ./

wc -l all_MC2016_Summer16_TTJets_powheg_sorted v12_7_dilep_merged_sets_TT.indexevents_sorted
  413696 all_MC2016_Summer16_TTJets_powheg_sorted
  408754 v12_7_dilep_merged_sets_TT.indexevents_sorted
  822450 total

join all_MC2016_Summer16_TTJets_powheg_sorted v12_7_dilep_merged_sets_TT.indexevents_sorted > v37_v12_indexevents_lep0_pt_joined


diff all_MC2016_Summer16_TTJets_powheg_sorted v12_7_dilep_merged_sets_TT.indexevents_sorted | wc -l
13619

diff all_MC2016_Summer16_TTJets_powheg_sorted v12_7_dilep_merged_sets_TT.indexevents_sorted > v37_v12_indexevents_lep0_pt_diff

11d10
<     3284  45.610252
45d43
<     9721  49.604503
81a80
>    16565  30.505113

grep " 16565 " all_MC2016_Summer16_TTJets_powheg_sorted v12_7_dilep_merged_sets_TT.indexevents_sorted
v12_7_dilep_merged_sets_TT.indexevents_sorted:   16565  30.505113

grep " 3284 " all_MC2016_Summer16_TTJets_powheg_sorted v12_7_dilep_merged_sets_TT.indexevents_sorted
all_MC2016_Summer16_TTJets_powheg_sorted:    3284  45.610252

diff all_MC2016_Summer16_TTJets_powheg_sorted v12_7_dilep_merged_sets_TT.indexevents_sorted | grep "^>" > v37_v12_indexevents_lep0_pt_diff_from_v12
diff all_MC2016_Summer16_TTJets_powheg_sorted v12_7_dilep_merged_sets_TT.indexevents_sorted | grep "^<" > v37_v12_indexevents_lep0_pt_diff_from_v37

wc -l v37_v12_indexevents_lep0_pt_diff_from_v12 v37_v12_indexevents_lep0_pt_diff_from_v37

  1095 v37_v12_indexevents_lep0_pt_diff_from_v12
  6037 v37_v12_indexevents_lep0_pt_diff_from_v37
  7132 total


build pT histo of these

v12 <- read.csv("v37_v12_indexevents_lep0_pt_diff_from_v12", header=T)
v37 <- read.csv("v37_v12_indexevents_lep0_pt_diff_from_v37", header=T)

library(ggplot2)

ggplot(v37, aes(lep0_pt, y=..count../sum(..count..))) + geom_histogram(binwidth=200/40, alpha=0.5) + geom_histogram(data=v12, binwidth=200/40, alpha=0.5) + scale_x_continuous(breaks=seq(0,200,by=10), limits=c(0,200))
ggsave("overlayed_distrs.png")

-- identical distrs

compare with the distr of overlapping events

comm -1 -2 all_MC2016_Summer16_TTJets_powheg_sorted v12_7_dilep_merged_sets_TT.indexevents_sorted > v37_v12_indexevents_lep0_pt_comm

wc -l v37_v12_indexevents_lep0_pt_comm
407659 v37_v12_indexevents_lep0_pt_comm

comm <- read.csv("v37_v12_indexevents_lep0_pt_comm", header=T)

ggplot(v37, aes(lep0_pt, y=..count../sum(..count..))) + geom_histogram(binwidth=200/40, alpha=0.5) + geom_histogram(data=v12, binwidth=200/40, alpha=0.5) + geom_histogram(data=comm, binwidth=200/40, alpha=0.5, fill="white", color="red") + scale_x_continuous(breaks=seq(0,200,by=10), limits=c(0,200))

ggsave("overlayed_distrs.png")

-- no difference in tails or anywhere else

compare with full v37 and v12 to see the effect of these on top of the common events

all_v37 <- read.csv("all_MC2016_Summer16_TTJets_powheg_sorted.csv", header=T)
all_v12 <- read.csv("v12_7_dilep_merged_sets_TT.indexevents_sorted.csv", header=T)


ggplot(all_v37, aes(lep0_pt, y=..count../sum(..count..))) + geom_histogram(binwidth=200/40, alpha=0.5) + geom_histogram(data=all_v12, binwidth=200/40, alpha=0.5) + geom_histogram(data=comm, binwidth=200/40, alpha=0.5, fill="white", color="red") + scale_x_continuous(breaks=seq(0,200,by=10), limits=c(0,200))

-- identical, no noticeable deviation in any distr

but still lets make histos and find the ratio between normalized bin contents

using this:

> bins <- seq(0, 100, 5) # Change this to whatever range your data encopasses
> h1 <- hist(data1, bins, plot=0)
> h2 <- hist(data2, bins, plot=0)
> 
> ratio <- h1$counts/h2$counts
> # Remove NaNs and Infs due to 0 counts
> ratio[is.na(ratio)] <- 0
> ratio[is.inf(ratio)] <- 0
> barplot(ratio)

bins <- seq(0, 200, by=200/40) # Change this to whatever range your data encopasses
h_v37  <- hist(all_v37[all_v37$lep0_pt<200, "lep0_pt"], bins, plot=0)
h_v12  <- hist(all_v12[all_v12$lep0_pt<200, "lep0_pt"], bins, plot=0)
h_comm <- hist(comm[comm$lep0_pt<200, "lep0_pt"], bins, plot=0)

ratio_v37 <- h_v37$counts/h_comm$counts
ratio_v12 <- h_v12$counts/h_comm$counts

> ratio_v37
 [1]      NaN      NaN      NaN      NaN      NaN      NaN 1.015547 1.015043
 [9] 1.014899 1.013825 1.015625 1.015435 1.015645 1.015452 1.013526 1.014905
[17] 1.013041 1.013727 1.014795 1.013431 1.017631 1.015345 1.015731 1.017924
[25] 1.016080 1.012370 1.013589 1.012710 1.010441 1.013169 1.011346 1.008465
[33] 1.013387 1.012763 1.011785 1.012276 1.014891 1.019512 1.009655 1.020218
> ratio_v12
 [1]      NaN      NaN      NaN      NaN      NaN      NaN 1.002850 1.002378
 [9] 1.002702 1.002587 1.002870 1.002383 1.002621 1.002830 1.002589 1.003251
[17] 1.002594 1.002180 1.003257 1.003223 1.002856 1.001421 1.002153 1.002801
[25] 1.002608 1.003216 1.002659 1.004466 1.002320 1.001317 1.002579 1.002822
[33] 1.006024 1.002252 1.002525 1.001889 1.005727 1.001220 1.002759 1.004666

yeah

So:
there is a paradox,
the distrs of (unweighted) csv show v12 and v37 pT identical,
but (unweighted) pyroot draw on v37 with the same condition as for Scan
is different from ntuple_distr draw on v12 and has a clear linear trend in pT,
and it is correctly different from weighted stage2 distr due to lep SFs.
So it cannot be due to different weights.
How can this be?



bin contents, unweighted from scans in v12 and v37:

h_v37$counts
 [1]     0     0     0     0     0     0 43111 41834 38691 35272 31850 28552
[13] 25189 21884 19182 16546 14449 12554 10906  9432  8196  7146  6134  5452
[25]  4676  4092  3431  2948  2613  2308  1961  1787  1514  1349  1202  1072
[37]   886   836   732   656
h_v12$counts
 [1]     0     0     0     0     0     0 42572 41312 38226 34881 31450 28185
[13] 24866 21612 18975 16356 14300 12411 10782  9337  8077  7048  6052  5371
[25]  4614  4055  3394  2924  2592  2281  1944  1777  1503  1335  1191  1061
[37]   878   821   727   646

and normalized:

h_v37$counts / sum(h_v37$counts)
h_v12$counts / sum(h_v12$counts)

 [1] 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000
 [7] 0.105549612 0.102423104 0.094728028 0.086357215 0.077979057 0.069904491
[13] 0.061670784 0.053579080 0.046963713 0.040509937 0.035375805 0.030736235
[19] 0.026701400 0.023092574 0.020066447 0.017495709 0.015018007 0.013348252
[25] 0.011448354 0.010018534 0.008400193 0.007217653 0.006397465 0.005650727
[31] 0.004801160 0.004375151 0.003706760 0.003302786 0.002942883 0.002624601
[37] 0.002169213 0.002046797 0.001792172 0.001606099

 [1] 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000 0.000000000
 [7] 0.105492175 0.102369931 0.094722913 0.086434101 0.077932183 0.069841608
[13] 0.061617223 0.053553906 0.047019497 0.040529691 0.035434983 0.030754096
[19] 0.026717482 0.023136814 0.020014570 0.017464738 0.014996680 0.013309181
[25] 0.011433357 0.010048172 0.008410233 0.007245587 0.006422900 0.005652251
[31] 0.004817175 0.004403354 0.003724390 0.003308091 0.002951263 0.002629127
[37] 0.002175658 0.002034414 0.001801485 0.001600769


bin contents in the weighted ntuple_distr v12:

root -l jobsums/debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root
histo_tt = (TH1D*) ((TH1D*) _file0->Get("tt_{em}"))->Clone()
histo_tt->SetDirectory(0)
histo_tt->SetName("histo_tt")
histo_tt->Add(((TH1D*) _file0->Get("tt_{other}")))
histo_tt->Integral()
histo_tt->Scale(1./histo_tt->Integral())

histo_tt->GetBinContent(7)
histo_tt->GetBinContent(8)
histo_tt->GetBinContent(9)
histo_tt->GetBinContent(10)
histo_tt->GetBinContent(11)
histo_tt->GetBinContent(12)
histo_tt->GetBinContent(13)
histo_tt->GetBinContent(14)
histo_tt->GetBinContent(15)
histo_tt->GetBinContent(16)
histo_tt->GetBinContent(17)
histo_tt->GetBinContent(18)
histo_tt->GetBinContent(19)
histo_tt->GetBinContent(20)
histo_tt->GetBinContent(21)
histo_tt->GetBinContent(22)
histo_tt->GetBinContent(23)
histo_tt->GetBinContent(24)
histo_tt->GetBinContent(25)
histo_tt->GetBinContent(26)
histo_tt->GetBinContent(27)
histo_tt->GetBinContent(28)
histo_tt->GetBinContent(29)
histo_tt->GetBinContent(30)
histo_tt->GetBinContent(31)
histo_tt->GetBinContent(32)
histo_tt->GetBinContent(33)
histo_tt->GetBinContent(34)
histo_tt->GetBinContent(35)
histo_tt->GetBinContent(36)
histo_tt->GetBinContent(37)
histo_tt->GetBinContent(38)
histo_tt->GetBinContent(39)
histo_tt->GetBinContent(40)
histo_tt->GetBinContent(41)

(Double_t) 0.106499
(Double_t) 0.103186
(Double_t) 0.0957874
(Double_t) 0.0872869
(Double_t) 0.0784083
(Double_t) 0.0702013
(Double_t) 0.0620859
(Double_t) 0.0538281
(Double_t) 0.0470736
(Double_t) 0.0405356
(Double_t) 0.0353368
(Double_t) 0.0306798
(Double_t) 0.0264750
(Double_t) 0.0228466
(Double_t) 0.0197603
(Double_t) 0.0171302
(Double_t) 0.0146929
(Double_t) 0.0130353
(Double_t) 0.0110829
(Double_t) 0.00970563
(Double_t) 0.00809741
(Double_t) 0.00694844
(Double_t) 0.00614620
(Double_t) 0.00543156
(Double_t) 0.00456424
(Double_t) 0.00420458
(Double_t) 0.00353653
(Double_t) 0.00310934
(Double_t) 0.00276420
(Double_t) 0.00248583
(Double_t) 0.00203942
(Double_t) 0.00187106
(Double_t) 0.00170067
(Double_t) 0.00146357
(Double_t) 0.0116355



unweighted draw over all v37 ntuples:

mu_pt
root -l testv37v12_pTtrends_TT_mu_pt.root

mu_pt->Integral()
408443.
-- integral is close to v12???
mu_pt->GetEntries()
413695.

-- ok

mu_pt->Scale(1./mu_pt->Integral())

mu_pt->GetBinContent(7)
mu_pt->GetBinContent(8)
mu_pt->GetBinContent(9)
mu_pt->GetBinContent(10)
mu_pt->GetBinContent(11)
mu_pt->GetBinContent(12)
mu_pt->GetBinContent(13)
mu_pt->GetBinContent(14)
mu_pt->GetBinContent(15)
mu_pt->GetBinContent(16)
mu_pt->GetBinContent(17)
mu_pt->GetBinContent(18)
mu_pt->GetBinContent(19)
mu_pt->GetBinContent(20)
mu_pt->GetBinContent(21)
mu_pt->GetBinContent(22)
mu_pt->GetBinContent(23)
mu_pt->GetBinContent(24)
mu_pt->GetBinContent(25)
mu_pt->GetBinContent(26)
mu_pt->GetBinContent(27)
mu_pt->GetBinContent(28)
mu_pt->GetBinContent(29)
mu_pt->GetBinContent(30)
mu_pt->GetBinContent(31)
mu_pt->GetBinContent(32)
mu_pt->GetBinContent(33)
mu_pt->GetBinContent(34)
mu_pt->GetBinContent(35)
mu_pt->GetBinContent(36)
mu_pt->GetBinContent(37)
mu_pt->GetBinContent(38)
mu_pt->GetBinContent(39)
mu_pt->GetBinContent(40)
mu_pt->GetBinContent(41)

(Double_t) 0.105550
(Double_t) 0.102423
(Double_t) 0.0947280
(Double_t) 0.0863548
(Double_t) 0.0779815
(Double_t) 0.0699045
(Double_t) 0.0616708
(Double_t) 0.0535791
(Double_t) 0.0469637
(Double_t) 0.0405099
(Double_t) 0.0353758
(Double_t) 0.0307362
(Double_t) 0.0267014
(Double_t) 0.0230926
(Double_t) 0.0200664
(Double_t) 0.0174957
(Double_t) 0.0150180
(Double_t) 0.0133483
(Double_t) 0.0114484
(Double_t) 0.0100185
(Double_t) 0.00840019
(Double_t) 0.00721765
(Double_t) 0.00639747
(Double_t) 0.00565073
(Double_t) 0.00480116
(Double_t) 0.00437515
(Double_t) 0.00370676
(Double_t) 0.00330279
(Double_t) 0.00294288
(Double_t) 0.00262460
(Double_t) 0.00216921
(Double_t) 0.00204680
(Double_t) 0.00179217
(Double_t) 0.00160610
(Double_t) 0.0128586



 v37           v12
 0.105550      0.106499
 0.102423      0.103186
 0.0947280     0.0957874
 0.0863548     0.0872869
 0.0779815     0.0784083
 0.0699045     0.0702013
 0.0616708     0.0620859
 0.0535791     0.0538281
 0.0469637     0.0470736
 0.0405099     0.0405356
 0.0353758     0.0353368
 0.0307362     0.0306798
 0.0267014     0.0264750
 0.0230926     0.0228466
 0.0200664     0.0197603
 0.0174957     0.0171302
 0.0150180     0.0146929
 0.0133483     0.0130353
 0.0114484     0.0110829
 0.0100185     0.00970563
 0.00840019    0.00809741
 0.00721765    0.00694844
 0.00639747    0.00614620
 0.00565073    0.00543156
 0.00480116    0.00456424
 0.00437515    0.00420458
 0.00370676    0.00353653
 0.00330279    0.00310934
 0.00294288    0.00276420
 0.00262460    0.00248583
 0.00216921    0.00203942
 0.00204680    0.00187106
 0.00179217    0.00170067
 0.00160610    0.00146357
 0.0128586     0.0116355


let's see the ratio

v37 = [ 0.105550 0.102423 0.0947280 0.0863548 0.0779815 0.0699045 0.0616708 0.0535791 0.0469637 0.0405099 0.0353758 0.0307362 0.0267014 0.0230926 0.0200664 0.0174957 0.0150180 0.0133483 0.0114484 0.0100185 0.00840019 0.00721765 0.00639747 0.00565073 0.00480116 0.00437515 0.00370676 0.00330279 0.00294288 0.00262460 0.00216921 0.00204680 0.00179217 0.00160610 0.0128586 ]

v12 = [ 0.106499 0.103186 0.0957874 0.0872869 0.0784083 0.0702013 0.0620859 0.0538281 0.0470736 0.0405356 0.0353368 0.0306798 0.0264750 0.0228466 0.0197603 0.0171302 0.0146929 0.0130353 0.0110829 0.00970563 0.00809741 0.00694844 0.00614620 0.00543156 0.00456424 0.00420458 0.00353653 0.00310934 0.00276420 0.00248583 0.00203942 0.00187106 0.00170067 0.00146357 0.0116355 ]

v37 ./ v12

function myshowall(io, x, limit = false)
  println(io, summary(x), ":")
  Base.print_matrix(IOContext(io, :limit => limit), x)
end

myshowall(stdout, (v37 ./ v12)', false)
341 LinearAlgebra.Adjoint{Float64,Array{Float64,2}}:
 0.9910891182076828
 0.9926055860291125
 0.9889400902415142
 0.9893214216566288
 0.9945566987168449
 0.9957721580654489
 0.993314101913639
 0.9953741633087551
 0.9976653580775636
 0.9993659894019086
 1.0011036653007628
 1.0018383431443492
 1.0085514636449482
 1.0107674664939204
 1.0154906555062424
 1.0213365868466215
 1.0221263331268844
 1.024011722016371
 1.0329787330030948
 1.0322359290432461
 1.037392203185957
 1.0387439482819165
 1.0408821710975886
 1.040351206651496
 1.0519078751336477
 1.0405676666872792
 1.048134753557866
 1.0622157756951636
 1.0646407640546993
 1.0558244127715892
 1.0636406429278913
 1.0939253685076908
 1.0538023249660429
 1.09738516094208
 1.1051179579734434

-- the linear trend


and to the scan values:

without scaling:

root -l testv37v12_pTtrends_TT_mu_pt.root

 43111.0
 41834.0
 38691.0
 35271.0
 28552.0
 25189.0
 21884.0
 19182.0
 16546.0
 14449.0
 12554.0
 10906.0
 9432.00
 8196.00
 7146.00
 6134.00
 5452.00
 4676.00
 4092.00
 3431.00
 2948.00
 2613.00
 2308.00
 1961.00
 1787.00
 1514.00
 1349.00
 1202.00
 1072.00
 886.000
 836.000
 732.000
 656.000
 5252.00

-- exactly the v37 scan numbers:

h_v37$counts
 [1]     0     0     0     0     0     0 43111 41834 38691 35272 31850 28552
[13] 25189 21884 19182 16546 14449 12554 10906  9432  8196  7146  6134  5452
[25]  4676  4092  3431  2948  2613  2308  1961  1787  1514  1349  1202  1072
[37]   886   836   732   656
h_v12$counts
 [1]     0     0     0     0     0     0 42572 41312 38226 34881 31450 28185
[13] 24866 21612 18975 16356 14300 12411 10782  9337  8077  7048  6052  5371
[25]  4614  4055  3394  2924  2592  2281  1944  1777  1503  1335  1191  1061
[37]   878   821   727   646

-- without the last bin

h_v37_counts = [ 43111 41834 38691 35272 31850 28552 25189 21884 19182 16546 14449 12554 10906  9432  8196  7146  6134  5452 4676  4092  3431  2948  2613  2308  1961  1787  1514  1349  1202  1072 886   836   732   656 5252 ]


So:
1) the scan of v12 or v37 + R hist give exactly the same bin contents as the sumup Draw of v37,
2) and they all (unweighted scans and unweighted sumup draw of v37) disagree with v12
   -- in a linear trend they have more high pT muons than v12.
(Also the weights of stage2 are negligible for this trend and behave ordinarily around the unweighted distr.)
So, v12 must weight distributions somehow in unexpected way?




##### weights of v12

the scan dump of v12 shows lep0_pt distribution identical to
v37 scan dump, draw py script (and stage2, considering weights)
-- they all have more high pT muons than v12, the difference makes a linear trend
   is it caused in ntuple_distr, by what and how?
   can TOPPT be so large? -- no, the trend was in all MC processes

time ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "lep_p4[0].pt()"  "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(40,0,200)"    INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_investigation_of_weights1  " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets Data13TeV_SingleMuon2016H_03Feb2017_ver2 MC2016_Summer16_TTJets_powheg

Draw lep_p4[0].pt()>>h_0(40,0,200), (pu_weight(nvtx_gen, 0))*0.986*(lepton_muon_SF(abs(lep_p4[0].eta()), lep_p4[0].pt(), 0.542860, 0.457140))*(lepton_muon_trigger_SF(abs(lep_p4[0].eta()), lep_p4[0].pt(), 0.542860, 0.457140))*(ttbar_pT_SF(gen_t_pt, gen_tb_pt))* (HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02 && abs(gen_t_w_decay_id * gen_tb_w_decay_id) == 13*11)



root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_investigation_of_weights1_TOP_PT.root

histo_tt = (TH1D*) ((TH1D*) _file0->Get("tt_{em}"))->Clone()
histo_tt->SetDirectory(0)
histo_tt->SetName("histo_tt")
histo_tt->Add(((TH1D*) _file0->Get("tt_{other}")))
histo_tt->Integral()

histo_tt->Scale(1./histo_tt->Integral())

histo_tt->GetBinContent(7)
histo_tt->GetBinContent(8)
histo_tt->GetBinContent(9)
histo_tt->GetBinContent(10)
histo_tt->GetBinContent(11)
histo_tt->GetBinContent(12)
histo_tt->GetBinContent(13)
histo_tt->GetBinContent(14)
histo_tt->GetBinContent(15)
histo_tt->GetBinContent(16)
histo_tt->GetBinContent(17)
histo_tt->GetBinContent(18)
histo_tt->GetBinContent(19)
histo_tt->GetBinContent(20)
histo_tt->GetBinContent(21)
histo_tt->GetBinContent(22)
histo_tt->GetBinContent(23)
histo_tt->GetBinContent(24)
histo_tt->GetBinContent(25)
histo_tt->GetBinContent(26)
histo_tt->GetBinContent(27)
histo_tt->GetBinContent(28)
histo_tt->GetBinContent(29)
histo_tt->GetBinContent(30)
histo_tt->GetBinContent(31)
histo_tt->GetBinContent(32)
histo_tt->GetBinContent(33)
histo_tt->GetBinContent(34)
histo_tt->GetBinContent(35)
histo_tt->GetBinContent(36)
histo_tt->GetBinContent(37)
histo_tt->GetBinContent(38)
histo_tt->GetBinContent(39)
histo_tt->GetBinContent(40)
histo_tt->GetBinContent(41)

(Double_t) 0.106499
(Double_t) 0.103186
(Double_t) 0.0957874
(Double_t) 0.0872869
(Double_t) 0.0784083
(Double_t) 0.0702013
(Double_t) 0.0620859
(Double_t) 0.0538281
(Double_t) 0.0470736
(Double_t) 0.0405356
(Double_t) 0.0353368
(Double_t) 0.0306798
(Double_t) 0.0264750
(Double_t) 0.0228466
(Double_t) 0.0197603
(Double_t) 0.0171302
(Double_t) 0.0146929
(Double_t) 0.0130353
(Double_t) 0.0110829
(Double_t) 0.00970563
(Double_t) 0.00809741
(Double_t) 0.00694844
(Double_t) 0.00614620
(Double_t) 0.00543156
(Double_t) 0.00456424
(Double_t) 0.00420458
(Double_t) 0.00353653
(Double_t) 0.00310934
(Double_t) 0.00276420
(Double_t) 0.00248583
(Double_t) 0.00203942
(Double_t) 0.00187106
(Double_t) 0.00170067
(Double_t) 0.00146357
(Double_t) 0.0116355

7319.00


and compare to old:

root -l jobsums/debugging_v37tests_w_comparison_to_v12.7_dilep/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_TOP_PT.root

5675.99

-- all MC is normalized to data!

(Double_t) 0.106499           0.106499
(Double_t) 0.103186           0.103186
(Double_t) 0.0957874          0.0957874
(Double_t) 0.0872869          0.0872869
(Double_t) 0.0784083          0.0784083
(Double_t) 0.0702013          0.0702013
(Double_t) 0.0620859          0.0620859
(Double_t) 0.0538281          0.0538281
(Double_t) 0.0470736          0.0470736
(Double_t) 0.0405356          0.0405356
(Double_t) 0.0353368          0.0353368
(Double_t) 0.0306798          0.0306798
(Double_t) 0.0264750          0.0264750
(Double_t) 0.0228466          0.0228466
(Double_t) 0.0197603          0.0197603
(Double_t) 0.0171302          0.0171302
(Double_t) 0.0146929          0.0146929
(Double_t) 0.0130353          0.0130353
(Double_t) 0.0110829          0.0110829
(Double_t) 0.00970563         0.00970563
(Double_t) 0.00809741         0.00809741
(Double_t) 0.00694844         0.00694844
(Double_t) 0.00614620         0.00614620
(Double_t) 0.00543156         0.00543156
(Double_t) 0.00456424         0.00456424
(Double_t) 0.00420458         0.00420458
(Double_t) 0.00353653         0.00353653
(Double_t) 0.00310934         0.00310934
(Double_t) 0.00276420         0.00276420
(Double_t) 0.00248583         0.00248583
(Double_t) 0.00203942         0.00203942
(Double_t) 0.00187106         0.00187106
(Double_t) 0.00170067         0.00170067
(Double_t) 0.00146357         0.00146357
(Double_t) 0.0116355          0.0116355

-- identical

now the weights

root -l /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_investigation_of_weights2_TOP_PT.root

histo_tt = (TH1D*) ((TH1D*) _file0->Get("noweight_tt_{em}"))->Clone()
histo_tt->SetDirectory(0)
histo_tt->SetName("histo_tt")
histo_tt->Add(((TH1D*) _file0->Get("noweight_tt_{other}")))
histo_tt->Integral()

403556.

histo_tt->Scale(1./histo_tt->Integral())
            noweights     weights3     weight4      weight5      weight6
0.106499    0.105492      0.105492     0.105492     0.104963     0.105245
0.103186    0.102370      0.102370     0.102370     0.101835     0.101985
0.0957874   0.0947229     0.0947229    0.0947229    0.0947302    0.0947166
0.0872869   0.0864316     0.0864316    0.0864316    0.0864273    0.0864419
0.0784083   0.0779347     0.0779347    0.0779347    0.0777174    0.0777296
0.0702013   0.0698416     0.0698416    0.0698416    0.0696637    0.0697377
0.0620859   0.0616172     0.0616172    0.0616172    0.0618533    0.0617841
0.0538281   0.0535539     0.0535539    0.0535539    0.0537661    0.0536926
0.0470736   0.0470195     0.0470195    0.0470195    0.0472001    0.0470825
0.0405356   0.0405297     0.0405297    0.0405297    0.0406882    0.0406505
0.0353368   0.0354350     0.0354350    0.0354350    0.0355780    0.0355369
0.0306798   0.0307541     0.0307541    0.0307541    0.0308818    0.0309313
0.0264750   0.0267175     0.0267175    0.0267175    0.0268240    0.0267890
0.0228466   0.0231368     0.0231368    0.0231368    0.0232217    0.0231765
0.0197603   0.0200146     0.0200146    0.0200146    0.0201027    0.0201104
0.0171302   0.0174647     0.0174647    0.0174647    0.0175364    0.0174752
0.0146929   0.0149967     0.0149967    0.0149967    0.0150601    0.0150342
0.0130353   0.0133092     0.0133092    0.0133092    0.0133646    0.0133676
0.0110829   0.0114334     0.0114334    0.0114334    0.0114267    0.0114163
0.00970563  0.0100482     0.0100482    0.0100482    0.0100377    0.0100242
0.00809741  0.00841023    0.00841023   0.00841023   0.00840318   0.00839178
0.00694844  0.00724559    0.00724559   0.00724559   0.00724177   0.00721747
0.00614620  0.00642290    0.00642290   0.00642290   0.00641692   0.00640605
0.00543156  0.00565225    0.00565225   0.00565225   0.00564795   0.00567819
0.00456424  0.00481718    0.00481718   0.00481718   0.00481180   0.00477787
0.00420458  0.00440335    0.00440335   0.00440335   0.00439687   0.00442427
0.00353653  0.00372439    0.00372439   0.00372439   0.00372155   0.00372712
0.00310934  0.00330809    0.00330809   0.00330809   0.00330396   0.00328682
0.00276420  0.00295126    0.00295126   0.00295126   0.00294620   0.00293216
0.00248583  0.00262913    0.00262913   0.00262913   0.00262491   0.00264067
0.00203942  0.00217566    0.00217566   0.00217566   0.00217376   0.00218156
0.00187106  0.00203441    0.00203441   0.00203441   0.00202844   0.00200797
0.00170067  0.00180148    0.00180148   0.00180148   0.00180369   0.00182251
0.00146357  0.00160077    0.00160077   0.00160077   0.00160050   0.00157903
0.0116355   0.0128780     0.0128780    0.0128780    0.0128435    0.0128639

-- no weights are closer to v37 stuff
   other weights don't change things
   the only remaining part is TOPPT...

sig global_scale withZPtMass tau_ID_SF with_b_SF with_lep_SF with_lep_trig_SF with_PU_weight SYS_shift

time ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT f f T 19094 16079 "lep_p4[0].pt()"  "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(40,0,200)"    INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_investigation_of_weights2  " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets Data13TeV_SingleMuon2016H_03Feb2017_ver2 MC2016_Summer16_TTJets_powheg

time ntuple_distr --verbose elmu 1.0 f -1 f f f f NOMINAL   f f T 19094 16079 "lep_p4[0].pt()"  "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(40,0,200)"    INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_investigation_of_weights3  " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets Data13TeV_SingleMuon2016H_03Feb2017_ver2 MC2016_Summer16_TTJets_powheg

Draw lep_p4[0].pt()>>h_1(40,0,200),  (HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02 && abs(gen_t_w_decay_id * gen_tb_w_decay_id) != 13*11)

-- no weights


time ntuple_distr --verbose elmu 1.0 T -1 T f f f NOMINAL   f f T 19094 16079 "lep_p4[0].pt()"  "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(40,0,200)"    INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_investigation_of_weights4  " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets Data13TeV_SingleMuon2016H_03Feb2017_ver2 MC2016_Summer16_TTJets_powheg &

time ntuple_distr --verbose elmu 1.0 T -1 T T T f NOMINAL   f f T 19094 16079 "lep_p4[0].pt()"  "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(40,0,200)"    INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_investigation_of_weights5  " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets Data13TeV_SingleMuon2016H_03Feb2017_ver2 MC2016_Summer16_TTJets_powheg &

time ntuple_distr --verbose elmu 1.0 T -1 T T T T NOMINAL   f f T 19094 16079 "lep_p4[0].pt()"  "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(40,0,200)"    INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_investigation_of_weights6  " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets Data13TeV_SingleMuon2016H_03Feb2017_ver2 MC2016_Summer16_TTJets_powheg &

in the weights6 one:

Draw lep_p4[0].pt()>>h_0(40,0,200), (pu_weight(nvtx_gen, 0))*0.986*(lepton_muon_SF(abs(lep_p4[0].eta()), lep_p4[0].pt(), 0.542860, 0.457140))*(lepton_muon_trigger_SF(abs(lep_p4[0].eta()), lep_p4[0].pt(), 0.542860, 0.457140))* (HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02 && abs(gen_t_w_decay_id * gen_tb_w_decay_id) == 13*11)

confirm:

time ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT   f f T 19094 16079 "lep_p4[0].pt()"  "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(40,0,200)"    INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_investigation_of_weights7  " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets Data13TeV_SingleMuon2016H_03Feb2017_ver2 MC2016_Summer16_TTJets_powheg

Draw lep_p4[0].pt()>>h_0(40,0,200), (pu_weight(nvtx_gen, 0))*0.986*(lepton_muon_SF(abs(lep_p4[0].eta()), lep_p4[0].pt(), 0.542860, 0.457140))*(lepton_muon_trigger_SF(abs(lep_p4[0].eta()), lep_p4[0].pt(), 0.542860, 0.457140))*(ttbar_pT_SF(gen_t_pt, gen_tb_pt))* (HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02 && abs(gen_t_w_decay_id * gen_tb_w_decay_id) == 13*11)


and watch weights in all MC -- is there TOPPT in other processes?:

time ntuple_distr --verbose elmu 1.0 T -1 T T T T TOP_PT   f f T 19094 16079 "lep_p4[0].pt()"  "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(40,0,200)"    INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_investigation_of_weights_all7  " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets `cat v12.7_dilep_dtags`

processing MC2016_Summer16_WZTo1L1Nu2Q_amcatnlo_madspin /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/MC2016_Summer16_WZTo1L1Nu2Q_amcatnlo_madspin.root
data DY WJets 000
got ttree, 2894 drawing:
lep_p4[0].pt()	(pu_weight(nvtx_gen, 0))*0.986*(aMCatNLO_weight > 0? 1 : -1)*(lepton_muon_SF(abs(lep_p4[0].eta()), lep_p4[0].pt(), 0.542860, 0.457140))*(lepton_muon_trigger_SF(abs(lep_p4[0].eta()), lep_p4[0].pt(), 0.542860, 0.457140))*	HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02
Draw lep_p4[0].pt()>>h_0(40,0,200), (pu_weight(nvtx_gen, 0))*0.986*(aMCatNLO_weight > 0? 1 : -1)*(lepton_muon_SF(abs(lep_p4[0].eta()), lep_p4[0].pt(), 0.542860, 0.457140))*(lepton_muon_trigger_SF(abs(lep_p4[0].eta()), lep_p4[0].pt(), 0.542860, 0.457140))* (HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02)

ttbar_pT_SF appears only in tt
check aMCatNLO_weight in stage2 -- DY10, scahnnel and dibosons have it



time ntuple_distr --verbose elmu 1.0 T -1 T T T T NOMINAL   f f T 19094 16079 "lep_p4[0].pt()"  "HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" "(40,0,200)"    INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_investigation_of_weights_all7  " Mt " " Events " /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets `cat v12.7_dilep_dtags`

eog /eos/user/o/otoldaie/ttbar-leptons-80X_data/v12.7_dilep_merged-sets/jobsums/QuickNtupleDistr_INVESTIGATION-v37tests-v12.7-test_elmu_lep0_pt_investigation_of_weights6_NOMINAL.png

--  not bad

python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/ -c tt_elmu --data-nick data_other -d elmu_mu_pt --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.2 --normalize -p -r

-- actually aside of minor fluctuations it's very similar to v12

python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/ -c tt_elmu --data-nick data_other -d elmu_el_pt --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.2 --normalize -p -r

-- also not bad, no jump at 85GeV

python stack_plot.py distrs/v37_test11_bunchDILEP3recalc_mc_3_nowjetsqcd.root distrs/v37_test11_bunchDILEP3recalc/SingleMuon.root -o plots/v37_test11_bunchDILEP3recalc_mc_1_limited/ -c tt_elmu --data-nick data_other -d elmu_el_pt --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --ratio-range 0.2 --normalize -p -r

-- here, yes, like in mu_pt, clearer trend, after 100GeV
   step in 80-120GeV



##### the end of tt_elmu investigation with comparison to v12, v37test13 tag

So it seems:
0) data H in v37 and v12 is the same
1) MC process fractions are also the same
2) the issue is in mc sum shape
   and the trend shows in all processes
3) in TT TOPPT is responsible for the linear trend
4) but what's with the other MC?

So:
How bad are the remaining deviations? (Probably DY dileptons are worst now..)
Is it just the difference between full Data and H?
What's with pT trends in non-TT processes?
-- these trends are very very small (single top is most visible?), they can be an after-effect of the step in electrons.
What's with the step in el pT now, which el SF causes it?
What's with crazy etas?
-- there is a distinct difference v12-v37 at high etas and incoherent bin-by-bin jumps.
   The high etas can be due to el SFs used in v37 and not in v12.
   The bin-by-bin could be due to 2D histos, when 1D are asymmetric.



hadd v37_test13_bunchDILEP1_mc_1_wNjets.root v37_test13_bunchDILEP1/MC*root v37_test13_bunchDILEP1/wjets_wNjets/MC*root

python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_1_wNjets.root distrs/v37_test13_bunchDILEP1/SingleElectron.root -p -r  -o plots/v37_test13_bunchDILEP1_mc_1_wNjets/  -c dy_elel --data-nick data_other -d met_c        --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_1_wNjets.root distrs/v37_test13_bunchDILEP1/SingleElectron.root -p -r  -o plots/v37_test13_bunchDILEP1_mc_1_wNjets/  -c dy_elel --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_1_wNjets.root distrs/v37_test13_bunchDILEP1/SingleElectron.root -p -r  -o plots/v37_test13_bunchDILEP1_mc_1_wNjets/  -c dy_elel --data-nick data_other -d lep_pt       --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_1_wNjets.root distrs/v37_test13_bunchDILEP1/SingleElectron.root -p -r  -o plots/v37_test13_bunchDILEP1_mc_1_wNjets/  -c dy_elel --data-nick data_other -d lep_eta      --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5

python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_1_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root     -p -r  -o plots/v37_test13_bunchDILEP1_mc_1_wNjets/  -c dy_mumu --data-nick data_other -d met_c        --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_1_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root     -p -r  -o plots/v37_test13_bunchDILEP1_mc_1_wNjets/  -c dy_mumu --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_1_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root     -p -r  -o plots/v37_test13_bunchDILEP1_mc_1_wNjets/  -c dy_mumu --data-nick data_other -d lept_pt      --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_1_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root     -p -r  -o plots/v37_test13_bunchDILEP1_mc_1_wNjets/  -c dy_mumu --data-nick data_other -d lept_eta     --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5

-- forgot to revert the PASSES function....

python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_1_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root     -p -r  -o plots/v37_test13_bunchDILEP1_mc_1_wNjets/  -c tt_elmu --data-nick data_other -d met_c        --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_1_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root     -p -r  -o plots/v37_test13_bunchDILEP1_mc_1_wNjets/  -c tt_elmu --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_1_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root     -p -r  -o plots/v37_test13_bunchDILEP1_mc_1_wNjets/  -c tt_elmu --data-nick data_other -d lep_pt       --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5
python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_1_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root     -p -r  -o plots/v37_test13_bunchDILEP1_mc_1_wNjets/  -c tt_elmu --data-nick data_other -d lep_eta      --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5

python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_1_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root     -p -r  -o plots/v37_test13_bunchDILEP1_mc_1_wNjets/  -c tt_elmu --data-nick data_other -d met_c        --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --sys TOPPTUp

python stack_plot.py distrs/v37_test13_bunchDILEP1_mc_1_wNjets.root distrs/v37_test13_bunchDILEP1/SingleMuon.root     -p -r  -o plots/v37_test13_bunchDILEP1_mc_1_wNjets/  -c tt_elmu --data-nick data_other -d met_c        --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.5 --qcd-factor 2.5 --sys TOPPTUp --factor-dy 1.1

norm:
INFO:root:data       =   158580.000000     1895.744849
INFO:root:mc sum     =   151772.933178   151772.933178

eog plots/v37_test13_bunchDILEP1_mc_1_wNjets/*png

with norm, larger DY (10-30% return to original xsec) and TOPPT looks ok
but the slight pT kink and eta bin-by-bin weirdness are indeed there
-- the trend is most visible in low met_c:
   high met agrees after TOPPTUp
   but low met does not, event DY factor 1.3 does not fix it, it bends the very low bins and the peak is still about 5% off the horizontal line from the rest
   this should be due to the BCDEF data not handled too well





##### reproduce v12 in v37 with sumup_ttree_draw?

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_corrected.pt()*(1 - cos(lep_p4[0].phi() - met_corrected.phi())))" --cond-com "pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output Data13TeV_SingleMuon2016H_03Feb2017_ver2.root --histo-name tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/Data13TeV_SingleMuon2016H_03Feb2017_ver2_1.root

python sumup_ttree_draw.py "sqrt(2*lep_p4[0].pt()*met_corrected.pt()*(1 - cos(lep_p4[0].phi() - met_corrected.phi())))" --cond-com "pass_basic_METfilters && METfilterbadChCand && METfilterbadPFMuon && HLT_mu && leps_ID == -11*13 && ((abs(lep_id[0]) == 13 && lep_matched_HLT[0]) || (abs(lep_id[1]) == 13 && lep_matched_HLT[1])) && lep_p4[0].pt()>30 && lep_p4[1].pt()>30 && abs(lep_p4[0].eta()) < 2.4 && abs(lep_p4[1].eta()) < 2.4 && lep_dxy[0] <0.01 && lep_dz[0]<0.02" --histo-range 20,0.,250 --output Data13TeV_SingleMuon2016H_03Feb2017_ver2.root --histo-name tt_elmu/data_other/NOMINAL/tt_elmu_data_other_NOMINAL_Mt_lep_met_f gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/*root &

gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016H_03Feb2017_ver2/190205_175811/0000/




##### run old code on new ntuples -- check if the difference is in the ntuples

compiled in
/misc/exper-cms/cmssw/users/olek/CMSSW_8_0_26_patch1/src/UserCode/ttbar-leptons-80X/test

hadd ntuples?

63G	gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8

1.3T	total

correct to run on lists of files
treating them as a given dtag
then hadd the outputs?


#### dy dileptons

python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo/  -c dy_elel --data-nick data_other -d met_c  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test8_bunchDILEP3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test8_bunchDILEP3_mc1_amcatnlo/  -c dy_mumu --data-nick data_other -d met_c  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

-- back to original kink in mumu, similar but smaller bend in elel



### bSF weight in tt_elmu

root -l lstore_outdirs/v37/test7/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_1.root

ttree_out->Draw("event_weight:event_weight_bSF*event_weight_init*event_weight_th*event_weight_PU", "selection_stage_em > 200 && selection_stage_em < 210")

ttree_out->Draw("event_met.pt()>>h(100,0,300)", "(selection_stage_em > 200 && selection_stage_em < 210)")

h_ = (TH1D*) ttree_out->GetHistogram()
h_met = (TH1D*) h_->Clone()
h_met->SetName("h_met")
h_met->SetDirectory(0)


ttree_out->Draw("event_met.pt()>>h(100,0,300)", "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_bSF")

h_ = (TH1D*) ttree_out->GetHistogram()
h_met_bSF = (TH1D*) h_->Clone()
h_met_bSF->SetName("h_met_bSF")
h_met_bSF->SetDirectory(0)

h_met_bSF->SetLineColor(kRed)

h_met_bSF->Draw()
h_met->Draw("same")

h_met->Divide(h_met_bSF)

h_met->Draw()

-- within stat uncertainty, under 1 percent deviations, no tren visible



### no bSF weight in DY elel

root -l lstore_outdirs/v37/test7/MC2016_Summer16_DYJetsToLL_50toInf_madgraph/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1.root

ttree_out->Draw("event_leptons[0].eta()>>h(50,-2.5,2.5)", "(selection_stage_dy_mumu == 112 || selection_stage_dy_mumu == 113 || selection_stage_dy_mumu == 115) * event_weight")

h_ = (TH1D*) ttree_out->GetHistogram()

h_ev_weight = (TH1D*) h_->Clone()
h_ev_weight->SetName("h_ev_weight")
h_ev_weight->SetDirectory(0)

ttree_out->Draw("event_leptons[0].eta()>>h(50,-2.5,2.5)", "(selection_stage_dy_mumu == 112 || selection_stage_dy_mumu == 113 || selection_stage_dy_mumu == 115) * event_weight_init")

h_ = (TH1D*) ttree_out->GetHistogram()

h_ev_init = (TH1D*) h_->Clone()
h_ev_init->SetName("h_ev_init")
h_ev_init->SetDirectory(0)

h_ev_init->SetLineColor(kRed)

h_ev_weight-> Draw()
h_ev_init->   Draw("same")

-- the same distributions


### check effect of Z mass

root -l gstore_outdirs/v37/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/Ntupler_v37_MC2016_Summer16_DYJetsToLL_50toInf_madgraph/190206_141133/0000/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1.root

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].eta()>>h(50,-2.5,2.5)", "leps_ID == -11*11 && HLT_el")

check where the Z peak:

((TTree*) ntupler->Get("reduced_ttree"))->Draw("genMass>>h(50,80,100)", "leps_ID == -11*11 && HLT_el")

at 90.47

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].eta()>>h(50,-2.5,2.5)", "leps_ID == -11*11 && abs(lep_p4[0].eta()) < 2.4 && HLT_el && genMass < 90.")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].eta()>>h(50,-2.5,2.5)", "leps_ID == -11*11 && abs(lep_p4[0].eta()) < 2.4 && HLT_el && genMass > 90.")

hard to say

correlations with eta and pT of leading lepton

((TTree*) ntupler->Get("reduced_ttree"))->Draw("genMass:lep_p4[0].eta()>>h(25,-2.5,2.5,25,80,100)", "leps_ID == -11*11 && abs(lep_p4[0].eta()) < 2.4 && HLT_el")

-- does not look like correlation, but maximum should be closer to 91?

try full DY MC

python sumup_ttree_draw.py "lep_p4[0].eta()" --cond-com "leps_ID == -11*11 && abs(lep_p4[0].eta()) < 2.4 && HLT_el && genMass < 90." --histo-range 50,-2.5,2.5 --output test_dy_elel_lep0_eta_ZmassLess90.root --histo-name test_dy_elel_lep0_eta_ZmassLess90 gstore_outdirs/v37/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/Ntupler_v37_MC2016_Summer16_DYJetsToLL_50toInf_madgraph/190206_141133/0000/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_*.root &
python sumup_ttree_draw.py "lep_p4[0].eta()" --cond-com "leps_ID == -11*11 && abs(lep_p4[0].eta()) < 2.4 && HLT_el && genMass > 90." --histo-range 50,-2.5,2.5 --output test_dy_elel_lep0_eta_ZmassMore90.root --histo-name test_dy_elel_lep0_eta_ZmassMore90 gstore_outdirs/v37/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/Ntupler_v37_MC2016_Summer16_DYJetsToLL_50toInf_madgraph/190206_141133/0000/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_*.root &

hadd  test_dy_elel_lep0_eta_Zmass.root test_dy_elel_lep0_eta_ZmassLess90.root test_dy_elel_lep0_eta_ZmassMore90.root

test_dy_elel_lep0_eta_ZmassMore90->Scale(1./test_dy_elel_lep0_eta_ZmassMore90->Integral())
test_dy_elel_lep0_eta_ZmassLess90->Scale(1./test_dy_elel_lep0_eta_ZmassLess90->Integral())

test_dy_elel_lep0_eta_ZmassMore90->SetLineColor(kRed)

test_dy_elel_lep0_eta_ZmassLess90->Draw()
test_dy_elel_lep0_eta_ZmassMore90->Draw("same")

-- the same, variations within the stat uncertainties



correlation with pT

((TTree*) ntupler->Get("reduced_ttree"))->Draw("genMass:lep_p4[0].pt()>>h(25,20,100,25,80,100)", "leps_ID == -11*11 && abs(lep_p4[0].eta()) < 2.4 && HLT_el")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("genMass:lep_p4[1].pt()>>h(25,20,100,25,80,100)", "leps_ID == -11*11 && abs(lep_p4[0].eta()) < 2.4 && HLT_el")

-- definitely slight correlation

same in muons:

((TTree*) ntupler->Get("reduced_ttree"))->Draw("genMass:lep_p4[0].pt()>>h(25,20,100,25,80,100)", "leps_ID == -13*13 && abs(lep_p4[0].eta()) < 2.4 && HLT_mu")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("genMass:lep_p4[1].pt()>>h(25,20,100,25,80,100)", "leps_ID == -13*13 && abs(lep_p4[0].eta()) < 2.4 && HLT_mu")

same stuff



try to reproduce the effect of lep SFs for different Z masses?
lep SFs are in stage2, Z mass is in ntuples...

use reco Z mass?

((TTree*) ntupler->Get("reduced_ttree"))->Draw("genMass:sqrt((lep_p4[0].T() + lep_p4[1].T())*(lep_p4[0].T() + lep_p4[1].T()) - ((lep_p4[0].Z() + lep_p4[1].Z())*(lep_p4[0].Z() + lep_p4[1].Z()) + (lep_p4[0].Y() + lep_p4[1].Y())*(lep_p4[0].Y() + lep_p4[1].Y()) + (lep_p4[0].X() + lep_p4[1].X())*(lep_p4[0].X() + lep_p4[1].X())))>>h(25,80,100,25,80,100)", "leps_ID == -13*13 && abs(lep_p4[0].eta()) < 2.4 && HLT_mu")

-- correlation ok


sqrt((event_leptons[0].T() + event_leptons[1].T())*(event_leptons[0].T() + event_leptons[1].T()) - ((event_leptons[0].Z() + event_leptons[1].Z())*(event_leptons[0].Z() + event_leptons[1].Z()) + (event_leptons[0].Y() + event_leptons[1].Y())*(event_leptons[0].Y() + event_leptons[1].Y()) + (event_leptons[0].X() + event_leptons[1].X())*(event_leptons[0].X() + event_leptons[1].X())))

python sumup_ttree_draw.py "event_leptons[0].eta()" --ttree ttree_out --cond-com "((selection_stage_dy_mumu == 112 || selection_stage_dy_mumu == 113 || selection_stage_dy_mumu == 115) && sqrt((event_leptons[0].T() + event_leptons[1].T())*(event_leptons[0].T() + event_leptons[1].T()) - ((event_leptons[0].Z() + event_leptons[1].Z())*(event_leptons[0].Z() + event_leptons[1].Z()) + (event_leptons[0].Y() + event_leptons[1].Y())*(event_leptons[0].Y() + event_leptons[1].Y()) + (event_leptons[0].X() + event_leptons[1].X())*(event_leptons[0].X() + event_leptons[1].X()))) < 90.) * event_weight" --histo-range 50,-2.5,2.5 --output test_dy_elel_lep0_eta_ZmassLess90_weight.root --histo-name test_dy_elel_lep0_eta_ZmassLess90_weight lstore_outdirs/v37/test7/MC2016_Summer16_DYJetsToLL_50toInf_madgraph/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_*.root &
python sumup_ttree_draw.py "event_leptons[0].eta()" --ttree ttree_out --cond-com "((selection_stage_dy_mumu == 112 || selection_stage_dy_mumu == 113 || selection_stage_dy_mumu == 115) && sqrt((event_leptons[0].T() + event_leptons[1].T())*(event_leptons[0].T() + event_leptons[1].T()) - ((event_leptons[0].Z() + event_leptons[1].Z())*(event_leptons[0].Z() + event_leptons[1].Z()) + (event_leptons[0].Y() + event_leptons[1].Y())*(event_leptons[0].Y() + event_leptons[1].Y()) + (event_leptons[0].X() + event_leptons[1].X())*(event_leptons[0].X() + event_leptons[1].X()))) > 90.) * event_weight" --histo-range 50,-2.5,2.5 --output test_dy_elel_lep0_eta_ZmassMore90_weight.root --histo-name test_dy_elel_lep0_eta_ZmassMore90_weight lstore_outdirs/v37/test7/MC2016_Summer16_DYJetsToLL_50toInf_madgraph/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_*.root &

python sumup_ttree_draw.py "event_leptons[0].eta()" --ttree ttree_out --cond-com "((selection_stage_dy_mumu == 112 || selection_stage_dy_mumu == 113 || selection_stage_dy_mumu == 115) && sqrt((event_leptons[0].T() + event_leptons[1].T())*(event_leptons[0].T() + event_leptons[1].T()) - ((event_leptons[0].Z() + event_leptons[1].Z())*(event_leptons[0].Z() + event_leptons[1].Z()) + (event_leptons[0].Y() + event_leptons[1].Y())*(event_leptons[0].Y() + event_leptons[1].Y()) + (event_leptons[0].X() + event_leptons[1].X())*(event_leptons[0].X() + event_leptons[1].X()))) < 90.)" --histo-range 50,-2.5,2.5 --output test_dy_elel_lep0_eta_ZmassLess90_NOweight.root --histo-name test_dy_elel_lep0_eta_ZmassLess90_NOweight lstore_outdirs/v37/test7/MC2016_Summer16_DYJetsToLL_50toInf_madgraph/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_*.root &
python sumup_ttree_draw.py "event_leptons[0].eta()" --ttree ttree_out --cond-com "((selection_stage_dy_mumu == 112 || selection_stage_dy_mumu == 113 || selection_stage_dy_mumu == 115) && sqrt((event_leptons[0].T() + event_leptons[1].T())*(event_leptons[0].T() + event_leptons[1].T()) - ((event_leptons[0].Z() + event_leptons[1].Z())*(event_leptons[0].Z() + event_leptons[1].Z()) + (event_leptons[0].Y() + event_leptons[1].Y())*(event_leptons[0].Y() + event_leptons[1].Y()) + (event_leptons[0].X() + event_leptons[1].X())*(event_leptons[0].X() + event_leptons[1].X()))) > 90.)" --histo-range 50,-2.5,2.5 --output test_dy_elel_lep0_eta_ZmassMore90_NOweight.root --histo-name test_dy_elel_lep0_eta_ZmassMore90_NOweight lstore_outdirs/v37/test7/MC2016_Summer16_DYJetsToLL_50toInf_madgraph/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_*.root &

hadd test_dy_elel_lep0_eta_Zmass_weighted.root test_dy_elel_lep0_eta_ZmassLess90_weight.root test_dy_elel_lep0_eta_ZmassMore90_weight.root test_dy_elel_lep0_eta_ZmassLess90_NOweight.root test_dy_elel_lep0_eta_ZmassMore90_NOweight.root

test_dy_elel_lep0_eta_ZmassMore90_weight->Scale(1./test_dy_elel_lep0_eta_ZmassMore90_weight->Integral())
test_dy_elel_lep0_eta_ZmassLess90_weight->Scale(1./test_dy_elel_lep0_eta_ZmassLess90_weight->Integral())

test_dy_elel_lep0_eta_ZmassMore90_NOweight->Scale(1./test_dy_elel_lep0_eta_ZmassMore90_NOweight->Integral())
test_dy_elel_lep0_eta_ZmassLess90_NOweight->Scale(1./test_dy_elel_lep0_eta_ZmassLess90_NOweight->Integral())

test_dy_elel_lep0_eta_ZmassMore90_weight->SetLineColor(kRed)

test_dy_elel_lep0_eta_ZmassLess90_NOweight->SetLineColor(kGreen)
test_dy_elel_lep0_eta_ZmassMore90_NOweight->SetLineColor(kYellow)

test_dy_elel_lep0_eta_ZmassLess90_weight->Draw()
test_dy_elel_lep0_eta_ZmassMore90_weight->Draw("same")
test_dy_elel_lep0_eta_ZmassLess90_NOweight->Draw("same")
test_dy_elel_lep0_eta_ZmassMore90_NOweight->Draw("same")

-- red (>90GeV) is smaller in endcaps
   and the no-weight distrs are close to the weighted

test_dy_elel_lep0_eta_ZmassLess90_weight->Divide(test_dy_elel_lep0_eta_ZmassMore90_weight)

test_dy_elel_lep0_eta_ZmassLess90_weight->Draw()

by 10-20% and more

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c dy_elel --data-nick data_other -d dilep_mass_dy --lumi 32220 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3/  -c dy_elel --data-nick data_other -d dilep_mass_dy --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- but here Data has smaller Z mass, not larger





### dy_elel eta, edcaps and dy_mumu too

why still MC>Data in endcaps?

all lep SFs are applied?
HLT is OR, which makes it == 1. -- maybe check the HLT match?




### compare eta in different data epochs

python get_shapes.py --formula "B:C:D:E:F:G:H:H2" --y-range 0,0.1 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj B:distrs/v37_test5_bunch2/Data13TeV_SingleElectron2016B_03Feb2017_ver2.root:dy_elel/data_other/NOMINAL/dy_elel_data_other_NOMINAL_lep_eta C:distrs/v37_test5_bunch2/Data13TeV_SingleElectron2016C_03Feb2017_v1.root:dy_elel/data_other/NOMINAL/dy_elel_data_other_NOMINAL_lep_eta D:distrs/v37_test5_bunch2/Data13TeV_SingleElectron2016D_03Feb2017_v1.root:dy_elel/data_other/NOMINAL/dy_elel_data_other_NOMINAL_lep_eta E:distrs/v37_test5_bunch2/Data13TeV_SingleElectron2016E_03Feb2017_v1.root:dy_elel/data_other/NOMINAL/dy_elel_data_other_NOMINAL_lep_eta F:distrs/v37_test5_bunch2/Data13TeV_SingleElectron2016F_03Feb2017_v1.root:dy_elel/data_other/NOMINAL/dy_elel_data_other_NOMINAL_lep_eta G:distrs/v37_test5_bunch2/Data13TeV_SingleElectron2016G_03Feb2017_v1.root:dy_elel/data_other/NOMINAL/dy_elel_data_other_NOMINAL_lep_eta H:distrs/v37_test5_bunch2/Data13TeV_SingleElectron2016H_03Feb2017_ver2.root:dy_elel/data_other/NOMINAL/dy_elel_data_other_NOMINAL_lep_eta H2:distrs/v37_test5_bunch2/Data13TeV_SingleElectron2016H_03Feb2017_ver3.root:dy_elel/data_other/NOMINAL/dy_elel_data_other_NOMINAL_lep_eta

mv ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_C,B,E,D,G,F,H2,H_formula.png compare_v37_test5_bunch2_SingleElectron_lep_eta_per_epoch_C,B,E,D,G,F,H2,H.png

-- indeed in endcaps, the lowest eta bin of endcap (1.5) is the same in all epochs
   indeed G and H is worse and B is better from it to eta 2.4 

B:distrs/v37_test5_bunch2/Data13TeV_SingleElectron2016B_03Feb2017_ver2.root:dy_elel/data_other/NOMINAL/dy_elel_data_other_NOMINAL_lep_eta
C:distrs/v37_test5_bunch2/Data13TeV_SingleElectron2016C_03Feb2017_v1.root:dy_elel/data_other/NOMINAL/dy_elel_data_other_NOMINAL_lep_eta
D:distrs/v37_test5_bunch2/Data13TeV_SingleElectron2016D_03Feb2017_v1.root:dy_elel/data_other/NOMINAL/dy_elel_data_other_NOMINAL_lep_eta
E:distrs/v37_test5_bunch2/Data13TeV_SingleElectron2016E_03Feb2017_v1.root:dy_elel/data_other/NOMINAL/dy_elel_data_other_NOMINAL_lep_eta
F:distrs/v37_test5_bunch2/Data13TeV_SingleElectron2016F_03Feb2017_v1.root:dy_elel/data_other/NOMINAL/dy_elel_data_other_NOMINAL_lep_eta
G:distrs/v37_test5_bunch2/Data13TeV_SingleElectron2016G_03Feb2017_v1.root:dy_elel/data_other/NOMINAL/dy_elel_data_other_NOMINAL_lep_eta
H:distrs/v37_test5_bunch2/Data13TeV_SingleElectron2016H_03Feb2017_ver2.root:dy_elel/data_other/NOMINAL/dy_elel_data_other_NOMINAL_lep_eta
H2:distrs/v37_test5_bunch2/Data13TeV_SingleElectron2016H_03Feb2017_ver3.root:dy_elel/data_other/NOMINAL/dy_elel_data_other_NOMINAL_lep_eta

muons

python get_shapes.py --formula "B:C:D:E:F:G:H:H2" --y-range 0,0.1 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj B:distrs/v37_test5_bunch2/Data13TeV_SingleMuon2016B_03Feb2017_ver2.root:dy_mumu/data_other/NOMINAL/dy_mumu_data_other_NOMINAL_lep_eta C:distrs/v37_test5_bunch2/Data13TeV_SingleMuon2016C_03Feb2017_v1.root:dy_mumu/data_other/NOMINAL/dy_mumu_data_other_NOMINAL_lep_eta D:distrs/v37_test5_bunch2/Data13TeV_SingleMuon2016D_03Feb2017_v1.root:dy_mumu/data_other/NOMINAL/dy_mumu_data_other_NOMINAL_lep_eta E:distrs/v37_test5_bunch2/Data13TeV_SingleMuon2016E_03Feb2017_v1.root:dy_mumu/data_other/NOMINAL/dy_mumu_data_other_NOMINAL_lep_eta F:distrs/v37_test5_bunch2/Data13TeV_SingleMuon2016F_03Feb2017_v1.root:dy_mumu/data_other/NOMINAL/dy_mumu_data_other_NOMINAL_lep_eta G:distrs/v37_test5_bunch2/Data13TeV_SingleMuon2016G_03Feb2017_v1.root:dy_mumu/data_other/NOMINAL/dy_mumu_data_other_NOMINAL_lep_eta H:distrs/v37_test5_bunch2/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:dy_mumu/data_other/NOMINAL/dy_mumu_data_other_NOMINAL_lep_eta H2:distrs/v37_test5_bunch2/Data13TeV_SingleMuon2016H_03Feb2017_ver3.root:dy_mumu/data_other/NOMINAL/dy_mumu_data_other_NOMINAL_lep_eta

mv ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_C,B,E,D,G,F,H2,H_formula.png compare_v37_test5_bunch2_SingleMuon_lep_eta_per_epoch_C,B,E,D,G,F,H2,H.png

-- practically all the same

B:distrs/v37_test5_bunch2/Data13TeV_SingleMuon2016B_03Feb2017_ver2.root:dy_mumu/data_other/NOMINAL/dy_mumu_data_other_NOMINAL_lep_eta
C:distrs/v37_test5_bunch2/Data13TeV_SingleMuon2016C_03Feb2017_v1.root:dy_mumu/data_other/NOMINAL/dy_mumu_data_other_NOMINAL_lep_eta
D:distrs/v37_test5_bunch2/Data13TeV_SingleMuon2016D_03Feb2017_v1.root:dy_mumu/data_other/NOMINAL/dy_mumu_data_other_NOMINAL_lep_eta
E:distrs/v37_test5_bunch2/Data13TeV_SingleMuon2016E_03Feb2017_v1.root:dy_mumu/data_other/NOMINAL/dy_mumu_data_other_NOMINAL_lep_eta
F:distrs/v37_test5_bunch2/Data13TeV_SingleMuon2016F_03Feb2017_v1.root:dy_mumu/data_other/NOMINAL/dy_mumu_data_other_NOMINAL_lep_eta
G:distrs/v37_test5_bunch2/Data13TeV_SingleMuon2016G_03Feb2017_v1.root:dy_mumu/data_other/NOMINAL/dy_mumu_data_other_NOMINAL_lep_eta
H:distrs/v37_test5_bunch2/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root:dy_mumu/data_other/NOMINAL/dy_mumu_data_other_NOMINAL_lep_eta
H2:distrs/v37_test5_bunch2/Data13TeV_SingleMuon2016H_03Feb2017_ver3.root:dy_mumu/data_other/NOMINAL/dy_mumu_data_other_NOMINAL_lep_eta



#### are two leptons od DY correlated in eta and pT?

ttree_out->Draw("event_leptons[0].eta()>>h(50,-2.5,2.5)", "(selection_stage_dy_mumu == 112 || selection_stage_dy_mumu == 113 || selection_stage_dy_mumu == 115) * event_weight_LEPelTRG")

root -l gstore_outdirs/v37/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/Ntupler_v37_MC2016_Summer16_DYJetsToLL_50toInf_madgraph/190206_141133/0000/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1.root

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].eta()", "leps_ID == -11*11")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].eta()", "leps_ID == -11*11 && abs(lep_p4[1].eta()) < 1.")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].eta()", "leps_ID == -11*11 && abs(lep_p4[1].eta()) > 1.")

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].eta():lep_p4[1].eta()", "leps_ID == -11*11")

-- noticeably correlated

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].pt()>>h(50,20,150)", "leps_ID == -11*11")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].pt()>>h(50,20,150)", "leps_ID == -11*11 && abs(lep_p4[1].eta()) < 1.")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].pt()>>h(50,20,150)", "leps_ID == -11*11 && abs(lep_p4[1].eta()) > 1.")

-- practically the same pT distribution

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].pt():lep_p4[1].pt()>>h(50,20,150,50,20,150)", "leps_ID == -11*11")

lep 0 is the leading lepton, hard to tell what the pattern means


but the probability to reconstruct and trigger one lepton is the same?
does it change with the correlation to the second lepton in the event?

just try single lepton trigger on leading lepton only?


#### check effects from the lep SFs

the lep_eta in dy_elel has about Data = 0.9*MC in endcaps and perfect match in the barrel
>>> sqrt(0.9)
0.9486832980505138
-- 1 SF of difference



root -l lstore_outdirs/v37/test7/MC2016_Summer16_DYJetsToLL_50toInf_madgraph/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1.root

ttree_out->Draw("event_leptons[0].eta()>>h(50,-2.5,2.5)", "(selection_stage_dy_mumu == 112 || selection_stage_dy_mumu == 113 || selection_stage_dy_mumu == 115) * event_weight_LEPelTRG")


in elel eta:
el ID  SF -- practically flat at 0.9
el TRG SF -- flat == 1.0 (as expected for OR HLT)






check again the input values for ID effs

python module_leptons.py --test-sfs foo bar

and 2D plots:

ele HLT: does have somewhat smaller eff in endcaps

ele reco: completely parallel in pT, almost flat in eta -- looks like 1D eta stretched over pT, and practically no variation in eta, checked the MC and Data histos separately -- they do look like this

ele ID: strange look the only reduction at endcaps is at low pT, at 10-30GeV when my cut is 30GeV, overall 1+-0.05, endcaps and pT>100 have 1.05 SF

-- hence the flatness of the ele SFs...





try to redivide Data/MC effs

ele ID:
EGamma_SF2D->Draw("colz")
EGamma_EffData2D->Divide(EGamma_EffMC2D)
EGamma_EffData2D->Draw("colz")

-- looks different,

EGamma_EffData2D->Divide(EGamma_EffMC2D)
EGamma_EffData2D->GetZaxis()->SetRangeUser(0.9,1.1)
EGamma_SF2D->GetZaxis()->SetRangeUser(0.9,1.1)

EGamma_EffData2D->Draw("colz")

EGamma_SF2D->Draw("colz")

-- the same in ele reco
   very similar ID except certain bins at pT>150

compare numbers with the pdf with the TH2D from EGamma

EGamma_SF2D->GetZaxis()->SetRangeUser(0.8,1.2)
EGamma_SF2D->Draw("colz text")
c1->SetLogy()

-- same numbers!

the ID SF differs by 4-7% between barrel and endcap at 30GeV
                 and 1-3% at 100GeV

but the reco SF is somewhat reversed: negative etas have larger SF in endcap
it is also skewed: negative etas' SF > positive





how SFs are different for Moriond17 and legacy rereco?
-- legacy rereco is weird, SF are positive in endcaps



the trigger SF might fix this...



check the usual number of HLT matched leptons

muons

root -l gstore_outdirs/v37/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/Ntupler_v37_MC2016_Summer16_DYJetsToLL_50toInf_madgraph/190206_141133/0000/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1.root

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_matched_HLT[0] || lep_matched_HLT[1]", "leps_ID == -13*13")
(Long64_t) 139986
-- all events pass

((TTree*) ntupler->Get("reduced_ttree"))->Draw("(lep_matched_HLT[0] && ! lep_matched_HLT[1]) || (lep_matched_HLT[1] && ! lep_matched_HLT[0])", "leps_ID == -13*13")
(Long64_t) 139986

mean 0.13

20322 / 139986 = 0.14517166002314516

-- non negligible
but can it constitute the whole of the difference?



electrons

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_matched_HLT[0] || lep_matched_HLT[1]", "leps_ID == -11*11")
56125
-- all pass

((TTree*) ntupler->Get("reduced_ttree"))->Draw("(lep_matched_HLT[0] && ! lep_matched_HLT[1]) || (lep_matched_HLT[1] && ! lep_matched_HLT[0])", "leps_ID == -11*11")
56125

((TTree*) ntupler->Get("reduced_ttree"))->Draw("(lep_matched_HLT[0] && ! lep_matched_HLT[1]) || (lep_matched_HLT[1] && ! lep_matched_HLT[0])", "leps_ID == -11*11 && HLT_el")
56122

((TTree*) ntupler->Get("reduced_ttree"))->Draw("(lep_matched_HLT[0] && ! lep_matched_HLT[1]) || (lep_matched_HLT[1] && ! lep_matched_HLT[0])", "leps_ID == -11*11 && ((lep_matched_HLT[0] && ! lep_matched_HLT[1]) || (lep_matched_HLT[1] && ! lep_matched_HLT[0]))")
3270

3270 / 56125 = 0.05826280623608018

-- negligible?



how to do HLT SF if lep does not match HLT?
In principle, no change is needed:
the not matched leptons are the not triggered ones,
the SF corrects how many ID muons do trigger HLT.





is the difference in trigger from leading lepton HLT to the OR of HLTs is reasonable?

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_matched_HLT[0]", "leps_ID == -11*11")
56125

0.9813

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_matched_HLT[0]", "leps_ID == -11*11 && HLT_el")
56122

>>> 56122. / 56125
0.9999465478841871

-- indeed the efficiency is very close to 1

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_matched_HLT[0]", "leps_ID == -11*11 && HLT_el && lep_matched_HLT[0]")
55075

efficiency 0.98

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_matched_HLT[0]", "leps_ID == -11*11 && HLT_el && lep_matched_HLT[1]")
53899

efficiency 0.96


>>> trig_or(0.98, 0.96)
0.9992

python stack_plot.py distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3/  -c dy_elel --data-nick data_other -d dilep_mass --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5




can in principle Z pT do it?

check z mass-pt re-weighting histo -- it is crap,
the main weights are at around 100-1000 of GeV of bot pT and mass.

in gen level the mass is strictly around the peak at 90,
pT is at < 100GeV

try shifting the Z mass manually? can it affect pt and eta of the final states?

python get_shapes.py --formula "data:mc" --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj mc:distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3.root:dy_mumu/dy_other/NOMINAL/dy_mumu_dy_other_NOMINAL_dilep_mass data:distrs/v37_test5_bunch2//SingleMuon.root:dy_mumu/data_other/NOMINAL/dy_mumu_data_other_NOMINAL_dilep_mass


python get_shapes.py --formula "data/mc" --y-range 0.7,1.3 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj mc:distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3.root:dy_mumu/dy_other/NOMINAL/dy_mumu_dy_other_NOMINAL_dilep_mass data:distrs/v37_test5_bunch2//SingleMuon.root:dy_mumu/data_other/NOMINAL/dy_mumu_data_other_NOMINAL_dilep_mass


python get_shapes.py --formula "data/mc" --y-range 0.7,1.3 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj mc:distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3.root:dy_elel/dy_other/NOMINAL/dy_elel_dy_other_NOMINAL_dilep_mass data:distrs/v37_test5_bunch2//SingleElectron.root:dy_elel/data_other/NOMINAL/dy_elel_data_other_NOMINAL_dilep_mass





Also, tt_elmu looks with SingleElectron Data looks ok.
-- the ele HLT is fine?




## correct pile-up averaging for muon channel?

need PU per BCDEF and GH
and average it together with lep SF

now the easiest way to get PU per BCDEF and GH is to re-use ele PU

now:
lumi_bcdef = 19252.03
lumi_gh    = 16290.02

sum 35542.05

correct ratio in the reduced lumicert?

at tag v17 was:
lumi_bcdef=20263.3, lumi_gh=16518.588
at v25
lumi_bcdef=20263.3, lumi_gh=16518.588
sum 36781.888

from logs.brilcalc
old ele
>>> 2765.338 + 941.616 + 1124.295 + 8243.992 + 4105.836 + 8081.105 +6076.177
31338.359

new ele on golden json and with HLT Ele prescale ON
>>> 2765.338 + 941.616 + 1124.295 + 8243.992 + 4597.535 + 9581.599 + 8605.690
35860.065

reduced and golden json:

+--------------------------+-------+------+-------+-------------------+------------------+               |+--------------------------+-------+------+-------+-------------------+------------------+               
| hltpath                  | nfill | nrun | ncms  | totdelivered(/pb) | totrecorded(/pb) |               || hltpath                  | nfill | nrun | ncms  | totdelivered(/pb) | totrecorded(/pb) |               
+--------------------------+-------+------+-------+-------------------+------------------+               |+--------------------------+-------+------+-------+-------------------+------------------+               
| HLT_Ele27_WPTight_Gsf_v1 | 23    | 66   | 29602 | 2882.641          | 2765.338         |               || HLT_Ele27_WPTight_Gsf_v1 | 23    | 66   | 29602 | 2882.641          | 2765.338         |               
| HLT_Ele27_WPTight_Gsf_v2 | 4     | 12   | 7544  | 984.327           | 941.616          |               || HLT_Ele27_WPTight_Gsf_v2 | 4     | 12   | 7544  | 984.327           | 941.616          |               
| HLT_Ele27_WPTight_Gsf_v3 | 4     | 16   | 8541  | 1170.568          | 1124.295         |               || HLT_Ele27_WPTight_Gsf_v3 | 4     | 16   | 8541  | 1170.568          | 1124.295         |               
| HLT_Ele27_WPTight_Gsf_v4 | 24    | 85   | 56875 | 8578.297          | 8243.992         |               || HLT_Ele27_WPTight_Gsf_v4 | 24    | 85   | 56875 | 8578.297          | 8243.992         |               
| HLT_Ele27_WPTight_Gsf_v5 | 17    | 34   | 25797 | 4303.758          | 4105.836         |               || HLT_Ele27_WPTight_Gsf_v5 | 17    | 36   | 27940 | 4827.341          | 4597.535         |               
| HLT_Ele27_WPTight_Gsf_v6 | 38    | 73   | 48010 | 8420.180          | 8081.105         |               || HLT_Ele27_WPTight_Gsf_v6 | 41    | 92   | 54253 | 9994.950          | 9581.599         |               
| HLT_Ele27_WPTight_Gsf_v7 | 28    | 61   | 37468 | 6296.719          | 6076.177         |               || HLT_Ele27_WPTight_Gsf_v7 | 32    | 86   | 47447 | 8938.448          | 8605.690         |               
+--------------------------+-------+------+-------+-------------------+------------------+               |+--------------------------+-------+------+-------+-------------------+------------------+               

so, are all reduced lumis in GH only?

run dataset=/SingleMuon/Run2016G-03Feb2017-v1/MINIAOD
results
279116
...
278...

85 records

run dataset=/SingleMuon/Run2016G-03Feb2017-v1/MINIAOD | sort
280385
280384
...
278820

85 records

das_client --limit 0 --query="run dataset=/SingleMuon/Run2016G-03Feb2017-v1/MINIAOD" | sort

-- same


278820 is in first 1/5-1/4 of v6
280385 -- final of v6


reduced lumicert:

| 278273:5169 | 08/05/16 17:37:20 | 36   | HLT_Ele27_WPTight_Gsf_v6 | 7.126          | 5.812         |
| 278274:5169 | 08/05/16 17:55:42 | 84   | HLT_Ele27_WPTight_Gsf_v6 | 19.178         | 17.874        |
| 278288:5170 | 08/05/16 21:13:56 | 8    | HLT_Ele27_WPTight_Gsf_v6 | 1.962          | 1.423         |
| 278289:5170 | 08/05/16 21:18:02 | 51   | HLT_Ele27_WPTight_Gsf_v6 | 11.128         | 9.375         |
| 278290:5170 | 08/05/16 21:42:34 | 11   | HLT_Ele27_WPTight_Gsf_v6 | 2.592          | 2.401         |
| 278308:5173 | 08/06/16 13:00:39 | 1740 | HLT_Ele27_WPTight_Gsf_v6 | 327.130        | 311.520       |
| 278310:5173 | 08/07/16 00:47:36 | 708  | HLT_Ele27_WPTight_Gsf_v6 | 91.365         | 88.449        |
| 278315:5179 | 08/07/16 10:56:52 | 693  | HLT_Ele27_WPTight_Gsf_v6 | 148.584        | 136.489       |
| 278345:5181 | 08/08/16 00:13:39 | 746  | HLT_Ele27_WPTight_Gsf_v6 | 162.146        | 149.017       |
| 278346:5181 | 08/08/16 05:08:15 | 117  | HLT_Ele27_WPTight_Gsf_v6 | 22.089         | 21.027        |
| 278349:5181 | 08/08/16 06:27:06 | 613  | HLT_Ele27_WPTight_Gsf_v6 | 98.871         | 94.508        |
| 278366:5181 | 08/08/16 10:36:47 | 453  | HLT_Ele27_WPTight_Gsf_v6 | 61.575         | 59.405        |
| 278406:5183 | 08/08/16 17:53:55 | 1499 | HLT_Ele27_WPTight_Gsf_v6 | 287.841        | 273.574       |
| 278509:5187 | 08/09/16 18:29:15 | 1376 | HLT_Ele27_WPTight_Gsf_v6 | 271.371        | 251.730       |
| 278770:5197 | 08/13/16 07:09:56 | 726  | HLT_Ele27_WPTight_Gsf_v6 | 159.448        | 152.705       |
| 278803:5198 | 08/13/16 15:52:03 | 215  | HLT_Ele27_WPTight_Gsf_v6 | 50.726         | 46.868        |
| 278804:5198 | 08/13/16 17:20:06 | 4    | HLT_Ele27_WPTight_Gsf_v6 | 0.905          | 0.742         |
| 278805:5198 | 08/13/16 17:23:57 | 274  | HLT_Ele27_WPTight_Gsf_v6 | 58.724         | 55.069        |
| 278808:5198 | 08/13/16 19:25:19 | 1791 | HLT_Ele27_WPTight_Gsf_v6 | 279.557        | 269.144       |

| 278820:5199 | 08/14/16 11:02:48 | 1431 | HLT_Ele27_WPTight_Gsf_v6 | 275.614        | 264.830       |

golden json:

| 278273:5169 | 08/05/16 17:37:20 | 36   | HLT_Ele27_WPTight_Gsf_v6 | 7.126          | 5.812         |
| 278274:5169 | 08/05/16 17:55:42 | 84   | HLT_Ele27_WPTight_Gsf_v6 | 19.178         | 17.874        |
| 278288:5170 | 08/05/16 21:11:12 | 15   | HLT_Ele27_WPTight_Gsf_v6 | 3.702          | 2.846         |
| 278289:5170 | 08/05/16 21:18:02 | 51   | HLT_Ele27_WPTight_Gsf_v6 | 11.128         | 9.375         |
| 278290:5170 | 08/05/16 21:42:34 | 11   | HLT_Ele27_WPTight_Gsf_v6 | 2.592          | 2.401         |
| 278308:5173 | 08/06/16 13:00:39 | 1740 | HLT_Ele27_WPTight_Gsf_v6 | 327.130        | 311.520       |
| 278310:5173 | 08/07/16 00:47:36 | 708  | HLT_Ele27_WPTight_Gsf_v6 | 91.365         | 88.449        |
| 278315:5179 | 08/07/16 10:56:52 | 693  | HLT_Ele27_WPTight_Gsf_v6 | 148.584        | 136.489       |
| 278345:5181 | 08/08/16 00:13:39 | 746  | HLT_Ele27_WPTight_Gsf_v6 | 162.146        | 149.017       |
| 278346:5181 | 08/08/16 05:08:15 | 117  | HLT_Ele27_WPTight_Gsf_v6 | 22.089         | 21.027        |
| 278349:5181 | 08/08/16 06:27:06 | 613  | HLT_Ele27_WPTight_Gsf_v6 | 98.871         | 94.508        |
| 278366:5181 | 08/08/16 10:36:47 | 453  | HLT_Ele27_WPTight_Gsf_v6 | 61.575         | 59.405        |
| 278406:5183 | 08/08/16 17:15:50 | 1597 | HLT_Ele27_WPTight_Gsf_v6 | 311.334        | 295.446       |
| 278509:5187 | 08/09/16 18:29:15 | 1467 | HLT_Ele27_WPTight_Gsf_v6 | 293.117        | 271.956       |
| 278769:5197 | 08/13/16 06:38:56 | 30   | HLT_Ele27_WPTight_Gsf_v6 | 7.722          | 7.136         |
| 278770:5197 | 08/13/16 06:54:00 | 767  | HLT_Ele27_WPTight_Gsf_v6 | 169.739        | 162.629       |
| 278801:5198 | 08/13/16 14:43:37 | 38   | HLT_Ele27_WPTight_Gsf_v6 | 10.014         | 7.722         |
| 278802:5198 | 08/13/16 15:01:05 | 17   | HLT_Ele27_WPTight_Gsf_v6 | 3.995          | 1.693         |
| 278803:5198 | 08/13/16 15:10:53 | 318  | HLT_Ele27_WPTight_Gsf_v6 | 76.633         | 70.852        |
| 278804:5198 | 08/13/16 17:20:06 | 4    | HLT_Ele27_WPTight_Gsf_v6 | 0.905          | 0.742         |
| 278805:5198 | 08/13/16 17:23:57 | 274  | HLT_Ele27_WPTight_Gsf_v6 | 58.724         | 55.069        |
| 278808:5198 | 08/13/16 19:25:19 | 1791 | HLT_Ele27_WPTight_Gsf_v6 | 279.557        | 269.144       |

| 278820:5199 | 08/14/16 11:00:51 | 1517 | HLT_Ele27_WPTight_Gsf_v6 | 296.801        | 285.103       |

the overlapping block:

sum([ 5.812   17.874  1.423   9.375   2.401   311.520 88.449  136.489 149.017 21.027  94.508  59.405  273.574 251.730 152.705 46.868  0.742   55.069  269.144 ])
sum([ 5.812   17.874  2.846   9.375   2.401   311.520 88.449  136.489 149.017 21.027  94.508  59.405  295.446 271.956 7.136   162.629 7.722   1.693   70.852  0.742   55.069  269.144 ])

1947.1319999999998
2041.1119999999999

reduced:

sum( [2765.338 941.616  1124.295 8243.992 4105.836 + 1947.1319999999998])
19128.209
sum( [8081.105 - 1947.1319999999998 6076.177 ])
12210.15


golden:

sum( [2765.338  941.616   1124.295  8243.992  4597.535  + 2041.1119999999999])
19713.888
sum( [9581.599  - 2041.1119999999999 8605.690  ])
16146.177

now, assuming correct pu ele and golden json pu

pu ele    = (pu B * 19128.209 + pu H * 12210.15)  / (19128.209 + 12210.15)
pu golden = (pu B * 19713.888 + pu H * 16146.177) / (19713.888 + 16146.177)

ele_B = 19128.209 / (19128.209 + 12210.15)
ele_H = 12210.15  / (19128.209 + 12210.15)
gld_B = 19713.888 / (19713.888 + 16146.177)
gld_H = 16146.177 / (19713.888 + 16146.177)


pu ele    = pu B * ele_B + pu H * ele_H
pu golden = pu B * gld_B + pu H * gld_H

pu ele    / ele_B = pu B + pu H * ele_H / ele_B
pu golden / gld_B = pu B + pu H * gld_H / gld_B

pu ele    / ele_B - pu golden / gld_B = pu H * (ele_H / ele_B - gld_H / gld_B)
pu H = (pu ele    / ele_B - pu golden / gld_B) / (ele_H / ele_B - gld_H / gld_B)


pu ele    / ele_H = pu B * ele_B / ele_H + pu H
pu golden / gld_H = pu B * gld_B / gld_H + pu H

pu ele    / ele_H - pu golden / gld_H = pu B * (ele_B / ele_H - gld_B / gld_H)
pu B = (pu ele    / ele_H - pu golden / gld_H) / (ele_B / ele_H - gld_B / gld_H)


HOW TO NORMALIZE THE NEW PU?

save the ratio PU
ratio_bcdef * weight_pu_bcdef + ratio_gh * weight_pu_gh
and compare later with golden json pu


### Check application in DY mumu

root -l MC2016_Summer16_DYJetsToLL_50toInf_madgraph_ext2_v1_37.root
root -l MC2016_Summer16_DYJetsToLL_50toInf_madgraph_ext2_v1_37_2.root

ttree_out->Draw("event_weight>>h(100,0.6,1.4)",  "(selection_stage_dy_mumu == 102 || selection_stage_dy_mumu == 103 || selection_stage_dy_mumu == 105)")


c1->SaveAs("v37_test7_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_ext2_v1_37_event_weight_dy_mumu.png")
c1->SaveAs("v37_test6_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_ext2_v1_37_event_weight_dy_mumu.png")

-- definitely different
   in test7
   main peak at 0.9 is smaller,
   the positive values of 1.2 have more events

distrs/v37_test7_bunchDILEP3/all/MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root

python get_shapes.py --formula "now / old" --y-range 0,2.0 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj old:distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root:dy_mumu/dy_other/NOMINAL/dy_mumu_dy_other_NOMINAL_met_c now:distrs/v37_test7_bunchDILEP3/all/MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root:dy_mumu/dy_other/NOMINAL/dy_mumu_dy_other_NOMINAL_met_c

mv compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_now,old_formula.png compare_v37_test6_bunch3_test7_bunchDILEP3_dy_mumu_met_c.png



try hybrid

hadd v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3.root v37_test6_bunch3/dy_hybrid/MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root v37_test6_bunch3/MC2016_Summer16_*root v37_test6_bunch3/wjets_amcatnlo/MC2016_Summer16_WJets_amcatnlo.root

python stack_plot.py distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3/  -c dy_mumu --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3/  -c dy_elel --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- now mumu trend is slightly in oppostie direction (incorrect PU BCDEF and GH?)
   elel is slightly wrongly normalized (PU re-normalization?)

python stack_plot.py distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3/  -c dy_mumu --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3/  -c dy_elel --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3/  -c dy_mumu --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3/  -c dy_elel --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- elel has too much MC in endcaps
   mumu   not enough MC in barrel? (or too much in endcaps and normalization is wrong)

python stack_plot.py distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3/  -c dy_mumu --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo_dy_from_v37_test7_bunchDILEP3/  -c dy_elel --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- elel kind of ok, bad at large mT
   mumu lack of Data at 100-150 (like in W+jets selection)

is elel the same as before or something broke?



### Check application in TT tt_elmu

distrs/v37_test7_bunchDILEP3/all/MC2016_Summer16_TTJets_powheg.root

python get_shapes.py --formula "now / old" --y-range 0,2.0 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj old:distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_met_c now:distrs/v37_test7_bunchDILEP3/all/MC2016_Summer16_TTJets_powheg.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_met_c

-- slight correction

mv compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_now,old_formula.png compare_v37_test6_bunch3_test7_bunchDILEP3_tt_elmu_met_c.png

hadd v37_test6_bunch3_mc_1_amcatnlo_dy_and_tt_from_v37_test7_bunchDILEP3.root v37_test6_bunch3/dy_hybrid/MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root v37_test6_bunch3/MC2016_Summer16_*root v37_test6_bunch3/wjets_amcatnlo/MC2016_Summer16_WJets_amcatnlo.root v37_test6_bunch3/tt_hybrid/MC2016_Summer16_TTJets_powheg.root


comparing with distrs/v37_test5_bunch2//SingleElectron.root
-- horrible normalization
INFO:root:197779.0
INFO:root:mc sum     =   165290.055221   165290.055221

and strange trends

-- same crap in SingleMuon

python stack_plot.py distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_and_tt_from_v37_test7_bunchDILEP3.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo_dy_and_tt_from_v37_test7_bunchDILEP3/  -c tt_elmu --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_and_tt_from_v37_test7_bunchDILEP3.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo_dy_and_tt_from_v37_test7_bunchDILEP3/  -c tt_elmu --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_and_tt_from_v37_test7_bunchDILEP3.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo_dy_and_tt_from_v37_test7_bunchDILEP3/  -c tt_elmu --data-nick data_other -d met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_and_tt_from_v37_test7_bunchDILEP3.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo_dy_and_tt_from_v37_test7_bunchDILEP3/  -c tt_elmu --data-nick data_other -d Mt_lep_met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_and_tt_from_v37_test7_bunchDILEP3.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo_dy_and_tt_from_v37_test7_bunchDILEP3/  -c tt_elmu --data-nick data_other -d Mt_lep_met_f   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5


python stack_plot.py distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_and_tt_from_v37_test7_bunchDILEP3.root distrs/v37_test5_bunchDILEP3//SingleMuon.root     -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo_dy_and_tt_from_v37_test7_bunchDILEP3/  -c tt_elmu --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_and_tt_from_v37_test7_bunchDILEP3.root distrs/v37_test5_bunchDILEP3//SingleMuon.root     -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo_dy_and_tt_from_v37_test7_bunchDILEP3/  -c tt_elmu --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_and_tt_from_v37_test7_bunchDILEP3.root distrs/v37_test5_bunchDILEP3//SingleMuon.root     -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo_dy_and_tt_from_v37_test7_bunchDILEP3/  -c tt_elmu --data-nick data_other -d met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test6_bunch3_mc_1_amcatnlo_dy_and_tt_from_v37_test7_bunchDILEP3.root distrs/v37_test5_bunchDILEP3//SingleMuon.root     -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo_dy_and_tt_from_v37_test7_bunchDILEP3/  -c tt_elmu --data-nick data_other -d Mt_lep_met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5


full MC

hadd v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu.root v37_test7_bunchDILEP3/MC*root v37_test7_bunchDILEP3/wjets_amcatnlo/MC2016_Summer16_WJets_amcatnlo.root

hadd v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root v37_test7_bunchDILEP3/MC*root v37_test7_bunchDILEP3/wjets_amcatnlo/MC2016_Summer16_WJets_amcatnlo.root

python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5 --sys TOPPTUp

-- normalization is off,
   many not closed files in test7
-- with full files the low pT is somewhat off? MC < Data


python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_el_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_el_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5 --sys TOPPTUp

-- very small deviations,
   trend on order 5% is visible: kink at 90-100GeV,
   Data>MC at low pT and reverse after that,
   TOPPT only tilts the whole kink together

python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_mu_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_mu_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5 --sys TOPPTUp

-- same kink up to 60-80GeV, TOPPT fixes the tail of large pT completely



the kink can be fixed with DY normalization?

python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_el_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5 --sys TOPPTUp --factor-dy 1.5

python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_mu_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5 --sys TOPPTUp --factor-dy 1.5

-- still something wrong at lowest bins elmu_mu
   and very wrong in elmu_el
   the kink bends backwards, at 30-40GeV Data < MC


python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_el_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_el_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5 --sys TOPPTUp

-- off at edge eta bins and some in the middle

python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_mu_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_mu_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5 --sys TOPPTUp

-- practically flat, that dip at eta=-0.3 is here,
   Data +5% in the eta -2.4 bin


python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5 --sys TOPPTUp
python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5 --sys TOPPTUp
python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d Mt_lep_met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d Mt_lep_met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5 --sys TOPPTUp

-- TOPPTUp in mT  flattens well, but does not fix the last bin
           in met almost fixes the tail, but does not fix the small met bins
           same in other distrs: almost fixes everything

python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d Mt_lep_met_f   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d nbjets   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d nrjets   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5


python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleMuon.root     -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleMuon.root     -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleMuon.root     -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleMuon.root     -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d Mt_lep_met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- worse? some strange trend in mT SingleElectron again, but less than in test5



#### issues in electron and muon pT

python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_el_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_mu_pt  --lumi 35800 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5



##### per epoch Data

hadd SingleElectron_BCDEF.root Data13TeV_SingleElectron2016[BCDEF]*.root &
hadd SingleElectron_GH.root    Data13TeV_SingleElectron2016[GH]*.root    &

hadd SingleMuon_BCDEF.root Data13TeV_SingleMuon2016[BCDEF]*.root &
hadd SingleMuon_GH.root    Data13TeV_SingleMuon2016[GH]*.root    &

the lumi split:

sum( [2765.338  941.616   1124.295  8243.992  4597.535  + 2041.1119999999999])
19713.888
sum( [9581.599  - 2041.1119999999999 8605.690  ])
16146.177

python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron_BCDEF.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_el_pt  --lumi 19714 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron_BCDEF.root -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_mu_pt  --lumi 19714 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

INFO:root:data       =    87836.000000     1489.241144
INFO:root:mc sum     =    88004.512012    88004.512012

yeah, the kink is there,
strangely in muons it looks like a step 30-50, 50-75

python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron_GH.root    -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_el_pt  --lumi 16146 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5
python stack_plot.py distrs/v37_test7_bunchDILEP3_mc_2_amcatnlo_tt_elmu.root distrs/v37_test5_bunchDILEP3//SingleElectron_GH.root    -p -r  -o plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu/  -c tt_elmu --data-nick data_other -d elmu_mu_pt  --lumi 16146 --overwrite --wjets 0.92 --ratio-range 0.2 --qcd-factor 2.5

INFO:root:data       =    74358.000000     1370.513755
INFO:root:mc sum     =    72076.739928    72076.739928

yeah the kink is visible, more than in previous epoch?

eog plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu//d*BCDEF*elmu_el_pt* plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu//d*GH*elmu_el_pt*

eog plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu//d*BCDEF*elmu_mu_pt* plots/v37_test7_bunchDILEP3_mc1_amcatnlo_tt_elmu//d*GH*elmu_mu_pt*

-- more visible in muons, kind of the same in electrons,
   the curve of the kink is a bit different


check correlation of electron and muon pT

root -l lstore_outdirs/v37/test7/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_1.root

ttree_out->Draw("event_leptons[0].pt():event_leptons[1].pt()>>h(50,20,150,50,20,150)", "selection_stage_em > 200 && selection_stage_em < 210")

-- no visible correlation


so, is it something with muon ID and PU averaging?



## v37 test5 issues, round3, for update, the fixed dilepton and electron SFs

python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c dy_mumu --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c dy_elel --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c dy_mumu --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c dy_elel --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c dy_mumu --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c dy_elel --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c dy_mumu --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c dy_elel --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- same trend in mumu (was exclusive trigger SF applied there?), and worse normalization: not enough MC
   practically no trend in elel, just at the largest met (blame on recoils or Z pt-mass? is Z pt-mass applied?)

tt elmu

python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c tt_elmu --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c tt_elmu --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c tt_elmu --data-nick data_other -d met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c tt_elmu --data-nick data_other -d Mt_lep_met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c tt_elmu --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c tt_elmu --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c tt_elmu --data-nick data_other -d met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c tt_elmu --data-nick data_other -d Mt_lep_met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- no difference?

compare to plots/v37_test5_bunch2_mc_tests2/

eog plots/v37_test6_bunch3_mc_1_amcatnlo/*SingleElectron*tt_elmu* &
eog plots/v37_test5_bunch2_mc_tests2/*SingleElectron*tt_elmu*     &

-- they seem exactly the same

eog plots/v37_test6_bunch3_mc_1_amcatnlo/*SingleMuon*tt_elmu* &

-- also no good (maybe better trends though)

also:
python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c tt_elmu --data-nick data_other -d Mt_lep_met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5 --systematic TOPPTUp

eog plots/v37_test6_bunch3_mc_1_amcatnlo//distrs,distrs_v37_test6_bunch3_mc_1_amcatnlo_distrs,v37_test5_bunch2,,SingleElectron_Mt_lep_met_c_tt_elmu_*_stack_ratio.png

-- yeap, slight improvement at edges
   per-bin variations are not fixed


python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c tt_elmu --data-nick data_other -d Mt_lep_met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root        -o plots/v37_test5_bunch2_mc_tests2/  -c tt_elmu --data-nick data_other -d Mt_lep_met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

python get_shapes.py --formula "old : now " --y-range 0,0.45 --no-std-path -e --x-title "m_{T} [GeV]" -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj old:plots/v37_test5_bunch2_mc_tests2//distrs,v37_test5_bunch2_mc_4_amcatnlo_HISTOSEL_Mt_lep_met_c_tt_elmu_NOMINAL.root:tt_elmu/sums_NOMINAL/mc_sum1_NOMINAL now:plots/v37_test6_bunch3_mc_1_amcatnlo//distrs,distrs_v37_test6_bunch3_mc_1_amcatnlo_HISTOSEL_Mt_lep_met_c_tt_elmu_NOMINAL.root:tt_elmu/sums_NOMINAL/mc_sum1_NOMINAL
mv ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_now,old_formula.png plots/v37_test6_bunch3_mc_1_amcatnlo/compare_mc_sum_in_old_v37_test5_bunch2_mc_tests2_new_v37_test6_bunch3_mc_1_amcatnlo.png

python get_shapes.py --formula "old / now " --y-range 0,2.0 --no-std-path -e --x-title "m_{T} [GeV]" -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj old:plots/v37_test5_bunch2_mc_tests2//distrs,v37_test5_bunch2_mc_4_amcatnlo_HISTOSEL_Mt_lep_met_c_tt_elmu_NOMINAL.root:tt_elmu/sums_NOMINAL/mc_sum1_NOMINAL now:plots/v37_test6_bunch3_mc_1_amcatnlo//distrs,distrs_v37_test6_bunch3_mc_1_amcatnlo_HISTOSEL_Mt_lep_met_c_tt_elmu_NOMINAL.root:tt_elmu/sums_NOMINAL/mc_sum1_NOMINAL
mv ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_now,old_formula.png plots/v37_test6_bunch3_mc_1_amcatnlo/compare_mc_sum_in_old_v37_test5_bunch2_mc_tests2_new_v37_test6_bunch3_mc_1_amcatnlo_ratio.png

-- identical, why?

is event weight applied? -- yes, for NOMINAL it is 
systs2_weights_nominal = {
'NOMINAL': lambda ev: ev.event_weight,
}

0) D submit preliminary both DY controls for Yuta (no data-driven QCD): mT < 40 and the control with 3 jets (event_jets_n_jets) as in signal
   stack plots
1) D check the application procedure: add a systematic INITIAL with no weights (run on 1 distr in 1 mumu DY channel in NOMINAL)
   -- certainly they are different
      is it due to lep weight or no?
2) D reconstruct event_weight from the separate weights
3) D compare in test5 and test6:
            event_weight_LEP[0]     = weight_lep if weight_lep > 0.0001 else 0.
4) R and compare nominal weight 'NOMINAL': lambda ev: ev.event_weight,


root -l lstore_outdirs/v37/test5/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_1.root
root -l lstore_outdirs/v37/test6/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_1.root

root -l lstore_outdirs/v37/test5/MC2016_Summer16_DYJetsToLL_50toInf_madgraph/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1.root 
root -l lstore_outdirs/v37/test6/MC2016_Summer16_DYJetsToLL_50toInf_madgraph/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1.root 

ttree_out->Draw("event_weight_LEP>>h(100,0.6,1.1)")
ttree_out->Draw("event_weight_LEP>>h(100,0.6,1.1)", "selection_stage_em > 200 && selection_stage_em < 210")
ttree_out->Draw("event_leptons[0].pt()>>h(100,0,150)", "selection_stage_em > 200 && selection_stage_em < 210")

c1->SaveAs("v37_test5_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_LEP.png")
c1->SaveAs("v37_test6_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_LEP.png")

c1->SaveAs("v37_test5_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_LEP_tt_elmu.png")
c1->SaveAs("v37_test6_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_LEP_tt_elmu.png")

c1->SaveAs("v37_test5_MC2016_Summer16_TTJets_powheg_1_event_weight_LEP_tt_elmu.png")
c1->SaveAs("v37_test6_MC2016_Summer16_TTJets_powheg_1_event_weight_LEP_tt_elmu.png")

eog v37_test5_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_LEP.png v37_test6_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_LEP.png
eog v37_test5_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_LEP_tt_elmu.png v37_test6_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_LEP_tt_elmu.png
eog v37_test5_MC2016_Summer16_TTJets_powheg_1_event_weight_LEP_tt_elmu.png v37_test6_MC2016_Summer16_TTJets_powheg_1_event_weight_LEP_tt_elmu.png

--completely different

confirm the files are the same

c1->SaveAs("v37_test5_MC2016_Summer16_TTJets_powheg_1_event_leptons_pt_tt_elmu.png")
c1->SaveAs("v37_test6_MC2016_Summer16_TTJets_powheg_1_event_leptons_pt_tt_elmu.png")

-- identical

the nominal weight:

ttree_out->Draw("event_weight>>h(100,0.2,1.4)", "selection_stage_em > 200 && selection_stage_em < 210")

c1->SaveAs("v37_test5_MC2016_Summer16_TTJets_powheg_1_event_weight_tt_elmu.png")
c1->SaveAs("v37_test6_MC2016_Summer16_TTJets_powheg_1_event_weight_tt_elmu.png")

-- slightly different, even the mean is different: 0.9357 test6 - 0.9419 test5
So, stage2 did produce different lep weights and probably the difference in the event weight is due to them.
DONE: reconstruct the event weight - then compare the weight without lep between test5 and test6.
      indeed, only leptonic weight is different between test5 and test6
But get_shapes of MC sums shows the same distributions in 5 and 6?
TODO: check get_shape on lep_eta for dy_elel (must be noticeable)
TODO: check 1 file completely, from stage2 to plots, the distr and the weight applied, with and without lep.

Does sumup_loop do all of it?
Can weights cancel out in dilepton case (one lep is low pT another one is high)?
-- the median has checnged, it must be noticeable


### confirm the issue in tt_elmu lep weight

DONE: in tt_elmu lep weight is different between test5 and test6 but final shapes are the same?
      no, the final shapes are sub-percent different,
      but the effect seems to small?

python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c tt_elmu --data-nick data_other -d lep_pt   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root        -o plots/v37_test5_bunch2_mc_tests2/      -c tt_elmu --data-nick data_other -d lep_pt   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c tt_elmu --data-nick data_other -d lep_eta   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root        -o plots/v37_test5_bunch2_mc_tests2/      -c tt_elmu --data-nick data_other -d lep_eta   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

python get_shapes.py --formula "old : now " --y-range 0,0.2 --no-std-path -e --x-title "m_{T} [GeV]" -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj old:plots/v37_test5_bunch2_mc_tests2//distrs,v37_test5_bunch2_mc_4_amcatnlo_HISTOSEL_lep_pt_tt_elmu_NOMINAL.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_lep_pt now:plots/v37_test6_bunch3_mc_1_amcatnlo//distrs,distrs_v37_test6_bunch3_mc_1_amcatnlo_HISTOSEL_lep_pt_tt_elmu_NOMINAL.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_lep_pt
mv ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_now,old_formula.png ./compare_v37_test5_test6_tt_elmu_tt_other_NOMINAL_lep_pt_now,old_formula.png

python get_shapes.py --formula "old / now " --y-range 0,2.0 --no-std-path -e --x-title "m_{T} [GeV]" -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj old:plots/v37_test5_bunch2_mc_tests2//distrs,v37_test5_bunch2_mc_4_amcatnlo_HISTOSEL_lep_pt_tt_elmu_NOMINAL.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_lep_pt now:plots/v37_test6_bunch3_mc_1_amcatnlo//distrs,distrs_v37_test6_bunch3_mc_1_amcatnlo_HISTOSEL_lep_pt_tt_elmu_NOMINAL.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_lep_pt
mv ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_now,old_formula.png ./compare_v37_test5_test6_tt_elmu_tt_other_NOMINAL_lep_pt_now,old_formula_ratio.png

python get_shapes.py --formula "old : now " --y-range 0,0.1 --no-std-path -e --x-title "m_{T} [GeV]" -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj old:plots/v37_test5_bunch2_mc_tests2//distrs,v37_test5_bunch2_mc_4_amcatnlo_HISTOSEL_lep_eta_tt_elmu_NOMINAL.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_lep_eta now:plots/v37_test6_bunch3_mc_1_amcatnlo//distrs,distrs_v37_test6_bunch3_mc_1_amcatnlo_HISTOSEL_lep_eta_tt_elmu_NOMINAL.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_lep_eta
mv ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_now,old_formula.png ./compare_v37_test5_test6_tt_elmu_tt_other_NOMINAL_lep_eta_now,old_formula.png

python get_shapes.py --formula "old / now : now / now " --y-range 0.95,1.05 --no-std-path -e --x-title "m_{T} [GeV]" -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj old:plots/v37_test5_bunch2_mc_tests2//distrs,v37_test5_bunch2_mc_4_amcatnlo_HISTOSEL_lep_eta_tt_elmu_NOMINAL.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_lep_eta now:plots/v37_test6_bunch3_mc_1_amcatnlo//distrs,distrs_v37_test6_bunch3_mc_1_amcatnlo_HISTOSEL_lep_eta_tt_elmu_NOMINAL.root:tt_elmu/tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_lep_eta
mv ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_now,old_formula.png ./compare_v37_test5_test6_tt_elmu_tt_other_NOMINAL_lep_eta_now,old_formula_ratio.png

-- barely sub-percent difference, mostly at eta > 2, not at negative eta

So, apprently, the final shapes are different by a very small factor, mostly at the lep eta>2 edge...

TODO: the overal weight difference ~ mean of lep weight?
TODO: what was the main correction?




### reconstruct event weight

ttree_out->Draw("event_weight:event_weight_bSF*event_weight_init*event_weight_th*event_weight_PU", "selection_stage_em > 200 && selection_stage_em < 210")

-- perfect correlation

ttree_out->Draw("event_weight_LEP:event_weight_init", "selection_stage_em > 200 && selection_stage_em < 210")

-- perfect correlation

compare non-lep weight in test5 and test6:

ttree_out->Draw("event_weight_bSF*event_weight_th*event_weight_PU>>h(100,0.6,1.4)", "selection_stage_em > 200 && selection_stage_em < 210")

c1->SaveAs("v37_test5_MC2016_Summer16_TTJets_powheg_1_event_weight_NON_LEP_tt_elmu.png")
c1->SaveAs("v37_test6_MC2016_Summer16_TTJets_powheg_1_event_weight_NON_LEP_tt_elmu.png")

-- identical




### check the differences in lep weight, DY dileps

what changed

in mumu:
    ID is product of both muons (must reduce the MC yield)
    TRG is exclusive formula (must increase the MC yield)

in elel:
    the SF calculation is corrected (asymetry in eta!)
    same as in mumu
    ID is product (less MC)
    TRG is exclusive formula (more MC)


for DY elel

root -l lstore_outdirs/v37/test5/MC2016_Summer16_DYJetsToLL_50toInf_madgraph/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1.root 
root -l lstore_outdirs/v37/test6/MC2016_Summer16_DYJetsToLL_50toInf_madgraph/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1.root 

ttree_out->Draw("event_weight_bSF*event_weight_th*event_weight_PU>>h(100,0.6,1.4)", "(selection_stage_dy_mumu == 112 || selection_stage_dy_mumu == 113 || selection_stage_dy_mumu == 115)")

c1->SaveAs("v37_test5_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_NON_LEP_dy_elel.png")
c1->SaveAs("v37_test6_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_NON_LEP_dy_elel.png")

-- identical

ttree_out->Draw("event_weight_LEP>>h(100,0.6,1.4)", "(selection_stage_dy_mumu == 112 || selection_stage_dy_mumu == 113 || selection_stage_dy_mumu == 115)")

c1->SaveAs("v37_test5_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_LEP_dy_elel.png")
c1->SaveAs("v37_test6_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_LEP_dy_elel.png")

-- completely different, the distr is a sharp peak, at 0.94 in test5 and 0.9 in test6

compare in mumu -- shows the effect of the exclusive trigger SF

ttree_out->Draw("event_weight_bSF*event_weight_th*event_weight_PU>>h(100,0.6,1.4)", "(selection_stage_dy_mumu == 102 || selection_stage_dy_mumu == 103 || selection_stage_dy_mumu == 105)")

c1->SaveAs("v37_test5_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_NON_LEP_dy_mumu.png")
c1->SaveAs("v37_test6_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_NON_LEP_dy_mumu.png")

-- identical, absolutely no difference

#### PROBLEM: exclusive trigger SF (test6) shows no difference with old SF (test5) in DY mumu?

also, trigger SF must be applied only to the HLT matched leptons
-- compare the mu TRG, via the muTRGUp

ttree_out->Draw("event_weight_LEPmuTRGUp*event_weight_LEP>>h(100,0.6,1.1)", "(selection_stage_dy_mumu == 102 || selection_stage_dy_mumu == 103 || selection_stage_dy_mumu == 105)")

c1->SaveAs("v37_test5_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_LEPmuTRGUp_dy_mumu.png")
c1->SaveAs("v37_test6_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_LEPmuTRGUp_dy_mumu.png")

-- completely different, mean goes from (test5) 0.922 to (test6) 0.8761

PROBLEM: why trigger SF becomes smaller after exclusive formula?
         -- confirm properly, with nominal MU and EL TRG weights
in test6 with TRG SF and mu0TRG SF:

root -l temp//MC2016_Summer16_DYJetsToLL_50toInf_madgraph_ext2_v1_37.root

ttree_out->Draw("event_weight_LEPmuTRG/event_weight_LEPmu0TRG>>h(100,0.6,1.1)", "(selection_stage_dy_mumu == 102 || selection_stage_dy_mumu == 103 || selection_stage_dy_mumu == 105)")

ttree_out->Draw("event_weight_LEPmuTRG>>h(100,0.6,1.1)",  "(selection_stage_dy_mumu == 102 || selection_stage_dy_mumu == 103 || selection_stage_dy_mumu == 105)")
ttree_out->Draw("event_weight_LEPmu0TRG>>h(100,0.6,1.1)", "(selection_stage_dy_mumu == 102 || selection_stage_dy_mumu == 103 || selection_stage_dy_mumu == 105)")

-- must be larger 1 (always when mu0TRG < 1.)
   indeed it is, muTRG is very = 1
   the mu0TRG is very binned...
   and both are very close to 1, no 0.92
   CHECK TRG Up
   COMPARE to a test6 file?

ttree_out->Draw("event_weight_LEPmuTRGctrl>>h(100,0.6,1.1)", "(selection_stage_dy_mumu == 102 || selection_stage_dy_mumu == 103 || selection_stage_dy_mumu == 105)")
0.8759
ttree_out->Draw("event_weight_LEPmu0TRGUp>>h(100,0.6,1.1)",  "(selection_stage_dy_mumu == 102 || selection_stage_dy_mumu == 103 || selection_stage_dy_mumu == 105)")
0.9219

-- and does look similar to the previous tests (ctrl = Up * weight_LEP, as expected)
why Up is smooth, nominal is close to 1

beacause Up includes the *ID SF!!!!

ttree_out->Draw("event_weight_LEPmuID>>h(100,0.6,1.1)",  "(selection_stage_dy_mumu == 102 || selection_stage_dy_mumu == 103 || selection_stage_dy_mumu == 105)")
ttree_out->Draw("event_weight_LEPmu0ID>>h(100,0.6,1.1)", "(selection_stage_dy_mumu == 102 || selection_stage_dy_mumu == 103 || selection_stage_dy_mumu == 105)")

-- mu0 ID == 1 -- it is off!
   mu  ID distr practically = trgUp distr

-- explanation why TRG Up is smaller in test6 -- it includes ID, ID is smaller because it's a product of ID SFs

so, mu TRG is pointless because it is so close to 1.

>>> 1. - (1. - 0.94)*(1 - 0.94)
0.9964


check the mu ID

ttree_out->Draw("event_weight_LEPmuIDUp*event_weight_LEP>>h(100,0.6,1.1)", "(selection_stage_dy_mumu == 102 || selection_stage_dy_mumu == 103 || selection_stage_dy_mumu == 105)")

c1->SaveAs("v37_test5_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_LEPmuIDUp_dy_mumu.png")
c1->SaveAs("v37_test6_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_LEPmuIDUp_dy_mumu.png")

-- different, from (test5) 0.9272 to (test6) 0.8895
   the smaller value is reasonable, since it's an AND of SFs


so, after all the confusion with TRGUp, which includes ID which changed too, TRG must become close to 1.
what was it before? it was calculated for leading lepton -- also close to 1.?


ttree_out->Draw("event_weight_LEPmu0TRG>>h(100,0.6,1.1)", "(selection_stage_dy_mumu == 102 || selection_stage_dy_mumu == 103 || selection_stage_dy_mumu == 105)")
mean at 0.9847
ttree_out->Draw("event_weight_LEPmuTRG>>h(100,0.6,1.1)",  "(selection_stage_dy_mumu == 102 || selection_stage_dy_mumu == 103 || selection_stage_dy_mumu == 105)")
mean at 0.9997

+1.5%?

So, basically, I was hoping that the problem in DY is easier to solve and it also fixes tt_elmu.
But it seems, as before,
1) everything is applied correctly in DY,
2) the issues are to be blamed on recoils or Z mass-pt thing,
3) the issues in DY are not that big,
   only met shows some trend, lep_pt and mT are mostly flat,
   also mumu normalization is off -- not enough MC (not sure why).



#### check the final shapes:

python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c dy_mumu --data-nick data_other -d lep_pt   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root        -o plots/v37_test5_bunch2_mc_tests2/      -c dy_mumu --data-nick data_other -d lep_pt   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/distrs_v37_test6_bunch3_mc_1_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root -o plots/v37_test6_bunch3_mc_1_amcatnlo/  -c dy_mumu --data-nick data_other -d lep_eta   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root        -o plots/v37_test5_bunch2_mc_tests2/      -c dy_mumu --data-nick data_other -d lep_eta   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

python get_shapes.py --formula "old : now " --y-range 0,0.5 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj old:plots/v37_test5_bunch2_mc_tests2//distrs,v37_test5_bunch2_mc_4_amcatnlo_HISTOSEL_lep_pt_dy_mumu_NOMINAL.root:dy_mumu/dy_other/NOMINAL/dy_mumu_dy_other_NOMINAL_lep_pt now:plots/v37_test6_bunch3_mc_1_amcatnlo//distrs,distrs_v37_test6_bunch3_mc_1_amcatnlo_HISTOSEL_lep_pt_dy_mumu_NOMINAL.root:dy_mumu/dy_other/NOMINAL/dy_mumu_dy_other_NOMINAL_lep_pt
mv ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_now,old_formula.png ./compare_v37_test5_test6_dy_mumu_dy_other_NOMINAL_lep_pt_now,old_formula.png

python get_shapes.py --formula "old / now : now / now " --y-range 0.9,1.1 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj old:plots/v37_test5_bunch2_mc_tests2//distrs,v37_test5_bunch2_mc_4_amcatnlo_HISTOSEL_lep_pt_dy_mumu_NOMINAL.root:dy_mumu/dy_other/NOMINAL/dy_mumu_dy_other_NOMINAL_lep_pt now:plots/v37_test6_bunch3_mc_1_amcatnlo//distrs,distrs_v37_test6_bunch3_mc_1_amcatnlo_HISTOSEL_lep_pt_dy_mumu_NOMINAL.root:dy_mumu/dy_other/NOMINAL/dy_mumu_dy_other_NOMINAL_lep_pt
mv ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_now,old_formula.png ./compare_v37_test5_test6_dy_mumu_dy_other_NOMINAL_lep_pt_now,old_formula_ratio.png

-- weird step in the shape, about 0.5% magnitude, at 50-60GeV

python get_shapes.py --no-norm --formula "old : now " --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj old:plots/v37_test5_bunch2_mc_tests2//distrs,v37_test5_bunch2_mc_4_amcatnlo_HISTOSEL_lep_pt_dy_mumu_NOMINAL.root:dy_mumu/dy_other/NOMINAL/dy_mumu_dy_other_NOMINAL_lep_pt now:plots/v37_test6_bunch3_mc_1_amcatnlo//distrs,distrs_v37_test6_bunch3_mc_1_amcatnlo_HISTOSEL_lep_pt_dy_mumu_NOMINAL.root:dy_mumu/dy_other/NOMINAL/dy_mumu_dy_other_NOMINAL_lep_pt
mv ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_now,old_formula_nonorm.png ./compare_v37_test5_test6_dy_mumu_dy_other_NOMINAL_lep_pt_now,old_formula_no_norm.png

-- noticeable normalization difference

python get_shapes.py --formula "old : now " --y-range 0,0.1 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj old:plots/v37_test5_bunch2_mc_tests2//distrs,v37_test5_bunch2_mc_4_amcatnlo_HISTOSEL_lep_eta_dy_mumu_NOMINAL.root:dy_mumu/dy_other/NOMINAL/dy_mumu_dy_other_NOMINAL_lep_eta now:plots/v37_test6_bunch3_mc_1_amcatnlo//distrs,distrs_v37_test6_bunch3_mc_1_amcatnlo_HISTOSEL_lep_eta_dy_mumu_NOMINAL.root:dy_mumu/dy_other/NOMINAL/dy_mumu_dy_other_NOMINAL_lep_eta
mv ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_now,old_formula.png ./compare_v37_test5_test6_dy_mumu_dy_other_NOMINAL_lep_eta_now,old_formula.png

python get_shapes.py --formula "now / old : old / old " --y-range 0.9,1.1 --no-std-path -e -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj old:plots/v37_test5_bunch2_mc_tests2//distrs,v37_test5_bunch2_mc_4_amcatnlo_HISTOSEL_lep_eta_dy_mumu_NOMINAL.root:dy_mumu/dy_other/NOMINAL/dy_mumu_dy_other_NOMINAL_lep_eta now:plots/v37_test6_bunch3_mc_1_amcatnlo//distrs,distrs_v37_test6_bunch3_mc_1_amcatnlo_HISTOSEL_lep_eta_dy_mumu_NOMINAL.root:dy_mumu/dy_other/NOMINAL/dy_mumu_dy_other_NOMINAL_lep_eta
mv ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_now,old_formula.png ./compare_v37_test5_test6_dy_mumu_dy_other_NOMINAL_lep_eta_now,old_formula_ratio.png

-- steps at the transition to endcaps,
   now there are more events in barel and less in endcaps (with some werid step at |eta| = 2)




DONE: what changed in elel, el ID or TRG? -- both are signicantly different
      -- no NOMINAL LEP weights
DONE: implement separate el and mu NOMINAL LEP weights!

compare by Up Down LEPs:

ttree_out->Draw("event_weight_LEPelIDUp*event_weight_LEP>>h(100,0.6,1.4)", "(selection_stage_dy_mumu == 112 || selection_stage_dy_mumu == 113 || selection_stage_dy_mumu == 115)")

ttree_out->Draw("event_weight_LEPelTRGUp*event_weight_LEP>>h(100,0.6,1.4)", "(selection_stage_dy_mumu == 112 || selection_stage_dy_mumu == 113 || selection_stage_dy_mumu == 115)")

c1->SaveAs("v37_test5_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_LEPelIDUp_dy_elel.png")
c1->SaveAs("v37_test5_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_LEPelTRGUp_dy_elel.png")

c1->SaveAs("v37_test6_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_LEPelIDUp_dy_elel.png")
c1->SaveAs("v37_test6_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_1_event_weight_LEPelTRGUp_dy_elel.png")

-- both are significantly different, TRG a bit more so




## check the DY tautau in v37 test5

There is no Same Sign! -- added

python stack_plot.py distrs/v37_test5_bunch4_mc_1_amcatnlo.root distrs/v37_test5_bunch4/SingleMuon.root     -p -r -o plots/v37_test5_bunch4_dy_tautau/  -c dy_mutau --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 3.0 --title-x "lepton p_{T} [GeV]"
python stack_plot.py distrs/v37_test5_bunch4_mc_1_amcatnlo.root distrs/v37_test5_bunch4/SingleMuon.root     -p -r -o plots/v37_test5_bunch4_dy_tautau/  -c dy_mutau --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 3.0

python stack_plot.py distrs/v37_test5_bunch4_mc_1_amcatnlo.root distrs/v37_test5_bunch4/SingleMuon.root     -p -r -o plots/v37_test5_bunch4_dy_tautau/  -c dy_mutau --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 3.0
python stack_plot.py distrs/v37_test5_bunch4_mc_1_amcatnlo.root distrs/v37_test5_bunch4/SingleMuon.root     -p -r -o plots/v37_test5_bunch4_dy_tautau/  -c dy_mutau --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 3.0

-- 20% lack of MC, but at Mt > 100 and met > 100 it looks ok? maybe just QCD? try factor 3.0
and forgot the Mt < 40 cut

python stack_plot.py distrs/v37_test5_bunch4_mc_1_amcatnlo.root distrs/v37_test5_bunch4/SingleElectron.root     -p -r -o plots/v37_test5_bunch4_dy_tautau/  -c dy_eltau --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 3.0 --title-x "lepton p_{T} [GeV]"
python stack_plot.py distrs/v37_test5_bunch4_mc_1_amcatnlo.root distrs/v37_test5_bunch4/SingleElectron.root     -p -r -o plots/v37_test5_bunch4_dy_tautau/  -c dy_eltau --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 3.0

python stack_plot.py distrs/v37_test5_bunch4_mc_1_amcatnlo.root distrs/v37_test5_bunch4/SingleElectron.root     -p -r -o plots/v37_test5_bunch4_dy_tautau/  -c dy_eltau --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 3.0
python stack_plot.py distrs/v37_test5_bunch4_mc_1_amcatnlo.root distrs/v37_test5_bunch4/SingleElectron.root     -p -r -o plots/v37_test5_bunch4_dy_tautau/  -c dy_eltau --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 3.0


also:

python stack_plot.py distrs/v37_test5_bunch4_mc_1_amcatnlo.root distrs/v37_test5_bunch4/SingleMuon.root     -p -r -o plots/v37_test5_bunch4_dy_tautau/  -c dy_mutau --data-nick data_other -d dilep_mass --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 3.0
python stack_plot.py distrs/v37_test5_bunch4_mc_1_amcatnlo.root distrs/v37_test5_bunch4/SingleMuon.root     -p -r -o plots/v37_test5_bunch4_dy_tautau/  -c dy_mutau --data-nick data_other -d nbjets --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 3.0
python stack_plot.py distrs/v37_test5_bunch4_mc_1_amcatnlo.root distrs/v37_test5_bunch4/SingleMuon.root     -p -r -o plots/v37_test5_bunch4_dy_tautau/  -c dy_mutau --data-nick data_other -d nrjets --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 3.0

-- the nbjets is only 1 bin (0 bjets), there data > mc only by ~7%, within stats of MC:
INFO:root:617771.0
INFO:root:mc sum     =   599573.939341   599573.939341

### the test5 bunch5 with mT < 40 and selection with 3 jets

setenv QCD_FACTOR "--qcd-factor 3.0"
setenv QCD_FACTOR "--qcd-factor 0.0"
setenv QCD_FACTOR "--qcd-factor 0.0 --skip-QCD"

python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleMuon.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_mutau --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR --title-x "lepton p_{T} [GeV]" --rebin 5 --infinite-bin-errors 5.
python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleMuon.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_mutau --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR

python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleMuon.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_mutau --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR
python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleMuon.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_mutau --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR

python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleMuon.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_mutau --data-nick data_other -d dilep_mass --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR --rebin 5 --infinite-bin-errors 5. --ratio-range 1.
python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleMuon.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_mutau --data-nick data_other -d nbjets --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR
python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleMuon.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_mutau --data-nick data_other -d nrjets --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR

with 3 jets

python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleMuon.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_mutau_3j --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR --title-x "lepton p_{T} [GeV]" --rebin 5 --infinite-bin-errors 5.
python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleMuon.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_mutau_3j --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR

python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleMuon.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_mutau_3j --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR
python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleMuon.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_mutau_3j --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR

python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleMuon.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_mutau_3j --data-nick data_other -d dilep_mass --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR --rebin 5 --infinite-bin-errors 5. --ratio-range 1.
python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleMuon.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_mutau_3j --data-nick data_other -d nbjets --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR
python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleMuon.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_mutau_3j --data-nick data_other -d nrjets --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR


dy_eltau

python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleElectron.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_eltau --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR --title-x "lepton p_{T} [GeV]"
python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleElectron.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_eltau --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR

python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleElectron.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_eltau --data-nick data_other -d met_c        --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR
python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleElectron.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_eltau --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR

python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleElectron.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_eltau --data-nick data_other -d dilep_mass --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR
python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleElectron.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_eltau --data-nick data_other -d nbjets     --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR
python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleElectron.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_eltau --data-nick data_other -d nrjets     --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR

python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleElectron.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_eltau_3j --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR --title-x "lepton p_{T} [GeV]"
python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleElectron.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_eltau_3j --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR

python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleElectron.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_eltau_3j --data-nick data_other -d met_c        --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR
python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleElectron.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_eltau_3j --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR

python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleElectron.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_eltau_3j --data-nick data_other -d dilep_mass --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR
python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleElectron.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_eltau_3j --data-nick data_other -d nbjets     --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR
python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleElectron.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_eltau_3j --data-nick data_other -d nrjets     --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR

-- similar but worse than dy_mutau? (due to less stats?)
   tau 30 GeV cuts a lot of events!

rebin:

python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleElectron.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_eltau --data-nick data_other -d dilep_mass --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR    --ratio-range 1. --rebin 5 --infinite-bin-errors 5.
python stack_plot.py distrs/v37_test5_bunch5_mc_1_amcatnlo.root distrs/v37_test5_bunch5/SingleElectron.root     -p -r -o plots/v37_test5_bunch5_dy_tautau/  -c dy_eltau_3j --data-nick data_other -d dilep_mass --lumi 35800 --overwrite --wjets 0.92 $QCD_FACTOR --ratio-range 1. --rebin 5 --infinite-bin-errors 5.


### dy_tautau dy_mutau dy_eltau with data-driven QCD

distrs/v37_test6_bunch4_mc_1_amcatnlo.root
distrs/v37_test5_bunch4DYtautau/SingleMuon.root

python stack_plot.py distrs/v37_test6_bunch4_mc_1_amcatnlo.root distrs/v37_test5_bunch4DYtautau/SingleElectron.root     -p -r -o plots/v37_test6_bunch4_bunch4DYtautau_dy_tautau/  -c dy_eltau    --data-nick data_other -d dilep_mass --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 0.01 --ratio-range 1.
python stack_plot.py distrs/v37_test6_bunch4_mc_1_amcatnlo.root distrs/v37_test5_bunch4DYtautau/SingleElectron.root     -p -r -o plots/v37_test6_bunch4_bunch4DYtautau_dy_tautau/  -c dy_eltau_ss    --data-nick data_other -d dilep_mass --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 0.01 --ratio-range 1.

python stack_plot.py distrs/v37_test6_bunch4_mc_1_amcatnlo.root distrs/v37_test5_bunch4DYtautau/SingleElectron.root     -p -r -o plots/v37_test6_bunch4_bunch4DYtautau_dy_tautau/  -c dy_eltau    --data-nick data_other -d dilep_mass --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05 --ratio-range 1.
python stack_plot.py distrs/v37_test6_bunch4_mc_1_amcatnlo.root distrs/v37_test5_bunch4DYtautau/SingleElectron.root     -p -r -o plots/v37_test6_bunch4_bunch4DYtautau_dy_tautau/  -c dy_eltau    --data-nick data_other -d dilep_mass --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05 --ratio-range 1. --rebin 5 --infinite-bin-errors 5.


todo:

python stack_plot.py distrs/v37_test6_bunch4_mc_1_amcatnlo.root distrs/v37_test5_bunch4DYtautau/SingleElectron.root     -p -r -o plots/v37_test6_bunch4_bunch4DYtautau_dy_tautau/  -c dy_eltau_3j --data-nick data_other -d dilep_mass --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05 --ratio-range 1. --rebin 5 --infinite-bin-errors 5.




## [The corrections to JEC and bSF of systematics](https://twiki.cern.ch/twiki/bin/viewauth/CMS/TopSystematics#Correction_factors_for_special_m)

bSF is clear:

> B-tagging efficiencies are measured from data.
> Uncertainties in the modeling of the parton shower are propagated to the uncertainties of these measurements.
> Usually, b-tagging corrections are provided in form of scale factors
> where the measured efficiency is divided by the efficiency taken from a MC based on the standard Pythia8 parton shower.
> As shown in the figure below these efficiencies depend on the parton shower model and its parameters.
> For a consistent usage of the various MCs the efficiencies should be calculated separately
> and the provided scale factors should be corrected by a factor {standard Pythia8}/{variation}.

So, how were the bSF effeciencies measured?
Jets of separate flavours (hadronFlavour? the one used for bSF) fill up the pT-eta 2D histogram.
The other set of per-flavour histograms is filled with b-tagged jets. Divide and get the efficiency.
I do have everything needed in the jets.
Was there a script?
Or just Draw with [] loops?


JEC is not so much, but they say:

> These MC specific correction factors are small for most of the alternative simulations.
> However, for the modified FSR shower scales and the Herwig++ sample they are not negligible
> compared to the overall effect typically observed for the variations.

It seems the difference is in the scale: the PS variations change <pT reco>/<pT gen> distribution.
Then we need: this correction scale factor (to measure it ourself?),
re-applying the JES with the correction applied.

In AN2017_003_v8 (TOP-17-002):

> As shown in Fig. 27 the b-tagging efficiency and the jet energy scale depend on some of these
> variations. The b-tagging efficiency and the jet energy scale are measured in the data and
> correction factors with respect to the default PYTHIA 8 simulation are used to correct all simu-
> lations. We have to take into account that the correction factors should be different for various
> simulations. Therefore, corrected b-tagging scale factors and jet energy scales based on the
> observed differences, shown in Fig. 27, are determined.

-- how are they determined and is the result available?

If I measure myself I need gen jet matching and gen jet momentum.

In the ntupler:

			// gen jet info only for MC
			//NT_jet_matched_genjet_p4.push_back(gen_jet_p4);
			NT_genjet_matched  .push_back( genjet_matched );
			NT_genjet_pt       .push_back( genjet_pt      );
			NT_genjet_dR       .push_back( genjet_dR      );
			NT_genjet_i        .push_back( genjet_i       );

-- daaammmmmmmmmnnn, why p4 is not saved?
But! The pT is enough for the energy scale!

compare these vectors with jet_initial_p4

root -l gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/MC2016_Summer16_TTJets_powheg_1.root

ntupler->Get("reduced_ttree")->Draw("jet_initial_p4[0].pt():genjet_pt[0]")

looks ok, strong correlation

And these are the gen jets from the token:

	genJets_ = consumes<vector<reco::GenJet>>(edm::InputTag("slimmedGenJets"));

No flavours in JES? Yes, it's per b and light flavours. (No c?)

So, measure and compare the deviation of bSF efficiency and JES of systematics from the nominal MC.


## Measure the bSF efficiency histogram

Hard to use the [] loop in the Draw command for 2 parameters simultaneously, like python's zip.
And I need matching the jet flavour, kinematics and tagged or not.

Where is the script?

btaggin_efficiency_test.py    calculates the weights for given efficiencies

new script:

btaggin_efficiency_count.py

the binning?

it seems the bins are in
~/D/l/l/ttbar-leptons-80X/src/recordFuncs.cc

// btag-efficiency bins
// 0.1 pt bins
static Float_t beff_bins_pt[19] = { 0, 20, 24, 28, 32, 36, 40, 44, 48, 52, 56, 60, 65, 70, 75, 80, 100, 150, 500 }; // 18 bins 19 edges
static int beff_n_bins_pt = 18;

// 0.1 eta bins
static Float_t beff_bins_eta[51] = { -2.5, -2.4, -2.3, -2.2, -2.1, -2., -1.9, -1.8, -1.7, -1.6, -1.5, -1.4, -1.3, -1.2, -1.1, -1, -0.9, -0.8, -0.7, -0.6, -0.5, -0.4, -0.3, -0.2, -0.1, 0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1., 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 2., 2.1, 2.2, 2.3, 2.4, 2.5 }; // 50 bins 51 edges
static int beff_n_bins_eta = 50;

python btaggin_efficiency_count.py test_beff_histos.root gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/MC2016_Summer16_TTJets_powheg_1.root

python btaggin_efficiency_count.py test_beff_histos.root --test --histo-prefix foobar_ gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/MC2016_Summer16_TTJets_powheg_1.root

time python btaggin_efficiency_count.py test_beff_histos.root gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root

[1]    Done                          python btaggin_efficiency_count.py test_beff_histos.root gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root
15433.814u 1148.100s 4:52:38.75 94.4%	0+0k 130858488+88io 1741pf+0w


btag_udsg_hadronFlavour_candidates_tagged ->Print()
btag_udsg_hadronFlavour_candidates ->Print()
btag_c_hadronFlavour_candidates_tagged ->Print()
btag_c_hadronFlavour_candidates ->Print()
btag_b_hadronFlavour_candidates_tagged ->Print()
btag_b_hadronFlavour_candidates ->Print()

btag_udsg_hadronFlavour_candidates_tagged ->Divide(btag_udsg_hadronFlavour_candidates)
btag_c_hadronFlavour_candidates_tagged ->Divide(btag_c_hadronFlavour_candidates)
btag_b_hadronFlavour_candidates_tagged ->Divide(btag_b_hadronFlavour_candidates)

btag_udsg_hadronFlavour_candidates_tagged ->Draw("colz")
btag_c_hadronFlavour_candidates_tagged    ->Draw("colz")
btag_b_hadronFlavour_candidates_tagged    ->Draw("colz")


## Measure JES deviations

in the same script?

for each jet find the gen jet and store 2D gen pT VS reco/gen pT?
or 1D at gen pT with weight reco/gen pT?

and per eta?
-- they do per barrel and endcap!

per flavour?

count number jets without gen jets

simply get this:

+            if ev.genjet_matched[i]:
+                pt_gen  = ev.genjet_pt[i]
+                pt_reco = p4.pt()
+
+                if abs(p4.eta()) < :
+                    # barrel
+                    histos["jes_cor_2d_gen_reco_barrel"].Fill(pt_gen, pt_reco)
+                    histos["jes_cor_1d_gen_reco_barrel"].Fill(pt_gen, pt_reco/pt_gen)
+                else:
+                    # endcap
+                    histos["jes_cor_2d_gen_reco_endcap"].Fill(pt_gen, pt_reco)
+                    histos["jes_cor_1d_gen_reco_endcap"].Fill(pt_gen, pt_reco/pt_gen)


time python btaggin_efficiency_count.py test_beff_histos.root gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/MC2016_Summer16_TTJets_powheg_1.root

217.753u 14.342s 3:59.74 96.8%	0+0k 1701456+96io 1736pf+0w

ls gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/ | grep 'MC.*root' | xargs --max-procs=10 --delimiter='\n' -I FILE echo FILE.root

ls gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/ | grep 'MC.*root' | xargs --max-procs=10 --delimiter='\n' -I FILE time python btaggin_efficiency_count.py test_beff_histos_FILE.root gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/FILE

hadd test_beff_histos_MC2016_Summer16_TTJets_powheg.root test_beff_histos_MC2016_Summer16_TTJets_powheg_*root

jes_cor_1d_gen_reco_endcap_b->Divide(jes_cor_1d_gen_reco_endcap_b_unit)

gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8
gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8
gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8
gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8
gstore_outdirs/v37/TT_TuneCUETP8M2T4down_13TeV-powheg-pythia8
gstore_outdirs/v37/TT_TuneCUETP8M2T4up_13TeV-powheg-pythia8
gstore_outdirs/v37/TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8
gstore_outdirs/v37/TT_hdampUP_TuneCUETP8M2T4_13TeV-powheg-pythia8

test:

foreach dset (gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8)
foreach subset (`ls $dset`)
ls $dset/$subset/*/*/ | grep 'MC.*root' | xargs --max-procs=10 --delimiter='\n' -I FILE echo test_beff_histos_${subset}_FILE
end
end

or:

foreach dset (gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8)
ls $dset/*/*/*/ | grep 'MC.*root' | xargs --max-procs=10 --delimiter='\n' -I FILE echo test_beff_histos__FILE
end

another test:

foreach dset (gstore_outdirs/v37/TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8 gstore_outdirs/v37/TT_hdampUP_TuneCUETP8M2T4_13TeV-powheg-pythia8)
find $dset -name 'MC*root' | xargs --max-procs=10 --delimiter='\n' -I FILE echo test_beff_histos_`basename FILE` FILE
end

or even:

ls gstore_outdirs/v37/TT_hdampUP_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg_hdampUP_ext1/190211_115206/0000/MC2016_Summer16_TTJets_powheg_hdampUP_ext1_58.root | xargs --max-procs=10 --delimiter='\n' -I FILE echo test_beff_histos_`basename FILE` FILE

ls gstore_outdirs/v37/TT_hdampUP_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg_hdampUP_ext1/190211_115206/0000/MC2016_Summer16_TTJets_powheg_hdampUP_ext1_58.root | xargs --max-procs=10 --delimiter='\n' -I FILE sh -c 'echo test_beff_histos_`basename FILE` FILE'

run:

foreach dset (gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8 gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8 gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8 gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8 gstore_outdirs/v37/TT_TuneCUETP8M2T4down_13TeV-powheg-pythia8 gstore_outdirs/v37/TT_TuneCUETP8M2T4up_13TeV-powheg-pythia8 gstore_outdirs/v37/TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8 gstore_outdirs/v37/TT_hdampUP_TuneCUETP8M2T4_13TeV-powheg-pythia8)

foreach dset (gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8 gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8)
foreach dset (gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8 gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8)
foreach dset (gstore_outdirs/v37/TT_TuneCUETP8M2T4down_13TeV-powheg-pythia8 gstore_outdirs/v37/TT_TuneCUETP8M2T4up_13TeV-powheg-pythia8)
foreach dset (gstore_outdirs/v37/TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8 gstore_outdirs/v37/TT_hdampUP_TuneCUETP8M2T4_13TeV-powheg-pythia8)
find $dset -name 'MC*root' | xargs --max-procs=10 --delimiter='\n' -I FILE sh -c 'time python btaggin_efficiency_count.py test_beff_histos_`basename FILE` FILE'
end

hadd test_beff_histos_MC2016_Summer16_TTJets_powheg_hdampDOWN.root test_beff_histos_MC2016_Summer16_TTJets_powheg_hdampDOWN_*.root &
hadd test_beff_histos_MC2016_Summer16_TTJets_powheg_hdampUP.root   test_beff_histos_MC2016_Summer16_TTJets_powheg_hdampUP_*.root   &

rm test_beff_histos_MC2016_Summer16_TTJets_powheg_hdampDOWN_*.root  test_beff_histos_MC2016_Summer16_TTJets_powheg_hdampUP_*.root
mv test_beff_histos_MC2016_Summer16_TTJets_powheg_hdampDOWN.root test_beff_histos_MC2016_Summer16_TTJets_powheg_hdampUP.root studies/jes_bSF_corrections/


hadd test_beff_histos_MC2016_Summer16_TTJets_powheg_fsrdown.root test_beff_histos_MC2016_Summer16_TTJets_powheg_fsrdown_*.root  &
hadd test_beff_histos_MC2016_Summer16_TTJets_powheg_fsrup.root   test_beff_histos_MC2016_Summer16_TTJets_powheg_fsrup_*.root    &

mv test_beff_histos_MC2016_Summer16_TTJets_powheg_fsrdown.root test_beff_histos_MC2016_Summer16_TTJets_powheg_fsrup.root studies/jes_bSF_corrections/

rm test_beff_histos_MC2016_Summer16_TTJets_powheg_fsrdown_*.root test_beff_histos_MC2016_Summer16_TTJets_powheg_fsrup_*.root


hadd test_beff_histos_MC2016_Summer16_TTJets_powheg_isrdown.root test_beff_histos_MC2016_Summer16_TTJets_powheg_isrdown_*.root  &
hadd test_beff_histos_MC2016_Summer16_TTJets_powheg_isrup.root   test_beff_histos_MC2016_Summer16_TTJets_powheg_isrup_*.root    &

mv test_beff_histos_MC2016_Summer16_TTJets_powheg_isrdown.root test_beff_histos_MC2016_Summer16_TTJets_powheg_isrup.root studies/jes_bSF_corrections/

rm test_beff_histos_MC2016_Summer16_TTJets_powheg_isrdown_*.root test_beff_histos_MC2016_Summer16_TTJets_powheg_isrup_*.root

TODO: what if write it in C?

/lstore/cms/olek/CMSSW_8_0_26_patch1/bin/slc6_amd64_gcc530/jet_masurements --test test_out.root ../proc/gstore_outdirs/v37/TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg_hdampDOWN/190219_120358/0000/MC2016_Summer16_TTJets_powheg_hdampDOWN_1.root

/lstore/cms/olek/CMSSW_8_0_26_patch1/bin/slc6_amd64_gcc530/jet_masurements --test test_out.root ../proc/gstore_outdirs/v37/TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg_hdampDOWN/190219_120358/0000/MC2016_Summer16_TTJets_powheg_hdampDOWN_1.root ../proc/gstore_outdirs/v37/TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg_hdampDOWN/190219_120358/0000/MC2016_Summer16_TTJets_powheg_hdampDOWN_2.root

/lstore/cms/olek/CMSSW_8_0_26_patch1/bin/slc6_amd64_gcc530/jet_masurements --test test_out.root ../proc/gstore_outdirs/v37/TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg_hdampDOWN/190219_120358/0000/MC2016_Summer16_TTJets_powheg_hdampDOWN_*.root

time /lstore/cms/olek/CMSSW_8_0_26_patch1/bin/slc6_amd64_gcc530/jet_masurements --test test_out.root ../proc/gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/*/*/*/*root | tee foobar

277 files input
in the foobar log: 277



time /lstore/cms/olek/CMSSW_8_0_26_patch1/bin/slc6_amd64_gcc530/jet_masurements test_out.root ../proc/gstore_outdirs/v37/TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg_hdampDOWN/190219_120358/0000/MC2016_Summer16_TTJets_powheg_hdampDOWN_*.root | tee foobar

time /lstore/cms/olek/CMSSW_8_0_26_patch1/bin/slc6_amd64_gcc530/jet_masurements test_out.root ../proc/gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/*/*/*/*root | tee foobar


## measure the speeds

typical pyROOT on isr files

real	6m3.875s
user	5m27.263s
sys	0m19.490s
INFO:root:import ROOT
INFO:root:done

real	5m43.379s
user	5m5.888s
sys	0m18.817s

real	5m12.508s
user	4m38.707s
sys	0m16.042s

real	5m22.283s
user	4m49.909s
sys	0m16.517s

real	5m6.626s
user	4m33.581s
sys	0m17.715s

real	4m19.697s
user	3m49.273s
sys	0m14.258s


real	4m51.699s
user	4m20.832s
sys	0m17.181s

real	4m14.564s
user	3m48.106s
sys	0m15.090s

real	4m31.144s
user	4m2.686s
sys	0m15.536s

time /lstore/cms/olek/CMSSW_8_0_26_patch1/bin/slc6_amd64_gcc530/jet_masurements --test test_out_C_10events.root ../proc/gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg_isrdown/190219_114901/0000/MC2016_Summer16_TTJets_powheg_isrdown_18.root
time /lstore/cms/olek/CMSSW_8_0_26_patch1/bin/slc6_amd64_gcc530/jet_masurements --test--verbose test_out_C_10events.root ../proc/gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg_isrdown/190219_114901/0000/MC2016_Summer16_TTJets_powheg_isrdown_18.root

time /lstore/cms/olek/CMSSW_8_0_26_patch1/bin/slc6_amd64_gcc530/jet_masurements --test test_out_C_10events.root ../proc/gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg_isrdown/190219_114901/0000/MC2016_Summer16_TTJets_powheg_isrdown_18.root
1.617u 0.523s 0:03.14 67.8%	0+0k 594080+64io 2447pf+0w

time /lstore/cms/olek/CMSSW_8_0_26_patch1/bin/slc6_amd64_gcc530/jet_masurements test_out_C.root ../proc/gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg_isrdown/190219_114901/0000/MC2016_Summer16_TTJets_powheg_isrdown_18.root
20.580u 1.162s 0:36.77 59.1%	0+0k 1885552+80io 2447pf+0w

time python ../proc/btaggin_efficiency_count.py test_out_beff_py.root ../proc/gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg_isrdown/190219_114901/0000/MC2016_Summer16_TTJets_powheg_isrdown_18.root

206.051u 14.380s 3:29.08 105.4%	0+0k 387232+112io 1741pf+0w

1 order of magnitude...


# using the jet_masurements.cc

foreach dset (gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8 gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8)
foreach dset (gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8 gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8)
foreach dset (gstore_outdirs/v37/TT_TuneCUETP8M2T4down_13TeV-powheg-pythia8 gstore_outdirs/v37/TT_TuneCUETP8M2T4up_13TeV-powheg-pythia8)
foreach dset (gstore_outdirs/v37/TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8 gstore_outdirs/v37/TT_hdampUP_TuneCUETP8M2T4_13TeV-powheg-pythia8)

TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8
TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8
TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8
TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8
TT_TuneCUETP8M2T4down_13TeV-powheg-pythia8
TT_TuneCUETP8M2T4up_13TeV-powheg-pythia8
TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8
TT_hdampUP_TuneCUETP8M2T4_13TeV-powheg-pythia8

foreach dset ( TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8 TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8 TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8 TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8 TT_TuneCUETP8M2T4down_13TeV-powheg-pythia8 TT_TuneCUETP8M2T4up_13TeV-powheg-pythia8 TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8 TT_hdampUP_TuneCUETP8M2T4_13TeV-powheg-pythia8 )
time /lstore/cms/olek/CMSSW_8_0_26_patch1/bin/slc6_amd64_gcc530/jet_masurements test_jet_masurements_${dset}.root ../proc/gstore_outdirs/v37/${dset}/*/*/*/*.root &
end

[8]    Done                          /lstore/cms/olek/CMSSW_8_0_26_patch1/bin/slc6_amd64_gcc530/jet_masurements test_jet_masurements_TT_hdampUP_TuneCUETP8M2T4_13TeV-powheg-pythia8.root ../proc/gstore_outdirs/v37/TT_hdampUP_TuneCUETP8M2T4_13TeV-powheg-pythia8/*/*/*/*.root
1845.504u 77.807s 1:10:38.51 45.3%	0+0k 101595952+72io 2241pf+0w
[7]    Done                          /lstore/cms/olek/CMSSW_8_0_26_patch1/bin/slc6_amd64_gcc530/jet_masurements test_jet_masurements_TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8.root ../proc/gstore_outdirs/v37/TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8/*/*/*/*.root
1794.571u 75.075s 1:07:33.86 46.1%	0+0k 96841048+72io 1848pf+0w
[6]    Done                          /lstore/cms/olek/CMSSW_8_0_26_patch1/bin/slc6_amd64_gcc530/jet_masurements test_jet_masurements_TT_TuneCUETP8M2T4up_13TeV-powheg-pythia8.root ../proc/gstore_outdirs/v37/TT_TuneCUETP8M2T4up_13TeV-powheg-pythia8/*/*/*/*.root
1784.362u 76.541s 1:09:49.31 44.4%	0+0k 101121408+72io 1399pf+0w
[5]    Done                          /lstore/cms/olek/CMSSW_8_0_26_patch1/bin/slc6_amd64_gcc530/jet_masurements test_jet_masurements_TT_TuneCUETP8M2T4down_13TeV-powheg-pythia8.root ../proc/gstore_outdirs/v37/TT_TuneCUETP8M2T4down_13TeV-powheg-pythia8/*/*/*/*.root
1747.131u 72.459s 1:07:19.08 45.0%	0+0k 98997608+72io 2212pf+0w
[4]    Done                          /lstore/cms/olek/CMSSW_8_0_26_patch1/bin/slc6_amd64_gcc530/jet_masurements test_jet_masurements_TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8.root ../proc/gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/*/*/*/*.root
1819.277u 77.242s 1:10:13.53 45.0%	0+0k 101635288+72io 1693pf+0w

1h instead of 10h

[3]    Done                          /lstore/cms/olek/CMSSW_8_0_26_patch1/bin/slc6_amd64_gcc530/jet_masurements test_jet_masurements_TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8.root ../proc/gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/*/*/*/*.root
4106.031u 158.889s 2:24:57.03 49.0%	0+0k 255492400+72io 2028pf+0w

[2]    Done                          /lstore/cms/olek/CMSSW_8_0_26_patch1/bin/slc6_amd64_gcc530/jet_masurements test_jet_masurements_TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8.root ../proc/gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/*/*/*/*.root
4500.598u 157.777s 2:31:24.24 51.2%	0+0k 254054272+72io 1554pf+0w
[1]  + Done                          /lstore/cms/olek/CMSSW_8_0_26_patch1/bin/slc6_amd64_gcc530/jet_masurements test_jet_masurements_TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8.root ../proc/gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/*/*/*/*.root
4216.008u 165.812s 2:29:54.97 48.7%	0+0k 271558520+72io 1706pf+0w




# RATIO PLANS

test2 -- repeat the MC test with Anup in 2016 and 2017 MC

to implement: SS selection for suppression of tau fakes from b jets

big studies:
1) using the lepton+tau HLT in ttbar and DY lepton+tau selections
   for lower pT cut on lepton and tau, more DY and ttbar events, possibly enough statistics in 2016+2017?
2) the Dalitz parameters to suppress the tau fakes from c-jets?
   (where to get enough events, true taus and c fakes with large SV significance?)
3) possibility to use the difference in MET of ttbar-> lepton+tau VS lepton+jets with c-jet tau fakes?

smaller studies:
1) optimizations of the selection
   2 loose b-tags instead of 1 medium?
   DY mass for DY->lepton+tau to suppress the W+jets?

issues: 10% of W+jets in DY->lepton+tau selection
        the tau fakes from c-jets of W->qq in ttbar




# number of events in the systematic datasets VS the nominal dataset

check the NT with full datasets processed:
v25
v34
v37

find gstore_outdirs/v25/ -name "*fsrup*root" | grep -v "failed" | wc -l
find gstore_outdirs/v34/ -name "*fsrup*root" | grep -v "failed" | wc -l
find gstore_outdirs/v37/ -name "*fsrup*root" | grep -v "failed" | wc -l

find gstore_outdirs/v25/ -name "*fsrdown*root" | grep -v "failed" | wc -l
find gstore_outdirs/v34/ -name "*fsrdown*root" | grep -v "failed" | wc -l
find gstore_outdirs/v37/ -name "*fsrdown*root" | grep -v "failed" | wc -l

find gstore_outdirs/v25/ -name "*isrup*root" | grep -v "failed" | wc -l
find gstore_outdirs/v34/ -name "*isrup*root" | grep -v "failed" | wc -l
find gstore_outdirs/v37/ -name "*isrup*root" | grep -v "failed" | wc -l

find gstore_outdirs/v25/ -name "*isrdown*root" | grep -v "failed" | wc -l
find gstore_outdirs/v34/ -name "*isrdown*root" | grep -v "failed" | wc -l
find gstore_outdirs/v37/ -name "*isrdown*root" | grep -v "failed" | wc -l

find gstore_outdirs/v25/ -name "*CUETP8M2T4up*root" | grep -v "failed" | wc -l
find gstore_outdirs/v34/ -name "*CUETP8M2T4up*root" | grep -v "failed" | wc -l
find gstore_outdirs/v37/ -name "*CUETP8M2T4up*root" | grep -v "failed" | wc -l

find gstore_outdirs/v25/ -name "*CUETP8M2T4down*root" | grep -v "failed" | wc -l
find gstore_outdirs/v34/ -name "*CUETP8M2T4down*root" | grep -v "failed" | wc -l
find gstore_outdirs/v37/ -name "*CUETP8M2T4down*root" | grep -v "failed" | wc -l

find gstore_outdirs/v25/ -name "*hdampUP*root" | grep -v "failed" | wc -l
find gstore_outdirs/v34/ -name "*hdampUP*root" | grep -v "failed" | wc -l
find gstore_outdirs/v37/ -name "*hdampUP*root" | grep -v "failed" | wc -l

find gstore_outdirs/v25/ -name "*hdampDOWN*root" | grep -v "failed" | wc -l
find gstore_outdirs/v34/ -name "*hdampDOWN*root" | grep -v "failed" | wc -l
find gstore_outdirs/v37/ -name "*hdampDOWN*root" | grep -v "failed" | wc -l

265
263
265

277
276
277

243
240
77

222
223
224

97
97
97

118
117
117


118
118
118

121
119
120

v25 is the best

265
277
243
222
97
118
118
121


r4?

find lstore_outdirs/v25/r4 -name "*fsrup*root"    | grep -v "failed" | wc -l
find lstore_outdirs/v25/r4 -name "*fsrdown*root"  | grep -v "failed" | wc -l
find lstore_outdirs/v25/r4 -name "*isrup*root"    | grep -v "failed" | wc -l
find lstore_outdirs/v25/r4 -name "*isrdown*root"  | grep -v "failed" | wc -l
find lstore_outdirs/v25/r4 -name "*CUETP8M2T4up*root"   | grep -v "failed" | wc -l
find lstore_outdirs/v25/r4 -name "*CUETP8M2T4down*root" | grep -v "failed" | wc -l
find lstore_outdirs/v25/r4 -name "*hdampUP*root"        | grep -v "failed" | wc -l
find lstore_outdirs/v25/r4 -name "*hdampDOWN*root"      | grep -v "failed" | wc -l

265
277
243
222
97
118
118
121

-- all

the script!

python check_gen_lumi_weights.py --counter-histo events_counter --counter-bin 1 lstore_outdirs/v25/r4/MC2016_Summer16_TTJets_powheg_hdampDOWN_ext1/MC2016_Summer16_TTJets_powheg_hdampDOWN_ext1_3.root
python check_gen_lumi_weights.py --counter-histo events_counter --counter-bin 1 lstore_outdirs/v25/r4/MC2016_Summer16_TTJets_powheg*/*root

"MC2016_Summer16_TTJets_powheg_CUETP8M2T4up" : 58953660.000000,
"MC2016_Summer16_TTJets_powheg_fsrup" : 123164168.000000,
"MC2016_Summer16_TTJets_powheg_CUETP8M2T4down" : 58338240.000000,
"MC2016_Summer16_TTJets_powheg_fsrdown" : 155435656.000000,
"MC2016_Summer16_TTJets_powheg_isrdown" : 148524168.000000,
"MC2016_Summer16_TTJets_powheg_isrup" : 156469815.000000,
"MC2016_Summer16_TTJets_powheg_hdampUP" : 58858606.000000,
"MC2016_Summer16_TTJets_powheg_hdampDOWN" : 58010008.000000,

whole lot of

the missing histo in the file: events_counter lstore_outdirs/v25/r4/MC2016_Summer16_TTJets_powheg_fsrup_ext1/MC2016_Summer16_TTJets_powheg_fsrup_ext1_25.root
in fsrup

-- empty files
   and it's all ext1 files

[olek@fermi05 proc]$ find lstore_outdirs/v25/ -name MC2016_Summer16_TTJets_powheg_fsrup_ext1 -type d
lstore_outdirs/v25/r4/MC2016_Summer16_TTJets_powheg_fsrup_ext1
lstore_outdirs/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup_ext1
lstore_outdirs/v25/resub1/MC2016_Summer16_TTJets_powheg_fsrup_ext1

not empty in
lstore_outdirs/v25/resub1/MC2016_Summer16_TTJets_powheg_fsrup_ext1

python check_gen_lumi_weights.py --counter-histo events_counter --counter-bin 1 lstore_outdirs/v25/resub1/MC2016_Summer16_TTJets_powheg_fsrup_ext1/*root

"MC2016_Summer16_TTJets_powheg_fsrup" : 29453411.000000,

also

python check_gen_lumi_weights.py --counter-histo events_counter --counter-bin 1 lstore_outdirs/v25/resub1/MC2016_Summer16_TTJets_powheg*/*root

"MC2016_Summer16_TTJets_powheg_CUETP8M2T4up" : 58953660.000000,
"MC2016_Summer16_TTJets_powheg_fsrup" : 152617579.000000,
"MC2016_Summer16_TTJets_powheg_CUETP8M2T4down" : 58338240.000000,
"MC2016_Summer16_TTJets_powheg_fsrdown" : 154998386.000000,
"MC2016_Summer16_TTJets_powheg_isrdown" : 147886033.000000,
"MC2016_Summer16_TTJets_powheg_isrup" : 156469815.000000,
"MC2016_Summer16_TTJets_powheg_hdampUP" : 58858606.000000,
"MC2016_Summer16_TTJets_powheg_hdampDOWN" : 58010008.000000,

ls lstore_outdirs/v25/r4/MC2016_Summer16_TTJets_powheg_fsrup*/*root | wc -l
265
ls lstore_outdirs/v25/resub1/MC2016_Summer16_TTJets_powheg_fsrup*/*root | wc -l
265


and nominal:
python check_gen_lumi_weights.py --counter-histo events_counter --counter-bin 1 lstore_outdirs/v37/test5/MC2016_Summer16_TTJets_powheg*/*root
"MC2016_Summer16_TTJets_powheg" : 77081156.000000,

python check_gen_lumi_weights.py --counter-histo events_counter --counter-bin 1 lstore_outdirs/v26/resub1/MC2016_Summer16_TTJets_powheg/*root
python check_gen_lumi_weights.py --counter-histo events_counter --counter-bin 1 lstore_outdirs/v26/r4/MC2016_Summer16_TTJets_powheg/*root

[olek@fermi05 proc]$ python check_gen_lumi_weights.py --counter-histo events_counter --counter-bin 1 lstore_outdirs/v26/resub1/MC2016_Summer16_TTJets_powheg/*root
"MC2016_Summer16_TTJets_powheg" : 77081156.000000,

[olek@fermi05 proc]$ python check_gen_lumi_weights.py --counter-histo events_counter --counter-bin 1 lstore_outdirs/v26/r4/MC2016_Summer16_TTJets_powheg/*root
"MC2016_Summer16_TTJets_powheg" : 77081156.000000,

so, for the report:

"MC2016_Summer16_TTJets_powheg_CUETP8M2T4up" : 58953660.000000,
"MC2016_Summer16_TTJets_powheg_fsrup" : 123164168.000000,
"MC2016_Summer16_TTJets_powheg_CUETP8M2T4down" : 58338240.000000,
"MC2016_Summer16_TTJets_powheg_fsrdown" : 155435656.000000,
"MC2016_Summer16_TTJets_powheg_isrdown" : 148524168.000000,
"MC2016_Summer16_TTJets_powheg_isrup" : 156469815.000000,
"MC2016_Summer16_TTJets_powheg_hdampUP" : 58858606.000000,
"MC2016_Summer16_TTJets_powheg_hdampDOWN" : 58010008.000000,

"MC2016_Summer16_TTJets_powheg_fsrup" : 152617579.000000,

"MC2016_Summer16_TTJets_powheg" : 77081156.000000,


"MC2016_Summer16_TTJets_powheg_fsrdown" : 155 435 656.000000,
"MC2016_Summer16_TTJets_powheg_fsrup"   : 152 617 579.000000,
"MC2016_Summer16_TTJets_powheg_isrdown" : 148 524 168.000000,
"MC2016_Summer16_TTJets_powheg_isrup"   : 156 469 815.000000,
"MC2016_Summer16_TTJets_powheg_CUETP8M2T4down" : 58 338 240.000000,
"MC2016_Summer16_TTJets_powheg_CUETP8M2T4up"   : 58 953 660.000000,
"MC2016_Summer16_TTJets_powheg_hdampDOWN" : 58 010 008.000000,
"MC2016_Summer16_TTJets_powheg_hdampUP" : 58 858 606.000000,
"MC2016_Summer16_TTJets_powheg" : 77 081 156.000000,

also:

$ das_client --limit 0 --query="summary dataset=/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/RunIISummer16MiniAODv2-PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/MINIAODSIM"
[{"file_size":3403800067777,"nblocks":54,"nevents":77081156,"nfiles":982,"nlumis":481156,"num_block":54,"num_event":77081156,"num_file":982,"num_lumi":481156}]

%BLUE% >> The datasets are in the Table 2 of the analysis note under the name "tt modeling systematics": /TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/RunIISummer16MiniAODv2-PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV*/MINIAODSIM etc -- including the extra datasets (ext1, ext2 etc). The number of events is stored for the control of normalization to the luminosity: FSR Down has 155.4 10^6 events and Up is 152.6 Mevents, ISR Down 148.5 Mevents and Up 156.4 M, the underlying event (Tune variation, /TT_TuneCUETP8M2T4down_13TeV-powheg-pythia8/*/*) Down 58.3 Mevents and Up 58.9 Mevents, ME-PS matching (hdamp parameter, /TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8/*) Down 58 Mevents and Up 58.8 Mevents. The nominal dataset has 77.1 Mevents (/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/RunIISummer16MiniAODv2-PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/MINIAODSIM).



# couple plots for poster phd open days

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -o plots/v37_test5_bunch2_mc_tests2/  -c mu_sel --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05 --no-data-plot --title "" --title-x "lepton p_{T} [GeV]" --y-range 0,3000



# v37 test5 issues, round2

the remaining issues


## dy trends at high met

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c dy_mumu --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c dy_elel --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- normalization is good in mumu, data -10% in elel
   the trend is not as bad as it was, the data rises above MC at 50-100GeV then falls below MC after 140-150GeV

CLUE
the trend could be due to wrong recoil corrections, Z mass-pt corrections or lepton SFs
the normalization in elel is strange, maybe the el weights are not properly applied?

CHECK how the lepton SF-s are calculated, trigger and reco --- is it the exclusive formula or just the SF of leading lepton?
-- exactly so.
   TODO: implement the exclusive function for the trigger, the reco is per-particle.

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c dy_elel --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- strange trend

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c dy_mumu --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- also trend, a bit more MC in endcaps...


## wjets



## shape at tt_elmu

checked: no effect from TOPPT --- the systematic was not applied for elmu

SingleMuon -- data at 0.90-0.95 of MC
SingleElectron agreement -- ok:
INFO:root:197779.0
INFO:root:mc sum     =   193056.431785   193056.431785

both -- the same shape disagreement down for particular bins (probably mostly the same events in MC and Data)
        Data peaks more at 70GeV
        also some outlier bin at 200GeV

check where it comes from: lep_pt, lep_eta, met_pt or phi

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c tt_elmu --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c tt_elmu --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c tt_elmu --data-nick data_other -d met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c tt_elmu --data-nick data_other -d Mt_lep_met_c   --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- slight trend in pT, data>MC at low values
   some deviations in eta (center is close, sides vary, may be due to pT)
   trend in met, data>MC at low values

in SingleMuon the normalization is 0.95 off:
35800 * 0.95 = 34010.0

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c tt_elmu --data-nick data_other -d lep_pt  --lumi 34010.0 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c tt_elmu --data-nick data_other -d lep_eta --lumi 34010.0 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c tt_elmu --data-nick data_other -d met_c   --lumi 34010.0 --overwrite --wjets 0.92 --qcd-factor 2.5

-- strange variation at low pT, data < MC at the smallest bins, then rises and falls
   weird variations in eta, wrong separate bins
   the trend in met is smaller than in Electron case, similar to lep pT

I don't have phi in tt_elmu -- added it in std_def

Check the pass_elmu events are not in PASSES -- YES, they are not there, only elmu_el.

[So, it seems that:
SingleMuon normalization is due to no muon HLT SF or whatever (and the electron HLT SF is too small??)
the electron deviations can be due to wrong lepton SF-s for the channel?]

The selection requires only leptons. And the deviation looks like an issue with lepton SFs.
But lepton SFs seem to be correctly calculated. Is something false or is there an unexpected effect?

Maybe just increase pT cuts to 30GeV as it was before?
(The low pT cut is needed for the ratio.)



### Check the effect of weights on the shapes in TT.

python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210)" --histo-range 100,0.,200. --output test_tt_elmu_lep_pt_init.root --histo-name tt_elmu_lep_pt_init lstore_outdirs/v37/test5/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight"      --histo-range 100,0.,200. --output test_tt_elmu_lep_pt_weight.root --histo-name tt_elmu_lep_pt_weight lstore_outdirs/v37/test5/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_init" --histo-range 100,0.,200. --output test_tt_elmu_lep_pt_weight_init.root --histo-name tt_elmu_lep_pt_weight_init lstore_outdirs/v37/test5/MC2016_Summer16_TTJets_powheg/*root &
python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_PU"   --histo-range 100,0.,200. --output test_tt_elmu_lep_pt_PU.root  --histo-name tt_elmu_lep_pt_PU lstore_outdirs/v37/test5/MC2016_Summer16_TTJets_powheg/*root        &
python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_LEP"  --histo-range 100,0.,200. --output test_tt_elmu_lep_pt_LEP.root --histo-name tt_elmu_lep_pt_LEP lstore_outdirs/v37/test5/MC2016_Summer16_TTJets_powheg/*root       &
python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_bSF"  --histo-range 100,0.,200. --output test_tt_elmu_lep_pt_bSF.root --histo-name tt_elmu_lep_pt_bSF lstore_outdirs/v37/test5/MC2016_Summer16_TTJets_powheg/*root       &

new batch:

python sumup_ttree_draw.py "event_leptons[0].pt()" --ttree ttree_out --cond-com "(selection_stage_em > 200 && selection_stage_em < 210) * event_weight_bSF"  --histo-range 100,0.,200. --output test_tt_elmu_lep_pt_bSF.root --histo-name tt_elmu_lep_pt_bSF lstore_outdirs/v37/test5/MC2016_Summer16_TTJets_powheg/*root       &

hadd test_tt_elmu_lep_pt.root test_tt_elmu_lep_pt_*.root

normalize them first

tt_elmu_lep_pt_init->Scale(1./tt_elmu_lep_pt_init->Integral())

tt_elmu_lep_pt_weight      ->Scale(1./tt_elmu_lep_pt_weight      ->Integral())
tt_elmu_lep_pt_weight_init ->Scale(1./tt_elmu_lep_pt_weight_init ->Integral())
tt_elmu_lep_pt_PU          ->Scale(1./tt_elmu_lep_pt_PU          ->Integral())
tt_elmu_lep_pt_LEP         ->Scale(1./tt_elmu_lep_pt_LEP         ->Integral())
tt_elmu_lep_pt_bSF         ->Scale(1./tt_elmu_lep_pt_bSF         ->Integral())

tt_elmu_lep_pt_weight      ->Divide(tt_elmu_lep_pt_init)
tt_elmu_lep_pt_weight_init ->Divide(tt_elmu_lep_pt_init)
tt_elmu_lep_pt_PU          ->Divide(tt_elmu_lep_pt_init)
tt_elmu_lep_pt_LEP         ->Divide(tt_elmu_lep_pt_init)
tt_elmu_lep_pt_bSF         ->Divide(tt_elmu_lep_pt_init)


l = TLine(20, 1, 200, 1)

tt_elmu_lep_pt_weight      ->Draw()
tt_elmu_lep_pt_weight      ->Draw() ; l.Draw("same") ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/shape_effect_on_lep_pt_from_weight.png")
tt_elmu_lep_pt_weight_init ->Draw() ; l.Draw("same") ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/shape_effect_on_lep_pt_from_weight_init.png")
tt_elmu_lep_pt_PU          ->Draw() ; l.Draw("same") ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/shape_effect_on_lep_pt_from_PU.png")
tt_elmu_lep_pt_LEP         ->Draw() ; l.Draw("same") ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/shape_effect_on_lep_pt_from_LEP.png")
tt_elmu_lep_pt_bSF         ->Draw() ; l.Draw("same") ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/shape_effect_on_lep_pt_from_bSF.png")

-- weight_init = weight_LEP
   bSF and PU have no shape effect
   PU introduces fluctuations
   it seems all of the trend in the final weight comes from the LEP weight and it is a small trend (1% max difference)

the value and uncertainty of the ele trigger SF for eta 2.1 and pT 30.1:
(0.8545982188646293, 0.02278517998528972)

-- it must have significant trend

sadly lep_pt is the leading lepton, not electron or muon
hard to track the effect of ele trigger on this lepton

let's check the validity of lep SF-s

python module_leptons.py gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root

python module_leptons.py --ele-trig-sfs foobar baz

-3.1 61.1 (0.9391737191937336, 0.03101668747740288)
-2.5 25.1 (0.3182096440770343, 0.01675800726039388)
-2.5 35.1 (0.9870918044555792, 0.024854905029802938)
-2.1 25.1 (0.3182096440770343, 0.01675800726039388)
-2.1 30.1 (0.931876824646139, 0.026106390447890433)
2.1 30.1 (0.8545982188646293, 0.02278517998528972)
2.1 31.1 (0.8545982188646293, 0.02278517998528972)
2.1 32.1 (0.9036779514758191, 0.023731428655587417)
2.1 35.1 (0.939636748350896, 0.02335939860380816)
2.1 40.1 (0.9634999131371064, 0.025688183696168234)
2.1 61.1 (0.9621277522412025, 0.028876244205443238)
2.1 100.1 (0.9476371244059494, 0.027980091928502163)
2.4 15.1 (0.23403082992002794, 0.01074516165424302)
2.4 31.1 (0.8545982188646293, 0.02278517998528972)
2.5 32.1 (0.0, 0.0)
3.1 40.1 (0.9634999131371064, 0.025688183696168234)

-- weird

electron_effs_dirname = "${CMSSW_BASE}/src/UserCode/NtuplerAnalyzer/analysis/electron-effs"

electron_effs_tracking_all_file  = TFile(electron_effs_dirname + "/2016_Sept23_ElectronReconstructionSF_egammaEffi.txt_EGM2D.root")
electron_effs_tracking_all_histo = electron_effs_tracking_all_file.Get("EGamma_SF2D")
logging.info("Y tracking (reconstruction)")

electron_effs_id_all_file  = TFile(electron_effs_dirname + "/2016_Sept23_ElectronID_TightCutBased_egammaEffi.txt_EGM2D.root")
electron_effs_id_all_histo = electron_effs_id_all_file.Get("EGamma_SF2D")
logging.info("Y id")

electron_effs_trg_all_file  = TFile(electron_effs_dirname + "/2016_03Feb_TriggerSF_Run2016All_v1.root")
electron_effs_trg_all_histo = electron_effs_trg_all_file.Get("Ele27_WPTight_Gsf")

root -l ../analysis/electron-effs//2016_03Feb_TriggerSF_Run2016All_v1.root
Ele27_WPTight_Gsf->Draw("colz")

-- eta is on Y, pT is on X (might be reverted by ROOT later on anyway!)
   looks like:
   eta is both + and -, 2.5 max
   pT is from 25 to 200

check:
ele trg SF histo X max 200.0
ele trg SF histo X min 25.0
ele trg SF histo Y max 2.5

root [3] Ele27_WPTight_Gsf->FindBin(32.1, 2.5)
(Int_t) 487
root [4] Ele27_WPTight_Gsf->GetBinContent(487)
(Double_t) 0.00000

idiotic root cannot find neither bin's center nor X or Y of the bin in 2D histogram.......

root [5] Ele27_WPTight_Gsf->FindBin(32.1, 2.4)
(Int_t) 464
root [6] Ele27_WPTight_Gsf->GetBinContent(464)
(Double_t) 0.903678

root [7] Ele27_WPTight_Gsf->FindBin(32.1, 2.499999)
(Int_t) 464

root [8] Ele27_WPTight_Gsf->FindBin(25.1, -2.5)
(Int_t) 24
root [9] Ele27_WPTight_Gsf->GetBinContent(24)
(Double_t) 0.318210

root [11] Ele27_WPTight_Gsf->FindBin(25.1, -2.45)
(Int_t) 24


ok, with <= and >=:

python module_leptons.py --ele-trig-sfs foobar baz
-3.1 61.1 (0.9391737191937336, 0.03101668747740288)
-2.5 25.1 (0.3182096440770343, 0.01675800726039388)
-2.5 35.1 (0.9870918044555792, 0.024854905029802938)
-2.1 25.1 (0.3182096440770343, 0.01675800726039388)
-2.1 30.1 (0.931876824646139, 0.026106390447890433)
2.1 30.1 (0.8545982188646293, 0.02278517998528972)
2.1 31.1 (0.8545982188646293, 0.02278517998528972)
2.1 32.1 (0.9036779514758191, 0.023731428655587417)
2.1 35.1 (0.939636748350896, 0.02335939860380816)
2.1 40.1 (0.9634999131371064, 0.025688183696168234)
2.1 61.1 (0.9621277522412025, 0.028876244205443238)
2.1 100.1 (0.9476371244059494, 0.027980091928502163)
2.4 15.1 (0.23403082992002794, 0.01074516165424302)
2.4 31.1 (0.8545982188646293, 0.02278517998528972)
2.5 32.1 (0.9036779514758191, 0.023731428655587417)
3.1 40.1 (0.9634999131371064, 0.025688183696168234)

-- still, at 30 GeV 2.1 eta has 0.85

like this:

-2.5 30.1 (0.931876824646139, 0.026106390447890433)
-2.4 30.1 (0.931876824646139, 0.026106390447890433)
-2.1 30.1 (0.931876824646139, 0.026106390447890433)
-1.1 30.1 (0.9618506052509189, 0.022658433572678757)
-0.1 30.1 (0.8669059088953605, 0.02201838722232047)
0.1 30.1 (0.8602315645085271, 0.021130975907428885)
1.1 30.1 (0.8546475205348963, 0.02197919296415359)
2.1 30.1 (0.8545982188646293, 0.02278517998528972)
2.4 30.1 (0.8545982188646293, 0.02278517998528972)
2.5 30.1 (0.8545982188646293, 0.02278517998528972)

-- should be noticeable in eta too!


### pass_elmu_el has no gap in electron eta

can it be the cause of anything?

it's not electron eta, it's the leading lepton!


### are the electron and muon reconstruction really independent?

Yes, it is a logical AND, both of them must pass the ID. And only the electron must pass the electron HLT.
(The probability for muon to pass the electron HLT is negligible.)


### THE ASYMETRIC ELE TRIGGER SF

                el_trg_sf, el_trg_unc  = lepton_electron_trigger_SF(abs(ev.lep_p4[el_n].eta()), ev.lep_p4[el_n].pt())

-- but the histo is noticeably assymetric!!

1. check other histos, add to tests
2. separate el and mu in elmu channel

check lep eta in single-lepton channels: tau-electron, tau-muon

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c el_sel --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c el_sel --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- ele eta seems ok,
   maybe somewhat more data at -2.5 eta than MC (which is as expected from the SF : the SF is larger at negative eta)
   the shape seems worse at positive values..

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_sel --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_sel --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- mu eta looks ok, the shape and normalization is the same at negative and positive values

proceed as:
add the printout test of lep SFs
correct abs eta

electron id (reco and id) at |eta| >= 2.5
-3.1 61.1 0.0 +- 0.0 0.0 +- 0.0
-2.5 25.1 1.31760430336 +- 0.0182387273858 0.88245934248 +- 0.0101198259436
2.5 32.1 0.0 +- 0.0 0.0 +- 0.0
3.1 40.1 0.0 +- 0.0 0.0 +- 0.0

 -- there is a mistake, it does not check the eta
there is a comment:
    # TODO: check this eta doesn't need defaults for overflow values (in principle our cuts on eta are smaller than these SF histos)
-- indeed, but let's check anyway

ok, now there are:
-3.1 61.1 1.31760430336 +- 0.0182387273858 0.940397322178 +- 0.00700136278822
-2.5 25.1 1.31760430336 +- 0.0182387273858 0.88245934248 +- 0.0101198259436
-2.5 35.1 1.31760430336 +- 0.0182387273858 0.918840587139 +- 0.00903908258991

norice, eta range:
-2.5 30.1 1.31760430336 +- 0.0182387273858 0.88245934248 +- 0.0101198259436
-2.4 30.1 1.02462530136 +- 0.00815834887034 0.88245934248 +- 0.0101198259436
-2.1 30.1 1.00727653503 +- 0.00420281345299 0.88245934248 +- 0.0101198259436
-1.1 30.1 0.985655725002 +- 0.00506368027448 0.972039461136 +- 0.013293087796
-0.1 30.1 0.980432569981 +- 0.00530156031977 0.952998399734 +- 0.0150816442813
0.1 30.1 0.984552025795 +- 0.00530156031977 0.981996715069 +- 0.0150816442813
1.1 30.1 0.987742602825 +- 0.00506368027448 0.975206613541 +- 0.013293087796
2.1 30.1 0.99794024229 +- 0.00420281345299 0.863321781158 +- 0.0101198259436
2.4 30.1 0.970518887043 +- 0.0110667218714 0.863321781158 +- 0.0101198259436
2.5 30.1 0.906666696072 +- 0.0182387273858 0.863321781158 +- 0.0101198259436

multiple issues with muons

muon trigger:

2.1 61.1 0.943909108639 +- 0.00430392554133 0.962784349918 +- 0.00424436726426
2.1 100.1 0.943909108639 +- 0.00430392554133 0.962784349918 +- 0.00424436726426
2.4 15.1 0.0 +- 0.002 0.0 +- 0.002
2.4 31.1 0.0 +- 0.002 0.0 +- 0.002
2.5 32.1 0.941213190556 +- 0.00241833622395 0.948634445667 +- 0.00245238681745

-2.5 30.1 0.978400230408 +- 0.00202590423906 0.991047501564 +- 0.00202767096067
-2.4 30.1 0.978400230408 +- 0.00202590423906 0.991047501564 +- 0.00202767096067
-2.1 30.1 0.978400230408 +- 0.00202590423906 0.991047501564 +- 0.00202767096067
-1.1 30.1 0.978400230408 +- 0.00202590423906 0.991047501564 +- 0.00202767096067
-0.1 30.1 0.978400230408 +- 0.00202590423906 0.991047501564 +- 0.00202767096067
0.1 30.1 0.978400230408 +- 0.00202590423906 0.991047501564 +- 0.00202767096067
1.1 30.1 0.961095392704 +- 0.00207871487016 0.971895813942 +- 0.00208252931936
2.1 30.1 0.941213190556 +- 0.00241833622395 0.948634445667 +- 0.00245238681745
2.4 30.1 0.0 +- 0.002 0.0 +- 0.002
2.5 30.1 0.941213190556 +- 0.00241833622395 0.948634445667 +- 0.00245238681745

-- why 2.4 eta = 0 but 2.5 is ok? probably 2.4 is exactly the maximum in the histo
printout max min
muon effs trg BCDEF (assume the same for GH) 26.0 500.0 0.0 2.4

notice the absolute value of eta -- negative = 0 here

check the histos

root -l ../analysis/muon-effs//2016_23Sep_tracking_more_BCDEF_fits.root
root -l ../analysis/muon-effs//2016_23Sep_MuonID_EfficienciesAndSF_BCDEF.root
root -l ../analysis/muon-effs//2016_23Sep_MuonISO_EfficienciesAndSF_BCDEF.root
root -l ../analysis/muon-effs//2016_23Sep_SingleMuonTrigger_EfficienciesAndSF_RunBtoF.root

ratio_eff_aeta_dr030e030_corr->Draw()
MC_NUM_TightID_DEN_genTracks_PAR_pt_eta->Get("pt_abseta_ratio")->Draw("colz")
TightISO_TightID_pt_eta->Get("pt_abseta_ratio")->Draw("colz")
IsoMu24_OR_IsoTkMu24_PtEtaBins->Get("pt_abseta_ratio")->Draw("colz")

-- all eta are positive
added the abs in SF calculation

no errors in muon tracking:

2.5 30.1 0.96134655248 +- 0.0 0.919699340197 +- 0.0 0.956952119799 +- 0.00509115908882 0.959166377241 +- 0.00540090145917 0.989746861096 +- 0.00211486143671 1.00819018779 +- 0.00211627165029

muon tracking vtx 10
-3.1 61.1 0.923208363711 +- 0.0 0.801800855428 +- 0.0
-2.5 25.1 0.960788514388 +- 0.0 0.919155572246 +- 0.0

-- yeah, the error is set to zero
TGraph does not give out the error?

because this:

        trk_gen_unc_bcdef = muon_effs_tracking_BCDEF_graph.GetErrorY(abs_eta)
    TypeError: double TGraphAsymmErrors::GetErrorY(int bin) =>
        could not convert argument 1

-- leave it 0, check for update

### implement the exclusive trigger SFs

the only queation is how to deal with the uncertainty

let's construct differentials

from this

    mu_trg_sf_b = 1. - (1. - mu_trg_sf_b1)*(1. - mu_trg_sf_b2)

differencials

    = d(mu_trg_sf_b1)(1 - mu_trg_sf_b2) + d(mu_trg_sf_b2)(1 - mu_trg_sf_b1)

mumu DONE
elel DONE

tests... do run... and finish

so, stage2 and then only the dilepton channels to reproduce





## normalization at presel

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c el_presel --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_presel --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c el_presel --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_presel --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- in both Data 20-30% larger than MC, at large lep pT too
   with not clear MC QCD
 ! but at large values of Mt_c clearly not enough tt: 10% in el and 20% in mu (and looks like the signal is too large, lj is too small)
   and different proportions in lj, ljout: 10-20% in lj, 40-50% in ljout

Small amount of QCD at large lep pT, MET and mT -- but still the same factor of disagreement.
Especially in the case of MET: most of the range of large MET values if ttbar->lepton+jets and the same disagreement.
Therefore it is not due to lack of QCD...

If preselCand is ok, then the whole difference is due to events which have no tau candidates.


### Are there really so many of presel events with no tau candidates

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_presel     --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_preselCand --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

INFO:root:2248861.0
INFO:root:mc sum     =  2007311.595863  2007311.595863

INFO:root:839131.0
INFO:root:mc sum     =   827958.280560   827958.280560

2.25 VS 0.84

count in data

python sumup_ttree_draw.py "2" --ttree ttree_out --cond-com "selection_stage_presel > 1 && selection_stage_presel < 10" --histo-range 5,0.,5. --output test_presel_events_all.root --histo-name presel_events_all lstore_outdirs/v37/test5/Data13TeV_SingleMuon2016*/*root &
python sumup_ttree_draw.py "2" --ttree ttree_out --cond-com "selection_stage_presel == 5" --histo-range 5,0.,5. --output test_presel_events_5.root --histo-name presel_events_5 lstore_outdirs/v37/test5/Data13TeV_SingleMuon2016*/*root  &
python sumup_ttree_draw.py "2" --ttree ttree_out --cond-com "selection_stage_presel == 6" --histo-range 5,0.,5. --output test_presel_events_6.root --histo-name presel_events_6 lstore_outdirs/v37/test5/Data13TeV_SingleMuon2016*/*root  &
python sumup_ttree_draw.py "2" --ttree ttree_out --cond-com "selection_stage_presel == 7" --histo-range 5,0.,5. --output test_presel_events_7.root --histo-name presel_events_7 lstore_outdirs/v37/test5/Data13TeV_SingleMuon2016*/*root  &
python sumup_ttree_draw.py "2" --ttree ttree_out --cond-com "selection_stage_presel == 8" --histo-range 5,0.,5. --output test_presel_events_8.root --histo-name presel_events_8 lstore_outdirs/v37/test5/Data13TeV_SingleMuon2016*/*root  &
python sumup_ttree_draw.py "2" --ttree ttree_out --cond-com "selection_stage_presel == 9" --histo-range 5,0.,5. --output test_presel_events_9.root --histo-name presel_events_9 lstore_outdirs/v37/test5/Data13TeV_SingleMuon2016*/*root  &

hadd test_presel_events.root test_presel_events_*.root

presel_events_all->Integral()
presel_events_5 ->Integral()
presel_events_6 ->Integral()
presel_events_7 ->Integral()
presel_events_8 ->Integral()
presel_events_9 ->Integral()

(Double_t) 2.27412e+06
root [3] presel_events_5 ->Integral()
(Double_t) 739643.
root [4] presel_events_6 ->Integral()
(Double_t) 4452.00
root [5] presel_events_7 ->Integral()
(Double_t) 5325.00
root [6] presel_events_8 ->Integral()
(Double_t) 674141.
root [7] presel_events_9 ->Integral()
(Double_t) 850556.

indeed a third has no tau candidates



### kinematics of the selection: leptons and jets

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c el_presel --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_presel --data-nick data_other -d lep_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c el_presel --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_presel --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c el_presel --data-nick data_other -d bjet_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_presel --data-nick data_other -d bjet_pt  --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c el_presel --data-nick data_other -d bjet_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_presel --data-nick data_other -d bjet_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- no particular gaps or trends..

I do not have the other jets...


### not enough MC at large mT

build fractions

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c el_presel --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5 --cumulative-fractions
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_presel --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5 --cumulative-fractions

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c el_presel --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5 --cumulative-fractions
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_presel --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5 --cumulative-fractions

-- strangely at large mT, tt->lj fraction is smaller than tt->ltau and tt->other???

fractions with cands:

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c el_preselCand --data-nick data_other -d Mt_lep_met_c2 --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5 --cumulative-fractions
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_preselCand --data-nick data_other -d Mt_lep_met_c2 --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5 --cumulative-fractions

-- same or larger amount of "other" ttbar processes

and the original shapes were not in the test (!):

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c el_preselCand --data-nick data_other -d Mt_lep_met_c2 --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_preselCand --data-nick data_other -d Mt_lep_met_c2 --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c el_preselCand --data-nick data_other -d Mt_lep_met_f --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_preselCand --data-nick data_other -d Mt_lep_met_f --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- could be better, but actually within MC stat uncertainty, very unreliable MC QCD

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c el_preselCand --data-nick data_other -d Mt_lep_met_c2 --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_preselCand --data-nick data_other -d Mt_lep_met_c2 --lumi 35800 --overwrite --wjets 0.92 --qcd 1.05

-- perfect, but the QCD shape is questionable

I had an old set of presel plots with very good stats, without this strange MC QCD.
Was it just ext QCD sets?


build njets and nbjets

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c el_presel --data-nick data_other -d nbjets --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_presel --data-nick data_other -d nbjets --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c el_presel --data-nick data_other -d nrjets --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_presel --data-nick data_other -d nrjets --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

some events have 0 b jets (tau-clean), some have 0-1 rjets
overall 10% more data, shape is not conclusive



build met in presel (maybe the old cut 40GeV fixes everything?)

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c el_presel --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_presel --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- no, at high and low met the same factor of disagreement

check fractions

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c el_presel --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5 --cumulative-fractions
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_presel --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5 --cumulative-fractions

-- !!! practically no QCD and ttbar->ljets at large values !!!

really small amount of W+jets..

mu_preselCand has slightly less W+jets than ctr_old_mu_presel v25v26pR4 and 100/120 less events overall


#### check the tt processes at mT > 200 at presel

'mu_presel':          (lambda sel_stage, ev: (sel_stage >  1 and sel_stage < 10), main_presel_stages),

python sumup_ttree_draw.py "gen_proc_id" --ttree ttree_out --cond-com "selection_stage_presel > 1 && selection_stage_presel < 10 && event_met_lep_mt >  200" --histo-range 50,0.,50. --output test_tt_procs_mu_presel_mT_large.root --histo-name tt_procs_mu_presel_mT_large lstore_outdirs/v37/test5/MC2016_Summer16_TT*/*root &
python sumup_ttree_draw.py "gen_proc_id" --ttree ttree_out --cond-com "selection_stage_presel > 1 && selection_stage_presel < 10 && event_met_lep_mt <= 200" --histo-range 50,0.,50. --output test_tt_procs_mu_presel_mT_small.root --histo-name tt_procs_mu_presel_mT_small lstore_outdirs/v37/test5/MC2016_Summer16_TT*/*root &

hadd test_tt_procs_mu_presel.root test_tt_procs_mu_presel_mT_*.root

root [3] tt_procs_mu_presel_mT_large->GetBinContent(1+0)
(Double_t) 6110.00
root [4] tt_procs_mu_presel_mT_large->GetBinContent(1+1)
(Double_t) 41.0000
root [5] tt_procs_mu_presel_mT_large->GetBinContent(1+2)
(Double_t) 2501.00
root [6] tt_procs_mu_presel_mT_large->GetBinContent(1+3)
(Double_t) 6397.00

6110.00   genproc_tt_other = ttbar -> jets?
6397.00   elmu

-- but ttbar->jets should have absolutely small MET, why does it have large mT?

check if veto leptons work?

python sumup_ttree_draw.py "no_iso_veto_leps" --histo-range 5,0.,5. --output test_tt_ntuples_no_iso_veto_leps.root --histo-name tt_ntuples_no_iso_veto_leps gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/*root

it works, 897681. VS 1.63435e+07 events do not pass


### not enough MC QCD?

ls lstore_outdirs/v37/test5/

MC2016_Summer16_QCD_HT-100-200
MC2016_Summer16_QCD_HT-1000-1500
MC2016_Summer16_QCD_HT-1500-2000
MC2016_Summer16_QCD_HT-200-300
MC2016_Summer16_QCD_HT-2000-Inf
MC2016_Summer16_QCD_HT-300-500
MC2016_Summer16_QCD_HT-500-700
MC2016_Summer16_QCD_HT-700-1000

foreach dt (`cat testfile `)
ls lstore_outdirs/v37/test5/$dt/*root | wc -l
end

foreach dt (`cat testfile `)
ls lstore_outdirs/v25/resub4/$dt/*root | wc -l
end

73
9
8
18
4
20
21
19

73
9
8
18
4
20
21
19

lstore_outdirs/v35/pQCDtest/ has QCD ext?

lstore_outdirs/v35/pQCDtest/MC2016_Summer16_QCD_HT-100-200         
lstore_outdirs/v35/pQCDtest/MC2016_Summer16_QCD_HT-1000-1500       
lstore_outdirs/v35/pQCDtest/MC2016_Summer16_QCD_HT-1000-1500_ext1  
lstore_outdirs/v35/pQCDtest/MC2016_Summer16_QCD_HT-1500-2000       
lstore_outdirs/v35/pQCDtest/MC2016_Summer16_QCD_HT-1500-2000_ext1  
lstore_outdirs/v35/pQCDtest/MC2016_Summer16_QCD_HT-200-300         
lstore_outdirs/v35/pQCDtest/MC2016_Summer16_QCD_HT-200-300_ext1    
lstore_outdirs/v35/pQCDtest/MC2016_Summer16_QCD_HT-2000-Inf        
lstore_outdirs/v35/pQCDtest/MC2016_Summer16_QCD_HT-2000-Inf_ext1
lstore_outdirs/v35/pQCDtest/MC2016_Summer16_QCD_HT-300-500
lstore_outdirs/v35/pQCDtest/MC2016_Summer16_QCD_HT-300-500_ext1
lstore_outdirs/v35/pQCDtest/MC2016_Summer16_QCD_HT-50-100
lstore_outdirs/v35/pQCDtest/MC2016_Summer16_QCD_HT-500-700
lstore_outdirs/v35/pQCDtest/MC2016_Summer16_QCD_HT-500-700_ext1
lstore_outdirs/v35/pQCDtest/MC2016_Summer16_QCD_HT-700-1000
lstore_outdirs/v35/pQCDtest/MC2016_Summer16_QCD_HT-700-1000_ext1

ok, and weights?

root -l jobsums/mc_norm/v37_test5_bunch2/MC2016_Summer16_QCD_HT-100-200.root

python check_gen_lumi_weights.py jobsums/mc_norm/v37_test5_bunch2/MC2016_Summer16_QCD_HT-*

"MC2016_Summer16_QCD_HT-1500-2000" : 4025637.189128,
"MC2016_Summer16_QCD_HT-100-200"   : 80668282.010224,
"MC2016_Summer16_QCD_HT-200-300"   : 18982179.906991,
"MC2016_Summer16_QCD_HT-700-1000"  : 15846448.822448,
"MC2016_Summer16_QCD_HT-2000-Inf"  : 2019120.954068,
"MC2016_Summer16_QCD_HT-500-700"   : 19192242.333873,
"MC2016_Summer16_QCD_HT-1000-1500" : 4831794.914995,
"MC2016_Summer16_QCD_HT-300-500"   : 17273854.173847,

python check_gen_lumi_weights.py lstore_outdirs/v37/test5/MC2016_Summer16_QCD_HT-*/*root

"MC2016_Summer16_QCD_HT-1500-2000" : 4025637.189128,
"MC2016_Summer16_QCD_HT-100-200"   : 80668282.010224,
"MC2016_Summer16_QCD_HT-200-300"   : 18982179.906991,
"MC2016_Summer16_QCD_HT-700-1000"  : 15846448.822448,
"MC2016_Summer16_QCD_HT-2000-Inf"  : 2019120.954068,
"MC2016_Summer16_QCD_HT-500-700"   : 19192242.333873,
"MC2016_Summer16_QCD_HT-1000-1500" : 4831794.914995,
"MC2016_Summer16_QCD_HT-300-500"   : 17273854.173847,


### drastic issues with b SFs? (QCD is light flavoured and must be weighted up)

check if weights work

python sumup_ttree_draw.py --debug "event_weight" --ttree ttree_out --histo-range 100,0.,2. --output test_ev_weights_$weight.root --histo-name ev_weight_$weight lstore_outdirs/v37/test5/MC2016_Summer16_QCD_HT-*/*root

foreach weight ( event_weight event_weight_init event_weight_PU event_weight_PU_el event_weight_PU_mu event_weight_th event_weight_bSF event_weight_bSFUp event_weight_bSFDown event_weight_bSF_JERUp event_weight_bSF_JERDown event_weight_bSF_JESUp event_weight_bSF_JESDown event_weight_toppt event_weight_LEPall event_weight_LEP event_weight_LEPmuIDUp event_weight_LEPmuIDDown event_weight_LEPmuTRGUp event_weight_LEPmuTRGDown event_weight_LEPelIDUp event_weight_LEPelIDDown event_weight_LEPelTRGUp event_weight_LEPelTRGDown event_weight_PUUp event_weight_PUDown event_weight_PUUp_el event_weight_PUDown_el event_weight_PUUp_mu event_weight_PUDown_mu)
echo "$weight"
python sumup_ttree_draw.py "$weight" --ttree ttree_out --histo-range 100,0.,2. --output test_ev_weights_$weight.root --histo-name ev_weight_$weight lstore_outdirs/v37/test5/MC2016_Summer16_QCD_HT-*/*root
end

for ttbar:

foreach weight ( event_weight event_weight_init event_weight_PU event_weight_PU_el event_weight_PU_mu event_weight_th event_weight_bSF event_weight_bSFUp event_weight_bSFDown event_weight_bSF_JERUp event_weight_bSF_JERDown event_weight_bSF_JESUp event_weight_bSF_JESDown event_weight_toppt event_weight_LEPall event_weight_LEP event_weight_LEPmuIDUp event_weight_LEPmuIDDown event_weight_LEPmuTRGUp event_weight_LEPmuTRGDown event_weight_LEPelIDUp event_weight_LEPelIDDown event_weight_LEPelTRGUp event_weight_LEPelTRGDown event_weight_PUUp event_weight_PUDown event_weight_PUUp_el event_weight_PUDown_el event_weight_PUUp_mu event_weight_PUDown_mu)
echo "$weight"
python sumup_ttree_draw.py "$weight" --ttree ttree_out --histo-range 100,0.,2. --output test_ev_weights_$weight.root --histo-name ev_weight_$weight lstore_outdirs/v37/test5/MC2016_Summer16_TT*/*root
end

hadd test_ev_weights.root test_ev_weights_*root

ev_weight_event_weight->Draw()              ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight.png")
ev_weight_event_weight_LEP->Draw()          ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_LEP.png")
ev_weight_event_weight_LEPall->Draw()       ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_LEPall.png")
ev_weight_event_weight_LEPelIDDown->Draw()  ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_LEPelIDDown.png")
ev_weight_event_weight_LEPelIDUp->Draw()    ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_LEPelIDUp.png")
ev_weight_event_weight_LEPelTRGDown->Draw() ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_LEPelTRGDown.png")
ev_weight_event_weight_LEPelTRGUp->Draw()   ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_LEPelTRGUp.png")
ev_weight_event_weight_LEPmuIDDown->Draw()  ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_LEPmuIDDown.png")
ev_weight_event_weight_LEPmuIDUp->Draw()    ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_LEPmuIDUp.png")
ev_weight_event_weight_LEPmuTRGDown->Draw() ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_LEPmuTRGDown.png")
ev_weight_event_weight_LEPmuTRGUp->Draw()   ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_LEPmuTRGUp.png")
ev_weight_event_weight_PU->Draw()           ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_PU.png")
ev_weight_event_weight_PUDown->Draw()       ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_PUDown.png")
ev_weight_event_weight_PUDown_el->Draw()    ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_PUDown_el.png")
ev_weight_event_weight_PUDown_mu->Draw()    ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_PUDown_mu.png")
ev_weight_event_weight_PUUp->Draw()         ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_PUUp.png")
ev_weight_event_weight_PUUp_el->Draw()      ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_PUUp_el.png")
ev_weight_event_weight_PUUp_mu->Draw()      ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_PUUp_mu.png")
ev_weight_event_weight_PU_el->Draw()        ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_PU_el.png")
ev_weight_event_weight_PU_mu->Draw()        ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_PU_mu.png")
ev_weight_event_weight_bSF->Draw()          ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_bSF.png")
ev_weight_event_weight_bSFDown->Draw()      ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_bSFDown.png")
ev_weight_event_weight_bSFUp->Draw()        ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_bSFUp.png")
ev_weight_event_weight_bSF_JERDown->Draw()  ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_bSF_JERDown.png")
ev_weight_event_weight_bSF_JERUp->Draw()    ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_bSF_JERUp.png")
ev_weight_event_weight_bSF_JESDown->Draw()  ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_bSF_JESDown.png")
ev_weight_event_weight_bSF_JESUp->Draw()    ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_bSF_JESUp.png")
ev_weight_event_weight_init->Draw()         ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_init.png")
ev_weight_event_weight_th->Draw()           ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_th.png")
ev_weight_event_weight_toppt->Draw()        ; c1->SaveAs("studies/v37_tes5_issues_test_event_weights/ev_weight_event_weight_toppt.png")

all work


## preselCand

perfect with data-driven QCD
needs more MC QCD, but there is not enough data

implemented: add preselCand_lj ljout in std_defs


## main selection

good agreement without Vloose shapes
both el_sel and mu_sel have the same dip at 200GeV mT --- CHECK same as elmu, but in opposite direction: in elmu there is more data than MC, in lep-tau the opposite






# check the yields of new selections

data with all channels:
hadd SingleMuon_all.root SingleMuon.root 1/SingleMuon.root
hadd SingleElectron_all.root SingleElectron.root 1/SingleElectron.root

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon_all.root     -o histosels/v37_test5_bunch2_mc_wjets_amcatnlo/  -c mu_presel       --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 2.0
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon_all.root     -o histosels/v37_test5_bunch2_mc_wjets_amcatnlo/  -c mu_preselCand   --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 2.0
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon_all.root     -o histosels/v37_test5_bunch2_mc_wjets_amcatnlo/  -c mu_presel_lj    --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 2.0
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon_all.root     -o histosels/v37_test5_bunch2_mc_wjets_amcatnlo/  -c mu_presel_ljout --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 2.0

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon_all.root     -o histosels/v37_test5_bunch2_mc_wjets_amcatnlo/  -c wjets_mu --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 2.0
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon_all.root     -o histosels/v37_test5_bunch2_mc_wjets_amcatnlo/  -c dy_mumu --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 2.0
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon_all.root     -o histosels/v37_test5_bunch2_mc_wjets_amcatnlo/  -c tt_elmu --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 2.0

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon_all.root     -o histosels/v37_test5_bunch2_mc_wjets_amcatnlo/  -c mu_sel       --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd 1.05
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon_all.root     -o histosels/v37_test5_bunch2_mc_wjets_amcatnlo/  -c mu_sel_lj    --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd 1.05
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon_all.root     -o histosels/v37_test5_bunch2_mc_wjets_amcatnlo/  -c mu_sel_ljout --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd 1.05


python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron_all.root     -o histosels/v37_test5_bunch2_mc_wjets_amcatnlo/  -c el_presel       --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 2.0
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron_all.root     -o histosels/v37_test5_bunch2_mc_wjets_amcatnlo/  -c el_preselCand   --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 2.0
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron_all.root     -o histosels/v37_test5_bunch2_mc_wjets_amcatnlo/  -c el_presel_lj    --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 2.0
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron_all.root     -o histosels/v37_test5_bunch2_mc_wjets_amcatnlo/  -c el_presel_ljout --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 2.0

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron_all.root     -o histosels/v37_test5_bunch2_mc_wjets_amcatnlo/  -c wjets_el --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 2.0
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron_all.root     -o histosels/v37_test5_bunch2_mc_wjets_amcatnlo/  -c dy_elel --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 2.0

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron_all.root     -o histosels/v37_test5_bunch2_mc_wjets_amcatnlo/  -c el_sel       --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd 1.05
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron_all.root     -o histosels/v37_test5_bunch2_mc_wjets_amcatnlo/  -c el_sel_lj    --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd 1.05
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron_all.root     -o histosels/v37_test5_bunch2_mc_wjets_amcatnlo/  -c el_sel_ljout --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd 1.05



hadd histosels/v37_test5_bunch2_mc_wjets_amcatnlo/HISTOSEL.root histosels/v37_test5_bunch2_mc_wjets_amcatnlo/distrs/*root

python numbers_for_datacard.py histosels/v37_test5_bunch2_mc_wjets_amcatnlo/HISTOSEL.root --data-nick data_other -d lep_pt -c el_presel,el_presel_lj,el_presel_ljout,el_preselCand,el_sel,el_sel_lj,el_sel_ljout -y --sqrt-unc
python numbers_for_datacard.py histosels/v37_test5_bunch2_mc_wjets_amcatnlo/HISTOSEL.root --data-nick data_other -d lep_pt -c mu_presel,mu_presel_lj,mu_presel_ljout,mu_preselCand,mu_sel,mu_sel_lj,mu_sel_ljout -y --sqrt-unc

python numbers_for_datacard.py histosels/v37_test5_bunch2_mc_wjets_amcatnlo/HISTOSEL.root --data-nick data_other -d lep_pt -c el_preselCand,el_sel,el_sel_lj,el_sel_ljout -y --sqrt-unc
python numbers_for_datacard.py histosels/v37_test5_bunch2_mc_wjets_amcatnlo/HISTOSEL.root --data-nick data_other -d lep_pt -c mu_preselCand,mu_sel,mu_sel_lj,mu_sel_ljout -y --sqrt-unc

python numbers_for_datacard.py histosels/v37_test5_bunch2_mc_wjets_amcatnlo/HISTOSEL.root --data-nick data_other -d lep_pt -c wjets_mu,wjets_el,dy_mumu,dy_elel,tt_elmu -y --sqrt-unc



separate:

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron_all.root     -o histosels/v37_test5_bunch2_mc_wjets_amcatnlo/  -c tt_elmu --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 2.0

## results

                                 process   el_presel   el_presel_lj   el_presel_ljout   el_preselCand   el_sel   el_sel_lj   el_sel_ljout
                                tt_eltau   $ 82333 \pm    212 $   $ 29441 \pm    127 $   $ 52892 \pm    170 $   $ 42367 \pm    152 $   $ 12156 \pm     79 $   $  4785 \pm     50 $   $  7371 \pm     61 $
                             tt_taultauh   $  4662 \pm     50 $   $  1622 \pm     30 $   $  3040 \pm     40 $   $  2459 \pm     36 $   $   702 \pm     19 $   $   271 \pm     12 $   $   431 \pm     15 $
                                   tt_lj   $1151752 \pm    791 $   $614933 \pm    578 $   $536819 \pm    540 $   $464148 \pm    503 $   $  5661 \pm     55 $   $  3420 \pm     42 $   $  2242 \pm     34 $
                                tt_taulj   $ 63754 \pm    184 $   $ 34307 \pm    135 $   $ 29447 \pm    125 $   $ 26101 \pm    118 $   $   305 \pm     13 $   $   186 \pm     10 $   $   119 \pm      8 $
                                tt_other   $100376 \pm    234 $   $ 33211 \pm    135 $   $ 67165 \pm    191 $   $ 30797 \pm    130 $   $   248 \pm     12 $   $    93 \pm      7 $   $   156 \pm      9 $
                             s_top_eltau   $   482 \pm     11 $   $   170 \pm      6 $   $   312 \pm      8 $   $  1622 \pm     19 $   $   561 \pm     11 $   $   201 \pm      6 $   $   361 \pm      9 $
                             s_top_other   $  1511 \pm     17 $   $   579 \pm     11 $   $   932 \pm     13 $   $  3242 \pm     26 $   $    67 \pm      4 $   $    28 \pm      2 $   $    39 \pm      3 $
                                s_top_lj   $ 16351 \pm     52 $   $  6437 \pm     35 $   $  9914 \pm     39 $   $ 36653 \pm     88 $   $   412 \pm      9 $   $   197 \pm      6 $   $   215 \pm      6 $
                               dy_tautau   $   467 \pm     44 $   $   152 \pm     26 $   $   315 \pm     38 $   $  1822 \pm     61 $   $   342 \pm     24 $   $   122 \pm     15 $   $   220 \pm     18 $
                                dy_other   $  6018 \pm    260 $   $  2195 \pm    145 $   $  3823 \pm    215 $   $  9845 \pm    185 $   $   105 \pm     14 $   $    29 \pm      7 $   $    75 \pm     12 $
                             wjets_other   $ 36173 \pm   1116 $   $ 10932 \pm    599 $   $ 25240 \pm    942 $   $ 42417 \pm   1195 $   $   219 \pm     60 $   $    58 \pm     31 $   $   161 \pm     58 $
                              wjets_taul   $  2144 \pm    261 $   $   603 \pm     86 $   $  1541 \pm    226 $   $  2610 \pm    277 $   $    36 \pm     20 $   $    11 \pm     11 $   $    25 \pm     23 $
                              wjets_tauh   $   -21 \pm     35 $   $   -12 \pm     12 $   $    -9 \pm     33 $   $    18 \pm     36 $   $     0 \pm      0 $   $     0 \pm      0 $   $     0 \pm      0 $
aaa!
                                mc_resum   1466000.903   734569.140   731431.763   664101.758   20813.163   9399.068   11414.095
                                   total   $1670632 \pm  38496 $   $808720 \pm  24825 $   $861912 \pm  30046 $   $741976 \pm  23915 $   $ 20933 \pm    156 $   $  9444 \pm     97 $   $ 11538 \pm    126 $
                                    data   $1427371 \pm   1206 $   $638531 \pm    805 $   $788840 \pm    898 $   $535968 \pm    740 $   $ 15198 \pm    124 $   $  6702 \pm     82 $   $  8496 \pm     93 $



                                 process   el_preselCand   el_sel   el_sel_lj   el_sel_ljout
                                tt_eltau   $ 42367 \pm    152 $   $ 12156 \pm     79 $   $  4785 \pm     50 $   $  7371 \pm     61 $
                             tt_taultauh   $  2459 \pm     36 $   $   702 \pm     19 $   $   271 \pm     12 $   $   431 \pm     15 $
                                   tt_lj   $464148 \pm    503 $   $  5661 \pm     55 $   $  3420 \pm     42 $   $  2242 \pm     34 $
                                tt_taulj   $ 26101 \pm    118 $   $   305 \pm     13 $   $   186 \pm     10 $   $   119 \pm      8 $
                                tt_other   $ 30797 \pm    130 $   $   248 \pm     12 $   $    93 \pm      7 $   $   156 \pm      9 $
                             s_top_eltau   $  1622 \pm     19 $   $   561 \pm     11 $   $   201 \pm      6 $   $   361 \pm      9 $
                             s_top_other   $  3242 \pm     26 $   $    67 \pm      4 $   $    28 \pm      2 $   $    39 \pm      3 $
                                s_top_lj   $ 36653 \pm     88 $   $   412 \pm      9 $   $   197 \pm      6 $   $   215 \pm      6 $
                               dy_tautau   $  1822 \pm     61 $   $   342 \pm     24 $   $   122 \pm     15 $   $   220 \pm     18 $
                                dy_other   $  9845 \pm    185 $   $   105 \pm     14 $   $    29 \pm      7 $   $    75 \pm     12 $
                             wjets_other   $ 42417 \pm   1195 $   $   219 \pm     60 $   $    58 \pm     31 $   $   161 \pm     58 $
                              wjets_taul   $  2610 \pm    277 $   $    36 \pm     20 $   $    11 \pm     11 $   $    25 \pm     23 $
                              wjets_tauh   $    18 \pm     36 $   $     0 \pm      0 $   $     0 \pm      0 $   $     0 \pm      0 $
                          dibosons_other   $  3158 \pm     36 $   $    84 \pm      6 $   $    26 \pm      3 $   $    58 \pm      5 $
                               qcd_other   $ 74717 \pm  23876 $
aaa!
                                mc_resum   741976.059   20896.761   9424.668   11472.094
                                   total   $741976 \pm  23915 $   $ 20933 \pm    156 $   $  9444 \pm     97 $   $ 11538 \pm    126 $
                                    data   $535968 \pm    740 $   $ 15198 \pm    124 $   $  6702 \pm     82 $   $  8496 \pm     93 $

AN v8:
31.3
    el_presel   el_sel     lj    ljout
mc   (k)  600       14    6.3      7.8
data (k)  595       14    6.1      7.9

* 35.8/31.3

686.262  16.0128  7.20575  8.92141
680.543  16.0128  6.977  9.03578

-- not enough data, but maybe new lumisections are the poorly reconstructed runs

mu 35.8
    presel   sel     lj   ljout
mc     998  24     10.7    13.2
data   987  23.8   10.2    13.5


                                 process   mu_presel   mu_presel_lj   mu_presel_ljout   mu_preselCand   mu_sel   mu_sel_lj   mu_sel_ljout
                                tt_mutau   $123421 \pm    256 $   $ 43769 \pm    153 $   $ 79653 \pm    205 $   $ 63749 \pm    184 $   $ 18731 \pm     97 $   $  7386 \pm     61 $   $ 11345 \pm     75 $
                             tt_taultauh   $  7955 \pm     65 $   $  2810 \pm     39 $   $  5145 \pm     52 $   $  4166 \pm     47 $   $  1197 \pm     24 $   $   466 \pm     15 $   $   732 \pm     19 $
                                   tt_lj   $1720937 \pm    953 $   $915442 \pm    695 $   $805495 \pm    652 $   $691463 \pm    605 $   $  8859 \pm     68 $   $  5312 \pm     53 $   $  3546 \pm     43 $
                                tt_taulj   $109814 \pm    240 $   $ 59046 \pm    176 $   $ 50767 \pm    163 $   $ 44609 \pm    153 $   $   566 \pm     17 $   $   341 \pm     13 $   $   226 \pm     11 $
                                tt_other   $152014 \pm    284 $   $ 50233 \pm    163 $   $101781 \pm    232 $   $ 46385 \pm    157 $   $   405 \pm     15 $   $   150 \pm      9 $   $   255 \pm     12 $
                             s_top_mutau   $   719 \pm     13 $   $   243 \pm      7 $   $   476 \pm     10 $   $  2330 \pm     23 $   $   815 \pm     13 $   $   279 \pm      8 $   $   536 \pm     11 $
                             s_top_other   $  2422 \pm     21 $   $   939 \pm     13 $   $  1482 \pm     16 $   $  5242 \pm     33 $   $   119 \pm      5 $   $    47 \pm      3 $   $    72 \pm      4 $
                                s_top_lj   $ 24433 \pm     62 $   $  9514 \pm     42 $   $ 14918 \pm     46 $   $ 54436 \pm    105 $   $   624 \pm     11 $   $   278 \pm      8 $   $   346 \pm      8 $
                               dy_tautau   $   852 \pm    nan $   $   264 \pm    nan $   $   588 \pm    nan $   $  3117 \pm    nan $   $   659 \pm     33 $   $   212 \pm     19 $   $   447 \pm     28 $
                                dy_other   $  6147 \pm    293 $   $  2132 \pm    168 $   $  4015 \pm    240 $   $  8431 \pm    196 $   $    32 \pm     14 $   $    11 \pm      9 $   $    21 \pm     10 $
                             wjets_other   $ 37637 \pm   1135 $   $ 11598 \pm    621 $   $ 26040 \pm    950 $   $ 63747 \pm   1465 $   $   594 \pm     86 $   $   172 \pm     47 $   $   422 \pm     75 $
                              wjets_taul   $  2237 \pm    290 $   $   402 \pm    159 $   $  1835 \pm    243 $   $  3815 \pm    384 $   $    50 \pm     29 $   $    25 \pm     17 $   $    25 \pm     23 $
                              wjets_tauh   $     0 \pm      0 $   $     0 \pm      0 $   $     0 \pm      0 $   $    13 \pm     12 $   $     0 \pm      0 $   $     0 \pm      0 $   $     0 \pm      0 $
aaa!
                                mc_resum   2188586.949   1096391.135   1092195.814   991502.457   32651.670   14677.332   17974.338
                                   total   $2547211 \pm  57529 $   $1226218 \pm  37951 $   $1320993 \pm  43236 $   $1064444 \pm  14623 $   $ 32830 \pm    193 $   $ 14757 \pm    124 $   $ 18114 \pm    151 $
                                    data   $2248861 \pm   1508 $   $1009647 \pm   1010 $   $1239214 \pm   1120 $   $839131 \pm    922 $   $ 23833 \pm    155 $   $ 10248 \pm    102 $   $ 13585 \pm    117 $


                                 process   mu_preselCand   mu_sel   mu_sel_lj   mu_sel_ljout
                                tt_mutau   $ 63749 \pm    184 $   $ 18731 \pm     97 $   $  7386 \pm     61 $   $ 11345 \pm     75 $
                             tt_taultauh   $  4166 \pm     47 $   $  1197 \pm     24 $   $   466 \pm     15 $   $   732 \pm     19 $
                                   tt_lj   $691463 \pm    605 $   $  8859 \pm     68 $   $  5312 \pm     53 $   $  3546 \pm     43 $
                                tt_taulj   $ 44609 \pm    153 $   $   566 \pm     17 $   $   341 \pm     13 $   $   226 \pm     11 $
                                tt_other   $ 46385 \pm    157 $   $   405 \pm     15 $   $   150 \pm      9 $   $   255 \pm     12 $
                             s_top_mutau   $  2330 \pm     23 $   $   815 \pm     13 $   $   279 \pm      8 $   $   536 \pm     11 $
                             s_top_other   $  5242 \pm     33 $   $   119 \pm      5 $   $    47 \pm      3 $   $    72 \pm      4 $
                                s_top_lj   $ 54436 \pm    105 $   $   624 \pm     11 $   $   278 \pm      8 $   $   346 \pm      8 $
                               dy_tautau   $  3117 \pm    nan $   $   659 \pm     33 $   $   212 \pm     19 $   $   447 \pm     28 $
                                dy_other   $  8431 \pm    196 $   $    32 \pm     14 $   $    11 \pm      9 $   $    21 \pm     10 $
                             wjets_other   $ 63747 \pm   1465 $   $   594 \pm     86 $   $   172 \pm     47 $   $   422 \pm     75 $
                              wjets_taul   $  3815 \pm    384 $   $    50 \pm     29 $   $    25 \pm     17 $   $    25 \pm     23 $
                              wjets_tauh   $    13 \pm     12 $   $     0 \pm      0 $   $     0 \pm      0 $   $     0 \pm      0 $
                          dibosons_other   $  4420 \pm     43 $   $   135 \pm      7 $   $    39 \pm      4 $   $    96 \pm      6 $
                               qcd_other   $ 68521 \pm  14527 $
aaa!
                                mc_resum   1064443.523   32787.163   14716.550   18070.614
                                   total   $1064444 \pm  14623 $   $ 32830 \pm    193 $   $ 14757 \pm    124 $   $ 18114 \pm    151 $
                                    data   $839131 \pm    922 $   $ 23833 \pm    155 $   $ 10248 \pm    102 $   $ 13585 \pm    117 $

-- in data sel is slightly larger than it was:

987469    23801   10251  13550

and that's with a couple jobs still missing!

CLUE
but preselCand is just smaller by 100k -- maybe it's propper b-tau cross-cleaning?

in MC
less wjets and DY (and QCD),
(el) more tt (+42-50%), single top (+19-21%) and      dibosons (+5%)
(mu) more tt (+25-32%), single-top (+5-9%)   and less dibosons (-10%)
-- and el got the +14% of 35.8 / 31.3

CHECK b SF correctness, tt lumi weight (~=0.33?)

                                 process   wjets_mu   wjets_el   dy_mumu   dy_elel   tt_elmu
                                tt_mutau   $ 32865 \pm    138 $   $     2 \pm      1 $   $   123 \pm      8 $   $     0 \pm      0 $   $    66 \pm      6 $
                             tt_taultauh   $  2146 \pm     35 $   $  1276 \pm     27 $   $     8 \pm      2 $   $     7 \pm      2 $   $    10 \pm      2 $
                                   tt_lj   $273005 \pm    398 $   $184328 \pm    332 $   $  1027 \pm     23 $   $   188 \pm     10 $   $   994 \pm     22 $
                                tt_taulj   $ 18474 \pm    103 $   $ 10705 \pm     79 $   $    61 \pm      6 $   $     8 \pm      2 $   $    37 \pm      4 $
                                tt_other   $ 22457 \pm    114 $   $ 36734 \pm    148 $   $149492 \pm    286 $   $ 81592 \pm    215 $   $208288 \pm    330 $
                             s_top_mutau   $  3642 \pm     29 $   $     0 \pm      0 $   $     6 \pm      1 $   $     0 \pm      0 $   $     5 \pm      1 $
                             s_top_other   $  5845 \pm     34 $   $  5921 \pm     36 $   $ 12024 \pm     52 $   $  6723 \pm     40 $   $ 17346 \pm     61 $
                                s_top_lj   $ 63195 \pm    109 $   $ 41229 \pm     90 $   $   224 \pm      6 $   $    43 \pm      3 $   $   201 \pm      6 $
                               dy_tautau   $289075 \pm    713 $   $119330 \pm    469 $   $  8874 \pm    119 $   $  3873 \pm     79 $   $ 13515 \pm    141 $
                                dy_other   $412425 \pm   1369 $   $406981 \pm   1229 $   $16906251 \pm   5079 $   $7573968 \pm   3435 $   $   652 \pm     35 $
                             wjets_other   $5961189 \pm  12723 $   $3565878 \pm  10000 $   $   351 \pm     78 $   $   612 \pm     89 $   $   897 \pm    nan $
                              wjets_taul   $327104 \pm   3018 $   $169609 \pm   2196 $   $     5 \pm     17 $   $    55 \pm     30 $   $    27 \pm     32 $
                              wjets_tauh   $   370 \pm     68 $   $  1625 \pm    nan $   $     0 \pm      0 $   $    12 \pm     12 $   $     0 \pm      0 $
aaa!
                                mc_resum   7411791.245   4543618.076   17078445.451   7667081.674   242036.155
                                   total   $9089374 \pm 162035 $   $5885178 \pm 139627 $   $17140356 \pm   5287 $   $7785019 \pm  46011 $   $280975 \pm    423 $
                                    data   $10346582 \pm   3226 $   $6962027 \pm   2655 $   $17405226 \pm   4175 $   $7077899 \pm   2664 $   $183623 \pm    431 $

was:
          dy_mumu   wjets_mu   tt_elmu
mc   (k)     7597      10065       177
data (k)     8016      10185       179

in data
-- much more DY dilep         maybe the HLT match was done only against leading lepton? check the HLT matching fractions
   more tt_elmu by 2.8%       (35.8/31.3 = 1,144)
   wjets_mu are 1.6% larger

CLUE
also now I do not have a default tau candidate
only the b candidate is required or required to not be there
-- and needs a propper SF?

## tt lumi weight

now:

root [4] el_presel->Get("tt_lj/NOMINAL/el_presel_tt_lj_NOMINAL_lep_pt")->Print()
TH1.Print Name  = el_presel_tt_lj_NOMINAL_lep_pt, Entries= 2357670, Total sum= 32.6184
root [5] 32.6184 * 35800
(double) 1.16774e+06
root [6] 1.16774e+06 / 2357670
(double) 0.495294

el_presel->Get("tt_eltau/NOMINAL/el_presel_tt_eltau_NOMINAL_lep_pt")->Print()

root [7] el_presel->Get("tt_eltau/NOMINAL/el_presel_tt_eltau_NOMINAL_lep_pt")->Print()
TH1.Print Name  = el_presel_tt_eltau_NOMINAL_lep_pt, Entries= 168181, Total sum= 2.33172
root [8] 
root [8] 2.33172 * 35800
(double) 83475.6
root [9] 2.33172 * 35800 / 168181
(double) 0.496344


mu_presel->Get("tt_mutau/NOMINAL/mu_presel_tt_mutau_NOMINAL_lep_pt")->Print()
mu_presel->Get("tt_lj/NOMINAL/mu_presel_tt_lj_NOMINAL_lep_pt")->Print()

root [10] mu_presel->Get("tt_mutau/NOMINAL/mu_presel_tt_mutau_NOMINAL_lep_pt")->Print()
TH1.Print Name  = mu_presel_tt_mutau_NOMINAL_lep_pt, Entries= 259007, Total sum= 3.49537
root [11] 3.49537 * 35800 / 259007
(double) 0.483131

root [12] mu_presel->Get("tt_lj/NOMINAL/mu_presel_tt_lj_NOMINAL_lep_pt")->Print()
TH1.Print Name  = mu_presel_tt_lj_NOMINAL_lep_pt, Entries= 3615738, Total sum= 48.7381
root [13] 48.7381 * 35800 / 3615738
(double) 0.482564

mu_preselCand->Get("tt_lj/NOMINAL/mu_preselCand_tt_lj_NOMINAL_lep_pt")->Print()

mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_lep_pt")->Print()
mu_sel->Get("tt_lj/NOMINAL/mu_sel_tt_lj_NOMINAL_lep_pt")->Print()

root [14] mu_preselCand->Get("tt_lj/NOMINAL/mu_preselCand_tt_lj_NOMINAL_lep_pt")->Print()
TH1.Print Name  = mu_preselCand_tt_lj_NOMINAL_lep_pt, Entries= 1449257, Total sum= 19.5827
root [15] 19.5827*35800 / 1449257
(double) 0.483738

root [16] mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_lep_pt")->Print()
TH1.Print Name  = mu_sel_tt_mutau_NOMINAL_lep_pt, Entries= 41061, Total sum= 0.558402
root [17] 0.558402 * 35800 / 41061
(double) 0.486856

root [18] mu_sel->Get("tt_lj/NOMINAL/mu_sel_tt_lj_NOMINAL_lep_pt")->Print()
TH1.Print Name  = mu_sel_tt_lj_NOMINAL_lep_pt, Entries= 18529, Total sum= 0.250886
root [19] 0.250886 * 35800 / 18529
(double) 0.484738

root [3] tt_elmu->Get("tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_lep_pt")->Print()
TH1.Print Name  = tt_elmu_tt_other_NOMINAL_lep_pt, Entries= 440051, Total sum= 5.89885
root [4] 5.89885*35800 / 440051.
(double) 0.479896
root [5] 5.89885/ 440051.
(double) 1.34049e-05

and in old files?

../sw-dir/jobsums/mc_v27p1.root

root [6] ctr_mu_tt_em->Get("tt_elmu/NOMINAL/ctr_mu_tt_em_tt_elmu_NOMINAL_lep_pt")->Print()
TH1.Print Name  = ctr_mu_tt_em_tt_elmu_NOMINAL_lep_pt, Entries= 363837, Total sum= 3.47039
root [7] 3.47039*35800 / 363837
(double) 0.341471
root [1] 3.47039/ 363837
(double) 9.53831e-06


the weight counters

root -l ../lstore_outdirs/merge-sets/v27/p1/MC2016_Summer16_TTJets_powheg.root

root [4] weight_counter->GetBinContent(1+1)
(Double_t) 7.81893e+07
root [5] weight_counter->GetBinContent(1+2)
(Double_t) 7.81893e+07
root [6] weight_counter->GetBinContent(1+3)
(Double_t) 7.81893e+07
root [7] weight_counter->GetBinContent(1+4)
(Double_t) 0.00000
root [8] weight_counter->GetBinContent(1+5)
(Double_t) 0.00000

root -l mc_norm/v37_test5_bunch2/MC2016_Summer16_TTJets_powheg.root

root [2] 
root [2] weight_counter->GetBinContent(1+1)
(Double_t) 5.49872e+07
root [3] weight_counter->GetBinContent(1+2)
(Double_t) 5.49872e+07
root [4] weight_counter->GetBinContent(1+3)
(Double_t) 5.49872e+07
root [5] weight_counter->GetBinContent(1+4)
(Double_t) 0.00000
root [6] weight_counter->GetBinContent(1+5)

ls lstore_outdirs/v27/p1/MC2016_Summer16_TTJets_powheg/MC*root | wc -l
99
[olek@fermi05 proc]$ ls lstore_outdirs/v37/test5/MC2016_Summer16_TTJets_powheg/MC*root | wc -l
99

root -l lstore_outdirs/v27/p1/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_7.root
root [1] weight_counter->GetBinContent(1+1)
(Double_t) 821334.

lstore_outdirs/v37/test5/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_7.root as _file0...
root [1] weight_counter->GetBinContent(1+1)
(Double_t) 821334.

[olek@fermi05 proc]$ root -l jobsums/distrs/v37_test5_bunch2/all/MC2016_Summer16_TTJets_powheg/weights/the_sums.root 
root [0] 
root [2] weight_counter->GetBinContent(1+1)
(Double_t) 5.49872e+07

[olek@fermi05 proc]$ python check_gen_lumi_weights.py lstore_outdirs/v37/test5/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_*.root
"MC2016_Summer16_TTJets_powheg" : 78189291.372787,

aha

python sumup_weights.py test_w_tt_v37_test5.root lstore_outdirs/v37/test5/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_*.root
root -l test_w_tt_v37_test5.root
weight_counter->GetBinContent(1+1)
7.81893e+07

ok, let's redo weights
make sumup_weights nt=v37 proc=test5 distrs=bunch2
root -l jobsums/distrs/v37_test5_bunch2/all/MC2016_Summer16_TTJets_powheg/weights/the_sums.root 
weight_counter->GetBinContent(1+1)

root [1] weight_counter->GetBinContent(1+1)
(Double_t) 7.81893e+07

aha!

rehadd everything for these damn weights?
-- no, run with usual weights

python check_gen_lumi_weights.py lstore_outdirs/v37/test5/MC*/MC*.root

"MC2016_Summer16_DYJetsToLL_10to50_amcatnlo" : 92667256.031132,
"MC2016_Summer16_DYJetsToLL_50toInf_madgraph" : 147827597.073751,
"MC2016_Summer16_QCD_HT-100-200" : 80668282.010224,
"MC2016_Summer16_QCD_HT-1000-1500" : 4831794.914995,
"MC2016_Summer16_QCD_HT-1500-2000" : 4025637.189128,
"MC2016_Summer16_QCD_HT-200-300" : 18982179.906991,
"MC2016_Summer16_QCD_HT-2000-Inf" : 2019120.954068,
"MC2016_Summer16_QCD_HT-300-500" : 17273854.173847,
"MC2016_Summer16_QCD_HT-500-700" : 19192242.333873,
"MC2016_Summer16_QCD_HT-700-1000" : 15846448.822448,
"MC2016_Summer16_SingleT_tW_5FS_powheg" : 7079946.591460,
"MC2016_Summer16_SingleTbar_tW_5FS_powheg" : 7060819.557982,
"MC2016_Summer16_TTJets_powheg" : 78189291.372787,
"MC2016_Summer16_W1Jets_madgraph" : 42268723.655958,
"MC2016_Summer16_W2Jets_madgraph" : 58623419.131360,
"MC2016_Summer16_W3Jets_madgraph" : 57773140.789413,
"MC2016_Summer16_W4Jets_madgraph" : 30412479.957944,
"MC2016_Summer16_WJets_amcatnlo" : 151108470.560272,
"MC2016_Summer16_WJets_madgraph" : 85737026.803850,
"MC2016_Summer16_WWTo2L2Nu_powheg" : 2026759.028423,
"MC2016_Summer16_WWToLNuQQ_powheg" : 2026281.926199,
"MC2016_Summer16_WZTo1L1Nu2Q_amcatnlo_madspin" : 14254071.531880,
"MC2016_Summer16_WZTo1L3Nu_amcatnlo_madspin" : 955200.742387,
"MC2016_Summer16_WZTo2L2Q_amcatnlo_madspin" : 16101693.833498,
"MC2016_Summer16_WZTo3LNu_powheg" : 2020951.120024,
"MC2016_Summer16_ZZTo2L2Nu_powheg" : 8965538.308207,
"MC2016_Summer16_ZZTo2L2Q_amcatnlo_madspin" : 9822865.311869,
"MC2016_Summer16_schannel_4FS_leptonicDecays_amcatnlo" : 637697.524850,
"MC2016_Summer16_tchannel_antitop_4f_leptonicDecays_powheg" : 39844542.965987,
"MC2016_Summer16_tchannel_top_4f_leptonicDecays_powheg" : 68953757.295413,


hadd v37_test5_bunch2_mc_4_amcatnlo.root v37_test5_bunch2/MC*root v37_test5_bunch2/wjets_amcatnlo/MC2016_Summer16_WJets_amcatnlo.root 
hadd v37_test5_bunch2_mc_4_wNjets.root   v37_test5_bunch2/MC*root v37_test5_bunch2/wjets_wNjets/MC2016_Summer16_*.root

make test_controls_v37_test5_issue1 mc=distrs/v37_test5_bunch2_mc_4_amcatnlo.root data_dir=distrs/v37_test5_bunch2/ tests=tests2

## the corrected weights, v37_test5_bunch2_mc_tests2

data-mc agreement

dy:
mumu -- ok                 Mt shape is ok too (data 1% above MC)
elel -- data at 0.90-0.95  Mt shape disagreement at large mT

wjets -- both ok, maybe need larger factor for wjets and MC QCD

tt_elmu:
checked: no effect from TOPPT --- the systematic was not applied for elmu
SingleMuon -- data at 0.90-0.95 of MC
SingleElectron agreement -- ok:
INFO:root:197779.0
INFO:root:mc sum     =   193056.431785   193056.431785
CHECK
both -- the same shape disagreement down for particular bins (probably mostly the same events in MC and Data)
        Data peaks more at 70GeV
        also some outlier bin at 200GeV

presel

python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c el_presel --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_presel --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c el_presel --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_4_amcatnlo.root distrs/v37_test5_bunch2//SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_tests2/  -c mu_presel --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- in both Data 20-30% less than MC
   with not clear MC QCD
   but at large values of Mt_c clearly not enough tt: 10% in el and 20% in mu (and looks like the signal is too large, lj is too small)
   and different proportions in lj, ljout: 10-20% in lj, 40-50% in ljout

preselCand -- perfect with data-driven QCD
   needs more MC QCD, but there is not enough data

implemented: add preselCand_lj ljout in std_defs

main selection
-- good agreement without Vloose shapes
   both el_sel and mu_sel have the same dip at 200GeV mT --- CHECK same as elmu, but in opposite direction: in elmu there is more data than MC, in lep-tau the opposite



# the data-driven QCD shape in OS and SS

python stack_plot.py ../sw-dir/jobsums/mc_v27p1.root ../lstore_outdirs/merge-sets/v27/p1/SingleMuon.root -o plots/ --lumi 34800 --osss-pl -c ctr_mu_wjet -p    -d Mt_lep_met_f --wjets 0.8 --factor-dy 1.05 --lumi-label 35800 --title "" --title-x "relative Isolation of muon" --bin-norm --no-label-osss

-- some noticeable difference... strange -- the should match perfectly?

python stack_plot.py ../sw-dir/jobsums/mc_v27p1.root ../lstore_outdirs/merge-sets/v27/p1/SingleMuon.root -o plots/ --lumi 34800           -c ctr_mu_wjet -p -r -d Mt_lep_met_f --wjets 0.8 --factor-dy 1.05 --lumi-label 35800 --title "" --title-x "relative Isolation of muon" --bin-norm --qcd 1.05

-- indeed off at large mT??

python stack_plot.py ../sw-dir/jobsums/mc_v27p1.root ../lstore_outdirs/merge-sets/v27/p1/SingleMuon.root -o plots/ --lumi 34800           -c ctr_mu_wjet -p -r -d Mt_lep_met_f --wjets 0.65 --factor-dy 1.05 --lumi-label 35800 --title "" --title-x "m_{T}" --bin-norm --qcd 1.1 --overwrite


also are there negative bins?

python stack_plot.py ../sw-dir/jobsums/mc_v27p1.root ../lstore_outdirs/merge-sets/v27/p1/SingleMuon.root -o plots/ --lumi 34800 --osss-pl -c ctr_mu_wjet -p    -d Mt_lep_met_f --wjets 0.7 --factor-dy 1.05 --lumi-label 35800 --title "" --title-x "m_{T}" --bin-norm --no-label-osss

python stack_plot.py ../sw-dir/jobsums/mc_v27p1.root ../lstore_outdirs/merge-sets/v27/p1/SingleMuon.root -o plots/ --lumi 34800 --osss-pl -c ctr_mu_wjet -p -d Mt_lep_met_f --wjets 0.8 --factor-dy 1.05 --lumi-label 35800 --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[events/1GeV]" --bin-norm --no-label-osss --y-range 0,60000 --nulify-qcd-bins 1.

-- some definite shape trend from low to high mT

python stack_plot.py ../sw-dir/jobsums/mc_v27p1.root ../lstore_outdirs/merge-sets/v27/p1/SingleElectron.root -o plots/ --lumi 31300 --osss-pl -c ctr_el_wjet -p -d Mt_lep_met_f --wjets 0.8 --factor-dy 1.05                --title "" --title-x "M_{T}(e, MET) [GeV]" --title-y "[events/1GeV]" --bin-norm --no-label-osss --y-range 0,60000 --nulify-qcd-bins 1.

-- same trend

use new data for wjets (the wjet distributions were ok there)

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -o plots/  -c wjets_mu --data-nick data_other -d Mt_lep_met_f --lumi 35800 --overwrite --wjets 0.92 --osss-pl --title "" --title-x "M_{T}(e, MET) [GeV]" --title-y "[events/1GeV]" --bin-norm --no-label-osss --y-range 0,60000 --nulify-qcd-bins 0.
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -o plots/  -c wjets_el --data-nick data_other -d Mt_lep_met_f --lumi 35800 --overwrite --wjets 0.92 --osss-pl --title "" --title-x "M_{T}(e, MET) [GeV]" --title-y "[events/1GeV]" --bin-norm --no-label-osss --y-range 0,60000 --nulify-qcd-bins 0.

-- same trend.



## presel

only ctr_old_el_presel_alliso ctr_old_mu_presel_alliso
in ../sw-dir/jobsums/mc_v27p1.root

python stack_plot.py ../sw-dir/jobsums/mc_v27p1.root ../lstore_outdirs/merge-sets/v27/p1/SingleMuon.root      -o plots/ --lumi 34800 --osss-pl -c ctr_old_mu_presel_alliso -p -d Mt_lep_met_f --wjets 0.8 --factor-dy 1.05 --lumi-label 35800 --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[events/1GeV]" --bin-norm --no-label-osss --y-range 0,6000 --nulify-qcd-bins 1.

python stack_plot.py ../sw-dir/jobsums/mc_v27p1.root ../lstore_outdirs/merge-sets/v27/p1/SingleElectron.root  -o plots/ --lumi 31300 --osss-pl -c ctr_old_el_presel_alliso -p -d Mt_lep_met_f --wjets 0.8 --factor-dy 1.05                    --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "[events/1GeV]" --bin-norm --no-label-osss --y-range 0,6000 --nulify-qcd-bins 1.


## compare to MC shapes

for el-tau

save the data-driven shapes

python stack_plot.py mc_v27p1.root ../lstore_outdirs/merge-sets/v27/p1/SingleElectron.root  -o plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven/ --lumi 31300 --osss-pl -c ctr_old_el_presel_alliso -d Mt_lep_met_f --wjets 0.8 --factor-dy 1.05                    --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "[events/1GeV]" --bin-norm --no-label-osss --y-range 0,6000 --nulify-qcd-bins 1.

root -l plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven//mc_v27p1_HISTOSEL_Mt_lep_met_f_ctr_old_el_presel_alliso_NOMINAL.root
ctr_old_el_presel_alliso->Get("qcd/NOMINAL/ctr_old_el_presel_alliso_qcd_NOMINAL_Mt_lep_met_f")->Draw()

-- it saved the mc qcd


AND ----------------
after correction:

mc:
python stack_plot.py mc_v27p1.root ../lstore_outdirs/merge-sets/v27/p1/SingleElectron.root  -o plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven/ --lumi 31300           -c ctr_old_el_presel_alliso -d Mt_lep_met_f --wjets 0.8 --factor-dy 1.05                    --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "[events/1GeV]" --bin-norm --no-label-osss --y-range 0,6000 --nulify-qcd-bins 1.
python stack_plot.py mc_v27p1.root ../lstore_outdirs/merge-sets/v27/p1/SingleElectron.root  -o plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven/ --lumi 31300           -c ctr_old_el_presel_alliso_ss -d Mt_lep_met_f --wjets 0.8 --factor-dy 1.05                    --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "[events/1GeV]" --bin-norm --no-label-osss --y-range 0,6000 --nulify-qcd-bins 1.

data-driven:
python stack_plot.py mc_v27p1.root ../lstore_outdirs/merge-sets/v27/p1/SingleElectron.root  -o plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven/ --lumi 31300 --osss-pl -c ctr_old_el_presel_alliso -d Mt_lep_met_f --wjets 0.8 --factor-dy 1.05                    --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "[events/1GeV]" --bin-norm --no-label-osss --y-range 0,6000 --nulify-qcd-bins 1.


root -l plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven/mc_v27p1_..,lstore_outdirs,merge-sets,v27,p1,SingleElectron_Mt_lep_met_f_ctr_old_el_presel_alliso_NOMINAL_osss-parts.root

compare shapes:

python get_shapes.py --formula "qcd_mc : qcd_data " --y-range 0,0.45 --no-std-path -e --title "electron-tau OS preselection" --x-title "m_{T} [GeV]" -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj qcd_mc:plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven//mc_v27p1_HISTOSEL_Mt_lep_met_f_ctr_old_el_presel_alliso_NOMINAL.root:ctr_old_el_presel_alliso/qcd/NOMINAL/ctr_old_el_presel_alliso_qcd_NOMINAL_Mt_lep_met_f qcd_data:plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven/mc_v27p1_..,lstore_outdirs,merge-sets,v27,p1,SingleElectron_Mt_lep_met_f_ctr_old_el_presel_alliso_NOMINAL_osss-parts.root:qcd_os
python get_shapes.py --formula "qcd_mc : qcd_data " --y-range 0,0.45 --no-std-path -e --title "electron-tau SS preselection" --x-title "m_{T} [GeV]" -c ctr_old_mu_sel_lj -d Mt_lep_met_f -p tt_lj qcd_mc:plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven//mc_v27p1_HISTOSEL_Mt_lep_met_f_ctr_old_el_presel_alliso_ss_NOMINAL.root:ctr_old_el_presel_alliso_ss/qcd/NOMINAL/ctr_old_el_presel_alliso_ss_qcd_NOMINAL_Mt_lep_met_f  qcd_data:plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven/mc_v27p1_..,lstore_outdirs,merge-sets,v27,p1,SingleElectron_Mt_lep_met_f_ctr_old_el_presel_alliso_NOMINAL_osss-parts.root:qcd_ss

mv ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_qcd_mc,qcd_data_formula.png ../studies/qcd-mc-cross-check//compare_v27p1_ctr_old_el_presel_alliso_Mt_lep_met_f_qcd_mc,qcd_data_formula_el_presel_OS.png
mv ./compare_ctr_old_mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f_qcd_mc,qcd_data_formula.png ../studies/qcd-mc-cross-check//compare_v27p1_ctr_old_el_presel_alliso_Mt_lep_met_f_qcd_mc,qcd_data_formula_el_presel_SS.png


wjets:

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -o plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven/  -c wjets_el      --data-nick data_other -d Mt_lep_met_f --lumi 35800 --overwrite --wjets 0.92           --title "" --title-x "M_{T}(e, MET) [GeV]" --title-y "[events/1GeV]" --bin-norm --no-label-osss --y-range 0,60000 --nulify-qcd-bins 0. --overwrite
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -o plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven/  -c wjets_el_ss   --data-nick data_other -d Mt_lep_met_f --lumi 35800 --overwrite --wjets 0.92           --title "" --title-x "M_{T}(e, MET) [GeV]" --title-y "[events/1GeV]" --bin-norm --no-label-osss --y-range 0,60000 --nulify-qcd-bins 0. --overwrite
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -o plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven/  -c wjets_el      --data-nick data_other -d Mt_lep_met_f --lumi 35800 --overwrite --wjets 0.92 --osss-pl --title "" --title-x "M_{T}(e, MET) [GeV]" --title-y "[events/1GeV]" --bin-norm --no-label-osss --y-range 0,60000 --nulify-qcd-bins 0. --nulify-qcd-bins 0.

plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven//distrs,v37_test5_bunch2_mc_wjets_amcatnlo_3_HISTOSEL_Mt_lep_met_f_wjets_el_NOMINAL.root
plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven//distrs,v37_test5_bunch2_mc_wjets_amcatnlo_3_HISTOSEL_Mt_lep_met_f_wjets_el_ss_NOMINAL.root
plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven/distrs,v37_test5_bunch2_mc_wjets_amcatnlo_3_distrs,v37_test5_bunch2,SingleElectron_Mt_lep_met_f_wjets_el_NOMINAL_osss-parts.root

python get_shapes.py --formula "qcd_mc : qcd_data " --y-range 0,0.45 --no-std-path -e --title "electron-tau OS W+jets control" --x-title "m_{T} [GeV]"  qcd_mc:plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven//distrs,v37_test5_bunch2_mc_wjets_amcatnlo_3_HISTOSEL_Mt_lep_met_f_wjets_el_NOMINAL.root:wjets_el/qcd_other/NOMINAL/wjets_el_qcd_other_NOMINAL_Mt_lep_met_f qcd_data:plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven/distrs,v37_test5_bunch2_mc_wjets_amcatnlo_3_distrs,v37_test5_bunch2,SingleElectron_Mt_lep_met_f_wjets_el_NOMINAL_osss-parts.root:qcd_os

python get_shapes.py --formula "qcd_mc : qcd_data " --y-range 0,0.45 --no-std-path -e --title "electron-tau SS W+jets control" --x-title "m_{T} [GeV]"  qcd_mc:plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven//distrs,v37_test5_bunch2_mc_wjets_amcatnlo_3_HISTOSEL_Mt_lep_met_f_wjets_el_ss_NOMINAL.root:wjets_el_ss/qcd_other/NOMINAL/wjets_el_ss_qcd_other_NOMINAL_Mt_lep_met_f qcd_data:plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven/distrs,v37_test5_bunch2_mc_wjets_amcatnlo_3_distrs,v37_test5_bunch2,SingleElectron_Mt_lep_met_f_wjets_el_NOMINAL_osss-parts.root:qcd_ss

mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_qcd_mc,qcd_data_formula.png  ../studies/qcd-mc-cross-check//compare_v37test5_Mt_lep_met_f_qcd_mc,qcd_data_formula_el_wjets_OS.png
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_qcd_mc,qcd_data_formula.png  ../studies/qcd-mc-cross-check//compare_v37test5_Mt_lep_met_f_qcd_mc,qcd_data_formula_el_wjets_SS.png



also muon-tau

python stack_plot.py mc_v27p1.root ../lstore_outdirs/merge-sets/v27/p1/SingleMuon.root      -o plots/an-v8-paper-v3_qcd-shapes_mc-and-data-driven/ --lumi 34800 --osss-pl -c ctr_old_mu_presel_alliso -d Mt_lep_met_f --wjets 0.8 --factor-dy 1.05 --lumi-label 35800 --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[events/1GeV]" --bin-norm --no-label-osss --y-range 0,6000 --nulify-qcd-bins 1.



## final files

plots/..,sw-dir,jobsums,mc_v27p1_..,lstore_outdirs,merge-sets,v27,p1,SingleElectron_Mt_lep_met_f_ctr_el_wjet_NOMINAL_osss-parts.png
plots/..,sw-dir,jobsums,mc_v27p1_..,lstore_outdirs,merge-sets,v27,p1,SingleElectron_Mt_lep_met_f_ctr_old_el_presel_alliso_NOMINAL_osss-parts.png
plots/..,sw-dir,jobsums,mc_v27p1_..,lstore_outdirs,merge-sets,v27,p1,SingleMuon_Mt_lep_met_f_ctr_mu_wjet_NOMINAL_osss-parts.png
plots/..,sw-dir,jobsums,mc_v27p1_..,lstore_outdirs,merge-sets,v27,p1,SingleMuon_Mt_lep_met_f_ctr_old_mu_presel_alliso_NOMINAL_osss-parts.png

mv plots/..,sw-dir,jobsums,mc_v27p1_..,lstore_outdirs,merge-sets,v27,p1,SingleElectron_Mt_lep_met_f_ctr_el_wjet_NOMINAL_osss-parts.png                plots/mt_shapes_os_ss_el_wjets_datadriven.png
mv plots/..,sw-dir,jobsums,mc_v27p1_..,lstore_outdirs,merge-sets,v27,p1,SingleElectron_Mt_lep_met_f_ctr_old_el_presel_alliso_NOMINAL_osss-parts.png   plots/mt_shapes_os_ss_el_presel_datadriven.png
mv plots/..,sw-dir,jobsums,mc_v27p1_..,lstore_outdirs,merge-sets,v27,p1,SingleMuon_Mt_lep_met_f_ctr_mu_wjet_NOMINAL_osss-parts.png                    plots/mt_shapes_os_ss_mu_wjets_datadriven.png
mv plots/..,sw-dir,jobsums,mc_v27p1_..,lstore_outdirs,merge-sets,v27,p1,SingleMuon_Mt_lep_met_f_ctr_old_mu_presel_alliso_NOMINAL_osss-parts.png       plots/mt_shapes_os_ss_mu_presel_datadriven.png



# finally the presel in v37

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c mu_presel --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 1.5

-- data problems in mu_presel, many jobs crashed (the issue with recording mu trg in pass_elmu)

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c el_presel --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.8 --qcd-factor 1.5

-- also too few data??

resub

now jobs are approximately:
[olek@fermi04 proc]$ ls -l jobsums/distrs/v37_test5_bunch2/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/tt_presel_cands/Data13TeV_SingleElectron2016B_03Feb2017_ver2_10.root
-rw-r-----+ 1 olek t3cms 30402 Mar 25 16:05 jobsums/distrs/v37_test5_bunch2/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/tt_presel_cands/Data13TeV_SingleElectron2016B_03Feb2017_ver2_10.root

[olek@fermi04 proc]$ ls -l jobsums/distrs/v37_test5_bunch2/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/tt_presel_lj_el/Data13TeV_SingleElectron2016B_03Feb2017_ver2_10.root
-rw-r-----+ 1 olek t3cms 17176 Mar 28 19:05 jobsums/distrs/v37_test5_bunch2/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/tt_presel_lj_el/Data13TeV_SingleElectron2016B_03Feb2017_ver2_10.root

[olek@fermi04 proc]$ ls -l jobsums/distrs/v37_test5_bunch2/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/tt_presel_lj_mu/Data13TeV_SingleElectron2016B_03Feb2017_ver2_10.root
-rw-r-----+ 1 olek t3cms 16705 Mar 28 19:05 jobsums/distrs/v37_test5_bunch2/all/Data13TeV_SingleElectron2016B_03Feb2017_ver2/tt_presel_lj_mu/Data13TeV_SingleElectron2016B_03Feb2017_ver2_10.root

make multihadd2_distrs

make multihadd2_distrs nt=v37 proc=test5 distrs=bunch2 dtag=Data13TeV_SingleElectron2016B_03Feb2017_ver2
make multihadd2_distrs nt=v37 proc=test5 distrs=bunch2 dtag=Data13TeV_SingleElectron2016C_03Feb2017_v1
make multihadd2_distrs nt=v37 proc=test5 distrs=bunch2 dtag=Data13TeV_SingleElectron2016D_03Feb2017_v1
make multihadd2_distrs nt=v37 proc=test5 distrs=bunch2 dtag=Data13TeV_SingleElectron2016E_03Feb2017_v1
make multihadd2_distrs nt=v37 proc=test5 distrs=bunch2 dtag=Data13TeV_SingleElectron2016F_03Feb2017_v1
make multihadd2_distrs nt=v37 proc=test5 distrs=bunch2 dtag=Data13TeV_SingleElectron2016G_03Feb2017_v1
make multihadd2_distrs nt=v37 proc=test5 distrs=bunch2 dtag=Data13TeV_SingleElectron2016H_03Feb2017_ver2
make multihadd2_distrs nt=v37 proc=test5 distrs=bunch2 dtag=Data13TeV_SingleElectron2016H_03Feb2017_ver3

make multihadd2_distrs nt=v37 proc=test5 distrs=bunch2 dtag=Data13TeV_SingleMuon2016B_03Feb2017_ver2
make multihadd2_distrs nt=v37 proc=test5 distrs=bunch2 dtag=Data13TeV_SingleMuon2016C_03Feb2017_v1
make multihadd2_distrs nt=v37 proc=test5 distrs=bunch2 dtag=Data13TeV_SingleMuon2016D_03Feb2017_v1
make multihadd2_distrs nt=v37 proc=test5 distrs=bunch2 dtag=Data13TeV_SingleMuon2016E_03Feb2017_v1
make multihadd2_distrs nt=v37 proc=test5 distrs=bunch2 dtag=Data13TeV_SingleMuon2016F_03Feb2017_v1
make multihadd2_distrs nt=v37 proc=test5 distrs=bunch2 dtag=Data13TeV_SingleMuon2016G_03Feb2017_v1
make multihadd2_distrs nt=v37 proc=test5 distrs=bunch2 dtag=Data13TeV_SingleMuon2016H_03Feb2017_ver2
make multihadd2_distrs nt=v37 proc=test5 distrs=bunch2 dtag=Data13TeV_SingleMuon2016H_03Feb2017_ver3

ok like this:

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c mu_presel --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c el_presel --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5

-- so, what's up with the lumi?

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c mu_presel_lj --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c el_presel_lj --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c mu_presel_ljout --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c el_presel_ljout --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c mu_preselCand --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c el_preselCand --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c mu_preselCand --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd 1.05
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c el_preselCand --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd 1.05

-- in cand data is 15% lower
   in lj    it is 10% lower
   in ljout it is 10% higher

and very small wjets?

damn


python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_wNjets.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c mu_presel --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_wNjets.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c el_presel --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5

-- same

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_wNjets.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c mu_presel_lj --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_wNjets.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c el_presel_lj --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_wNjets.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c mu_presel_ljout --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_wNjets.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c el_presel_ljout --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_wNjets.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c mu_preselCand --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_wNjets.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c el_preselCand --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_wNjets.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c mu_preselCand --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd 1.05
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_wNjets.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2_mc_wjets_amcatnlo/  -c el_preselCand --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd 1.05

-- about same

lj parameters were not saved

check yields:

root [3] mu_presel->Get("tt_lj/NOMINAL/mu_presel_tt_lj_NOMINAL_lep_pt")->Print()
TH1.Print Name  = mu_presel_tt_lj_NOMINAL_lep_pt, Entries= 3615738, Total sum= 48.7381
Root > mu_presel_lj->Get("tt_lj/NOMINAL/mu_presel_lj_tt_lj_NOMINAL_lep_pt")->Print()
TH1.Print Name  = mu_presel_lj_tt_lj_NOMINAL_lep_pt, Entries= 1921419, Total sum= 25.9259
root [6] mu_presel_ljout->Get("tt_lj/NOMINAL/mu_presel_ljout_tt_lj_NOMINAL_lep_pt")->Print()
TH1.Print Name  = mu_presel_ljout_tt_lj_NOMINAL_lep_pt, Entries= 1694319, Total sum= 22.8122
root [7] mu_preselCand->Get("tt_lj/NOMINAL/mu_preselCand_tt_lj_NOMINAL_lep_pt")->Print()
TH1.Print Name  = mu_preselCand_tt_lj_NOMINAL_lep_pt, Entries= 1449257, Total sum= 19.5827

so, candidates are about half of initial stuff..

TODO probably b for lj is taken from tau-cleaned b... -- check it's correct
TODO add lj params to presel
TODO submit controls and final selection

make std_changroups nt=v37 proc=test5 distrs=bunch2 changroup=wjets,wjets_ss,dy_dileptons,tt_dileptons,fit_tt_leptau,fit_tt_leptau_lj,fit_tt_leptau_ljout,fit_tt_leptau_Vloose,fit_tt_leptau_Vloose_lj,fit_tt_leptau_Vloose_ljout,tt_leptau,tt_leptau_lj,tt_leptau_ljout,tt_leptau_Vloose,tt_leptau_Vloose_lj,tt_leptau_Vloose_ljout

make submit_batch_plots
split -l 1500 batch_jobs/submit batch_jobs/submit.


## the control regions in v37

### presel

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/1/SingleMuon.root     -p -r -o plots/v37_test5_bunch2/  -c mu_presel --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/1/SingleElectron.root -p -r -o plots/v37_test5_bunch2/  -c el_presel --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5

-- so, what's up with the lumi?

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/1/SingleMuon.root     -p -r -o plots/v37_test5_bunch2/  -c mu_presel_lj --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/1/SingleElectron.root -p -r -o plots/v37_test5_bunch2/  -c el_presel_lj --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/1/SingleMuon.root     -p -r -o plots/v37_test5_bunch2/  -c mu_presel_ljout --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/1/SingleElectron.root -p -r -o plots/v37_test5_bunch2/  -c el_presel_ljout --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/1/SingleMuon.root     -p -r -o plots/v37_test5_bunch2/  -c mu_preselCand --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/1/SingleElectron.root -p -r -o plots/v37_test5_bunch2/  -c el_preselCand --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd-factor 1.5

-- no presel channels in the data of the 3rd plotting
   same distrs here


### tt_elmu

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_wNjets_2.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c tt_elmu --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd 1.05
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_wNjets_2.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c tt_elmu --data-nick data_other -d lep_pt --lumi 33000 --overwrite --wjets 0.8 --qcd 1.05

-- tt_elmu is missing, even though distrs have this directory

make multihadd2_distrs proc=test5 size=50 max_procs=12

mv distrs/v37_test5_bunch2/all/MC2016_Summer16_TTJets_powheg ./

rm distrs/v37_test5_bunch2/all/*/all_chans.root.*

make multihadd2_distrs_all_dtags proc=test5 distrs=bunch2 max_procs=12

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_wNjets_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c tt_elmu --data-nick data_other -d lep_pt --lumi 23100 --overwrite --wjets 0.8
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_wNjets_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c tt_elmu --data-nick data_other -d lep_pt --lumi 23100 --overwrite --wjets 0.8

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c tt_elmu --data-nick data_other -d lep_pt --lumi 23800 --overwrite --wjets 0.8
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c tt_elmu --data-nick data_other -d lep_pt --lumi 23800 --overwrite --wjets 0.8

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c tt_elmu --data-nick data_other -d lep_pt --lumi 23800 --overwrite --wjets 0.8 --systematic TOPPTUp
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c tt_elmu --data-nick data_other -d lep_pt --lumi 23800 --overwrite --wjets 0.8 --systematic TOPPTUp

CHECK tt_elmu -- no effect from TOP PT and strange deviation at low pT in ele channel

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c tt_elmu --data-nick data_other -d Mt_lep_met_f --lumi 23800 --overwrite --wjets 0.8
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c tt_elmu --data-nick data_other -d Mt_lep_met_f --lumi 23800 --overwrite --wjets 0.8

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c tt_elmu --data-nick data_other -d Mt_lep_met_f --lumi 23800 --overwrite --wjets 0.8 --systematic TOPPTUp

CHECK tt_elmu -- again no effect, and the slight difference at high mT might be due to it.



### wjets

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c wjets_mu --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 1.0 --qcd-factor 2.
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c wjets_el --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 1.0 --qcd-factor 2.

- more or less ok

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c wjets_mu --data-nick data_other -d Mt_lep_met_f --lumi 35800 --overwrite --wjets 1.0 --qcd-factor 2.
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c wjets_el --data-nick data_other -d Mt_lep_met_f --lumi 35800 --overwrite --wjets 1.0 --qcd-factor 2.

-- poor shape agreement
better:

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c wjets_mu --data-nick data_other -d Mt_lep_met_f --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c wjets_el --data-nick data_other -d Mt_lep_met_f --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c wjets_mu --data-nick data_other -d Mt_lep_met_f --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5 --cumulative-fractions
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c wjets_el --data-nick data_other -d Mt_lep_met_f --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5 --cumulative-fractions

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c wjets_mu --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c wjets_el --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5

CHECK wjets -- the data trend goes down at large mT, instead of up?

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c wjets_mu --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c wjets_el --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5



### dy mumu, elel

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c dy_mumu --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c dy_elel --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c dy_elel --data-nick data_other -d lep_pt --lumi 32220 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c dy_mumu --data-nick data_other -d lep_eta --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c dy_elel --data-nick data_other -d lep_eta --lumi 32220 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c dy_mumu --data-nick data_other -d met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c dy_elel --data-nick data_other -d met_c --lumi 32220 --overwrite --wjets 0.92 --qcd-factor 2.5

-- el has 90% of data (32220 lumi)

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c dy_mumu --data-nick data_other -d Mt_lep_met_c --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c dy_elel --data-nick data_other -d Mt_lep_met_c --lumi 32220 --overwrite --wjets 0.92 --qcd-factor 2.5

CHECK dy mumu, elel -- clear trend data down at large met and mT (was not there before), small but significant disagreement in eta...

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c dy_mumu --data-nick data_other -d dilep_mass_dy --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c dy_elel --data-nick data_other -d dilep_mass_dy --lumi 32220 --overwrite --wjets 0.92 --qcd-factor 2.5

-- usual shift


### main selection

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c mu_sel --data-nick data_other -d lep_pt --lumi 35800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c el_sel --data-nick data_other -d lep_pt --lumi 32220 --overwrite --wjets 0.92 --qcd-factor 2.5

CHECK main selection -- normal amount of data and way too much MC

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c mu_sel --data-nick data_other -d lep_pt --lumi 25800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c el_sel --data-nick data_other -d lep_pt --lumi 25800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- ok, except couple MC QCD events

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c mu_selVloose --data-nick data_other -d lep_pt --lumi 25800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c el_selVloose --data-nick data_other -d lep_pt --lumi 25800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- also ok, and lack of QCD at low pT?

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c mu_selVloose --data-nick data_other -d lep_pt --lumi 25800 --overwrite --wjets 0.92 --qcd 1.05
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c el_selVloose --data-nick data_other -d lep_pt --lumi 25800 --overwrite --wjets 0.92 --qcd 1.05

-- ok (and poor shape of WJets from amcatnlo)

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c mu_sel --data-nick data_other -d lep_eta --lumi 25800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c el_sel --data-nick data_other -d lep_eta --lumi 25800 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c mu_sel --data-nick data_other -d met_c --lumi 25800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c el_sel --data-nick data_other -d met_c --lumi 25800 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c mu_sel --data-nick data_other -d phi_met_lep --lumi 25800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c el_sel --data-nick data_other -d phi_met_lep --lumi 25800 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c mu_sel --data-nick data_other -d cos_phi_met_lep --lumi 25800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c el_sel --data-nick data_other -d cos_phi_met_lep --lumi 25800 --overwrite --wjets 0.92 --qcd-factor 2.5

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c mu_sel --data-nick data_other -d Mt_lep_met_c --lumi 25800 --overwrite --wjets 0.92 --qcd-factor 2.5
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c el_sel --data-nick data_other -d Mt_lep_met_c --lumi 25800 --overwrite --wjets 0.92 --qcd-factor 2.5

-- no phi and cos! -- added to std def now
   kind of the same mT
CHECK main selection  trend in met, data falls from low to high met

split lj:

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c mu_sel_lj    --data-nick data_other -d lep_pt --lumi 25800 --overwrite --wjets 0.92 --qcd-factor 0.0001
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c el_sel_lj    --data-nick data_other -d lep_pt --lumi 25800 --overwrite --wjets 0.92 --qcd-factor 0.0001

python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleMuon.root     -p -r  -o plots/v37_test5_bunch2/  -c mu_sel_ljout --data-nick data_other -d lep_pt --lumi 25800 --overwrite --wjets 0.92 --qcd-factor 0.0001
python stack_plot.py distrs/v37_test5_bunch2_mc_wjets_amcatnlo_3.root distrs/v37_test5_bunch2/SingleElectron.root -p -r  -o plots/v37_test5_bunch2/  -c el_sel_ljout --data-nick data_other -d lep_pt --lumi 25800 --overwrite --wjets 0.92 --qcd-factor 0.0001

-- both ok, need normal QCD in ljout



# new comments from Enrique

why FSR and ISR are only rate and not shape?
the number of events in nominal and FSR/ISR datasets at final selection

in histosel of the fit:
root [3] el_sel->Get("tt_eltau/NOMINAL/el_sel_tt_eltau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = el_sel_tt_eltau_NOMINAL_Mt_lep_met_f, Entries= 34685, Total sum= 7701.12

but no FSR or ISR

in v25 r4?

in v37 with quick tests
-- only test1 has updowns

python sumup_ttree_draw.py --ttree ttree_out "1" --cond-com "selection_stage==17 || selection_stage==19" --per-weight --histo-range 3,0,3 --histo-name tt_yields_v37test1_nom_el_sel      --output tt_yields_v37test1_nom_el_sel.root lstore_outdirs/v37/test1/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_*root    &
python sumup_ttree_draw.py --ttree ttree_out "1" --cond-com "selection_stage==17 || selection_stage==19" --per-weight --histo-range 3,0,3 --histo-name tt_yields_v37test1_fsrup_el_sel    --output tt_yields_v37test1_fsrup_el_sel.root lstore_outdirs/v37/test1/MC2016_Summer16_TTJets_powheg_fsrup*/MC2016_Summer16_TTJets_powheg_fsrup*root    &
python sumup_ttree_draw.py --ttree ttree_out "1" --cond-com "selection_stage==17 || selection_stage==19" --per-weight --histo-range 3,0,3 --histo-name tt_yields_v37test1_fsrdown_el_sel  --output tt_yields_v37test1_fsrdown_el_sel.root lstore_outdirs/v37/test1/MC2016_Summer16_TTJets_powheg_fsrdown*/MC2016_Summer16_TTJets_powheg_fsrdown*root    &
python sumup_ttree_draw.py --ttree ttree_out "1" --cond-com "selection_stage==17 || selection_stage==19" --per-weight --histo-range 3,0,3 --histo-name tt_yields_v37test1_isrup_el_sel    --output tt_yields_v37test1_isrup_el_sel.root lstore_outdirs/v37/test1/MC2016_Summer16_TTJets_powheg_isrup*/MC2016_Summer16_TTJets_powheg_isrup*root    &
python sumup_ttree_draw.py --ttree ttree_out "1" --cond-com "selection_stage==17 || selection_stage==19" --per-weight --histo-range 3,0,3 --histo-name tt_yields_v37test1_isrdown_el_sel  --output tt_yields_v37test1_isrdown_el_sel.root lstore_outdirs/v37/test1/MC2016_Summer16_TTJets_powheg_isrdown*/MC2016_Summer16_TTJets_powheg_isrdown*root    &

python sumup_ttree_draw.py --ttree ttree_out "1" --cond-com "selection_stage==7 || selection_stage==9"   --per-weight --histo-range 3,0,3 --histo-name tt_yields_v37test1_nom_mu_sel      --output tt_yields_v37test1_nom_mu_sel.root lstore_outdirs/v37/test1/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_*root    &
python sumup_ttree_draw.py --ttree ttree_out "1" --cond-com "selection_stage==7 || selection_stage==9"   --per-weight --histo-range 3,0,3 --histo-name tt_yields_v37test1_fsrup_mu_sel    --output tt_yields_v37test1_fsrup_mu_sel.root lstore_outdirs/v37/test1/MC2016_Summer16_TTJets_powheg_fsrup*/MC2016_Summer16_TTJets_powheg_fsrup*root    &
python sumup_ttree_draw.py --ttree ttree_out "1" --cond-com "selection_stage==7 || selection_stage==9"   --per-weight --histo-range 3,0,3 --histo-name tt_yields_v37test1_fsrdown_mu_sel  --output tt_yields_v37test1_fsrdown_mu_sel.root lstore_outdirs/v37/test1/MC2016_Summer16_TTJets_powheg_fsrdown*/MC2016_Summer16_TTJets_powheg_fsrdown*root    &
python sumup_ttree_draw.py --ttree ttree_out "1" --cond-com "selection_stage==7 || selection_stage==9"   --per-weight --histo-range 3,0,3 --histo-name tt_yields_v37test1_isrup_mu_sel    --output tt_yields_v37test1_isrup_mu_sel.root lstore_outdirs/v37/test1/MC2016_Summer16_TTJets_powheg_isrup*/MC2016_Summer16_TTJets_powheg_isrup*root    &
python sumup_ttree_draw.py --ttree ttree_out "1" --cond-com "selection_stage==7 || selection_stage==9"   --per-weight --histo-range 3,0,3 --histo-name tt_yields_v37test1_isrdown_mu_sel  --output tt_yields_v37test1_isrdown_mu_sel.root lstore_outdirs/v37/test1/MC2016_Summer16_TTJets_powheg_isrdown*/MC2016_Summer16_TTJets_powheg_isrdown*root    &

fixing empty files
ls -l lstore_outdirs/v37/test1/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_*root lstore_outdirs/v37/test1/MC2016_Summer16_TTJets_powheg_fsrup*/MC2016_Summer16_TTJets_powheg_fsrup*root lstore_outdirs/v37/test1/MC2016_Summer16_TTJets_powheg_fsrdown*/MC2016_Summer16_TTJets_powheg_fsrdown*root > empty_files
ls -l lstore_outdirs/v37/test1/MC2016_Summer16_TTJets_powheg_isrup*/MC2016_Summer16_TTJets_powheg_isrup*root lstore_outdirs/v37/test1/MC2016_Summer16_TTJets_powheg_isrdown*/MC2016_Summer16_TTJets_powheg_isrdown*root > empty_files

hadd tt_yields_v37test1.root tt_yields_v37test1_*.root

tt_yields_v37test1_nom_el_sel->Get("tt_yields_v37test1_nom_el_sel_tt_yields_v37test1_nom_el_sel")->Print()
tt_yields_v37test1_fsrup_el_sel->Get("tt_yields_v37test1_fsrup_el_sel_tt_yields_v37test1_fsrup_el_sel")->Print()
tt_yields_v37test1_fsrdown_el_sel->Get("tt_yields_v37test1_fsrdown_el_sel_tt_yields_v37test1_fsrdown_el_sel")->Print()
tt_yields_v37test1_isrup_el_sel->Get("tt_yields_v37test1_isrup_el_sel_tt_yields_v37test1_isrup_el_sel")->Print()
tt_yields_v37test1_isrdown_el_sel->Get("tt_yields_v37test1_isrdown_el_sel_tt_yields_v37test1_isrdown_el_sel")->Print()

tt_yields_v37test1_nom_mu_sel->Get("tt_yields_v37test1_nom_mu_sel_tt_yields_v37test1_nom_mu_sel")->Print()
tt_yields_v37test1_fsrup_mu_sel->Get("tt_yields_v37test1_fsrup_mu_sel_tt_yields_v37test1_fsrup_mu_sel")->Print()
tt_yields_v37test1_fsrdown_mu_sel->Get("tt_yields_v37test1_fsrdown_mu_sel_tt_yields_v37test1_fsrdown_mu_sel")->Print()
tt_yields_v37test1_isrup_mu_sel->Get("tt_yields_v37test1_isrup_mu_sel_tt_yields_v37test1_isrup_mu_sel")->Print()
tt_yields_v37test1_isrdown_mu_sel->Get("tt_yields_v37test1_isrdown_mu_sel_tt_yields_v37test1_isrdown_mu_sel")->Print()


tt_yields_v37test1_nom_el_sel->Get("tt_yields_v37test1_nom_el_sel_tt_yields_v37test1_nom_el_sel")->Print()
 Name  = tt_yields_v37test1_nom_el_sel_tt_yields_v37test1_nom_el_sel, Entries= 39493, Total sum= 39493
tt_yields_v37test1_fsrup_el_sel->Get("tt_yields_v37test1_fsrup_el_sel_tt_yields_v37test1_fsrup_el_sel")->Print()
 Name  = tt_yields_v37test1_fsrup_el_sel_tt_yields_v37test1_fsrup_el_sel, Entries= 62113, Total sum= 62113
tt_yields_v37test1_fsrdown_el_sel->Get("tt_yields_v37test1_fsrdown_el_sel_tt_yields_v37test1_fsrdown_el_sel")->Print()
 Name  = tt_yields_v37test1_fsrdown_el_sel_tt_yields_v37test1_fsrdown_el_sel, Entries= 96223, Total sum= 96223
tt_yields_v37test1_isrup_el_sel->Get("tt_yields_v37test1_isrup_el_sel_tt_yields_v37test1_isrup_el_sel")->Print()
 Name  = tt_yields_v37test1_isrup_el_sel_tt_yields_v37test1_isrup_el_sel, Entries= 30082, Total sum= 0.000515432
tt_yields_v37test1_isrdown_el_sel->Get("tt_yields_v37test1_isrdown_el_sel_tt_yields_v37test1_isrdown_el_sel")->Print()
 Name  = tt_yields_v37test1_isrdown_el_sel_tt_yields_v37test1_isrdown_el_sel, Entries= 78255, Total sum= 0.000531874

el_sel = [39493 62113 96223 30082 78255]

tt_yields_v37test1_nom_mu_sel->Get("tt_yields_v37test1_nom_mu_sel_tt_yields_v37test1_nom_mu_sel")->Print()
 Name  = tt_yields_v37test1_nom_mu_sel_tt_yields_v37test1_nom_mu_sel, Entries= 62270, Total sum= 62270
tt_yields_v37test1_fsrup_mu_sel->Get("tt_yields_v37test1_fsrup_mu_sel_tt_yields_v37test1_fsrup_mu_sel")->Print()
 Name  = tt_yields_v37test1_fsrup_mu_sel_tt_yields_v37test1_fsrup_mu_sel, Entries= 95965, Total sum= 95965
 tt_yields_v37test1_fsrdown_mu_sel->Get("tt_yields_v37test1_fsrdown_mu_sel_tt_yields_v37test1_fsrdown_mu_sel")->Print()
TH1.Print Name  = tt_yields_v37test1_fsrdown_mu_sel_tt_yields_v37test1_fsrdown_mu_sel, Entries= 148605, Total sum= 148605
tt_yields_v37test1_isrup_mu_sel->Get("tt_yields_v37test1_isrup_mu_sel_tt_yields_v37test1_isrup_mu_sel")->Print()
 Name  = tt_yields_v37test1_isrup_mu_sel_tt_yields_v37test1_isrup_mu_sel, Entries= 46676, Total sum= 46676
tt_yields_v37test1_isrdown_mu_sel->Get("tt_yields_v37test1_isrdown_mu_sel_tt_yields_v37test1_isrdown_mu_sel")->Print()
TH1.Print Name  = tt_yields_v37test1_isrdown_mu_sel_tt_yields_v37test1_isrdown_mu_sel, Entries= 121649, Total sum= 121649

mu_sel = [62270 95965 148605 46676 121649]

coarsely compare stats with v25:

[olek@fermi04 proc]$ find  gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/ -name "*root" | wc -l
77
[olek@fermi04 proc]$ find gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/ -name "*root" | wc -l
243
[olek@fermi04 proc]$ find gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/ -name "*root" | wc -l
224
[olek@fermi04 proc]$ find gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/ -name "*root" | wc -l
222


[olek@fermi04 proc]$ find gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/ -name "*root" | wc -l
277
[olek@fermi04 proc]$ find gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/ -name "*root" | wc -l
265
[olek@fermi04 proc]$ find gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/ -name "*root" | wc -l
277
[olek@fermi04 proc]$ find gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/ -name "*root" | wc -l
322

correct numbers for fsrup and isrup:

fsrup_factor = 322. / 265.
isrup_factor = 243. /  77.

el_sel = [39493 62113*fsrup_factor 96223  30082*isrup_factor 78255]
mu_sel = [62270 95965*fsrup_factor 148605 46676*isrup_factor 121649]

julia> el_sel
 39493  75473  96223  94934  78255

julia> mu_sel
 62270  116607  148605  147302  121649

sqrt(el_sel) ./ el_sel
sqrt(mu_sel) ./ mu_sel

 0.00503199  0.00364002  0.00322374  0.00324555  0.00357474
 0.00400738  0.00292846  0.00259408  0.00260553  0.00286712


In the final selection (before splitting into event categories) for electron-tau channel approximate numbers are:
 39493 (nominal),  75473 (FSR Up),  96223 (FSR Down),  94934 (ISR Up),  78255 (ISR Down).
For muon-tau:
 62270 (nominal),  116607 (FSR Up),  148605 (FSR Down),  147302 (ISR Up),  121649 (ISR Down).
Approximate statistical uncertainty for each number of events, calculated as sqrt(number of events)/number of events, is:
in electron-tau 5% (nominal), 3.6 (FSR Up),  3.2 (FSR Down),  3.2 (ISR Up), 3.6 (ISR Down),
in muon-tau 4% (nominal), 2.9 (FSR Up),  2.6 (FSR Down),  2.6 (ISR Up), 2.9 (ISR Down).

scale factors per weight?



# final plots

## the stat unc in the yields table

python numbers_for_datacard.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -d Mt_lep_met_f -c el_sel,el_sel_lj,el_sel_ljout -y --sqrt-unc

                                 process       el_sel    el_sel_lj   el_sel_ljout
                                tt_eltau   $      7701 \pm         46 $   $      3010 \pm         29 $   $      4691 \pm         36 $
                             tt_taultauh   $       450 \pm         11 $   $       170 \pm          7 $   $       280 \pm          9 $
                                   tt_lj   $      3672 \pm         20 $   $      2215 \pm         16 $   $      1457 \pm         13 $
                                tt_taulj   $       194 \pm          5 $   $       118 \pm          4 $   $        76 \pm          3 $
                                tt_other   $       160 \pm          5 $   $        60 \pm          3 $   $       100 \pm          4 $
                             s_top_eltau   $       427 \pm          8 $   $       152 \pm          5 $   $       274 \pm          6 $
                             s_top_other   $        52 \pm          2 $   $        21 \pm          1 $   $        31 \pm          2 $
                                s_top_lj   $       319 \pm          4 $   $       151 \pm          3 $   $       169 \pm          3 $
                               dy_tautau   $       293 \pm         19 $   $       103 \pm         13 $   $       190 \pm         14 $
                                dy_other   $       137 \pm         11 $   $        34 \pm          6 $   $       103 \pm          9 $
                             wjets_other   $       436 \pm         11 $   $       194 \pm         10 $   $       241 \pm          6 $
                              wjets_taul   $        14 \pm          2 $   $         7 \pm          1 $   $         7 \pm          1 $
                              wjets_tauh   $         1 \pm          1 $   $         0 \pm          0 $   $         1 \pm          1 $
                                dibosons   $        44 \pm          3 $   $        13 \pm          1 $   $        31 \pm          2 $
                                     qcd   $       463 \pm         32 $   $       136 \pm         21 $   $       327 \pm         24 $
aaa!
                                mc_resum    14364.069     6383.362     7980.707
                                   total   $     14364 \pm         67 $   $      6383 \pm         44 $   $      7981 \pm         50 $
                                    data   $     14096 \pm        120 $   $      6190 \pm         79 $   $      7906 \pm         90 $


--- a bit more MC than in AN.... data is on the spot (data was from v23?)

python numbers_for_datacard.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -d Mt_lep_met_f -c mu_sel,mu_sel_lj,mu_sel_ljout -y --sqrt-unc

                                 process       mu_sel    mu_sel_lj   mu_sel_ljout
                                tt_mutau   $     13062 \pm         61 $   $      5136 \pm         38 $   $      7926 \pm         47 $
                             tt_taultauh   $       845 \pm         15 $   $       328 \pm          9 $   $       517 \pm         12 $
                                   tt_lj   $      6289 \pm         27 $   $      3757 \pm         21 $   $      2532 \pm         17 $
                                tt_taulj   $       401 \pm          7 $   $       240 \pm          5 $   $       161 \pm          4 $
                                tt_other   $       285 \pm          6 $   $       104 \pm          4 $   $       181 \pm          5 $
                             s_top_mutau   $       682 \pm         10 $   $       232 \pm          6 $   $       450 \pm          8 $
                             s_top_other   $       101 \pm          3 $   $        40 \pm          2 $   $        61 \pm          2 $
                                s_top_lj   $       531 \pm          6 $   $       235 \pm          4 $   $       296 \pm          4 $
                               dy_tautau   $       624 \pm         28 $   $       200 \pm         15 $   $       424 \pm         24 $
                                dy_other   $        84 \pm         10 $   $        22 \pm          5 $   $        62 \pm          8 $
                             wjets_other   $       738 \pm         12 $   $       303 \pm          8 $   $       434 \pm          8 $
                              wjets_taul   $        27 \pm          2 $   $        11 \pm          1 $   $        16 \pm          2 $
                              wjets_tauh   $         0 \pm          0 $   $         0 \pm          0 $   $         0 \pm          0 $
                                dibosons   $        84 \pm          4 $   $        25 \pm          2 $   $        58 \pm          3 $
                                     qcd   $       430 \pm         25 $   $       173 \pm         15 $   $       258 \pm         19 $
aaa!
                                mc_resum    24181.955    10805.584    13376.781
                                   total   $     24182 \pm         81 $   $     10806 \pm         52 $   $     13377 \pm         62 $
                                    data   $     23801 \pm        155 $   $     10251 \pm        102 $   $     13550 \pm        117 $

-- again same data, more MC





## OS/SS factor plot with vertical lines for iso region

ok muons

python stack_plot.py ../sw-dir/jobsums/mc_v27p1.root ../lstore_outdirs/merge-sets/v27/p1/SingleMuon.root -o plots/answers_to_paper-draft-3_an-version-7/ --lumi 34800 --osss -c ctr_old_mu_presel_alliso -p -d lep_relIso --wjets 0.8 --factor-dy 1.05 --lumi-label 35800 --title "" --title-x "relative Isolation of muon" --y-range 0,1.5 --vert-lines 0.15

python stack_plot.py ../sw-dir/jobsums/mc_v27p1.root ../lstore_outdirs/merge-sets/v27/p1/SingleMuon.root        -o plots/answers_to_paper-draft-3_an-version-7/ --lumi 34800 --osss -c ctr_old_mu_presel_alliso -p -d lep_relIso --wjets 0.8 --factor-dy 1.05 --lumi-label 35800 --title "" --title-x "relative Isolation of muon" --y-range 0,1.5 --vert-lines 0.15

muons

python stack_plot.py v23p1_mc.root ../merge-sets/v23/p1_data/SingleMuon.root     -o plots/answers_to_paper-draft-3_an-version-7/ --lumi 32800 --osss -c ctr_old_mu_presel_alliso -p -d lep_relIso --wjets 0.8 --factor-dy 1.05 --lumi-label 35800 --title "" --title-x "relative Isolation of muon" --y-range 0,1.2



v23p1

python stack_plot.py ../sw-dir/jobsums/mc_norm/v23p1_backups/v23p1_mc_fast.root ../sw-dir/jobsums/mc_norm/v23p1_backups/v23p1_mc_fast.root   -o plots/answers_to_paper-draft-3_an-version-7/ --lumi 30000 --osss -c ctr_old_el_presel_alliso -p -d lep_relIso_el --lumi 30000 --wjets 0.8 --factor-dy 1.05 --lumi-label 31300 --title "" --title-x "relative Isolation of electron" --y-range 0,1.2

-- no v23 data is left after the removals.........................!

mix v27 data:

python stack_plot.py ../sw-dir/jobsums/mc_norm/v23p1_backups/v23p1_mc_fast.root ../lstore_outdirs/merge-sets/v27/p1/SingleElectron.root   -o plots/answers_to_paper-draft-3_an-version-7/ --lumi 30000 --osss -c ctr_old_el_presel_alliso -p -d lep_relIso_el --lumi 30000 --wjets 0.8 --factor-dy 1.05 --lumi-label 31300 --title "" --title-x "relative Isolation of electron" --y-range 0,1.2

-- no, same last bin problem


no ss:

../sw-dir/jobsums/plots/paper-draft-1_an-version-3/v23p1_mc_HISTOSEL_lep_relIso_el_ctr_old_el_presel_alliso_NOMINAL.root

with ss:
../sw-dir/jobsums/mc_norm/v23p1_backups/v23p1_mc_fast.root


hadd v27p1_
../sw-dir/jobsums/histosel-roots/mc_v27p1_HISTOSEL_lep_relIso_ctr_old_el_presel_alliso_NOMINAL.root
../sw-dir/jobsums/histosel-roots/mc_v27p1_HISTOSEL_lep_relIso_el_ctr_old_el_presel_alliso_ss_NOMINAL.root


and in v27

python stack_plot.py ../sw-dir/jobsums/mc_v27p1.root ../lstore_outdirs/merge-sets/v27/p1/SingleElectron.root    -o plots/answers_to_paper-draft-3_an-version-7/ --lumi 31300 --osss -c ctr_old_el_presel_alliso -p -d lep_relIso_el --wjets 0.8 --factor-dy 1.05 --y-range 0,1.4

-- last bin is a bit up

../sw-dir/jobsums/mc_v27p1_amcatnlo1.root

python stack_plot.py ../sw-dir/jobsums/mc_v27p1_amcatnlo1.root ../lstore_outdirs/merge-sets/v27/p1/SingleElectron.root    -o plots/answers_to_paper-draft-3_an-version-7/ --lumi 31300 --osss -c ctr_old_el_presel_alliso -p -d lep_relIso_el --wjets 0.8 --factor-dy 1.05 --y-range 0,1.5 --title "" --title-x "relative Isolation of electron"  --vert-lines 0.058

-- same bin up

v28 data? -- pF does not have antiiso

another v27?
pR10 -- no antiiso



## mT shape in signal- and background-enriched categories

python get_shapes.py --norm-binwidth --formula "sig-enriched:bckg-enriched" sig-enriched:histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root:el_sel_ljout/tt_eltau/NOMINAL/Mt_lep_met_f   bckg-enriched:histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root:el_sel_lj/tt_eltau/NOMINAL/Mt_lep_met_f

python get_shapes.py --norm-binwidth --formula "sig-enriched:bckg-enriched" sig-enriched:histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root:mu_sel_ljout/tt_mutau/NOMINAL/Mt_lep_met_f   bckg-enriched:histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root:mu_sel_lj/tt_mutau/NOMINAL/Mt_lep_met_f

-- there is a slight difference, but within the stats?

python get_shapes.py --norm-binwidth --formula "s_sig-enriched:s_bckg-enriched:b_sig-enriched:b_bckg-enriched" s_sig-enriched:histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root:mu_sel_ljout/tt_mutau/NOMINAL/Mt_lep_met_f   s_bckg-enriched:histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root:mu_sel_lj/tt_mutau/NOMINAL/Mt_lep_met_f   b_sig-enriched:histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root:mu_sel_ljout/tt_lj/NOMINAL/Mt_lep_met_f   b_bckg-enriched:histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root:mu_sel_lj/tt_lj/NOMINAL/Mt_lep_met_f

-- yeah, the difference with backgrounds is much stronger

python get_shapes.py --y-range 0,0.015 --left-title --x-title "M_{T}(e, MET) [GeV]" --y-title "arbitrary units" --outname compare_Mt_shape_signal-bckg_tt-eltau-tt-eljets_sigrich.png.png --norm-binwidth --formula "signal:background" signal:distrs/distrs_v25v26_resub3_mc.root:el_sel_ljout/tt_eltau/NOMINAL/Mt_lep_met_c   background:distrs/distrs_v25v26_resub3_mc.root:el_sel_ljout/tt_lj/NOMINAL/Mt_lep_met_c

python get_shapes.py --y-range 0,0.015 --left-title --x-title "M_{T}(e, MET) [GeV]" --y-title "arbitrary units" --outname compare_Mt_shape_signal-bckg_tt-eltau-tt-eljets_bkgrich.png.png --norm-binwidth --formula "signal:background" signal:distrs/distrs_v25v26_resub3_mc.root:el_sel_lj/tt_eltau/NOMINAL/Mt_lep_met_c   background:distrs/distrs_v25v26_resub3_mc.root:el_sel_lj/tt_lj/NOMINAL/Mt_lep_met_c

python get_shapes.py --y-range 0,0.015 --left-title --x-title "M_{T}(#mu, MET) [GeV]" --y-title "arbitrary units" --outname compare_Mt_shape_signal-bckg_tt-mutau-tt-mujets_sigrich.png.png --norm-binwidth --formula "signal:background" signal:distrs/distrs_v25v26_resub3_mc.root:mu_sel_ljout/tt_mutau/NOMINAL/Mt_lep_met_c   background:distrs/distrs_v25v26_resub3_mc.root:mu_sel_ljout/tt_lj/NOMINAL/Mt_lep_met_c

python get_shapes.py --y-range 0,0.015 --left-title --x-title "M_{T}(#mu, MET) [GeV]" --y-title "arbitrary units" --outname compare_Mt_shape_signal-bckg_tt-mutau-tt-mujets_bkgrich.png.png --norm-binwidth --formula "signal:background" signal:distrs/distrs_v25v26_resub3_mc.root:mu_sel_lj/tt_mutau/NOMINAL/Mt_lep_met_c   background:distrs/distrs_v25v26_resub3_mc.root:mu_sel_lj/tt_lj/NOMINAL/Mt_lep_met_c

-- yeah, the peak of bckg is sharper in sigrich....


## all the systematic variations

ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root
ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root

histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root

PUUp,PUDown
TOPPTUp,TOPPTDown

bSFUp,bSFDown
TESUp,TESDown
JESUp,JESDown
JERUp,JERDown

FragUp,FragDown
PetersonUp,PetersonDown
SemilepBRUp,SemilepBRDown

MfUp,MfDown
MfrUp,MfrDown
MrUp,MrDown

LEPelIDUp
LEPelIDDown
LEPelTRGUp
LEPelTRGDown

LEPmuIDUp
LEPmuIDDown
LEPmuTRGUp
LEPmuTRGDown

test:

python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root --y-max 1500 -c el_sel_lj    -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o an-v7-and-paper-draft-3_answers/sys-vars/ --outname el_sel_lj_all_Mt_lep_met_f_PUUp,PUDown.png
python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root --y-max 1500 -c el_sel_ljout -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o an-v7-and-paper-draft-3_answers/sys-vars/ --outname el_sel_ljout_all_Mt_lep_met_f_PUUp,PUDown.png

python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root --y-max 2500 -c mu_sel_lj    -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o an-v7-and-paper-draft-3_answers/sys-vars/ --outname mu_sel_lj_all_Mt_lep_met_f_PUUp,PUDown.png
python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root --y-max 2500 -c mu_sel_ljout -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o an-v7-and-paper-draft-3_answers/sys-vars/ --outname mu_sel_ljout_all_Mt_lep_met_f_PUUp,PUDown.png

with Tight selection:

./histosels/HISTOSELS_redo_v25v26_resub3_shaped.root
./histosels/HISTOSELS_redo_v25v26_resub3_noshapes.root

python mc_per_sys.py --ratio-range 0.1 ./histosels/HISTOSELS_redo_v25v26_resub3_shaped.root   --y-max 1500 -c el_selTight_lj    -d Mt_lep_met_c -s PUUp,PUDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o an-v7-and-paper-draft-3_answers/sys-vars/ --outname el_sel_lj_all_Mt_lep_met_f_PUUp,PUDown_Tight_shaped.png
python mc_per_sys.py --ratio-range 0.1 ./histosels/HISTOSELS_redo_v25v26_resub3_noshapes.root --y-max 1500 -c el_selTight_lj    -d Mt_lep_met_c -s PUUp,PUDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o an-v7-and-paper-draft-3_answers/sys-vars/ --outname el_sel_lj_all_Mt_lep_met_f_PUUp,PUDown_Tight_noshapes.png

-- shaped has much smaller band

try this for MC stat:

python mc_per_sys.py --ratio-range 0.1 histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root --y-max 1500 -c el_sel_lj    -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o an-v7-and-paper-draft-3_answers/sys-vars/ --outname el_sel_lj_all_Mt_lep_met_f_PUUp,PUDown_std.png
python mc_per_sys.py --ratio-range 0.1 ./histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1.root --y-max 1500 -c el_sel_lj    -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o an-v7-and-paper-draft-3_answers/sys-vars/ --outname el_sel_lj_all_Mt_lep_met_f_PUUp,PUDown_another.png

-- same shade size


foreach sysdef (PUUp,PUDown)

foreach sysdef (PUUp,PUDown TOPPTUp,TOPPTDown bSFUp,bSFDown TESUp,TESDown JESUp,JESDown JERUp,JERDown FragUp,FragDown PetersonUp,PetersonDown SemilepBRUp,SemilepBRDown MfUp,MfDown MfrUp,MfrDown MrUp,MrDown)
python mc_per_sys.py --ratio-range 0.1 --y-max 1500. histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -c el_sel_lj    -d Mt_lep_met_f -s $sysdef --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o an-v7-and-paper-draft-3_answers/sys-vars/ --outname el_sel_lj_all_Mt_lep_met_f_$sysdef.png
python mc_per_sys.py --ratio-range 0.1 --y-max 1500. histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -c el_sel_ljout -d Mt_lep_met_f -s $sysdef --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o an-v7-and-paper-draft-3_answers/sys-vars/ --outname el_sel_ljout_all_Mt_lep_met_f_$sysdef.png

python mc_per_sys.py --ratio-range 0.1 --y-max 2500. histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -c mu_sel_lj    -d Mt_lep_met_f -s $sysdef --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o an-v7-and-paper-draft-3_answers/sys-vars/ --outname mu_sel_lj_all_Mt_lep_met_f_$sysdef.png
python mc_per_sys.py --ratio-range 0.1 --y-max 2500. histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -c mu_sel_ljout -d Mt_lep_met_f -s $sysdef --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o an-v7-and-paper-draft-3_answers/sys-vars/ --outname mu_sel_ljout_all_Mt_lep_met_f_$sysdef.png
end


foreach sysdef ( LEPelIDUp,LEPelIDDown LEPelTRGUp,LEPelTRGDown)
python mc_per_sys.py --ratio-range 0.1 --y-max 1500 histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -c el_sel_lj    -d Mt_lep_met_f -s $sysdef --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o an-v7-and-paper-draft-3_answers/sys-vars/ --outname el_sel_lj_all_Mt_lep_met_f_$sysdef.png
python mc_per_sys.py --ratio-range 0.1 --y-max 1500 histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -c el_sel_ljout -d Mt_lep_met_f -s $sysdef --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o an-v7-and-paper-draft-3_answers/sys-vars/ --outname el_sel_ljout_all_Mt_lep_met_f_$sysdef.png
end

foreach sysdef ( LEPmuIDUp,LEPmuIDDown LEPmuTRGUp,LEPmuTRGDown)
python mc_per_sys.py --ratio-range 0.1 --y-max 2500. histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -c mu_sel_lj    -d Mt_lep_met_f -s $sysdef --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o an-v7-and-paper-draft-3_answers/sys-vars/ --outname mu_sel_lj_all_Mt_lep_met_f_$sysdef.png
python mc_per_sys.py --ratio-range 0.1 --y-max 2500. histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -c mu_sel_ljout -d Mt_lep_met_f -s $sysdef --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o an-v7-and-paper-draft-3_answers/sys-vars/ --outname mu_sel_ljout_all_Mt_lep_met_f_$sysdef.png
end



python mc_per_sys.py --y-max 80. plots/distrs_v25v26resub2_sys_var_tauID_misID/distrs/histosel.root -c el_sel_lj    -d Mt_lep_met_f -s $sysdef --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o an-v7-and-paper-draft-3_answers/sys-var_tauid-misid/ --outname el_sel_lj_all_Mt_lep_met_f_TauMisIDUp,TauMisIDDown.png
python mc_per_sys.py --y-max 80. plots/distrs_v25v26resub2_sys_var_tauID_misID/distrs/histosel.root -c el_sel_ljout -d Mt_lep_met_f -s $sysdef --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o an-v7-and-paper-draft-3_answers/sys-var_tauid-misid/ --outname el_sel_ljout_all_Mt_lep_met_f_$sysdef.png

python mc_per_sys.py --y-max 150. plots/distrs_v25v26resub2_sys_var_tauID_misID/distrs/histosel.root -c mu_sel_lj    -d Mt_lep_met_f -s $sysdef --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o an-v7-and-paper-draft-3_answers/sys-var_tauid-misid/ --outname mu_sel_lj_all_Mt_lep_met_f_$sysdef.png
python mc_per_sys.py --y-max 150. plots/distrs_v25v26resub2_sys_var_tauID_misID/distrs/histosel.root -c mu_sel_ljout -d Mt_lep_met_f -s $sysdef --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " -o an-v7-and-paper-draft-3_answers/sys-var_tauid-misid/ --outname mu_sel_ljout_all_Mt_lep_met_f_$sysdef.png



### the tau ID and tau mis-ID variation

distrs/distrs_redo_v25v26_alldata_4.root

root [4] mu_sel->Get("data/NOMINAL/mu_sel_data_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_data_NOMINAL_Mt_lep_met_f, Entries= 24147, Total sum= 23801

and histosel:

root [1] mu_sel->Get("data/NOMINAL/mu_sel_data_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_data_NOMINAL_Mt_lep_met_f, Entries= 24147, Total sum= 23801

-- same

try the tauID and misID

python stack_plot.py distrs/distrs_redo_v25v26_alldata_4.root distrs/distrs_redo_v25v26_alldata_4.root  -o plots/distrs_redo_v25v26_alldata_4_sys_var_tauID_misID/ -p -r -c mu_sel --data-nick data -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd 1.05 --overwrite --wjets 0.8

python stack_plot.py distrs/distrs_redo_v25v26_alldata_4.root distrs/distrs_redo_v25v26_alldata_4.root  -o plots/distrs_redo_v25v26_alldata_4_sys_var_tauID_misID/ -p -r -c el_sel --data-nick data -d Mt_lep_met_f --bin-norm --lumi 31300 --qcd 1.05 --overwrite --wjets 0.8

-- no el data

lrwxrwxrwx 1 olek t3cms 42 Jan  9 13:25 ../quick-test/v25v26-resub4_hadds/SingleElectron.root -> ../v25v26-resub3_hadds/SingleElectron.root
lrwxrwxrwx 1 olek t3cms 38 Jan  9 13:25 ../quick-test/v25v26-resub4_hadds/SingleMuon.root -> ../v25v26-resub3_hadds/SingleMuon.root

[olek@fermi04 jobsums]$ root -l ../quick-test/v25v26-resub4_hadds/SingleElectron.root 
root [2] el_sel->Get("data/NOMINAL/el_sel_data_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = el_sel_data_NOMINAL_Mt_lep_met_f, Entries= 14383, Total sum= 14096

python stack_plot.py distrs/distrs_redo_v25v26_alldata_4.root ../quick-test/v25v26-resub4_hadds/SingleElectron.root  -o plots/distrs_redo_v25v26_alldata_4_sys_var_tauID_misID/ -p -r -c el_sel --data-nick data -d Mt_lep_met_c --bin-norm --lumi 31300 --qcd 1.05 --overwrite --wjets 0.8

    qcd_hist = data_hist - mc_hist
TypeError: unsupported operand type(s) for -: 'TH1F' and 'TH1D'

???

python stack_plot.py distrs/v25v26_redo_4_mc.root ../quick-test/v25v26-resub4_hadds/SingleElectron.root  -o plots/distrs_redo_v25v26_alldata_4_sys_var_tauID_misID/ -p -r -c el_sel --data-nick data -d Mt_lep_met_f --bin-norm --lumi 31300 --qcd 1.05 --overwrite --wjets 0.8

from histos_1

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleElectron.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/ -p -r -c el_sel       --data-nick data -d Mt_lep_met_f --bin-norm --lumi 31300 --qcd 1.05 --overwrite --wjets 0.8

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleElectron.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/ -p -r -c el_sel_lj    --data-nick data -d Mt_lep_met_f --bin-norm --lumi 31300 --qcd 1.05 --overwrite --wjets 0.8
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleElectron.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/ -p -r -c el_sel_ljout --data-nick data -d Mt_lep_met_f --bin-norm --lumi 31300 --qcd 1.05 --overwrite --wjets 0.8

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/ -p -r -c mu_sel_lj    --data-nick data -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd 1.05 --overwrite --wjets 0.8
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/ -p -r -c mu_sel_ljout --data-nick data -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd 1.05 --overwrite --wjets 0.8

-- ok

produce the variations from NOMINAL distrs:

nominals

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/  -c mu_sel_lj    --data-nick data -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd 1.05 --overwrite --wjets 0.8
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/  -c mu_sel_ljout --data-nick data -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd 1.05 --overwrite --wjets 0.8

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleElectron.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/  -c el_sel_lj    --data-nick data -d Mt_lep_met_f --bin-norm --lumi 31300 --qcd 1.05 --overwrite --wjets 0.8
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleElectron.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/  -c el_sel_ljout --data-nick data -d Mt_lep_met_f --bin-norm --lumi 31300 --qcd 1.05 --overwrite --wjets 0.8

tauID

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/  -c mu_sel_lj    --data-nick data -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd 1.05 --overwrite --wjets 0.8  --rename-sys TauIDDown --factor-rate-systematic tt_mutau,tt_eltau,tt_taultauh,s_top_mutau,s_top_eltau,s_top_other,dy_tautau:0.95
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/  -c mu_sel_ljout --data-nick data -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd 1.05 --overwrite --wjets 0.8  --rename-sys TauIDDown --factor-rate-systematic tt_mutau,tt_eltau,tt_taultauh,s_top_mutau,s_top_eltau,s_top_other,dy_tautau:0.95

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/  -c mu_sel_lj    --data-nick data -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd 1.05 --overwrite --wjets 0.8  --rename-sys TauIDUp   --factor-rate-systematic tt_mutau,tt_eltau,tt_taultauh,s_top_mutau,s_top_eltau,s_top_other,dy_tautau:1.05
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/  -c mu_sel_ljout --data-nick data -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd 1.05 --overwrite --wjets 0.8  --rename-sys TauIDUp   --factor-rate-systematic tt_mutau,tt_eltau,tt_taultauh,s_top_mutau,s_top_eltau,s_top_other,dy_tautau:1.05

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleElectron.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/  -c el_sel_lj    --data-nick data -d Mt_lep_met_f --bin-norm --lumi 31300 --qcd 1.05 --overwrite --wjets 0.8  --rename-sys TauIDDown --factor-rate-systematic tt_mutau,tt_eltau,tt_taultauh,s_top_mutau,s_top_eltau,s_top_other,dy_tautau:0.95
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleElectron.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/  -c el_sel_ljout --data-nick data -d Mt_lep_met_f --bin-norm --lumi 31300 --qcd 1.05 --overwrite --wjets 0.8  --rename-sys TauIDDown --factor-rate-systematic tt_mutau,tt_eltau,tt_taultauh,s_top_mutau,s_top_eltau,s_top_other,dy_tautau:0.95

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleElectron.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/  -c el_sel_lj    --data-nick data -d Mt_lep_met_f --bin-norm --lumi 31300 --qcd 1.05 --overwrite --wjets 0.8  --rename-sys TauIDUp   --factor-rate-systematic tt_mutau,tt_eltau,tt_taultauh,s_top_mutau,s_top_eltau,s_top_other,dy_tautau:1.05
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleElectron.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/  -c el_sel_ljout --data-nick data -d Mt_lep_met_f --bin-norm --lumi 31300 --qcd 1.05 --overwrite --wjets 0.8  --rename-sys TauIDUp   --factor-rate-systematic tt_mutau,tt_eltau,tt_taultauh,s_top_mutau,s_top_eltau,s_top_other,dy_tautau:1.05

misID

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/  -c mu_sel_lj    --data-nick data -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd 1.05 --overwrite --wjets 0.8  --rename-sys TauMisIDDown --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj,dibosons:0.5
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/  -c mu_sel_ljout --data-nick data -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd 1.05 --overwrite --wjets 0.8  --rename-sys TauMisIDDown --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj,dibosons:0.5

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/  -c mu_sel_lj    --data-nick data -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd 1.05 --overwrite --wjets 0.8  --rename-sys TauMisIDUp   --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj,dibosons:1.5
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/  -c mu_sel_ljout --data-nick data -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd 1.05 --overwrite --wjets 0.8  --rename-sys TauMisIDUp   --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj,dibosons:1.5


python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleElectron.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/  -c el_sel_lj    --data-nick data -d Mt_lep_met_f --bin-norm --lumi 31300 --qcd 1.05 --overwrite --wjets 0.8  --rename-sys TauMisIDDown --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj,dibosons:0.5
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleElectron.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/  -c el_sel_ljout --data-nick data -d Mt_lep_met_f --bin-norm --lumi 31300 --qcd 1.05 --overwrite --wjets 0.8  --rename-sys TauMisIDDown --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj,dibosons:0.5

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleElectron.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/  -c el_sel_lj    --data-nick data -d Mt_lep_met_f --bin-norm --lumi 31300 --qcd 1.05 --overwrite --wjets 0.8  --rename-sys TauMisIDUp   --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj,dibosons:1.5
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleElectron.root  -o plots/distrs_v25v26resub2_sys_var_tauID_misID/  -c el_sel_ljout --data-nick data -d Mt_lep_met_f --bin-norm --lumi 31300 --qcd 1.05 --overwrite --wjets 0.8  --rename-sys TauMisIDUp   --factor-rate-systematic tt_lj,tt_taulj,tt_other,s_top_lj,dibosons:1.5

hadd plots/distrs_v25v26resub2_sys_var_tauID_misID/distrs/histosel.root plots/distrs_v25v26resub2_sys_var_tauID_misID/distrs/distrs*root

variations of the MC sum:

python mc_per_sys.py --y-max 80. plots/distrs_v25v26resub2_sys_var_tauID_misID/distrs/histosel.root -c el_sel_lj    -d Mt_lep_met_f -s TauIDUp,TauIDDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " --outname el_sel_lj_all_Mt_lep_met_f_TauIDUp,TauIDDown.png
python mc_per_sys.py --y-max 80. plots/distrs_v25v26resub2_sys_var_tauID_misID/distrs/histosel.root -c el_sel_ljout -d Mt_lep_met_f -s TauIDUp,TauIDDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " --outname el_sel_ljout_all_Mt_lep_met_f_TauIDUp,TauIDDown.png

python mc_per_sys.py --y-max 150. plots/distrs_v25v26resub2_sys_var_tauID_misID/distrs/histosel.root -c mu_sel_lj    -d Mt_lep_met_f -s TauIDUp,TauIDDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " --outname mu_sel_lj_all_Mt_lep_met_f_TauIDUp,TauIDDown.png
python mc_per_sys.py --y-max 150. plots/distrs_v25v26resub2_sys_var_tauID_misID/distrs/histosel.root -c mu_sel_ljout -d Mt_lep_met_f -s TauIDUp,TauIDDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " --outname mu_sel_ljout_all_Mt_lep_met_f_TauIDUp,TauIDDown.png


python mc_per_sys.py --y-max 80. plots/distrs_v25v26resub2_sys_var_tauID_misID/distrs/histosel.root -c el_sel_lj    -d Mt_lep_met_f -s TauMisIDUp,TauMisIDDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " --outname el_sel_lj_all_Mt_lep_met_f_TauMisIDUp,TauMisIDDown.png
python mc_per_sys.py --y-max 80. plots/distrs_v25v26resub2_sys_var_tauID_misID/distrs/histosel.root -c el_sel_ljout -d Mt_lep_met_f -s TauMisIDUp,TauMisIDDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " --outname el_sel_ljout_all_Mt_lep_met_f_TauMisIDUp,TauMisIDDown.png

python mc_per_sys.py --y-max 150. plots/distrs_v25v26resub2_sys_var_tauID_misID/distrs/histosel.root -c mu_sel_lj    -d Mt_lep_met_f -s TauMisIDUp,TauMisIDDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " --outname mu_sel_lj_all_Mt_lep_met_f_TauMisIDUp,TauMisIDDown.png
python mc_per_sys.py --y-max 150. plots/distrs_v25v26resub2_sys_var_tauID_misID/distrs/histosel.root -c mu_sel_ljout -d Mt_lep_met_f -s TauMisIDUp,TauMisIDDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]" --title " " --outname mu_sel_ljout_all_Mt_lep_met_f_TauMisIDUp,TauMisIDDown.png


el lj     80
el ljout  80
mu lj    150
mu ljout 150

TODO: automate, write it up in the Makefile


### tauID and misID in old files -- not implemented all necessary stuff in the mc_per_sys

old files:

python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -p tt_lj -c el_sel_lj    -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]"



## difference in el and mu shapes

python get_shapes.py --norm-binwidth --y-range 0,0.01 --formula "el:mu" el:distrs/v25v26_redo_4_mc.root:el_sel/tt_eltau/NOMINAL/Mt_lep_met_f mu:distrs/v25v26_redo_4_mc.root:mu_sel/tt_mutau/NOMINAL/Mt_lep_met_f

## wjets control region

-- not enough inclusive WJets
weight
"MC2016_Summer16_WJets_madgraph" : 51952262.172543,
instead 85737026.803850,

-- plugged new weights

python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleMuon.root -o plots/v37_test5_bunch1/ -p -r -c wjets_mu --data-nick data_other -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd-factor 2.0 --overwrite --wjets 0.95

python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleElectron.root -o plots/v37_test5_bunch1/ -p -r -c wjets_el --data-nick data_other -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd-factor 2.5 --overwrite --wjets 0.95

-- the weight for MC QCD is 2.5 in electron channel
   plus couple of bins with gigantic error

python stack_plot.py distrs/v37_test5_bunch1_mc_2_wNjets.root distrs/v37_test5_bunch1/SingleMuon.root -o plots/v37_test5_bunch1/ -p -r -c wjets_mu --data-nick data_other -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd-factor 2.0 --overwrite --wjets 1.4

python stack_plot.py distrs/v37_test5_bunch1_mc_2_wNjets.root distrs/v37_test5_bunch1/SingleElectron.root -o plots/v37_test5_bunch1/ -p -r -c wjets_el --data-nick data_other -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd-factor 2.8 --overwrite --wjets 1.4

??? 1.4 for WJets ???

### the control plots for the deviation

python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleMuon.root     -o plots/v37_test5_bunch1/ -p -r -c wjets_mu --data-nick data_other -d lep_eta --bin-norm --lumi 35800 --qcd-factor 2.0 --overwrite --wjets 0.95
python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleElectron.root -o plots/v37_test5_bunch1/ -p -r -c wjets_el --data-nick data_other -d lep_eta --bin-norm --lumi 35800 --qcd-factor 2.5 --overwrite --wjets 0.95

python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleMuon.root     -o plots/v37_test5_bunch1/ -p -r -c wjets_mu --data-nick data_other -d lep_pt --bin-norm --lumi 35800 --qcd-factor 2.0 --overwrite --wjets 0.95
python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleElectron.root -o plots/v37_test5_bunch1/ -p -r -c wjets_el --data-nick data_other -d lep_pt --bin-norm --lumi 35800 --qcd-factor 2.5 --overwrite --wjets 0.95

python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleMuon.root     -o plots/v37_test5_bunch1/ -p -r -c wjets_mu --data-nick data_other -d met_c --bin-norm --lumi 35800 --qcd-factor 2.0 --overwrite --wjets 0.95
python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleElectron.root -o plots/v37_test5_bunch1/ -p -r -c wjets_el --data-nick data_other -d met_c --bin-norm --lumi 35800 --qcd-factor 2.5 --overwrite --wjets 0.95

python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleMuon.root     -o plots/v37_test5_bunch1/ -p -r -c wjets_mu --data-nick data_other -d phi_met_lep --bin-norm --lumi 35800 --qcd-factor 2.0 --overwrite --wjets 0.95
python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleElectron.root -o plots/v37_test5_bunch1/ -p -r -c wjets_el --data-nick data_other -d phi_met_lep --bin-norm --lumi 35800 --qcd-factor 2.5 --overwrite --wjets 0.95

python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleMuon.root     -o plots/v37_test5_bunch1/ -p -r -c wjets_mu --data-nick data_other -d cos_phi_met_lep --bin-norm --lumi 35800 --qcd-factor 2.0 --overwrite --wjets 0.95
python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleElectron.root -o plots/v37_test5_bunch1/ -p -r -c wjets_el --data-nick data_other -d cos_phi_met_lep --bin-norm --lumi 35800 --qcd-factor 2.5 --overwrite --wjets 0.95


## dy dilepton mass

python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleMuon.root     -o plots/v37_test5_bunch1/ -p -r -c dy_mumu --data-nick data_other -d lep_pt --bin-norm --lumi 35800 --qcd-factor 2.0 --overwrite --wjets 0.95 --factor-dy 1.1
python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleElectron.root -o plots/v37_test5_bunch1/ -p -r -c dy_elel --data-nick data_other -d lep_pt --bin-norm --lumi 35800 --qcd-factor 2.5 --overwrite --wjets 0.95

??? dy mumu needs 10% normalization correction but elel is ok ??? what's with lep efficiency SFs?
   (also there is a tren at high pT?)

python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleMuon.root     -o plots/v37_test5_bunch1/ -p -r -c dy_mumu --data-nick data_other -d lep_eta --bin-norm --lumi 35800 --qcd-factor 2.0 --overwrite --wjets 0.95 --factor-dy 1.1
python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleElectron.root -o plots/v37_test5_bunch1/ -p -r -c dy_elel --data-nick data_other -d lep_eta --bin-norm --lumi 35800 --qcd-factor 2.5 --overwrite --wjets 0.95

python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleMuon.root     -o plots/v37_test5_bunch1/ -p -r -c dy_mumu --data-nick data_other -d met_c --bin-norm --lumi 35800 --qcd-factor 2.0 --overwrite --wjets 0.95 --factor-dy 1.1
python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleElectron.root -o plots/v37_test5_bunch1/ -p -r -c dy_elel --data-nick data_other -d met_c --bin-norm --lumi 35800 --qcd-factor 2.5 --overwrite --wjets 0.95

python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleMuon.root     -o plots/v37_test5_bunch1/ -p -r -c dy_mumu --data-nick data_other -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd-factor 2.0 --overwrite --wjets 0.95 --factor-dy 1.1
python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleElectron.root -o plots/v37_test5_bunch1/ -p -r -c dy_elel --data-nick data_other -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd-factor 2.5 --overwrite --wjets 0.95

python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleMuon.root     -o plots/v37_test5_bunch1/ -p -r -c dy_mumu --data-nick data_other -d dilep_mass_dy --bin-norm --lumi 35800 --qcd-factor 2.0 --overwrite --wjets 0.95 --factor-dy 1.1
python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleElectron.root -o plots/v37_test5_bunch1/ -p -r -c dy_elel --data-nick data_other -d dilep_mass_dy --bin-norm --lumi 35800 --qcd-factor 2.5 --overwrite --wjets 0.95


was not stored:

python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleMuon.root     -o plots/v37_test5_bunch1/ -p -r -c dy_mumu --data-nick data_other -d met_init_f --bin-norm --lumi 35800 --qcd-factor 2.0 --overwrite --wjets 0.95 --factor-dy 1.1
python stack_plot.py distrs/v37_test5_bunch1_mc_2_wjets_amcatnlo.root distrs/v37_test5_bunch1/SingleElectron.root -o plots/v37_test5_bunch1/ -p -r -c dy_elel --data-nick data_other -d met_init_f --bin-norm --lumi 35800 --qcd-factor 2.5 --overwrite --wjets 0.95

??? dy mumu has large deviation at large met, slight at lep_pt and lep_eta, also dilep mass is as usual ???
    and same deviations in elel, but to a smaller degree



# the fitting stuff

## refitting old datacards

make fit_unc nn=el_orig1 workspace=ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root   &
make fit_unc nn=mu_orig1 workspace=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root   &
make fit_unc nn=bt_orig1 workspace=ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms.root &

make impacts nn=el_orig1 workspace=ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root   &
make impacts nn=mu_orig1 workspace=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root   &
make impacts nn=bt_orig1 workspace=ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms.root &

-- how close are they?
   what's the impact of mis-ID?

python new_impact_table.py --merge-pdf latest_impacts_el_orig1.json  latest_impacts_mu_orig1.json latest_impacts_bt_orig1.json

$\tauh$ jet identification  &  5.1 &  4.7 &  4.5 \\
       pileup uncertainty  &  2.9 &  2.4 &  2.5 \\
$\tauh$ misidentification background  &  2.8 &  2.5 &  2.4 \\
        top quark $p_{T}$  &  2.9 &  3.0 &  2.3 \\
        QCD normalization  &  0.2 &  1.2 &  1.4 \\
     b-tagging efficiency  &  1.6 &  1.5 &  1.4 \\
     W+jets normalization  &  0.3 &  1.1 &  1.1 \\
       muon ID efficiency  &  0.7 &  0.7 \\
         DY normalization  &  0.3 &  0.3 &  0.6 \\
 Single Top normalization  &  0.6 &  0.5 &  0.4 \\
electron trigger efficiency  &  2.6 &  0.4 \\
  muon trigger efficiency  &  0.4 &  0.3 \\
   electron ID efficiency  &  1.9 &  0.3 \\
     $\tauh$ Energy Scale  &  0.3 &  0.4 &  0.3 \\
    jet energy resolution  &  0.1 &  0.1 &  0.2 \\
         jet energy scale  &  0.3 &  0.2 &  0.1 \\
   Dibosons normalization  &  0.0 &  0.0 &  0.0 \\
               Luminosity  &  0.0 &  0.0 &  0.0 \\
          b fragmentation  &  2.7 &  2.6 &  2.7 \\
  final   state radiation  &  2.2 &  1.6 &  1.8 \\
  initial state radiation  &  1.9 &  1.3 &  1.3 \\
ME combined scale variation  &  0.6 &  1.1 &  0.9 \\
 ME Renormalization scale  &  0.8 &  1.2 &  0.9 \\
   ME-PS matching (hdamp)  &  0.2 &  0.6 &  0.6 \\
underlying event (Pythia tune)  &  0.5 &  0.4 &  0.5 \\
semi-leptonic b-hadron BRs  &  0.5 &  0.3 &  0.3 \\
   ME Factorization scale  &  0.3 &  0.3 &  0.1 \\
                      PDF  &  1.5 &  1.2 &  1.4 \\
            MC statistics  &  2.4 &  1.7 &  1.8 \\


the impacts
in electron-tau are almost identical (PU changes the 2nd place with TOPPT due to correct normalization)
and in muon tau too (PU also goes down the list, changes 3rd place with mis-ID)

SO THESE ARE GOOD


### readable pulls of nuisances withput PDF

../scripts/text2workspace.py ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.txt
../scripts/text2workspace.py ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.txt

combine -M FitDiagnostics ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root   --name ElShape    --noMCbonly 0 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf_only &
combine -M FitDiagnostics ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root   --name MuShape    --noMCbonly 0 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf_only &

combine -M FitDiagnostics ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root   --name ElShape    --noMCbonly 0 --freezeParameters lumi_13TeV,prop_binel_sel_ljout_bin8,prop_binel_sel_ljout_bin7,prop_binel_sel_ljout_bin6,prop_binel_sel_ljout_bin5,prop_binel_sel_ljout_bin4,prop_binel_sel_ljout_bin3,prop_binel_sel_ljout_bin2,prop_binel_sel_ljout_bin1,prop_binel_sel_ljout_bin0,prop_binel_sel_lj_bin8,prop_binel_sel_lj_bin7,prop_binel_sel_lj_bin6,prop_binel_sel_lj_bin5,prop_binel_sel_lj_bin4,prop_binel_sel_lj_bin3,prop_binel_sel_lj_bin2,prop_binel_sel_lj_bin1,prop_binel_sel_lj_bin0 --freezeNuisanceGroup tt_th_pdf_only &
combine -M FitDiagnostics ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root   --name MuShape    --noMCbonly 0 --freezeParameters lumi_13TeV,prop_binmu_sel_ljout_bin8,prop_binmu_sel_ljout_bin7,prop_binmu_sel_ljout_bin6,prop_binmu_sel_ljout_bin5,prop_binmu_sel_ljout_bin4,prop_binmu_sel_ljout_bin3,prop_binmu_sel_ljout_bin2,prop_binmu_sel_ljout_bin1,prop_binmu_sel_ljout_bin0,prop_binmu_sel_lj_bin8,prop_binmu_sel_lj_bin7,prop_binmu_sel_lj_bin6,prop_binmu_sel_lj_bin5,prop_binmu_sel_lj_bin4,prop_binmu_sel_lj_bin3,prop_binmu_sel_lj_bin2,prop_binmu_sel_lj_bin1,prop_binmu_sel_lj_bin0 --freezeNuisanceGroup tt_th_pdf_only &


combine -M FitDiagnostics ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms.root --name BothShape  --noMCbonly 0 --freezeParameters lumi_13TeV

Produce nuisances with custom script which skips background-only step:

python ttxsec/fit-stuff/diffNuisances.py fitDiagnosticsElShape.root   -g pulls_of_nuisances_el_shape.root   -o
python ttxsec/fit-stuff/diffNuisances.py fitDiagnosticsMuShape.root   -g pulls_of_nuisances_mu_shape.root   -o

python fit-stuff/diffNuisances.py fitDiagnosticsBothShape.root -g pulls_of_nuisances_both_shape.root -o



### the impacts with mis-ID 20%

vim -p ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_misID20.txt ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_misID20.txt ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_misID20.txt

../scripts/text2workspace.py ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_misID20.txt
../scripts/text2workspace.py ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_misID20.txt
../scripts/text2workspace.py ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_misID20.txt

make impacts nn=el_orig1_misID20 workspace=ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_misID20.root   &
make impacts nn=mu_orig1_misID20 workspace=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_misID20.root   &
make impacts nn=bt_orig1_misID20 workspace=ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_misID20.root &

fakes go far down, rest is similar

python new_impact_table.py --merge-pdf latest_impacts_el_orig1_misID20.json  latest_impacts_mu_orig1_misID20.json latest_impacts_bt_orig1_misID20.json

$\tauh$ jet identification  &  5.1 &  4.7 &  4.5 \\
        top quark $p_{T}$  &  3.0 &  3.0 &  2.4 \\
       pileup uncertainty  &  2.8 &  2.3 &  2.3 \\
     b-tagging efficiency  &  1.7 &  1.7 &  1.6 \\
$\tauh$ misidentification background  &  1.7 &  1.4 &  1.5 \\
        QCD normalization  &  0.1 &  1.2 &  1.4 \\
     W+jets normalization  &  0.2 &  1.2 &  1.2 \\
       muon ID efficiency  &  0.7 &  0.7 \\
         DY normalization  &  0.3 &  0.4 &  0.7 \\
 Single Top normalization  &  0.6 &  0.6 &  0.5 \\
electron trigger efficiency  &  2.5 &  0.4 \\
   electron ID efficiency  &  1.9 &  0.3 \\
  muon trigger efficiency  &  0.4 &  0.3 \\
         jet energy scale  &  0.2 &  0.1 &  0.2 \\
     $\tauh$ Energy Scale  &  0.1 &  0.3 &  0.2 \\
    jet energy resolution  &  0.1 &  0.0 &  0.2 \\
   Dibosons normalization  &  0.0 &  0.0 &  0.0 \\
               Luminosity  &  0.0 &  0.0 &  0.0 \\
          b fragmentation  &  2.5 &  2.4 &  2.6 \\
  initial state radiation  &  2.0 &  1.5 &  1.5 \\
ME combined scale variation  &  0.5 &  1.2 &  0.9 \\
 ME Renormalization scale  &  0.8 &  1.3 &  0.9 \\
underlying event (Pythia tune)  &  0.4 &  0.4 &  0.4 \\
  final   state radiation  &  0.9 &  0.2 &  0.4 \\
   ME-PS matching (hdamp)  &  0.0 &  0.5 &  0.4 \\
semi-leptonic b-hadron BRs  &  0.5 &  0.3 &  0.3 \\
   ME Factorization scale  &  0.4 &  0.3 &  0.1 \\
                      PDF  &  1.4 &  1.2 &  1.2 \\
            MC statistics  &  2.5 &  1.7 &  1.9 \\

overall uncertainties

el
50%  9.06%
20%  8.92%

mu
50%  7.20%
20%  7.07%



## w Tight working points

old datacards

ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c.txt
ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_shaped_Tight_c.txt
ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_shaped_Tight_c.txt
ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c.txt

datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c2.txt
datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight.txt

how to properly freeze MC stats?

no mc datacards:
../scripts/text2workspace.py ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c_nomc.txt
../scripts/text2workspace.py ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c_nomc.txt

the breakdown:

a) stat. only b) stat + syst (except for tau ID and MC stat.) c) stat + syst (except for MC stat.) d) stat + syst (all, including MC stat.) e) everything 

-- d) and e) are the same


make fit_unc_breakdown_yutas_q chan=el nn=el_tight_noshape workspace=ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c.root workspace_nomc=ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c_nomc.root &
make fit_unc_breakdown_yutas_q chan=mu nn=mu_tight_noshape workspace=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c.root workspace_nomc=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c_nomc.root &

el
   r :    +0.972

no MC
   r :    +0.985

mu
   r :    +0.959
   r :    +0.949


no prop_bin_el_sel_ljout_bin8 in the workspace
it's Tight!!!!
prop_bin_el_selTight_ljout_bin8

and
[#0] ERROR:InputArguments --  RooWorkspace::argSet(w) no RooAbsArg named "prop_bin_el_selTight_ljout_bin8" in workspace

combine -M MultiDimFit --algo grid --points 100 --rMin 0.6 --rMax 1.4 higgsCombineel_tight_noshapeBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters "lumi_13TeV,prop_binel_selTight_ljout_bin8" -n el_tight_noshape_correct_NoMC

wooooooooooooooooooooorks!

,prop_bin${chan}_selTight_ljout_bin8,prop_bin${chan}_selTight_ljout_bin7,prop_bin${chan}_selTight_ljout_bin6,prop_bin${chan}_selTight_ljout_bin5,prop_bin${chan}_selTight_ljout_bin4,prop_bin${chan}_selTight_ljout_bin3,prop_bin${chan}_selTight_ljout_bin2,prop_bin${chan}_selTight_ljout_bin1,prop_bin${chan}_selTight_ljout_bin0,prop_bin${chan}_selTight_lj_bin8,prop_bin${chan}_selTight_lj_bin7,prop_bin${chan}_selTight_lj_bin6,prop_bin${chan}_selTight_lj_bin5,prop_bin${chan}_selTight_lj_bin4,prop_bin${chan}_selTight_lj_bin3,prop_bin${chan}_selTight_lj_bin2,prop_bin${chan}_selTight_lj_bin1,prop_bin${chan}_selTight_lj_bin0

make fit_unc_breakdown_yutas_q chan=el nn=el_tight_noshape workspace=ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c.root  &
make fit_unc_breakdown_yutas_q chan=mu nn=mu_tight_noshape workspace=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c.root  &



the numbers are weird, the plot of NLL is reasonable, only the minimum is shifted

plot1DScan.py --output scan_el_tight_noshape higgsCombineel_tight_noshapeFullUncertaintyWLumi.MultiDimFit.mH120.root --others 'higgsCombineel_tight_noshapeNoMC.MultiDimFit.mH120.root:nomc:4' 'higgsCombineel_tight_noshapeNoTauNoMC.MultiDimFit.mH120.root:notau:3' 'higgsCombineel_tight_noshapeNoSys.MultiDimFit.mH120.root:stat:2' --breakdown lumi,nomc,notau,stat

plot1DScan.py --output scan_el_tight_noshape higgsCombineel_tight_noshapeNoMC.MultiDimFit.mH120.root --others  'higgsCombineel_tight_noshapeNoTauNoMC.MultiDimFit.mH120.root:nomcnotau:4' 'higgsCombineel_tight_noshapeNoSys.MultiDimFit.mH120.root:stat:2' --breakdown nomc,notau,stat

-- same weirdness

0.985 +- 0.05 (nomc) +- 0.083 (notau) +- 0.016 (stat)

-- why the notau is larger than nomc? it is larger on the plot?


correct interpretation:

plot1DScan.py --output scan_el_tight_noshape higgsCombineel_tight_noshapeFullUncertaintyWLumi.MultiDimFit.mH120.root --others 'higgsCombineel_tight_noshapeNoMC.MultiDimFit.mH120.root:nomc:4' 'higgsCombineel_tight_noshapeNoTauNoMC.MultiDimFit.mH120.root:notau:3' 'higgsCombineel_tight_noshapeNoSys.MultiDimFit.mH120.root:stat:2' --breakdown lumiMC,Tau,Rest,stat

or better with no lumi:

plot1DScan.py --output scan_el_tight_noshape higgsCombineel_tight_noshapeFullUncertaintyNoLumi.MultiDimFit.mH120.root --others 'higgsCombineel_tight_noshapeNoMC.MultiDimFit.mH120.root:No MC:4' 'higgsCombineel_tight_noshapeNoTauNoMC.MultiDimFit.mH120.root:No MC No Tau:3' 'higgsCombineel_tight_noshapeNoSys.MultiDimFit.mH120.root:stat:2' --breakdown "MC,Tau,other syst,stat"

-- large "other syst"??


## large "other systematics" 

impacts:

make impacts nn=el_tight_test workspace=ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c.root &
make impacts nn=mu_tight_test workspace=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c.root &




# comment on post-fit impacts for questions

%BLUE% >> The post-fit pull of the ISR variation is slightly different between the two channels: the nominal value of ISR nuisance parameter is close to zero in electron tau and it is about -0.6 in muon-tau.
The impact of nuisance parameters with pulled nominal values on the signal strength can be different.
Most likely, the differences in post-fit nuisance parameters of two channels are due to:
1) the difference in the shapes between the channels (which comes from higher pT cut on electrons), which can make the nuisance parameters behave differently in the fit,
2) the different post-fit value of nominal signal strength (smaller in muon-tau channel), which can affect the nuisances by forcing them to adjust to the difference in the distributions,
3) statistical fluctuations and significant effects of MC statistics.

%BLUE% >> The main contribution to the variation of the signal acceptance is due to ISR Down variation, and it is indeed larger in electron-tau case.
We find that the ISR variation somehow correlates with the distribution of the reconstructed lepton pT: ISR Down decreases lepton pT-s.
The following figure shows it in the ratio of lepton pT distributions of ISR Down / ISR Up.
This effect is more significant for electron selection due to higher pT threshold.

--- the threshold and reco pT are not relevant, since in the acceptance study the generated leptons are used.
I did check the distributions of gen pT in all events of the samples -- it does not vary with ISR.
But maybe it varies with the selection requirements.


from "more tests"

clues:
* the ISR Down deviation persists
  with the same kinematic cuts on the generated electrons and muons
* the reco lepton pT varies with ISR Down: pT is smaller with ISR Down
  but the gen lepton pT does not vary
* the number of electron events is systematically larger than muon events in all ISR Down datasets
  but the deviation of the acceptance in the dataset with the smallest difference
  is not small enough
* statistical uncertainty estimated as sqrt(N events at each selection stage)
  is larger than the reported 0.0004 (it is around 0.001)
  but if the deviation of electrons were a stat fluctuation,
  than it would show up in the same difit of other uncertainties,
  since the number of events is similar
  (especially in the Tune variation)
  --- no! the true uncertainty is ratio * sqrt(N events)/N
      then it is = to the estimation from the histograms, 0.0004
	  0.001-0.002 is the relational uncertainty, it is 0.2% of uncertainty, when the deviation is 0.7%
* but at final step of the selection the el-mu deviation varies in the other direction
  (2.8sigma more el in all events and -1.7sigma less at final cut)
* the pT distributions of taus have large uncertainties?
  the isrup / isrdown ratio has too large uncertainties to notice anything, it variaes around 1 though

%BLUE% >> The deviation in electron channel is due to the variation in ISR Down datasets only.
The deviation of the acceptance is the same when the kinematic cuts of muons are applied to electrons.
The deviation appears in the overall number of generated events and in the number of events passing the selection requirements.
In ISR Down datasets the overall number of generated electron-tau events is larger than muon-tau events,
in relation to the statistical uncertainty (sqrt(N)/N) it is larger by about 2.8sigma.
And the number of electron-tau events passing the selection requirements is smaller than in muon-tau channel by about 1.7sigma of statistical uncertainty.
It leads to the discrepancy in the acceptance ratio of passing to all events.
A study of kinematic distributions at generation level does not show any difference between electron and muon channel in ISR Down.
Therefore, we conclude that it is a statistical fluctuation.




## more tests

commands running the acceptance study:

python signal_acceptance.py --no-tau-cut temp/ gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v34_MC2016_Summer16_TTJets_powheg/180717_001103/0000/MC2016_Summer16_TTJets_powheg_90.root

cat accept_study_v34_t2_tt* | xargs -P 12 -d "\n" -I COMM sh -c "COMM || true"

hadd  MC2016_Summer16_TTJets_powheg_isrdown.root  MC2016_Summer16_TTJets_powheg_isrdown/*.root &
hadd  MC2016_Summer16_TTJets_powheg_isrup.root    MC2016_Summer16_TTJets_powheg_isrup/*.root   &
hadd  MC2016_Summer16_TTJets_powheg.root          MC2016_Summer16_TTJets_powheg/*.root         &

quick script

python sumup_ttree_draw.py "lep_p4[0].pt()" --custom-range 20,24,28,32,40,50,60,70,90,110,140,200,300 --histo-name accept_incl_isr_issue_nom_lep_pt     --output accept_incl_isr_issue_nom_lep_pt.root     gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v34_MC2016_Summer16_TTJets_powheg/180717_001103/0000/MC2016_Summer16_TTJets_powheg_*.root  &
python sumup_ttree_draw.py "lep_p4[0].pt()" --custom-range 20,24,28,32,40,50,60,70,90,110,140,200,300 --histo-name accept_incl_isr_issue_isrup_lep_pt   --output accept_incl_isr_issue_isrup_lep_pt.root   gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/*/*/*/*root  &
python sumup_ttree_draw.py "lep_p4[0].pt()" --custom-range 20,24,28,32,40,50,60,70,90,110,140,200,300 --histo-name accept_incl_isr_issue_isrdown_lep_pt --output accept_incl_isr_issue_isrdown_lep_pt.root gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/*/*/*/*root  &

python sumup_ttree_draw.py "gen2_jets_p4[0].pt()" --custom-range 20,24,28,32,40,50,60,70,90,110,140,200,300 --histo-name accept_incl_isr_issue_isrdown_jet_pt0    --output accept_incl_isr_issue_isrdown_jet_pt0.root     gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/*/*/*/*root  &

python sumup_ttree_draw.py "gen2_jets_p4[].pt()"  --custom-range 20,24,28,32,40,50,60,70,90,110,140,200,300 --histo-name accept_incl_isr_issue_nom_jet_pt_all     --output accept_incl_isr_issue_nom_jet_pt_all.root      gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v34_MC2016_Summer16_TTJets_powheg/180717_001103/0000/MC2016_Summer16_TTJets_powheg_*.root  &
python sumup_ttree_draw.py "gen2_jets_p4[].pt()"  --custom-range 20,24,28,32,40,50,60,70,90,110,140,200,300 --histo-name accept_incl_isr_issue_isrdown_jet_pt_all --output accept_incl_isr_issue_isrdown_jet_pt_all.root  gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/*/*/*/*root  &
python sumup_ttree_draw.py "gen2_jets_p4[].pt()"  --custom-range 20,24,28,32,40,50,60,70,90,110,140,200,300 --histo-name accept_incl_isr_issue_isrup_jet_pt_all   --output accept_incl_isr_issue_isrup_jet_pt_all.root    gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/*/*/*/*root    &

python jobsums/get_shapes.py --y-range 0.95,1.05 --no-std-path --formula "isrup/nom:isrdown/nom" isrup:accept_incl_isr_issue_isrup_jet_pt_all.root:accept_incl_isr_issue_isrup_jet_pt_all/accept_incl_isr_issue_isrup_jet_pt_all_accept_incl_isr_issue_isrup_jet_pt_all   isrdown:accept_incl_isr_issue_isrdown_jet_pt_all.root:accept_incl_isr_issue_isrdown_jet_pt_all/accept_incl_isr_issue_isrdown_jet_pt_all_accept_incl_isr_issue_isrdown_jet_pt_all   nom:accept_incl_isr_issue_nom_jet_pt_all.root:accept_incl_isr_issue_nom_jet_pt_all/accept_incl_isr_issue_nom_jet_pt_all_accept_incl_isr_issue_nom_jet_pt_all
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png compare_acceptance_issue_isrdown_el_ratio_of_jet_pT_up_down_to_nom.png

python jobsums/get_shapes.py --y-range 0.95,1.05 --no-std-path --formula "isrup/isrdown" isrup:accept_incl_isr_issue_isrup_jet_pt_all.root:accept_incl_isr_issue_isrup_jet_pt_all/accept_incl_isr_issue_isrup_jet_pt_all_accept_incl_isr_issue_isrup_jet_pt_all   isrdown:accept_incl_isr_issue_isrdown_jet_pt_all.root:accept_incl_isr_issue_isrdown_jet_pt_all/accept_incl_isr_issue_isrdown_jet_pt_all_accept_incl_isr_issue_isrdown_jet_pt_all
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_isrup,isrdown_formula.png compare_acceptance_issue_isrdown_el_ratio_of_jet_pT_up_to_down.png

-- yeah, there is the expected variation, isrup has more low pT, isrdown -- less

gen_tt_tau_vis_p4

python sumup_ttree_draw.py "gen_tt_tau_vis_p4[0].pt()" --cond-com "abs(gen_t_w_decay_id) == 11 || abs(gen_tb_w_decay_id) == 11"  --custom-range 0,20,25,30,40,50,70,90,120,150,300 --histo-name accept_incl_isr_issue_el_nom_tau_pt     --output accept_incl_isr_issue_el_nom_tau_pt.root      gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v34_MC2016_Summer16_TTJets_powheg/180717_001103/0000/MC2016_Summer16_TTJets_powheg_*.root  &
python sumup_ttree_draw.py "gen_tt_tau_vis_p4[0].pt()" --cond-com "abs(gen_t_w_decay_id) == 11 || abs(gen_tb_w_decay_id) == 11"  --custom-range 0,20,25,30,40,50,70,90,120,150,300 --histo-name accept_incl_isr_issue_el_isrdown_tau_pt --output accept_incl_isr_issue_el_isrdown_tau_pt.root  gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/*/*/*/*root  &
python sumup_ttree_draw.py "gen_tt_tau_vis_p4[0].pt()" --cond-com "abs(gen_t_w_decay_id) == 11 || abs(gen_tb_w_decay_id) == 11"  --custom-range 0,20,25,30,40,50,70,90,120,150,300 --histo-name accept_incl_isr_issue_el_isrup_tau_pt   --output accept_incl_isr_issue_el_isrup_tau_pt.root    gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/*/*/*/*root    &

python sumup_ttree_draw.py "gen_tt_tau_vis_p4[0].pt()" --cond-com "abs(gen_t_w_decay_id) == 13 || abs(gen_tb_w_decay_id) == 13"  --custom-range 0,20,25,30,40,50,70,90,120,150,300 --histo-name accept_incl_isr_issue_mu_nom_tau_pt     --output accept_incl_isr_issue_mu_nom_tau_pt.root      gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v34_MC2016_Summer16_TTJets_powheg/180717_001103/0000/MC2016_Summer16_TTJets_powheg_*.root  &
python sumup_ttree_draw.py "gen_tt_tau_vis_p4[0].pt()" --cond-com "abs(gen_t_w_decay_id) == 13 || abs(gen_tb_w_decay_id) == 13"  --custom-range 0,20,25,30,40,50,70,90,120,150,300 --histo-name accept_incl_isr_issue_mu_isrdown_tau_pt --output accept_incl_isr_issue_mu_isrdown_tau_pt.root  gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/*/*/*/*root  &
python sumup_ttree_draw.py "gen_tt_tau_vis_p4[0].pt()" --cond-com "abs(gen_t_w_decay_id) == 13 || abs(gen_tb_w_decay_id) == 13"  --custom-range 0,20,25,30,40,50,70,90,120,150,300 --histo-name accept_incl_isr_issue_mu_isrup_tau_pt   --output accept_incl_isr_issue_mu_isrup_tau_pt.root    gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/*/*/*/*root    &

python jobsums/get_shapes.py --draw-error-bars --y-range 0.95,1.05 --no-std-path --formula "isrup/isrdown" isrup:accept_incl_isr_issue_el_isrup_tau_pt.root:accept_incl_isr_issue_el_isrup_tau_pt/accept_incl_isr_issue_el_isrup_tau_pt_accept_incl_isr_issue_el_isrup_tau_pt   isrdown:accept_incl_isr_issue_el_isrdown_tau_pt.root:accept_incl_isr_issue_el_isrdown_tau_pt/accept_incl_isr_issue_el_isrdown_tau_pt_accept_incl_isr_issue_el_isrdown_tau_pt
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_isrup,isrdown_formula.png compare_acceptance_issue_el_isrdown_el_tau_pt_up_to_down.png

python jobsums/get_shapes.py --draw-error-bars --y-range 0.95,1.05 --no-std-path --formula "isrup/isrdown" isrup:accept_incl_isr_issue_mu_isrup_tau_pt.root:accept_incl_isr_issue_mu_isrup_tau_pt/accept_incl_isr_issue_mu_isrup_tau_pt_accept_incl_isr_issue_mu_isrup_tau_pt   isrdown:accept_incl_isr_issue_mu_isrdown_tau_pt.root:accept_incl_isr_issue_mu_isrdown_tau_pt/accept_incl_isr_issue_mu_isrdown_tau_pt_accept_incl_isr_issue_mu_isrdown_tau_pt
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_isrup,isrdown_formula.png compare_acceptance_issue_mu_isrdown_mu_tau_pt_up_to_down.png

-- large fluctuations

python jobsums/get_shapes.py --draw-error-bars --y-range 0.95,1.05 --no-std-path --formula "isrup/nom:isrdown/nom" isrup:accept_incl_isr_issue_el_isrup_tau_pt.root:accept_incl_isr_issue_el_isrup_tau_pt/accept_incl_isr_issue_el_isrup_tau_pt_accept_incl_isr_issue_el_isrup_tau_pt   isrdown:accept_incl_isr_issue_el_isrdown_tau_pt.root:accept_incl_isr_issue_el_isrdown_tau_pt/accept_incl_isr_issue_el_isrdown_tau_pt_accept_incl_isr_issue_el_isrdown_tau_pt   nom:accept_incl_isr_issue_el_nom_tau_pt.root:accept_incl_isr_issue_el_nom_tau_pt/accept_incl_isr_issue_el_nom_tau_pt_accept_incl_isr_issue_el_nom_tau_pt
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png compare_acceptance_issue_el_isrdown_el_ratio_of_tau_pt_up_down_to_nom.png

python jobsums/get_shapes.py --draw-error-bars --no-std-path --formula "isrup:nom:isrdown" isrup:accept_incl_isr_issue_el_isrup_tau_pt.root:accept_incl_isr_issue_el_isrup_tau_pt/accept_incl_isr_issue_el_isrup_tau_pt_accept_incl_isr_issue_el_isrup_tau_pt   isrdown:accept_incl_isr_issue_el_isrdown_tau_pt.root:accept_incl_isr_issue_el_isrdown_tau_pt/accept_incl_isr_issue_el_isrdown_tau_pt_accept_incl_isr_issue_el_isrdown_tau_pt   nom:accept_incl_isr_issue_el_nom_tau_pt.root:accept_incl_isr_issue_el_nom_tau_pt/accept_incl_isr_issue_el_nom_tau_pt_accept_incl_isr_issue_el_nom_tau_pt
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png compare_acceptance_issue_el_isrdown_el_tau_pt_up_down_nom.png

python jobsums/get_shapes.py --y-range 0.95,1.05 --no-std-path --formula "isrup/nom:isrdown/nom" isrup:accept_incl_isr_issue_mu_isrup_tau_pt.root:accept_incl_isr_issue_mu_isrup_tau_pt/accept_incl_isr_issue_mu_isrup_tau_pt_accept_incl_isr_issue_mu_isrup_tau_pt   isrdown:accept_incl_isr_issue_mu_isrdown_tau_pt.root:accept_incl_isr_issue_mu_isrdown_tau_pt/accept_incl_isr_issue_mu_isrdown_tau_pt_accept_incl_isr_issue_mu_isrdown_tau_pt   nom:accept_incl_isr_issue_mu_nom_tau_pt.root:accept_incl_isr_issue_mu_nom_tau_pt/accept_incl_isr_issue_mu_nom_tau_pt_accept_incl_isr_issue_mu_nom_tau_pt
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png compare_acceptance_issue_mu_isrdown_el_ratio_of_tau_pt_up_down_to_nom.png

python jobsums/get_shapes.py --draw-error-bars --no-std-path --formula "isrup:nom:isrdown" isrup:accept_incl_isr_issue_mu_isrup_tau_pt.root:accept_incl_isr_issue_mu_isrup_tau_pt/accept_incl_isr_issue_mu_isrup_tau_pt_accept_incl_isr_issue_mu_isrup_tau_pt   isrdown:accept_incl_isr_issue_mu_isrdown_tau_pt.root:accept_incl_isr_issue_mu_isrdown_tau_pt/accept_incl_isr_issue_mu_isrdown_tau_pt_accept_incl_isr_issue_mu_isrdown_tau_pt   nom:accept_incl_isr_issue_mu_nom_tau_pt.root:accept_incl_isr_issue_mu_nom_tau_pt/accept_incl_isr_issue_mu_nom_tau_pt_accept_incl_isr_issue_mu_nom_tau_pt
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png compare_acceptance_issue_mu_isrdown_mu_tau_pt_up_down_nom.png


compatisons of the kinematic shapes:

python jobsums/get_shapes.py --norm-binwidth --no-std-path --formula "isrup:nom:isrdown" isrup:lstore_outdirs/v34/t2/MC2016_Summer16_TTJets_powheg_isrup.root:pre_gen_el_pt isrdown:lstore_outdirs/v34/t2/MC2016_Summer16_TTJets_powheg_isrdown.root:pre_gen_el_pt nom:lstore_outdirs/v34/t2/MC2016_Summer16_TTJets_powheg.root:pre_gen_el_pt
python jobsums/get_shapes.py --norm-binwidth --no-std-path --formula "isrup:nom:isrdown" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:pre_gen_el_pt isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:pre_gen_el_pt nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:pre_gen_el_pt

cut_ev_mutau->GetBinContent(1)      / all_ev_mutau->GetBinContent(1)
cut_ev_eltau->GetBinContent(1)      / all_ev_eltau->GetBinContent(1)

ctr_cut_ev_eltau->GetBinContent(1)


1) the kino cut on the electron is the same as in muons
but the acceptance still varies differently:

cut_ev_mutau->GetBinContent(1)      / all_ev_mutau->GetBinContent(1)
cut_ev_eltau->GetBinContent(1)      / all_ev_eltau->GetBinContent(1)

nom_el =  0.183190
nom_mu =  0.183309

isrup_el = 0.183696
isrup_mu = 0.183581

isrdown_el = 0.182958
isrdown_mu = 0.182129

--- isrdown_el - isrdown_mu = 0.0008
    8 in 4th sign
	in nom and isrup it is 1 in 4th sign

isrup_el  - nom_el
isrup_mu  - nom_mu

0.000506000
0.000272000

isrdown_el  - nom_el
isrdown_mu  - nom_mu

-0.000232000
-0.00118000

2) the dR cross-clean is exactly the same among them
the dR distrs are the same
and counters too:

ctr_cut_ev_mutau->GetBinContent(1+8) / ctr_cut_ev_mutau->GetBinContent(1+7)

ctr_cut_ev_mutau->GetBinContent(1+9) / ctr_cut_ev_mutau->GetBinContent(1+7)
ctr_cut_ev_eltau->GetBinContent(1+9) / ctr_cut_ev_eltau->GetBinContent(1+7)

isrdown:
0.965424
0.965420

nom:
0.965504
0.965674

isrup:
0.966180
0.966324


## check the N events having gen leptons

ctr_cut_ev_mutau->GetBinContent(1+1) / all_ev_mutau->GetBinContent(1)
ctr_cut_ev_mutau->GetBinContent(1+2) / all_ev_mutau->GetBinContent(1)
ctr_cut_ev_mutau->GetBinContent(1+3) / all_ev_mutau->GetBinContent(1)
ctr_cut_ev_mutau->GetBinContent(1+4) / all_ev_mutau->GetBinContent(1)
ctr_cut_ev_mutau->GetBinContent(1+5) / all_ev_mutau->GetBinContent(1)
ctr_cut_ev_mutau->GetBinContent(1+6) / all_ev_mutau->GetBinContent(1)
ctr_cut_ev_mutau->GetBinContent(1+7) / all_ev_mutau->GetBinContent(1)
ctr_cut_ev_mutau->GetBinContent(1+8) / all_ev_mutau->GetBinContent(1)
ctr_cut_ev_mutau->GetBinContent(1+9) / all_ev_mutau->GetBinContent(1)

ctr_cut_ev_eltau->GetBinContent(1+1) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+2) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+3) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+4) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+5) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+6) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+7) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+8) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+9) / all_ev_eltau->GetBinContent(1)

nom_mu = [ 0.848148 0.848148 0.695899 0.252915 0.186949 0.186949 0.183190 0.180907 0.176871 ]
nom_el = [ 0.848275 0.848275 0.695915 0.253200 0.187230 0.187230 0.183309 0.181007 0.177017 ]

isrdown_mu = [ 0.848335 0.848335 0.695701 0.252799 0.186695 0.186695 0.182958 0.180659 0.176632 ]
isrdown_el = [ 0.848384 0.848384 0.695994 0.252162 0.185912 0.185912 0.182129 0.179843 0.175831 ]

 julia> isrdown_mu - nom_mu
 1x9 Array{Float64,2}:
  0.000187  0.000187  -0.000198  -0.000116  -0.000254  -0.000254  -0.000232  -0.000248  -0.000239

julia> isrdown_el - nom_el
1x9 Array{Float64,2}:
 0.000109  0.000109  7.9e-5  -0.001038  -0.001318  -0.001318  -0.00118  -0.001164  -0.001186

-- after lep kino cuts 7.9e-5 in el
   after tau kino cuts -0.001038

without weights:

ctr_cut_ev_mutau->GetBinContent(1+101) / all_ev_mutau->GetBinContent(1)
ctr_cut_ev_mutau->GetBinContent(1+102) / all_ev_mutau->GetBinContent(1)
ctr_cut_ev_mutau->GetBinContent(1+103) / all_ev_mutau->GetBinContent(1)
ctr_cut_ev_mutau->GetBinContent(1+104) / all_ev_mutau->GetBinContent(1)
ctr_cut_ev_mutau->GetBinContent(1+105) / all_ev_mutau->GetBinContent(1)
ctr_cut_ev_mutau->GetBinContent(1+106) / all_ev_mutau->GetBinContent(1)
ctr_cut_ev_mutau->GetBinContent(1+107) / all_ev_mutau->GetBinContent(1)
ctr_cut_ev_mutau->GetBinContent(1+108) / all_ev_mutau->GetBinContent(1)
ctr_cut_ev_mutau->GetBinContent(1+109) / all_ev_mutau->GetBinContent(1)

ctr_cut_ev_eltau->GetBinContent(1+101) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+102) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+103) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+104) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+105) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+106) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+107) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+108) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+109) / all_ev_eltau->GetBinContent(1)

isrup_mu = [ 0.847673 0.847673 0.695526 0.252508 0.187575 0.187575 0.183614 0.181291 0.177417 ]
isrup_el = [ 0.848021 0.848021 0.695725 0.252264 0.187577 0.187577 0.183575 0.181274 0.177399 ]

nom_mu = [ 0.848054 0.848054 0.695796 0.253010 0.187021 0.187021 0.183281 0.180993 0.176967 ]
nom_el = [ 0.848239 0.848239 0.695907 0.253108 0.187120 0.187120 0.183219 0.180896 0.176911 ]

isrdown_mu = [ 0.848454 0.848454 0.695849 0.252731 0.186633 0.186633 0.182903 0.180617 0.176591 ]
isrdown_el = [ 0.848026 0.848026 0.695728 0.252062 0.185826 0.185826 0.182044 0.179771 0.175742 ]

isrdown_mu - nom_mu
 0.0004  0.0004  5.3e-5  -0.000279  -0.000388  -0.000388  -0.000378  -0.000376  -0.000376
isrdown_el - nom_el
 -0.000213  -0.000213  -0.000179  -0.001046  -0.001294  -0.001294  -0.001175  -0.001125  -0.001169

-- aha! it's not in weights
   and it is after the tau cuts

isrup_mu - nom_mu
 -0.000381  -0.000381  -0.00027  -0.000502  0.000554  0.000554  0.000333  0.000298  0.00045
isrup_el - nom_el
 -0.000218  -0.000218  -0.000182  -0.000844  0.000457  0.000457  0.000356  0.000378  0.000488


is it only tau cuts or lep and tau together?
nolep 3
notau 4

ctr_cut_ev_mutau->GetBinContent(1+3) / all_ev_mutau->GetBinContent(1)
ctr_cut_ev_mutau->GetBinContent(1+4) / all_ev_mutau->GetBinContent(1)

ctr_cut_ev_eltau->GetBinContent(1+3) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+4) / all_ev_eltau->GetBinContent(1)

nom

nom_mu_lepcut = 0.695899
nom_mu_taucut = 0.306912
nom_el_lepcut = 0.695915
nom_el_taucut = 0.307436

isrup

isrup_mu_lepcut = 0.695712
isrup_mu_taucut = 0.306410
isrup_el_lepcut = 0.695876
isrup_el_taucut = 0.306276

isrdown

isrdown_mu_lepcut = 0.695701
isrdown_mu_taucut = 0.306819
isrdown_el_lepcut = 0.695994
isrdown_el_taucut = 0.306072

isrdown_mu_lepcut - nom_mu_lepcut
isrdown_el_lepcut - nom_el_lepcut

-0.00019800000000003148
7.900000000005125e-5

isrdown_mu_taucut - nom_mu_taucut
isrdown_el_taucut - nom_el_taucut

-9.300000000000974e-5
-0.0013639999999999763

-- tau cuts only!!!


## the el-mu difference per statistical uncertainty

root -l lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root
root -l lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root
root -l lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root

cut_ev_eltau->GetBinContent(1) / all_ev_eltau->GetBinContent(1)
cut_ev_mutau->GetBinContent(1) / all_ev_mutau->GetBinContent(1)

              el       mu
isrup   0.183581 0.183696
nom     0.183309 0.183190
isrdown 0.182129 0.182958

cut_ev_mutau->GetBinContent(1) / all_ev_eltau->GetBinContent(1)
(double) 0.182613

cut_ev_eltau->GetBinContent(1) / all_ev_mutau->GetBinContent(1)
(double) 0.182473


(all_ev_eltau->GetBinContent(1) - all_ev_mutau->GetBinContent(1)) / sqrt((all_ev_eltau->GetBinContent(1) + all_ev_mutau->GetBinContent(1))*0.5)
(double) 2.83428

and at cut steps

(cut_ev_eltau->GetBinContent(1) - cut_ev_mutau->GetBinContent(1)) / sqrt((cut_ev_eltau->GetBinContent(1) + cut_ev_mutau->GetBinContent(1))*0.5)

nom      -0.822783  -0.0543454
isrup    -0.383495  -0.575477
isrdown   2.83428   -1.70413

number of all eltau events is 3sigma above the number of mutau in isrdown
and the number of passing eltau events is 1.7sigma bellow
hence the large difference in the ratio of passing/all events

can this be a statistical flucatuation?


let's try normalizing to muon yield

ctr_cut_ev_eltau->GetBinContent(1+3) / all_ev_mutau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+4) / all_ev_mutau->GetBinContent(1)

isrdown_el_lepcut_munorm = 0.697308
isrdown_el_taucut_munorm = 0.306650

isrdown_el_lepcut_munorm - nom_el_lepcut
isrdown_el_taucut_munorm - nom_el_taucut

0.0013930000000000886
-0.0007860000000000089

lepcut horrible, taucut is kind of more reasonable?

if the deviation is statistical, then it won't show up in each sample

hadd MC2016_Summer16_TTJets_powheg_isrdown_num.root  MC2016_Summer16_TTJets_powheg_isrdown/MC2016_Summer16_TTJets_powheg_isrdown_[0-9]*.root &
hadd MC2016_Summer16_TTJets_powheg_isrdown_ext1.root MC2016_Summer16_TTJets_powheg_isrdown/MC2016_Summer16_TTJets_powheg_isrdown_ext1*.root  &
hadd MC2016_Summer16_TTJets_powheg_isrdown_ext2.root MC2016_Summer16_TTJets_powheg_isrdown/MC2016_Summer16_TTJets_powheg_isrdown_ext2*.root  &

hadd MC2016_Summer16_TTJets_powheg_isrup_num.root  MC2016_Summer16_TTJets_powheg_isrup/MC2016_Summer16_TTJets_powheg_isrup_[0-9]*.root &
hadd MC2016_Summer16_TTJets_powheg_isrup_ext2.root MC2016_Summer16_TTJets_powheg_isrup/MC2016_Summer16_TTJets_powheg_isrup_ext2*.root  &

root -l MC2016_Summer16_TTJets_powheg_isrdown_num.root
root -l MC2016_Summer16_TTJets_powheg_isrdown_ext1.root
root -l MC2016_Summer16_TTJets_powheg_isrdown_ext2.root
(all_ev_eltau->GetBinContent(1) - all_ev_mutau->GetBinContent(1)) / sqrt((all_ev_eltau->GetBinContent(1) + all_ev_mutau->GetBinContent(1))*0.5)
1.37427
2.47743
1.44152

damn, consistently more eltau events

in isrup:
-0.383495

num 0.804745 ext2 -1.11995

in nom:
-0.822783

What's in cut1 bin (there are gen leptons)?

(ctr_cut_ev_eltau->GetBinContent(1+1) - ctr_cut_ev_mutau->GetBinContent(1+1)) / sqrt((ctr_cut_ev_eltau->GetBinContent(1+1) + ctr_cut_ev_mutau->GetBinContent(1+1))*0.5)

isrup ext2 -0.793386 num 1.24135 -- arround the same

isrdown inclusive 2.69027

num  0.479239
ext1 3.10477
ext2 1.39697

same stuff
Sooooo... what is it?

What if only num is used for isrdown?

ctr_cut_ev_eltau->GetBinContent(1+1) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+2) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+3) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+4) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+5) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+6) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+7) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+8) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+9) / all_ev_eltau->GetBinContent(1)

nom_el = [ 0.848275 0.848275 0.695915 0.253200 0.187230 0.187230 0.183309 0.181007 0.177017 ]
isrdown_el     = [ 0.848384 0.848384 0.695994 0.252162 0.185912 0.185912 0.182129 0.179843 0.175831 ]
isrdown_el_num = [ 0.847788 0.847788 0.696196 0.306360 0.186109 0.186109 0.182371 0.180066 0.175984 ]

--- only 1 out of 12 closer...



lepcuts:

isrup_mu_lepcut - nom_mu_lepcut
isrup_el_lepcut - nom_el_lepcut

-0.00018700000000004824
-3.8999999999900226e-5

isrup_mu_taucut - nom_mu_taucut
isrup_el_taucut - nom_el_taucut

-0.0005020000000000024
-0.0011599999999999944

isrup too??

both up and down are negative, in el and mu

but at final selection isrup in electrons is ok?

ctr_cut_ev_mutau->GetBinContent(1+7) / all_ev_mutau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+7) / all_ev_eltau->GetBinContent(1)

isrdown
0.182958
0.182129

isrup
0.183696
0.183581

nom
0.183190
0.183309

-- yep




## check the kinematics at the tau cuts

I did not save the weighted kinematics! check unweighted counters!

ctr_cut_ev_mutau->GetBinContent(1+103) / all_ev_mutau->GetBinContent(1)
ctr_cut_ev_mutau->GetBinContent(1+104) / all_ev_mutau->GetBinContent(1)

ctr_cut_ev_eltau->GetBinContent(1+103) / all_ev_eltau->GetBinContent(1)
ctr_cut_ev_eltau->GetBinContent(1+104) / all_ev_eltau->GetBinContent(1)


gen_el_taucut_tau_pt
gen_el_taucut_tau_eta

gen_mu_taucut_tau_pt
gen_mu_taucut_tau_eta

python jobsums/get_shapes.py --y-range 0.95,1.05 --no-std-path --formula "isrup / nom:isrdown / nom" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_el_taucut_tau_eta isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_el_taucut_tau_eta nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_el_taucut_tau_eta
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png accept_compare_taucut_kino_tau_eta_el_chan.png

python jobsums/get_shapes.py --y-range 0.95,1.05 --no-std-path --formula "isrup / nom:isrdown / nom" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_el_taucut_tau_pt isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_el_taucut_tau_pt nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_el_taucut_tau_pt
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png accept_compare_taucut_kino_tau_pt_el_chan.png


python jobsums/get_shapes.py --y-range 0.95,1.05 --no-std-path --formula "isrup / nom:isrdown / nom" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_mu_taucut_tau_eta isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_mu_taucut_tau_eta nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_mu_taucut_tau_eta
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png accept_compare_taucut_kino_tau_eta_mu_chan.png

python jobsums/get_shapes.py --y-range 0.95,1.05 --no-std-path --formula "isrup / nom:isrdown / nom" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_mu_taucut_tau_pt isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_mu_taucut_tau_pt nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_mu_taucut_tau_pt
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png accept_compare_taucut_kino_tau_pt_mu_chan.png

large fluctuations in eta...
and shit in tau pt?

python jobsums/get_shapes.py -e --y-range 0.95,1.05 --no-std-path --formula "isrdown / isrup" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_el_taucut_tau_pt isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_el_taucut_tau_pt nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_el_taucut_tau_pt
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png accept_compare_taucut_kino_tau_pt_el_chan_down-to-up.png

python jobsums/get_shapes.py -e --y-range 0.95,1.05 --no-std-path --formula "isrdown / isrup" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_mu_taucut_tau_pt isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_mu_taucut_tau_pt nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_mu_taucut_tau_pt
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png accept_compare_taucut_kino_tau_pt_mu_chan_down-to-up.png

kind of seems like isrdown shifts tau pt down (like with the reco lep pt...)

-- with binning upto 500 it does not seem so

weighted distrs:

python jobsums/get_shapes.py -e --y-range 0.95,1.05 --no-std-path --formula "isrdown / isrup" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_el_taucut_tau_pt_w isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_el_taucut_tau_pt_w nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_el_taucut_tau_pt_w
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png accept_compare_taucut_kino_weighted_tau_pt_el_chan_down-to-up.png

python jobsums/get_shapes.py -e --y-range 0.95,1.05 --no-std-path --formula "isrdown / isrup" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_mu_taucut_tau_pt_w isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_mu_taucut_tau_pt_w nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_mu_taucut_tau_pt_w
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png accept_compare_taucut_kino_weighted_tau_pt_mu_chan_down-to-up.png

-- same

leptons kino

python jobsums/get_shapes.py -e --y-range 0.95,1.05 --no-std-path --formula "isrdown / isrup" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_el_taucut_lep_pt isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_el_taucut_lep_pt nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_el_taucut_lep_pt
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png accept_compare_taucut_kino_lep_pt_el_chan_down-to-up.png

python jobsums/get_shapes.py -e --y-range 0.95,1.05 --no-std-path --formula "isrdown / isrup" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_mu_taucut_lep_pt isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_mu_taucut_lep_pt nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_mu_taucut_lep_pt
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png accept_compare_taucut_kino_lep_pt_mu_chan_down-to-up.png

python jobsums/get_shapes.py -e --y-range 0.95,1.05 --no-std-path --formula "isrdown / isrup" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_el_taucut_lep_eta isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_el_taucut_lep_eta nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_el_taucut_lep_eta
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png accept_compare_taucut_kino_lep_eta_el_chan_down-to-up.png

python jobsums/get_shapes.py -e --y-range 0.95,1.05 --no-std-path --formula "isrdown / isrup" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_mu_taucut_lep_eta isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_mu_taucut_lep_eta nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_mu_taucut_lep_eta
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png accept_compare_taucut_kino_lep_eta_mu_chan_down-to-up.png


python jobsums/get_shapes.py -e --y-range 0.95,1.05 --no-std-path --formula "isrdown / isrup" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_el_taucut_lep_pt_w isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_el_taucut_lep_pt_w nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_el_taucut_lep_pt_w
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png accept_compare_taucut_kino_lep_pt_w_el_chan_down-to-up.png

python jobsums/get_shapes.py -e --y-range 0.95,1.05 --no-std-path --formula "isrdown / isrup" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_mu_taucut_lep_pt_w isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_mu_taucut_lep_pt_w nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_mu_taucut_lep_pt_w
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png accept_compare_taucut_kino_lep_pt_w_mu_chan_down-to-up.png

python jobsums/get_shapes.py -e --y-range 0.95,1.05 --no-std-path --formula "isrdown / isrup" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_el_taucut_lep_eta_w isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_el_taucut_lep_eta_w nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_el_taucut_lep_eta_w
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png accept_compare_taucut_kino_lep_eta_w_el_chan_down-to-up.png

python jobsums/get_shapes.py -e --y-range 0.95,1.05 --no-std-path --formula "isrdown / isrup" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_mu_taucut_lep_eta_w isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_mu_taucut_lep_eta_w nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_mu_taucut_lep_eta_w
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png accept_compare_taucut_kino_lep_eta_w_mu_chan_down-to-up.png

## check the el-mu deviations in isrdown at different cuts

taucuts

(ctr_cut_ev_eltau->GetBinContent(1+4) - ctr_cut_ev_mutau->GetBinContent(1+4)) / sqrt((ctr_cut_ev_eltau->GetBinContent(1+4) + ctr_cut_ev_mutau->GetBinContent(1+4))*0.5)

isrup
-0.583901

nom
0.560909

isrdown
0.197620
0.642383
-1.06799
inc
-0.459232

damn


lepcuts

(ctr_cut_ev_eltau->GetBinContent(1+3) - ctr_cut_ev_mutau->GetBinContent(1+3)) / sqrt((ctr_cut_ev_eltau->GetBinContent(1+3) + ctr_cut_ev_mutau->GetBinContent(1+3))*0.5)

isrup
-0.0187096

nom
-0.665385

isrdown
2.89260



## So is it just unfortunate double-fluctuation?

in nominal there are
a bit more muons     <-------- no! it would show up in all other systematics!
in isrdown ---
a bit more electrons

or rather:

in nominal the electrons pass
a bit better         <--------- it would also show up in all ther other systematics?
in isrdown ---
a bit worse

is that 0.7% = 0.007 within stat uncertainties?

down
nom
up

cut_ev_eltau->GetBinContent(1) / all_ev_eltau->GetBinContent(1)
0.182129
0.183309
0.183581

(0.182129 - 0.183309) / 0.183309
-0.00643722

sqrt(all_ev_eltau->GetBinContent(1)) / all_ev_eltau->GetBinContent(1)
sqrt(cut_ev_eltau->GetBinContent(1)) / cut_ev_eltau->GetBinContent(1)

isrdown
0.000665287
0.00155890

nom
0.000929730
0.00217153

isrup
0.000653029
0.00152412

--- so, it is indeed within 1 sigma

julia> 0.007 * 0.1687
0.0011809

but in the table of acceptance statistical uncertainty is only
0.00004

-- why??



# if tau cuts do this, then there must be a deviation in the tau kinematics?

ALSO: eta cut on tau now is 2.4 instead of 2.3!

tau kino:

python jobsums/get_shapes.py --norm-binwidth --no-std-path --formula "isrup:nom:isrdown" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_mu_tau_pt isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_mu_tau_pt nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_mu_tau_pt
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png ./compare_accept_tau_pt_mu_nom,isrup,isrdown_formula.png

python jobsums/get_shapes.py --norm-binwidth --no-std-path --formula "isrup:nom:isrdown" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_el_tau_pt isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_el_tau_pt nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_el_tau_pt
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png ./compare_accept_tau_pt_el_nom,isrup,isrdown_formula.png

python jobsums/get_shapes.py --norm-binwidth --no-std-path --formula "isrup:nom:isrdown" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_mu_tau_eta isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_mu_tau_eta nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_mu_tau_eta
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png ./compare_accept_tau_eta_mu_nom,isrup,isrdown_formula.png

python jobsums/get_shapes.py --norm-binwidth --no-std-path --formula "isrup:nom:isrdown" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_el_tau_eta isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_el_tau_eta nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_el_tau_eta
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png ./compare_accept_tau_eta_el_nom,isrup,isrdown_formula.png

-- no difference!

python jobsums/get_shapes.py --no-std-path --formula "isrup / nom:isrdown / nom" isrup:lstore_outdirs/v34/t3/5/MC2016_Summer16_TTJets_powheg_isrup.root:gen_el_tau_eta isrdown:lstore_outdirs/v34/t3/5/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_el_tau_eta nom:lstore_outdirs/v34/t3/5/MC2016_Summer16_TTJets_powheg.root:gen_el_tau_eta
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png ./compare_accept_tau_eta_el_ratio_nom,isrup,isrdown_formula.png

python jobsums/get_shapes.py --no-std-path --formula "isrup / nom:isrdown / nom" isrup:lstore_outdirs/v34/t3/5/MC2016_Summer16_TTJets_powheg_isrup.root:gen_el_tau_pt isrdown:lstore_outdirs/v34/t3/5/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_el_tau_pt nom:lstore_outdirs/v34/t3/5/MC2016_Summer16_TTJets_powheg.root:gen_el_tau_pt

python jobsums/get_shapes.py --no-std-path --formula "isrup / nom:isrdown / nom" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_el_taucut_tau_pt isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_el_taucut_tau_pt nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_el_taucut_tau_pt

python jobsums/get_shapes.py --no-std-path --formula "isrup / nom:isrdown / nom" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_el_taucut_tau_eta isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_el_taucut_tau_eta nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_el_taucut_tau_eta


python jobsums/get_shapes.py --y-range 0.9,1.1 --no-std-path --no-legend --formula "isrup / isrdown:isrdown / nom" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_el_taucut_tau_pt isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_el_taucut_tau_pt nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_el_taucut_tau_pt
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png ./compare_accept_attaucut_tau_pt_el_ratio_nom,isrup,isrdown_formula.png

python jobsums/get_shapes.py --no-std-path --no-legend --formula "isrup / isrdown:isrdown / nom" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_el_taucut_tau_eta isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_el_taucut_tau_eta nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_el_taucut_tau_eta
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png ./compare_accept_attaucut_tau_eta_el_ratio_nom,isrup,isrdown_formula.png


python jobsums/get_shapes.py --no-std-path --no-legend --formula "isrup / isrdown:isrdown / nom" isrup:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_el_pt isrdown:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_el_pt nom:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg.root:gen_el_pt
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_nom,isrup,isrdown_formula.png ./compare_accept_el_pt_el_ratio_nom,isrup,isrdown_formula.png

python jobsums/get_shapes.py --y-range 0.9,1.1 --no-std-path --formula "isrup_mu / isrdown_mu:isrup_el / isrdown_el" isrup_el:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_el_pt isrdown_el:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_el_pt isrup_mu:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_mu_pt isrdown_mu:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_mu_pt
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_isrdown_el,isrdown_mu,isrup_mu,isrup_el_formula.png ./compare_accept_el_pt_mu_pt_ratio_isrup-isrdown.png

python jobsums/get_shapes.py --no-std-path --formula "isrup_mu:isrdown_mu" isrup_mu:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:gen_mu_pt isrdown_mu:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:gen_mu_pt

maybe the difference after the lep cuts matters somehow?

python jobsums/get_shapes.py --y-range 0.9,1.1 --no-std-path --formula "isrup_mu / isrdown_mu:isrup_el / isrdown_el" isrup_el:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:pre_gen_el_pt isrdown_el:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:pre_gen_el_pt isrup_mu:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrup.root:pre_gen_mu_pt isrdown_mu:lstore_outdirs/v34/t3/MC2016_Summer16_TTJets_powheg_isrdown.root:pre_gen_mu_pt
mv ./compare_mu_sel_tt_lj_NOMINAL_Mt_lep_met_f_isrdown_el,isrdown_mu,isrup_mu,isrup_el_formula.png ./compare_accept_pre_el_pt_mu_pt_ratio_isrup-isrdown.png

-- fluctuations only



## stats in samples

all_ev_eltau->GetBinContent(1)
all_ev_mutau->GetBinContent(1)

nom
1.15688e+06
1.15776e+06

isrup
2.34496e+06
2.34554e+06

isrdown
2.25934e+06
2.25509e+06

old:

hdamp DOWN:
733697.
732305.

isrup
1.46485e+06
1.46540e+06

isrdown
1.43009e+06
1.42765e+06

--- in new stats the isrdown still has the deviation


## effect through event weight?





# strange difference in ISR variation of the acceptance: eltau is larger than mutau

it is indeed so:

python print_acceptances.py --sys-weights lstore_outdirs/merge-sets/v34/t1/MC2016_Summer16_TTJets_powheg*.root --devs merge_files_rel --how-print cols
INFO:root:import ROOT
INFO:root:done
eltau
nominal_0 (0.16871733092913158, 0.00044946129767493365)
tune_Down (0.16822052666973739, 0.0005241794281337938)
tune_Up (0.16840016803100344, 0.0005320992953274569)
fsr_Down (0.17090530022248543, 0.00035300196957377785)
fsr_Up (0.16453780904762194, 0.00048450046176938175)
hdamp_Down (0.16671218230020823, 0.0005604933136098909)
hdamp_Up (0.16879452643576406, 0.0005885384721412596)
isr_Down (0.1675388724176389, 0.0004026906254954683)
isr_Up (0.1688960375464582, 0.00039971862006218776)
mutau
nominal_0 (0.17559440519640376, 0.000437255062928371)
tune_Down (0.1753945159403695, 0.0005110194936480807)
tune_Up (0.17517004651555723, 0.0005177170179845502)
fsr_Down (0.17781251414016475, 0.00034358418820011665)
fsr_Up (0.17117813584968303, 0.0004714894297375974)
hdamp_Down (0.1730218042045469, 0.0005450966131799825)
hdamp_Up (0.17571221242868296, 0.0005734473338443343)
isr_Down (0.17536520694951038, 0.0003935401370710812)
isr_Up (0.17616418259127953, 0.0003894714516344488)
sum
nominal_0 (0.17215718299241814, 0.000313564816444656)
tune_Down (0.17180524295639155, 0.0003660778559867503)
tune_Up (0.17178567026597544, 0.00037124226142166994)
fsr_Down (0.1743584276021855, 0.000246332890447185)
fsr_Up (0.16785695069685447, 0.0003380662159919259)
hdamp_Down (0.16986399815108275, 0.00039097663457298765)
hdamp_Up (0.17225143717847446, 0.00041091330471192816)
isr_Down (0.17144869031677326, 0.00028157061031020063)
isr_Up (0.1725308002656982, 0.000279077104625903)
                               eltau      mutau        sum
 nominal_0 nom                           0.1687     0.1756     0.1722
 nominal_0 scales_renorm                 0.0010     0.0018     0.0014
 nominal_0 scales_refact                 0.0029     0.0030     0.0029
 nominal_0 scales_both                   0.0021     0.0025     0.0022
 nominal_0 pdfs                          0.0129     0.0141     0.0133
      tune nom                           0.0035     0.0027     0.0030
     hdamp nom                           0.0119     0.0147     0.0133
       isr nom                           0.0071     0.0035     0.0047
       fsr nom                           0.0280     0.0281     0.0281

-- maybe ISR varies lepton pT and gets at the cut of electron pT?

hadd lstore_outdirs/merge-sets/v25/r4/MC2016_Summer16_TTJets_powheg_isrdown.root      lstore_outdirs/v25/r4/MC2016_Summer16_TTJets_powheg_isrdown/MC2016_Summer16_TTJets_powheg_isrdown_*.root
hadd lstore_outdirs/merge-sets/v25/r4/MC2016_Summer16_TTJets_powheg_isrdown_ext1.root lstore_outdirs/v25/r4/MC2016_Summer16_TTJets_powheg_isrdown_ext1/MC2016_Summer16_TTJets_powheg_isrdown_*.root
hadd lstore_outdirs/merge-sets/v25/r4/MC2016_Summer16_TTJets_powheg_isrdown_ext2.root lstore_outdirs/v25/r4/MC2016_Summer16_TTJets_powheg_isrdown_ext2/MC2016_Summer16_TTJets_powheg_isrdown_*.root

hadd lstore_outdirs/merge-sets/v25/r4/MC2016_Summer16_TTJets_powheg_isrup.root      lstore_outdirs/v25/r4/MC2016_Summer16_TTJets_powheg_isrup/MC2016_Summer16_TTJets_powheg_isrup_*.root
hadd lstore_outdirs/merge-sets/v25/r4/MC2016_Summer16_TTJets_powheg_isrup_ext2.root lstore_outdirs/v25/r4/MC2016_Summer16_TTJets_powheg_isrup/MC2016_Summer16_TTJets_powheg_isrup_*.root

hadd all_MC2016_Summer16_TTJets_powheg_isrup.root   MC2016_Summer16_TTJets_powheg_isrup*.root
hadd all_MC2016_Summer16_TTJets_powheg_isrdown.root MC2016_Summer16_TTJets_powheg_isrdown*.root

hadd lstore_outdirs/merge-sets/v25/pStage2Test5/MC2016_Summer16_TTJets_powheg.root lstore_outdirs/v25/pStage2Test5/MC2016_Summer16_TTJets_powheg/*root

root -l lstore_outdirs/merge-sets/v25/r4/all_MC2016_Summer16_TTJets_powheg_isrup.root
root -l lstore_outdirs/merge-sets/v25/r4/all_MC2016_Summer16_TTJets_powheg_isrdown.root
root -l lstore_outdirs/merge-sets/v25/pStage2Test5/MC2016_Summer16_TTJets_powheg.root

ttree_out->Draw("event_leptons[0].pt()>>h(30,0,300)", "gen_proc_id == 41")
h_ = (TH1D*) ttree_out->GetHistogram()
h_isr = (TH1D*) h_->Clone()

h_isr->SetName("h_isrup1")
h_isr->SetDirectory(0)
h_isr->SaveAs("h_isrup1_lep_pt.root")

h_isr->SetName("h_isrdown1")
h_isr->SetDirectory(0)
h_isr->SaveAs("h_isrdown1_lep_pt.root")

h_isr->SetName("h_nom")
h_isr->SetDirectory(0)
h_isr->SaveAs("h_nom_lep_pt.root")

hadd h_isr_lep_pt.root h_isrup1_lep_pt.root h_isrdown1_lep_pt.root h_nom_lep_pt.root

int_h_isrup1   = h_isrup1->Integral()
int_h_isrdown1 = h_isrdown1->Integral()
int_h_nom      = h_nom->Integral()

h_isrup1   ->Scale(1./h_isrup1->Integral())
h_isrdown1 ->Scale(1./h_isrdown1->Integral())
h_nom ->Scale(1./h_nom->Integral())

h_isrup1 ->SetLineColor(kRed)
h_nom    ->SetLineColor(kGreen)

h_isrup   ->SetBinError(1,  h_isrup->GetBinError(1) /(int_isrup * h_isrup->GetBinContent(1) ))
h_isrup   ->SetBinError(2,  h_isrup->GetBinError(2) /(int_isrup * h_isrup->GetBinContent(2) ))
h_isrup   ->SetBinError(3,  h_isrup->GetBinError(3) /(int_isrup * h_isrup->GetBinContent(3) ))
h_isrup   ->SetBinError(4,  h_isrup->GetBinError(4) /(int_isrup * h_isrup->GetBinContent(4) ))
h_isrup   ->SetBinError(5,  h_isrup->GetBinError(5) /(int_isrup * h_isrup->GetBinContent(5) ))
h_isrup   ->SetBinError(6,  h_isrup->GetBinError(6) /(int_isrup * h_isrup->GetBinContent(6) ))
h_isrup   ->SetBinError(7,  h_isrup->GetBinError(7) /(int_isrup * h_isrup->GetBinContent(7) ))
h_isrup   ->SetBinError(8,  h_isrup->GetBinError(8) /(int_isrup * h_isrup->GetBinContent(8) ))
h_isrup   ->SetBinError(9,  h_isrup->GetBinError(9) /(int_isrup * h_isrup->GetBinContent(9) ))
h_isrup   ->SetBinError(10, h_isrup->GetBinError(10)/(int_isrup * h_isrup->GetBinContent(10)))
h_isrup   ->SetBinError(11, h_isrup->GetBinError(11)/(int_isrup * h_isrup->GetBinContent(11)))
h_isrup   ->SetBinError(12, h_isrup->GetBinError(12)/(int_isrup * h_isrup->GetBinContent(12)))
h_isrup   ->SetBinError(13, h_isrup->GetBinError(13)/(int_isrup * h_isrup->GetBinContent(13)))
h_isrup   ->SetBinError(14, h_isrup->GetBinError(14)/(int_isrup * h_isrup->GetBinContent(14)))
h_isrup   ->SetBinError(15, h_isrup->GetBinError(15)/(int_isrup * h_isrup->GetBinContent(15)))
h_isrup   ->SetBinError(16, h_isrup->GetBinError(16)/(int_isrup * h_isrup->GetBinContent(16)))
h_isrup   ->SetBinError(17, h_isrup->GetBinError(17)/(int_isrup * h_isrup->GetBinContent(17)))
h_isrup   ->SetBinError(18, h_isrup->GetBinError(18)/(int_isrup * h_isrup->GetBinContent(18)))
h_isrup   ->SetBinError(19, h_isrup->GetBinError(19)/(int_isrup * h_isrup->GetBinContent(19)))
h_isrup   ->SetBinError(20, h_isrup->GetBinError(20)/(int_isrup * h_isrup->GetBinContent(20)))
h_isrup   ->SetBinError(21, h_isrup->GetBinError(21)/(int_isrup * h_isrup->GetBinContent(21)))
h_isrup   ->SetBinError(22, h_isrup->GetBinError(22)/(int_isrup * h_isrup->GetBinContent(22)))
h_isrup   ->SetBinError(23, h_isrup->GetBinError(23)/(int_isrup * h_isrup->GetBinContent(23)))
h_isrup   ->SetBinError(24, h_isrup->GetBinError(24)/(int_isrup * h_isrup->GetBinContent(24)))
h_isrup   ->SetBinError(25, h_isrup->GetBinError(25)/(int_isrup * h_isrup->GetBinContent(25)))
h_isrup   ->SetBinError(26, h_isrup->GetBinError(26)/(int_isrup * h_isrup->GetBinContent(26)))
h_isrup   ->SetBinError(27, h_isrup->GetBinError(27)/(int_isrup * h_isrup->GetBinContent(27)))
h_isrup   ->SetBinError(28, h_isrup->GetBinError(28)/(int_isrup * h_isrup->GetBinContent(28)))
h_isrup   ->SetBinError(29, h_isrup->GetBinError(29)/(int_isrup * h_isrup->GetBinContent(29)))
h_isrup   ->SetBinError(30, h_isrup->GetBinError(30)/(int_isrup * h_isrup->GetBinContent(30)))

h_isrdown   ->SetBinError(1,  h_isrdown->GetBinError(1) /(int_isrdown*h_isrdown->GetBinContent(1) ))
h_isrdown   ->SetBinError(2,  h_isrdown->GetBinError(2) /(int_isrdown*h_isrdown->GetBinContent(2) ))
h_isrdown   ->SetBinError(3,  h_isrdown->GetBinError(3) /(int_isrdown*h_isrdown->GetBinContent(3) ))
h_isrdown   ->SetBinError(4,  h_isrdown->GetBinError(4) /(int_isrdown*h_isrdown->GetBinContent(4) ))
h_isrdown   ->SetBinError(5,  h_isrdown->GetBinError(5) /(int_isrdown*h_isrdown->GetBinContent(5) ))
h_isrdown   ->SetBinError(6,  h_isrdown->GetBinError(6) /(int_isrdown*h_isrdown->GetBinContent(6) ))
h_isrdown   ->SetBinError(7,  h_isrdown->GetBinError(7) /(int_isrdown*h_isrdown->GetBinContent(7) ))
h_isrdown   ->SetBinError(8,  h_isrdown->GetBinError(8) /(int_isrdown*h_isrdown->GetBinContent(8) ))
h_isrdown   ->SetBinError(9,  h_isrdown->GetBinError(9) /(int_isrdown*h_isrdown->GetBinContent(9) ))
h_isrdown   ->SetBinError(10, h_isrdown->GetBinError(10)/(int_isrdown*h_isrdown->GetBinContent(10)))
h_isrdown   ->SetBinError(11, h_isrdown->GetBinError(11)/(int_isrdown*h_isrdown->GetBinContent(11)))
h_isrdown   ->SetBinError(12, h_isrdown->GetBinError(12)/(int_isrdown*h_isrdown->GetBinContent(12)))
h_isrdown   ->SetBinError(13, h_isrdown->GetBinError(13)/(int_isrdown*h_isrdown->GetBinContent(13)))
h_isrdown   ->SetBinError(14, h_isrdown->GetBinError(14)/(int_isrdown*h_isrdown->GetBinContent(14)))
h_isrdown   ->SetBinError(15, h_isrdown->GetBinError(15)/(int_isrdown*h_isrdown->GetBinContent(15)))
h_isrdown   ->SetBinError(16, h_isrdown->GetBinError(16)/(int_isrdown*h_isrdown->GetBinContent(16)))
h_isrdown   ->SetBinError(17, h_isrdown->GetBinError(17)/(int_isrdown*h_isrdown->GetBinContent(17)))
h_isrdown   ->SetBinError(18, h_isrdown->GetBinError(18)/(int_isrdown*h_isrdown->GetBinContent(18)))
h_isrdown   ->SetBinError(19, h_isrdown->GetBinError(19)/(int_isrdown*h_isrdown->GetBinContent(19)))
h_isrdown   ->SetBinError(20, h_isrdown->GetBinError(20)/(int_isrdown*h_isrdown->GetBinContent(20)))
h_isrdown   ->SetBinError(21, h_isrdown->GetBinError(21)/(int_isrdown*h_isrdown->GetBinContent(21)))
h_isrdown   ->SetBinError(22, h_isrdown->GetBinError(22)/(int_isrdown*h_isrdown->GetBinContent(22)))
h_isrdown   ->SetBinError(23, h_isrdown->GetBinError(23)/(int_isrdown*h_isrdown->GetBinContent(23)))
h_isrdown   ->SetBinError(24, h_isrdown->GetBinError(24)/(int_isrdown*h_isrdown->GetBinContent(24)))
h_isrdown   ->SetBinError(25, h_isrdown->GetBinError(25)/(int_isrdown*h_isrdown->GetBinContent(25)))
h_isrdown   ->SetBinError(26, h_isrdown->GetBinError(26)/(int_isrdown*h_isrdown->GetBinContent(26)))
h_isrdown   ->SetBinError(27, h_isrdown->GetBinError(27)/(int_isrdown*h_isrdown->GetBinContent(27)))
h_isrdown   ->SetBinError(28, h_isrdown->GetBinError(28)/(int_isrdown*h_isrdown->GetBinContent(28)))
h_isrdown   ->SetBinError(29, h_isrdown->GetBinError(29)/(int_isrdown*h_isrdown->GetBinContent(29)))
h_isrdown   ->SetBinError(30, h_isrdown->GetBinError(30)/(int_isrdown*h_isrdown->GetBinContent(30)))

h_nom   ->SetBinError(1,  h_nom->GetBinError(1) /(int_nom*h_nom->GetBinContent(1) ))
h_nom   ->SetBinError(2,  h_nom->GetBinError(2) /(int_nom*h_nom->GetBinContent(2) ))
h_nom   ->SetBinError(3,  h_nom->GetBinError(3) /(int_nom*h_nom->GetBinContent(3) ))
h_nom   ->SetBinError(4,  h_nom->GetBinError(4) /(int_nom*h_nom->GetBinContent(4) ))
h_nom   ->SetBinError(5,  h_nom->GetBinError(5) /(int_nom*h_nom->GetBinContent(5) ))
h_nom   ->SetBinError(6,  h_nom->GetBinError(6) /(int_nom*h_nom->GetBinContent(6) ))
h_nom   ->SetBinError(7,  h_nom->GetBinError(7) /(int_nom*h_nom->GetBinContent(7) ))
h_nom   ->SetBinError(8,  h_nom->GetBinError(8) /(int_nom*h_nom->GetBinContent(8) ))
h_nom   ->SetBinError(9,  h_nom->GetBinError(9) /(int_nom*h_nom->GetBinContent(9) ))
h_nom   ->SetBinError(10, h_nom->GetBinError(10)/(int_nom*h_nom->GetBinContent(10)))
h_nom   ->SetBinError(11, h_nom->GetBinError(11)/(int_nom*h_nom->GetBinContent(11)))
h_nom   ->SetBinError(12, h_nom->GetBinError(12)/(int_nom*h_nom->GetBinContent(12)))
h_nom   ->SetBinError(13, h_nom->GetBinError(13)/(int_nom*h_nom->GetBinContent(13)))
h_nom   ->SetBinError(14, h_nom->GetBinError(14)/(int_nom*h_nom->GetBinContent(14)))
h_nom   ->SetBinError(15, h_nom->GetBinError(15)/(int_nom*h_nom->GetBinContent(15)))
h_nom   ->SetBinError(16, h_nom->GetBinError(16)/(int_nom*h_nom->GetBinContent(16)))
h_nom   ->SetBinError(17, h_nom->GetBinError(17)/(int_nom*h_nom->GetBinContent(17)))
h_nom   ->SetBinError(18, h_nom->GetBinError(18)/(int_nom*h_nom->GetBinContent(18)))
h_nom   ->SetBinError(19, h_nom->GetBinError(19)/(int_nom*h_nom->GetBinContent(19)))
h_nom   ->SetBinError(20, h_nom->GetBinError(20)/(int_nom*h_nom->GetBinContent(20)))
h_nom   ->SetBinError(21, h_nom->GetBinError(21)/(int_nom*h_nom->GetBinContent(21)))
h_nom   ->SetBinError(22, h_nom->GetBinError(22)/(int_nom*h_nom->GetBinContent(22)))
h_nom   ->SetBinError(23, h_nom->GetBinError(23)/(int_nom*h_nom->GetBinContent(23)))
h_nom   ->SetBinError(24, h_nom->GetBinError(24)/(int_nom*h_nom->GetBinContent(24)))
h_nom   ->SetBinError(25, h_nom->GetBinError(25)/(int_nom*h_nom->GetBinContent(25)))
h_nom   ->SetBinError(26, h_nom->GetBinError(26)/(int_nom*h_nom->GetBinContent(26)))
h_nom   ->SetBinError(27, h_nom->GetBinError(27)/(int_nom*h_nom->GetBinContent(27)))
h_nom   ->SetBinError(28, h_nom->GetBinError(28)/(int_nom*h_nom->GetBinContent(28)))
h_nom   ->SetBinError(29, h_nom->GetBinError(29)/(int_nom*h_nom->GetBinContent(29)))
h_nom   ->SetBinError(30, h_nom->GetBinError(30)/(int_nom*h_nom->GetBinContent(30)))

h_isrup1   ->Draw()
h_isrdown1 ->Draw("same")
h_nom ->Draw("same")


need full sumup on gstore of v34 which stores full signal sample
--histo-range 100,0,300

python sumup_ttree_draw.py "lep_p4[0].pt()" --custom-range 20,24,28,32,40,50,60,70,90,110,140,200,300 --histo-name accept_incl_isr_issue_nom_lep_pt     --output accept_incl_isr_issue_nom_lep_pt.root     gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v34_MC2016_Summer16_TTJets_powheg/180717_001103/0000/MC2016_Summer16_TTJets_powheg_*.root  &
python sumup_ttree_draw.py "lep_p4[0].pt()" --custom-range 20,24,28,32,40,50,60,70,90,110,140,200,300 --histo-name accept_incl_isr_issue_isrup_lep_pt   --output accept_incl_isr_issue_isrup_lep_pt.root   gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/*/*/*/*root  &
python sumup_ttree_draw.py "lep_p4[0].pt()" --custom-range 20,24,28,32,40,50,60,70,90,110,140,200,300 --histo-name accept_incl_isr_issue_isrdown_lep_pt --output accept_incl_isr_issue_isrdown_lep_pt.root gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/*/*/*/*root  &

--- this one has the best hint of the ISR effect on lepton pT.

hadd accept_isr_issue_reco_lep_pt.root accept_incl_isr_issue_nom_lep_pt.root accept_incl_isr_issue_isrup_lep_pt.root accept_incl_isr_issue_isrdown_lep_pt.root



python sumup_ttree_draw.py "lep_p4[0].pt()" --custom-range 10,20,25,28,31,35,40,45,50,60,70,90,110,140,200,300 --histo-name accept_incl_isr_issue_nom_lep_pt     --output accept_incl_isr_issue_nom.root     gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v34_MC2016_Summer16_TTJets_powheg/180717_001103/0000/MC2016_Summer16_TTJets_powheg_*.root  &
python sumup_ttree_draw.py "lep_p4[0].pt()" --custom-range 10,20,25,28,31,35,40,45,50,60,70,90,110,140,200,300 --histo-name accept_incl_isr_issue_isrup_lep_pt   --output accept_incl_isr_issue_isrup.root   gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/*/*/*/*root  &
python sumup_ttree_draw.py "lep_p4[0].pt()" --custom-range 10,20,25,28,31,35,40,45,50,60,70,90,110,140,200,300 --histo-name accept_incl_isr_issue_isrdown_lep_pt --output accept_incl_isr_issue_isrdown.root gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/*/*/*/*root  &

python sumup_ttree_draw.py "lep_p4[0].pt()" --cond-com "abs(gen_t_w_decay_id) == 11 || abs(gen_tb_w_decay_id) == 11" --custom-range 10,20,25,28,31,35,40,45,50,60,70,90,110,140,200,300 --histo-name accept_el_isr_issue_nom_lep_pt     --output accept_el_isr_issue_nom.root     gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v34_MC2016_Summer16_TTJets_powheg/180717_001103/0000/MC2016_Summer16_TTJets_powheg_*.root  &
python sumup_ttree_draw.py "lep_p4[0].pt()" --cond-com "abs(gen_t_w_decay_id) == 11 || abs(gen_tb_w_decay_id) == 11" --custom-range 10,20,25,28,31,35,40,45,50,60,70,90,110,140,200,300 --histo-name accept_el_isr_issue_isrup_lep_pt   --output accept_el_isr_issue_isrup.root   gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/*/*/*/*root  &
python sumup_ttree_draw.py "lep_p4[0].pt()" --cond-com "abs(gen_t_w_decay_id) == 11 || abs(gen_tb_w_decay_id) == 11" --custom-range 10,20,25,28,31,35,40,45,50,60,70,90,110,140,200,300 --histo-name accept_el_isr_issue_isrdown_lep_pt --output accept_el_isr_issue_isrdown.root gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/*/*/*/*root  &

python sumup_ttree_draw.py "lep_p4[0].pt()" --cond-com "abs(gen_t_w_decay_id) == 13 || abs(gen_tb_w_decay_id) == 13" --custom-range 10,20,25,28,31,35,40,45,50,60,70,90,110,140,200,300 --histo-name accept_mu_isr_issue_nom_lep_pt     --output accept_mu_isr_issue_nom.root     gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v34_MC2016_Summer16_TTJets_powheg/180717_001103/0000/MC2016_Summer16_TTJets_powheg_*.root  &
python sumup_ttree_draw.py "lep_p4[0].pt()" --cond-com "abs(gen_t_w_decay_id) == 13 || abs(gen_tb_w_decay_id) == 13" --custom-range 10,20,25,28,31,35,40,45,50,60,70,90,110,140,200,300 --histo-name accept_mu_isr_issue_isrup_lep_pt   --output accept_mu_isr_issue_isrup.root   gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/*/*/*/*root  &
python sumup_ttree_draw.py "lep_p4[0].pt()" --cond-com "abs(gen_t_w_decay_id) == 13 || abs(gen_tb_w_decay_id) == 13" --custom-range 10,20,25,28,31,35,40,45,50,60,70,90,110,140,200,300 --histo-name accept_mu_isr_issue_isrdown_lep_pt --output accept_mu_isr_issue_isrdown.root gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/*/*/*/*root  &


hadd accept_isr_issue.root accept_el_isr_issue_nom.root accept_el_isr_issue_isrup.root accept_el_isr_issue_isrdown.root accept_mu_isr_issue_nom.root accept_mu_isr_issue_isrup.root accept_mu_isr_issue_isrdown.root

gen leps

python sumup_ttree_draw.py "gen2_leptons_p4[0].pt()" --custom-range 0,10,20,30,40,50,60,70,90,110,140,200,300,500 --histo-name accept_gen_incl_isr_issue_nom_lep_pt     --output accept_gen_incl_isr_issue_nom.root     gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v34_MC2016_Summer16_TTJets_powheg/180717_001103/0000/MC2016_Summer16_TTJets_powheg_*.root  &
python sumup_ttree_draw.py "gen2_leptons_p4[0].pt()" --custom-range 0,10,20,30,40,50,60,70,90,110,140,200,300,500 --histo-name accept_gen_incl_isr_issue_isrup_lep_pt   --output accept_gen_incl_isr_issue_isrup.root   gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/*/*/*/*root  &
python sumup_ttree_draw.py "gen2_leptons_p4[0].pt()" --custom-range 0,10,20,30,40,50,60,70,90,110,140,200,300,500 --histo-name accept_gen_incl_isr_issue_isrdown_lep_pt --output accept_gen_incl_isr_issue_isrdown.root gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/*/*/*/*root  &

python sumup_ttree_draw.py "gen2_leptons_p4[0].pt()" --cond-com "abs(gen_t_w_decay_id) == 11 || abs(gen_tb_w_decay_id) == 11" --custom-range 0,10,20,30,40,50,60,70,90,110,140,200,300,500 --histo-name accept_gen_el_isr_issue_nom_lep_pt     --output accept_gen_el_isr_issue_nom.root     gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v34_MC2016_Summer16_TTJets_powheg/180717_001103/0000/MC2016_Summer16_TTJets_powheg_*.root  &
python sumup_ttree_draw.py "gen2_leptons_p4[0].pt()" --cond-com "abs(gen_t_w_decay_id) == 11 || abs(gen_tb_w_decay_id) == 11" --custom-range 0,10,20,30,40,50,60,70,90,110,140,200,300,500 --histo-name accept_gen_el_isr_issue_isrup_lep_pt   --output accept_gen_el_isr_issue_isrup.root   gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/*/*/*/*root  &
python sumup_ttree_draw.py "gen2_leptons_p4[0].pt()" --cond-com "abs(gen_t_w_decay_id) == 11 || abs(gen_tb_w_decay_id) == 11" --custom-range 0,10,20,30,40,50,60,70,90,110,140,200,300,500 --histo-name accept_gen_el_isr_issue_isrdown_lep_pt --output accept_gen_el_isr_issue_isrdown.root gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/*/*/*/*root  &

python sumup_ttree_draw.py "gen2_leptons_p4[0].pt()" --cond-com "abs(gen_t_w_decay_id) == 13 || abs(gen_tb_w_decay_id) == 13" --custom-range 0,10,20,30,40,50,60,70,90,110,140,200,300,500 --histo-name accept_gen_mu_isr_issue_nom_lep_pt     --output accept_gen_mu_isr_issue_nom.root     gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v34_MC2016_Summer16_TTJets_powheg/180717_001103/0000/MC2016_Summer16_TTJets_powheg_*.root  &
python sumup_ttree_draw.py "gen2_leptons_p4[0].pt()" --cond-com "abs(gen_t_w_decay_id) == 13 || abs(gen_tb_w_decay_id) == 13" --custom-range 0,10,20,30,40,50,60,70,90,110,140,200,300,500 --histo-name accept_gen_mu_isr_issue_isrup_lep_pt   --output accept_gen_mu_isr_issue_isrup.root   gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/*/*/*/*root  &
python sumup_ttree_draw.py "gen2_leptons_p4[0].pt()" --cond-com "abs(gen_t_w_decay_id) == 13 || abs(gen_tb_w_decay_id) == 13" --custom-range 0,10,20,30,40,50,60,70,90,110,140,200,300,500 --histo-name accept_gen_mu_isr_issue_isrdown_lep_pt --output accept_gen_mu_isr_issue_isrdown.root gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/*/*/*/*root  &


hadd accept_gen_isr_issue.root accept_gen_el_isr_issue_nom.root accept_gen_el_isr_issue_isrup.root accept_gen_el_isr_issue_isrdown.root accept_gen_mu_isr_issue_nom.root accept_gen_mu_isr_issue_isrup.root accept_gen_mu_isr_issue_isrdown.root accept_gen_incl_isr_issue_nom.root accept_gen_incl_isr_issue_isrup.root accept_gen_incl_isr_issue_isrdown.root

plots

h_incl_nom = (TH1D*) accept_gen_incl_isr_issue_nom_lep_pt->Get("accept_gen_incl_isr_issue_nom_lep_pt_accept_gen_incl_isr_issue_nom_lep_pt")
h_incl_isrup = (TH1D*) accept_gen_incl_isr_issue_isrup_lep_pt->Get("accept_gen_incl_isr_issue_isrup_lep_pt_accept_gen_incl_isr_issue_isrup_lep_pt")
h_incl_isrdown = (TH1D*) accept_gen_incl_isr_issue_isrdown_lep_pt->Get("accept_gen_incl_isr_issue_isrdown_lep_pt_accept_gen_incl_isr_issue_isrdown_lep_pt")

h_el_nom = (TH1D*) accept_gen_el_isr_issue_nom_lep_pt->Get("accept_gen_el_isr_issue_nom_lep_pt_accept_gen_el_isr_issue_nom_lep_pt")
h_el_isrup = (TH1D*) accept_gen_el_isr_issue_isrup_lep_pt->Get("accept_gen_el_isr_issue_isrup_lep_pt_accept_gen_el_isr_issue_isrup_lep_pt")
h_el_isrdown = (TH1D*) accept_gen_el_isr_issue_isrdown_lep_pt->Get("accept_gen_el_isr_issue_isrdown_lep_pt_accept_gen_el_isr_issue_isrdown_lep_pt")

h_mu_nom = (TH1D*) accept_gen_mu_isr_issue_nom_lep_pt->Get("accept_gen_mu_isr_issue_nom_lep_pt_accept_gen_mu_isr_issue_nom_lep_pt")
h_mu_isrup = (TH1D*) accept_gen_mu_isr_issue_isrup_lep_pt->Get("accept_gen_mu_isr_issue_isrup_lep_pt_accept_gen_mu_isr_issue_isrup_lep_pt")
h_mu_isrdown = (TH1D*) accept_gen_mu_isr_issue_isrdown_lep_pt->Get("accept_gen_mu_isr_issue_isrdown_lep_pt_accept_gen_mu_isr_issue_isrdown_lep_pt")

h_el_nom    ->Scale(1./h_el_nom->Integral())
h_el_isrup  ->Scale(1./h_el_isrup->Integral())
h_el_isrdown->Scale(1./h_el_isrdown->Integral())

h_mu_nom    ->Scale(1./h_mu_nom->Integral())
h_mu_isrup  ->Scale(1./h_mu_isrup->Integral())
h_mu_isrdown->Scale(1./h_mu_isrdown->Integral())

h_el_nom->Divide(h_mu_nom)
h_el_isrup->Divide(h_mu_isrup)
h_el_isrdown->Divide(h_mu_isrdown)

h_el_nom->Draw()
h_el_isrup->Draw()
h_el_isrdown->Draw()

-- seems like no significant difference between the generated electron and muon pT

h_el_nom = (TH1D*) accept_el_isr_issue_nom_lep_pt->Get("accept_el_isr_issue_nom_lep_pt_accept_el_isr_issue_nom_lep_pt")
h_el_isrup = (TH1D*) accept_el_isr_issue_isrup_lep_pt->Get("accept_el_isr_issue_isrup_lep_pt_accept_el_isr_issue_isrup_lep_pt")
h_el_isrdown = (TH1D*) accept_el_isr_issue_isrdown_lep_pt->Get("accept_el_isr_issue_isrdown_lep_pt_accept_el_isr_issue_isrdown_lep_pt")

h_mu_nom = (TH1D*) accept_mu_isr_issue_nom_lep_pt->Get("accept_mu_isr_issue_nom_lep_pt_accept_mu_isr_issue_nom_lep_pt")
h_mu_isrup = (TH1D*) accept_mu_isr_issue_isrup_lep_pt->Get("accept_mu_isr_issue_isrup_lep_pt_accept_mu_isr_issue_isrup_lep_pt")
h_mu_isrdown = (TH1D*) accept_mu_isr_issue_isrdown_lep_pt->Get("accept_mu_isr_issue_isrdown_lep_pt_accept_mu_isr_issue_isrdown_lep_pt")

-- and noticeable difference in the reconstructed pT-s.
Due to the turn on curves of the triggers.

So, probably ISR Down touches some other parameter, which correlates with the reconstructed electron pT.
Then the question is:
if ISR Down moves another parameter, which is not related to the electron,
then why the effect of it is different between electron and muon channels?
Is it a correlation with the lepton in the event?
In principle, ISR should generate more jets, therefore the jet cut should be involved.
But how is it connected with the electron? The ISR jets confuse the electron reconstruction?
Aren't they cross-cleaned in dR?

Check gen eta to be sure.

python sumup_ttree_draw.py "gen2_leptons_p4[0].eta()" --histo-range 50,-2.5,2.5 --histo-name accept_gen_incl_isr_issue_nom_lep_eta     --output accept_gen_incl_isr_issue_nom_lep_eta.root     gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v34_MC2016_Summer16_TTJets_powheg/180717_001103/0000/MC2016_Summer16_TTJets_powheg_*.root  &
python sumup_ttree_draw.py "gen2_leptons_p4[0].eta()" --histo-range 50,-2.5,2.5 --histo-name accept_gen_incl_isr_issue_isrup_lep_eta   --output accept_gen_incl_isr_issue_isrup_lep_eta.root   gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/*/*/*/*root  &
python sumup_ttree_draw.py "gen2_leptons_p4[0].eta()" --histo-range 50,-2.5,2.5 --histo-name accept_gen_incl_isr_issue_isrdown_lep_eta --output accept_gen_incl_isr_issue_isrdown_lep_eta.root gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/*/*/*/*root  &

python sumup_ttree_draw.py "gen2_leptons_p4[0].eta()" --cond-com "abs(gen_t_w_decay_id) == 11 || abs(gen_tb_w_decay_id) == 11" --histo-range 50,-2.5,2.5 --histo-name accept_gen_el_isr_issue_nom_lep_eta     --output accept_gen_el_isr_issue_nom_lep_eta.root     gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v34_MC2016_Summer16_TTJets_powheg/180717_001103/0000/MC2016_Summer16_TTJets_powheg_*.root  &
python sumup_ttree_draw.py "gen2_leptons_p4[0].eta()" --cond-com "abs(gen_t_w_decay_id) == 11 || abs(gen_tb_w_decay_id) == 11" --histo-range 50,-2.5,2.5 --histo-name accept_gen_el_isr_issue_isrup_lep_eta   --output accept_gen_el_isr_issue_isrup_lep_eta.root   gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/*/*/*/*root  &
python sumup_ttree_draw.py "gen2_leptons_p4[0].eta()" --cond-com "abs(gen_t_w_decay_id) == 11 || abs(gen_tb_w_decay_id) == 11" --histo-range 50,-2.5,2.5 --histo-name accept_gen_el_isr_issue_isrdown_lep_eta --output accept_gen_el_isr_issue_isrdown_lep_eta.root gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/*/*/*/*root  &

python sumup_ttree_draw.py "gen2_leptons_p4[0].eta()" --cond-com "abs(gen_t_w_decay_id) == 13 || abs(gen_tb_w_decay_id) == 13" --histo-range 50,-2.5,2.5 --histo-name accept_gen_mu_isr_issue_nom_lep_eta     --output accept_gen_mu_isr_issue_nom_lep_eta.root     gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v34_MC2016_Summer16_TTJets_powheg/180717_001103/0000/MC2016_Summer16_TTJets_powheg_*.root  &
python sumup_ttree_draw.py "gen2_leptons_p4[0].eta()" --cond-com "abs(gen_t_w_decay_id) == 13 || abs(gen_tb_w_decay_id) == 13" --histo-range 50,-2.5,2.5 --histo-name accept_gen_mu_isr_issue_isrup_lep_eta   --output accept_gen_mu_isr_issue_isrup_lep_eta.root   gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/*/*/*/*root  &
python sumup_ttree_draw.py "gen2_leptons_p4[0].eta()" --cond-com "abs(gen_t_w_decay_id) == 13 || abs(gen_tb_w_decay_id) == 13" --histo-range 50,-2.5,2.5 --histo-name accept_gen_mu_isr_issue_isrdown_lep_eta --output accept_gen_mu_isr_issue_isrdown_lep_eta.root gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/*/*/*/*root  &

hadd accept_gen_lep_eta_isr_issue.root accept_gen_el_isr_issue_nom_lep_eta.root accept_gen_el_isr_issue_isrup_lep_eta.root accept_gen_el_isr_issue_isrdown_lep_eta.root accept_gen_mu_isr_issue_nom_lep_eta.root accept_gen_mu_isr_issue_isrup_lep_eta.root accept_gen_mu_isr_issue_isrdown_lep_eta.root accept_gen_incl_isr_issue_nom_lep_eta.root accept_gen_incl_isr_issue_isrup_lep_eta.root accept_gen_incl_isr_issue_isrdown_lep_eta.root 

h_incl_nom = (TH1D*) accept_gen_incl_isr_issue_nom_lep_eta->Get("accept_gen_incl_isr_issue_nom_lep_eta_accept_gen_incl_isr_issue_nom_lep_eta")
h_incl_isrup = (TH1D*) accept_gen_incl_isr_issue_isrup_lep_eta->Get("accept_gen_incl_isr_issue_isrup_lep_eta_accept_gen_incl_isr_issue_isrup_lep_eta")
h_incl_isrdown = (TH1D*) accept_gen_incl_isr_issue_isrdown_lep_eta->Get("accept_gen_incl_isr_issue_isrdown_lep_eta_accept_gen_incl_isr_issue_isrdown_lep_eta")

h_el_nom = (TH1D*) accept_gen_el_isr_issue_nom_lep_eta->Get("accept_gen_el_isr_issue_nom_lep_eta_accept_gen_el_isr_issue_nom_lep_eta")
h_el_isrup = (TH1D*) accept_gen_el_isr_issue_isrup_lep_eta->Get("accept_gen_el_isr_issue_isrup_lep_eta_accept_gen_el_isr_issue_isrup_lep_eta")
h_el_isrdown = (TH1D*) accept_gen_el_isr_issue_isrdown_lep_eta->Get("accept_gen_el_isr_issue_isrdown_lep_eta_accept_gen_el_isr_issue_isrdown_lep_eta")

h_mu_nom = (TH1D*) accept_gen_mu_isr_issue_nom_lep_eta->Get("accept_gen_mu_isr_issue_nom_lep_eta_accept_gen_mu_isr_issue_nom_lep_eta")
h_mu_isrup = (TH1D*) accept_gen_mu_isr_issue_isrup_lep_eta->Get("accept_gen_mu_isr_issue_isrup_lep_eta_accept_gen_mu_isr_issue_isrup_lep_eta")
h_mu_isrdown = (TH1D*) accept_gen_mu_isr_issue_isrdown_lep_eta->Get("accept_gen_mu_isr_issue_isrdown_lep_eta_accept_gen_mu_isr_issue_isrdown_lep_eta")

--- no difference, flat distrs.


The number of generated vectors.

python sumup_ttree_draw.py "@gen2_jets_p4.size()" --histo-range 12,0,12 --histo-name accept_gen_incl_isr_issue_nom_njets     --output accept_gen_incl_isr_issue_nom_njets.root     gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v34_MC2016_Summer16_TTJets_powheg/180717_001103/0000/MC2016_Summer16_TTJets_powheg_*.root  &
python sumup_ttree_draw.py "@gen2_jets_p4.size()" --histo-range 12,0,12 --histo-name accept_gen_incl_isr_issue_isrup_njets   --output accept_gen_incl_isr_issue_isrup_njets.root   gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/*/*/*/*root  &
python sumup_ttree_draw.py "@gen2_jets_p4.size()" --histo-range 12,0,12 --histo-name accept_gen_incl_isr_issue_isrdown_njets --output accept_gen_incl_isr_issue_isrdown_njets.root gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/*/*/*/*root  &

python sumup_ttree_draw.py "@gen2_jets_p4[0].size()" --cond-com "abs(gen_t_w_decay_id) == 11 || abs(gen_tb_w_decay_id) == 11" --histo-range 12,0,12 --histo-name accept_gen_el_isr_issue_nom_njets     --output accept_gen_el_isr_issue_nom_njets.root     gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v34_MC2016_Summer16_TTJets_powheg/180717_001103/0000/MC2016_Summer16_TTJets_powheg_*.root  &
python sumup_ttree_draw.py "@gen2_jets_p4[0].size()" --cond-com "abs(gen_t_w_decay_id) == 11 || abs(gen_tb_w_decay_id) == 11" --histo-range 12,0,12 --histo-name accept_gen_el_isr_issue_isrup_njets   --output accept_gen_el_isr_issue_isrup_njets.root   gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/*/*/*/*root  &
python sumup_ttree_draw.py "@gen2_jets_p4[0].size()" --cond-com "abs(gen_t_w_decay_id) == 11 || abs(gen_tb_w_decay_id) == 11" --histo-range 12,0,12 --histo-name accept_gen_el_isr_issue_isrdown_njets --output accept_gen_el_isr_issue_isrdown_njets.root gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/*/*/*/*root  &

python sumup_ttree_draw.py "@gen2_jets_p4[0].size()" --cond-com "abs(gen_t_w_decay_id) == 13 || abs(gen_tb_w_decay_id) == 13" --histo-range 12,0,12 --histo-name accept_gen_mu_isr_issue_nom_njets     --output accept_gen_mu_isr_issue_nom_njets.root     gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v34_MC2016_Summer16_TTJets_powheg/180717_001103/0000/MC2016_Summer16_TTJets_powheg_*.root  &
python sumup_ttree_draw.py "@gen2_jets_p4[0].size()" --cond-com "abs(gen_t_w_decay_id) == 13 || abs(gen_tb_w_decay_id) == 13" --histo-range 12,0,12 --histo-name accept_gen_mu_isr_issue_isrup_njets   --output accept_gen_mu_isr_issue_isrup_njets.root   gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/*/*/*/*root  &
python sumup_ttree_draw.py "@gen2_jets_p4[0].size()" --cond-com "abs(gen_t_w_decay_id) == 13 || abs(gen_tb_w_decay_id) == 13" --histo-range 12,0,12 --histo-name accept_gen_mu_isr_issue_isrdown_njets --output accept_gen_mu_isr_issue_isrdown_njets.root gstore_outdirs/v34/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/*/*/*/*root  &

hadd accept_isr_issue_gen_njets.root accept_gen_mu_isr_issue_isrdown_njets.root accept_gen_mu_isr_issue_isrup_njets.root accept_gen_mu_isr_issue_nom_njets.root accept_gen_el_isr_issue_isrdown_njets.root accept_gen_el_isr_issue_isrup_njets.root accept_gen_el_isr_issue_nom_njets.root accept_gen_incl_isr_issue_isrdown_njets.root accept_gen_incl_isr_issue_isrup_njets.root accept_gen_incl_isr_issue_nom_njets.root

h_el_nom = (TH1D*) accept_gen_el_isr_issue_nom_njets->Get("accept_gen_el_isr_issue_nom_njets_accept_gen_el_isr_issue_nom_njets")
h_el_isrup = (TH1D*) accept_gen_el_isr_issue_isrup_njets->Get("accept_gen_el_isr_issue_isrup_njets_accept_gen_el_isr_issue_isrup_njets")
h_el_isrdown = (TH1D*) accept_gen_el_isr_issue_isrdown_njets->Get("accept_gen_el_isr_issue_isrdown_njets_accept_gen_el_isr_issue_isrdown_njets")

h_mu_nom = (TH1D*) accept_gen_mu_isr_issue_nom_njets->Get("accept_gen_mu_isr_issue_nom_njets_accept_gen_mu_isr_issue_nom_njets")
h_mu_isrup = (TH1D*) accept_gen_mu_isr_issue_isrup_njets->Get("accept_gen_mu_isr_issue_isrup_njets_accept_gen_mu_isr_issue_isrup_njets")
h_mu_isrdown = (TH1D*) accept_gen_mu_isr_issue_isrdown_njets->Get("accept_gen_mu_isr_issue_isrdown_njets_accept_gen_mu_isr_issue_isrdown_njets")

h_el_isrup->Divide(h_el_nom)
h_el_isrdown->Divide(h_el_nom)

h_mu_isrup->Divide(h_mu_nom)
h_mu_isrdown->Divide(h_mu_nom)

h_el_nom->Divide(h_el_nom)
h_mu_nom->Divide(h_mu_nom)

h_el_isrup->Draw()
h_el_isrdown->Draw("same")
h_el_nom->Draw("same")

h_mu_isrup->Draw()
h_mu_isrdown->Draw("same")
h_mu_nom->Draw("same")

-- significant effect, isrdown does not have more than 6 jets

How might this correlate with the reconstructed electron?
The cross-cleaning indeed was not performed.



PLOTS


h_nom     = (TH1D*) h_incl_nom
h_isrup   = (TH1D*) h_incl_isrup
h_isrdown = (TH1D*) h_incl_isrdown


h_nom = (TH1D*) accept_incl_isr_issue_nom_lep_pt->Get("accept_incl_isr_issue_nom_lep_pt_accept_incl_isr_issue_nom_lep_pt")
h_isrup = (TH1D*) accept_incl_isr_issue_isrup_lep_pt->Get("accept_incl_isr_issue_isrup_lep_pt_accept_incl_isr_issue_isrup_lep_pt")
h_isrdown = (TH1D*) accept_incl_isr_issue_isrdown_lep_pt->Get("accept_incl_isr_issue_isrdown_lep_pt_accept_incl_isr_issue_isrdown_lep_pt")

h_nom = (TH1D*) accept_el_isr_issue_nom_lep_pt->Get("accept_el_isr_issue_nom_lep_pt_accept_el_isr_issue_nom_lep_pt")
h_isrup = (TH1D*) accept_el_isr_issue_isrup_lep_pt->Get("accept_el_isr_issue_isrup_lep_pt_accept_el_isr_issue_isrup_lep_pt")
h_isrdown = (TH1D*) accept_el_isr_issue_isrdown_lep_pt->Get("accept_el_isr_issue_isrdown_lep_pt_accept_el_isr_issue_isrdown_lep_pt")

h_nom = (TH1D*) accept_mu_isr_issue_nom_lep_pt->Get("accept_mu_isr_issue_nom_lep_pt_accept_mu_isr_issue_nom_lep_pt")
h_isrup = (TH1D*) accept_mu_isr_issue_isrup_lep_pt->Get("accept_mu_isr_issue_isrup_lep_pt_accept_mu_isr_issue_isrup_lep_pt")
h_isrdown = (TH1D*) accept_mu_isr_issue_isrdown_lep_pt->Get("accept_mu_isr_issue_isrdown_lep_pt_accept_mu_isr_issue_isrdown_lep_pt")

h_isrup->SetLineColor(kGreen)
h_isrdown->SetLineColor(kRed)

int_nom = h_nom->Integral()
int_isrup = h_isrup->Integral()
int_isrdown = h_isrdown->Integral()

h_nom->Scale(1./int_nom)
h_isrup->Scale(1./int_isrup)
h_isrdown->Scale(1./int_isrdown)

h_nom->Draw()
h_isrup->Draw("same")
h_isrdown->Draw("same")

h_isrdown->Divide(h_isrup)

h_isrdown->Divide(h_nom)

h_isrdown->Draw()


l = TLine(20, 1, 300, 1)
l.Draw("same")

l = TLine(10, 1, 450, 1)
l.Draw("same")

c1->SaveAs("acceptances_issue_incl_ISR_down_large_variation_ratio_of_lep_pt_of_ISRDown_to_ISRUp_in_all_signal_events.png")
c1->SaveAs("acceptances_issue_el_ISR_down_large_variation_ratio_of_lep_pt_of_ISRDown_to_ISRUp_in_all_signal_events.png")
c1->SaveAs("acceptances_issue_mu_ISR_down_large_variation_ratio_of_lep_pt_of_ISRDown_to_ISRUp_in_all_signal_events.png")

-- the ratio of reconstructed lep_pt does show slight trend, as if ISRDown shifts the pT to smaller values.
This shift might have larger effect on electrons due to higher pT threshold there.
But the distributions of reconstructed lep_pt-s are not similar enough to draw such conclusion.
It seems they differ due to different turn-on curves...
The gen lep pT do not have that trend in the ratio ISRDown/ISRUp.

l = TLine(30, 0, 30, 0.14)
l.Draw("same")

l = TLine(26, 0, 26, 0.14)
l.Draw("same")

c1->SaveAs("acceptances_issue_el_ISR_down_large_variation_lep_pt_distr_w_cut_threshold.png")
c1->SaveAs("acceptances_issue_mu_ISR_down_large_variation_lep_pt_distr_w_cut_threshold.png")


how to normalize these bins by width?

aptr = (TH1D*) h_nom
aptr = (TH1D*) h_isrup
aptr = (TH1D*) h_isrdown

aptr   ->SetBinContent(1,  aptr->GetBinContent(1) / aptr->GetBinWidth(1) )
aptr   ->SetBinContent(2,  aptr->GetBinContent(2) / aptr->GetBinWidth(2) )
aptr   ->SetBinContent(3,  aptr->GetBinContent(3) / aptr->GetBinWidth(3) )
aptr   ->SetBinContent(4,  aptr->GetBinContent(4) / aptr->GetBinWidth(4) )
aptr   ->SetBinContent(5,  aptr->GetBinContent(5) / aptr->GetBinWidth(5) )
aptr   ->SetBinContent(6,  aptr->GetBinContent(6) / aptr->GetBinWidth(6) )
aptr   ->SetBinContent(7,  aptr->GetBinContent(7) / aptr->GetBinWidth(7) )
aptr   ->SetBinContent(8,  aptr->GetBinContent(8) / aptr->GetBinWidth(8) )
aptr   ->SetBinContent(9,  aptr->GetBinContent(9) / aptr->GetBinWidth(9) )
aptr   ->SetBinContent(10, aptr->GetBinContent(10)/ aptr->GetBinWidth(10))
aptr   ->SetBinContent(11, aptr->GetBinContent(11)/ aptr->GetBinWidth(11))
aptr   ->SetBinContent(12, aptr->GetBinContent(12)/ aptr->GetBinWidth(12))
aptr   ->SetBinContent(13, aptr->GetBinContent(13)/ aptr->GetBinWidth(13))
aptr   ->SetBinContent(14, aptr->GetBinContent(14)/ aptr->GetBinWidth(14))
aptr   ->SetBinContent(15, aptr->GetBinContent(15)/ aptr->GetBinWidth(15))
aptr   ->SetBinContent(16, aptr->GetBinContent(16)/ aptr->GetBinWidth(16))
aptr   ->SetBinContent(17, aptr->GetBinContent(17)/ aptr->GetBinWidth(17))
aptr   ->SetBinContent(18, aptr->GetBinContent(18)/ aptr->GetBinWidth(18))
aptr   ->SetBinContent(19, aptr->GetBinContent(19)/ aptr->GetBinWidth(19))
aptr   ->SetBinContent(20, aptr->GetBinContent(20)/ aptr->GetBinWidth(20))
aptr   ->SetBinContent(21, aptr->GetBinContent(21)/ aptr->GetBinWidth(21))
aptr   ->SetBinContent(22, aptr->GetBinContent(22)/ aptr->GetBinWidth(22))
aptr   ->SetBinContent(23, aptr->GetBinContent(23)/ aptr->GetBinWidth(23))
aptr   ->SetBinContent(24, aptr->GetBinContent(24)/ aptr->GetBinWidth(24))
aptr   ->SetBinContent(25, aptr->GetBinContent(25)/ aptr->GetBinWidth(25))
aptr   ->SetBinContent(26, aptr->GetBinContent(26)/ aptr->GetBinWidth(26))
aptr   ->SetBinContent(27, aptr->GetBinContent(27)/ aptr->GetBinWidth(27))
aptr   ->SetBinContent(28, aptr->GetBinContent(28)/ aptr->GetBinWidth(28))
aptr   ->SetBinContent(29, aptr->GetBinContent(29)/ aptr->GetBinWidth(29))
aptr   ->SetBinContent(30, aptr->GetBinContent(30)/ aptr->GetBinWidth(30))






# couple refitting questions

the old files

datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_lepMETprop.root
datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop.root
datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.root

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d fitting/ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.root   --freezeParameters lumi_13TeV -m 125  --name MuImpactsRecent   --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d fitting/ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.root   --freezeParameters lumi_13TeV -m 125  --name MuImpactsRecent   --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d fitting/ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.root   --freezeParameters lumi_13TeV -m 125  --name MuImpactsRecent   -o latest_el_impacts_recent.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts_recent.json -o postfit_el_impacts_recent

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d fitting/ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop.root   --freezeParameters lumi_13TeV -m 125  --name ElImpactsRecent   --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d fitting/ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop.root   --freezeParameters lumi_13TeV -m 125  --name ElImpactsRecent   --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d fitting/ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop.root   --freezeParameters lumi_13TeV -m 125  --name ElImpactsRecent   -o latest_mu_impacts_recent.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_recent.json -o postfit_mu_impacts_recent

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d fitting/ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_lepMETprop.root --freezeParameters lumi_13TeV -m 125  --name BothImpactsRecent --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d fitting/ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_lepMETprop.root --freezeParameters lumi_13TeV -m 125  --name BothImpactsRecent --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d fitting/ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_lepMETprop.root --freezeParameters lumi_13TeV -m 125  --name BothImpactsRecent -o latest_both_impacts_recent.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_recent.json -o postfit_both_impacts_recent


ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms.root
ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root
ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d fitting/ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root   --freezeParameters lumi_13TeV -m 125  --name MuImpactsRecent   --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d fitting/ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root   --freezeParameters lumi_13TeV -m 125  --name MuImpactsRecent   --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d fitting/ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root   --freezeParameters lumi_13TeV -m 125  --name MuImpactsRecent   -o latest_el_impacts_recentOrig1.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts_recentOrig1.json -o postfit_el_impacts_recentOrig1

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d fitting/ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root   --freezeParameters lumi_13TeV -m 125  --name ElImpactsRecent   --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d fitting/ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root   --freezeParameters lumi_13TeV -m 125  --name ElImpactsRecent   --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d fitting/ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root   --freezeParameters lumi_13TeV -m 125  --name ElImpactsRecent   -o latest_mu_impacts_recentOrig1.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_recentOrig1.json -o postfit_mu_impacts_recentOrig1

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d fitting/ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms.root --freezeParameters lumi_13TeV -m 125  --name BothImpactsRecent --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d fitting/ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms.root --freezeParameters lumi_13TeV -m 125  --name BothImpactsRecent --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d fitting/ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms.root --freezeParameters lumi_13TeV -m 125  --name BothImpactsRecent -o latest_both_impacts_recentOrig1.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_recentOrig1.json -o postfit_both_impacts_recentOrig1

python new_impact_table.py --merge-pdf latest_el_impacts_recent.json latest_mu_impacts_recent.json latest_both_impacts_recent.json

python fitting/new_impact_table.py --merge-pdf latest_el_impacts_recent.json      latest_mu_impacts_recent.json
python fitting/new_impact_table.py --merge-pdf latest_el_impacts_recentOrig1.json latest_mu_impacts_recentOrig1.json

lets try to find by scanning

make fit_unc nn=el_orig1 workspace=ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root
make fit_unc nn=mu_orig1 workspace=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root
make fit_unc nn=bt_orig1 workspace=ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms.root

-- close, but not exactly the same

make fit_unc nn=el_lepMETprop workspace=ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.root
make fit_unc nn=mu_lepMETprop workspace=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop.root
make fit_unc nn=bt_lepMETprop workspace=ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_lepMETprop.root

-- el is not close, r=0.98



# another wjets shape investigation

comparison to v27p1 in Mt_f

wjets

python get_shapes.py --norm-binwidth --formula "now : v27p1 :wjets_amc " -d Mt_lep_met_f -c test_wjets_v37test1_v27p1 -p wjets_Mt_f v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,wjets,NOMINAL,Mt_lep_met_f now:distrs/v37_test1_bunch3-5_mc_1_amcatnlo_recoils.root:wjets_mu,wjets_other,NOMINAL,Mt_lep_met_f wjets_amc:distrs/v37_test1_bunch5/MC2016_Summer16_WJets_amcatnlo.root:wjets_mu,wjets_other,NOMINAL,Mt_lep_met_f

-- v27 is slightly smaller

data

python get_shapes.py --norm-binwidth --formula "v27p1 :now_data" -d Mt_lep_met_f -c test_wjets_v37test1_v27p1 -p data_Mt_f v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,data,NOMINAL,Mt_lep_met_f now_data:distrs/v37_test1_bunch5/SingleMuon.root:wjets_mu,data_other,NOMINAL,Mt_lep_met_f

-- v27 is also slightly smaller
(in data! there should have been no differences!)

data met:

python get_shapes.py --norm-binwidth --formula "v27p1 :now_data" -d Mt_lep_met_f -c test_wjets_v37test1_v27p1 -p data_met    v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,data,NOMINAL,met now_data:distrs/v37_test1_bunch5/SingleMuon.root:wjets_mu,data_other,NOMINAL,met_c

-- again nothing is clear, need met_f

python get_shapes.py --norm-binwidth --formula "v27p1 :now_data" -d Mt_lep_met_f -c test_wjets_v37test1_v27p1 -p data_met_f  v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,data,NOMINAL,met now_data:distrs/v37_test1_bunch6/SingleMuon.root:wjets_mu,data_other,NOMINAL,met_f

-- now met is smaller now, the peak grows
   but mT is larger? -- turned against the lepton, like a lepton-related propagation?

python get_shapes.py --norm-binwidth --formula "v27p1 :now_data" -d Mt_lep_met_f -c test_wjets_v37test1_v27p1 -p data_lep_pt v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,data,NOMINAL,lep_pt now_data:distrs/v37_test1_bunch6/SingleMuon.root:wjets_mu,data_other,NOMINAL,lep_pt

-- exactly the same
   only slight difference at small pt, probably the missing couple jobs

qcd

python get_shapes.py --norm-binwidth --formula "v27p1 :now_qcd" -d Mt_lep_met_f -c test_wjets_v37test1_v27p1 -p wjets_Mt_f v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,qcd,NOMINAL,Mt_lep_met_f now_qcd:mc_norm/v37_test1_bunch5/qcd.root:wjets_mu,qcd_other,NOMINAL,Mt_lep_met_f

-- also slightly smaller

So:
1) what changes data?
2) what is different in MC corrections?
-- 3) what was the v27p1 procedure?

event_met        = proc_met (not the double corrections)
event_met_lep_mt = calc on lep_p4[0] and proc_met
 -- and these are correct leptons

now MC met:
* comes from met_init
  or ROOT.met_pt_recoilcor_x of met_init, gen_genPx and gen_visPx
  or met_slimmedMETsMuEGClean for data                                  --- in v27p1 the same
* correction from all jets passing 20GeV, including lep-matched         --- all jets, no 20GeV
* corrections from TES of all taus (any candidate, no ID requirement)   --- these corrections are done at the end, only for sel_taus

-- all corrections are done to data with factor 0, so they should not apply

does met or lep_pt divert in data (and MC-s)?
   --- lep_pt is the same, so it is not an event selection or event weight problem
       but met peaks!
does data get weighted?
   --- according 1 Muon file no,
   event_weight_init and event_weight == 1
is there a difference at WJets selection and some events are skipped?


old full_selection.py:

  taus_nom    .presel.sort(key=lambda it: it[1]*it[0].pt(), reverse=True)

    if pass_mu and len(jets.old.medium) == 0 and taus.presel:
        presel_os = taus.presel[0][2] * ev.lep_id[0] < 0
        sel_b_weight = weight_bSF_lowest
        if presel_os:
            passed_channels.append(('ctr_mu_wjet', sel_b_weight, leps.iso, jets.old, taus.presel))
        else:
            passed_channels.append(('ctr_mu_wjet_ss', sel_b_weight, leps.iso, jets.old, taus.presel))

sorting of the tau cands now:

  taus_candidates       .sort(key=lambda it: (it[4], it[1]   *it[0].pt()), reverse=True)

--- maybe there are a lot of vloose taus in wjets control and they have different pt?
try sorting by pt

tau cands now:

    # nominals
    if tau_pt > 20. and not match_lep:
        taus_candidates.append((p4, TES_factor, tau_pdgID, i, tau_ID, jetmatched))

was:

    # nominals
    if tau_pt > 20.:
        if not match_lep:
            taus_nom               .presel.append((p4, TES_factor, tau_pdgID, i, jetmatched))

b-tagged cands now:

        selection_wjets_control = passes_wjets_control_selection(passed_triggers, leps, (N_jets_nom_med, N_jets_nom_all), taus_candidates, proc_met)

           if not match_lep:
             # count the jets
             if b_tagged_medium:
                 if jet_pt > JETS_PT_CUT:
                     N_jets_nom_med_all += 1
             if not jet_tau_match_old and b_tagged_medium:
                 if jet_pt > JETS_PT_CUT:
                     N_jets_nom_med += 1
             if jet_pt > JETS_PT_CUT:
                 N_jets_nom_all += 1
             if not jet_tau_match_old:
               if b_tagged_medium:
                   jets_nom.medium.append((p4, en_factors, bSF_weights, jet_b_discr, HF, PF, jet_index))

was:

    pt_cut = 30.
    # match lep
    if not match_lep:
      # match tau
      if not jet_tau_match_old:
        # the same, but the cuts and lowest -> cuts
        # nominals
        # match b-tag
        if b_tagged_medium:
            # pass pt cuts
            if jet_pt > pt_cut:
                jets_nom.old.medium.append((p4, en_factor, jet_weight_bSF_nom, jet_b_discr, HF, PF, jet_index))

and muon pt cut is at 26GeV

-- everything looks exactly the same


## why met peaks in data?

1) it seems the correctlions should not apply
2) the initial met is the same as in v27 -- met_slimmedMETsMuEGClean

according to git tag v27p1
met_slimmedMETsMuEGClean is produced in the same way
but it is not used in the processing!
met_init is used!

Mt_lep_met and met_pt come from met_x_prop met_y_prop
which includes jet and tau corrections at the end, but again for data it should cancel with 1.

-- testing met_init

python get_shapes.py --norm-binwidth --formula "v27p1:now_data" -d Mt_lep_met_f -c test_wjets_v37test1_v27p1 -p wjets_Mt_f v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,data,NOMINAL,Mt_lep_met_f now_data:distrs/v37_test2_bunch1/SingleMuon.root:wjets_mu,data_other,NOMINAL,Mt_lep_met_f

python get_shapes.py --norm-binwidth --formula "now_data_MuEGClean:now_data_init" -d Mt_lep_met_f -c test_wjets_v37test1_v27p1 -p wjets_Mt_f now_data_MuEGClean:distrs/v37_test1_bunch6/SingleMuon.root:wjets_mu,data_other,NOMINAL,Mt_lep_met_f now_data_init:distrs/v37_test2_bunch1/SingleMuon.root:wjets_mu,data_other,NOMINAL,Mt_lep_met_f

-- the same?
check met_init and slimmed in gstore data

-- practically identical numbers!!!!


so, 1) it must be a correction and 2) it must somehow propagate in data!

to check:
* all corrections in data VS original met
* lept pt and met in MC -- confirm that lep pt is the same

time python channel_distrs_full_loop.py --do-W-stitching --options no_prop_tau  --metmuegclean false  -l logss temp/notau/  channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/SingleElectron/Ntupler_v37_Data13TeV_SingleElectron2016H_03Feb2017_ver2/190205_181606/0000/Data13TeV_SingleElectron2016H_03Feb2017_ver2_20.root &
time python channel_distrs_full_loop.py --do-W-stitching --options no_prop_jets --metmuegclean false  -l logss temp/nojets/ channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/SingleElectron/Ntupler_v37_Data13TeV_SingleElectron2016H_03Feb2017_ver2/190205_181606/0000/Data13TeV_SingleElectron2016H_03Feb2017_ver2_20.root &
time python channel_distrs_full_loop.py --do-W-stitching --options no_prop_tau,no_prop_jets --metmuegclean false  -l logss temp/notaunojets/ channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/SingleElectron/Ntupler_v37_Data13TeV_SingleElectron2016H_03Feb2017_ver2/190205_181606/0000/Data13TeV_SingleElectron2016H_03Feb2017_ver2_20.root &

-- in each event_met is the same as event_met_init

??? v27p1 must have some correction in data???

let's check MC for clues
check lep_pt and met in MC now and v27p1: lep_pt must be the same, met -- different.
test all corrections in MC

python get_shapes.py --norm-binwidth --formula "v27p1:wjets_amc" -d Mt_lep_met_f -c test_wjets_v37test1_v27p1 -p wjets_met_f v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,wjets,NOMINAL,met  wjets_amc:mc_norm/v37_test1_bunch6/MC2016_Summer16_WJets_amcatnlo.root:wjets_mu,wjets_other,NOMINAL,met_f

python get_shapes.py --norm-binwidth --formula "v27p1:wjets_amc" -d Mt_lep_met_f -c test_wjets_v37test1_v27p1 -p wjets_lep_pt v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,wjets,NOMINAL,lep_pt  wjets_amc:mc_norm/v37_test1_bunch6/MC2016_Summer16_WJets_amcatnlo.root:wjets_mu,wjets_other,NOMINAL,lep_pt

-- both are slightly indecisively different!
   is v27p1 aMCatNLO?

python get_shapes.py --norm-binwidth --formula "v27p1:v27_p1_amc:wjets_amc" -d Mt_lep_met_f -c test_wjets_v37test1_v27p1 -p wjets_lep_pt v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,wjets,NOMINAL,lep_pt wjets_amc:mc_norm/v37_test1_bunch6/MC2016_Summer16_WJets_amcatnlo.root:wjets_mu,wjets_other,NOMINAL,lep_pt v27_p1_amc:../lstore_outdirs/v27/p1/MC2016_Summer16_WJets_amcatnlo.root:ctr_mu_wjet,wjets,NOMINAL,lep_pt

python get_shapes.py --norm-binwidth --formula "v27p1:v27_p1_amc" -d Mt_lep_met_f -c test_wjets_v37test1_v27p1 -p wjets_lep_pt v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,wjets,NOMINAL,lep_pt wjets_amc:mc_norm/v37_test1_bunch6/MC2016_Summer16_WJets_amcatnlo.root:wjets_mu,wjets_other,NOMINAL,lep_pt v27_p1_amc:../lstore_outdirs/v27/p1/MC2016_Summer16_WJets_amcatnlo.root:ctr_mu_wjet,wjets,NOMINAL,lep_pt

-- yes, v27p1 was amcatnlo

python get_shapes.py --norm-binwidth --formula "v27p1:wjets_amc" -d Mt_lep_met_f -c test_wjets_v37test1_v27p1 -p wjets_Mt_f v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,wjets,NOMINAL,Mt_lep_met_f  wjets_amc:mc_norm/v37_test1_bunch6/MC2016_Summer16_WJets_amcatnlo.root:wjets_mu,wjets_other,NOMINAL,Mt_lep_met_f

qcd:

python get_shapes.py --norm-binwidth --formula "v27p1:qcd_now" -d Mt_lep_met_f -c test_wjets_v37test1_v27p1 -p qcd_met_f  v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,qcd,NOMINAL,met    qcd_now:mc_norm/v37_test1_bunch6/qcd.root:wjets_mu,qcd_other,NOMINAL,met_f

python get_shapes.py --norm-binwidth --formula "v27p1:qcd_now" -d Mt_lep_met_f -c test_wjets_v37test1_v27p1 -p qcd_lep_pt v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,qcd,NOMINAL,lep_pt qcd_now:mc_norm/v37_test1_bunch6/qcd.root:wjets_mu,qcd_other,NOMINAL,lep_pt

-- both are slightly undecisively different

??? why lep_pt is different???

python get_shapes.py --norm-binwidth --formula "v27p1:qcd_now" -d Mt_lep_met_f -c test_wjets_v37test1_v27p1 -p qcd_Mt_f v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,qcd,NOMINAL,Mt_lep_met_f qcd_now:mc_norm/v37_test1_bunch6/qcd.root:wjets_mu,qcd_other,NOMINAL,Mt_lep_met_f

let's test turning off the corrections, if it has any effect in MC...

time python channel_distrs_full_loop.py --do-W-stitching --options no_prop_tau --metmuegclean true  -l logss temp/notau/   channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/WJetsToLNu_TuneCUETP8M1_13TeV-amcatnloFXFX-pythia8/Ntupler_v37_MC2016_Summer16_WJets_amcatnlo/190206_135323/0000/MC2016_Summer16_WJets_amcatnlo_16.root &
time python channel_distrs_full_loop.py --do-W-stitching --options no_prop_jets --metmuegclean true  -l logss temp/nojets/ channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/WJetsToLNu_TuneCUETP8M1_13TeV-amcatnloFXFX-pythia8/Ntupler_v37_MC2016_Summer16_WJets_amcatnlo/190206_135323/0000/MC2016_Summer16_WJets_amcatnlo_16.root &
time python channel_distrs_full_loop.py --do-W-stitching --options no_prop_tau,no_prop_jets --metmuegclean true  -l logss temp/notaunojets/ channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/WJetsToLNu_TuneCUETP8M1_13TeV-amcatnloFXFX-pythia8/Ntupler_v37_MC2016_Summer16_WJets_amcatnlo/190206_135323/0000/MC2016_Summer16_WJets_amcatnlo_16.root &
time python channel_distrs_full_loop.py --do-W-stitching --metmuegclean true  -l logss temp/orig/ channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/WJetsToLNu_TuneCUETP8M1_13TeV-amcatnloFXFX-pythia8/Ntupler_v37_MC2016_Summer16_WJets_amcatnlo/190206_135323/0000/MC2016_Summer16_WJets_amcatnlo_16.root &

ttree_out->Draw("event_met_init.pt()>>h(40,0,200)")
ttree_out->Draw("event_met.pt()>>h(40,0,200)")

ttree_out->Draw("event_met.pt()>>h(40,0,200)")
h_ = (TH1D*) ttree_out->GetHistogram()
h_met = (TH1D*) h_->Clone()
h_met->SetDirectory(0)
h_met->SetName("met")
h_met->SetLineColor(kRed)
ttree_out->Draw("event_met_init.pt()>>h(40,0,200)")
h_ = (TH1D*) ttree_out->GetHistogram()
h_met_init = (TH1D*) h_->Clone()
h_met_init->SetDirectory(0)
h_met_init->SetName("met_init")

h_met_init->Draw()
h_met->Draw("same")

-- mostly jet corrections change stuff, tau is minimal
   and they slightly increase met

in data
!!! also! try sorting tau cands by pT only!!!!
-- but why only met changes and lep_pt does not?

python get_shapes.py --norm-binwidth --formula "v27p1 :now_data_sortpt" -d Mt_lep_met_f -c test_wjets_v37test3_v27p1 -p data_Mt_f   v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,data,NOMINAL,Mt_lep_met_f now_data_sortpt:distrs/v37_test3_bunch1/SingleMuon.root:wjets_mu,data_other,NOMINAL,Mt_lep_met_f
python get_shapes.py --norm-binwidth --formula "v27p1 :now_data_sortpt" -d Mt_lep_met_f -c test_wjets_v37test3_v27p1 -p data_met_f  v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,data,NOMINAL,met          now_data_sortpt:distrs/v37_test3_bunch1/SingleMuon.root:wjets_mu,data_other,NOMINAL,met_f
python get_shapes.py --norm-binwidth --formula "v27p1 :now_data_sortpt" -d Mt_lep_met_f -c test_wjets_v37test3_v27p1 -p data_lep_pt v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,data,NOMINAL,lep_pt       now_data_sortpt:distrs/v37_test3_bunch1/SingleMuon.root:wjets_mu,data_other,NOMINAL,lep_pt

-- sort by pT only does not change anything
   probably most of taus are candidates without any ID, as expected


so the questions are:
* for data lep_pt is not changed, met and mT are different, met is smaller and mT is larger now
  why?
  --- according to git tag v27p1 that version had an error:
      in data the jets were corrected with jes re-correcting factor and it was propafated to met
	  in mc this factor canceled out with uncor factor
	  (not clear why uncor was applied only to mc --- maybe I thought it was for jer instead of jes)
	  it seems this should not be done, since miniaod jets are already jes-corrected (and I checked that)
	  and the correction is propagated to met (type1 met includes jec corrections, jec=jes it's just yet another naming)

  + test different recoils of wjets?

python channel_distrs_full_loop.py --do-W-stitching --metmuegclean false --options no_prop_lepjets  -l logss --n-recoil-jets 0 temp/recoil0 channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/WJetsToLNu_TuneCUETP8M1_13TeV-amcatnloFXFX-pythia8/Ntupler_v37_MC2016_Summer16_WJets_amcatnlo_ext2_v2/190211_115413/0000/MC2016_Summer16_WJets_amcatnlo_ext2_v2_177.root &
python channel_distrs_full_loop.py --do-W-stitching --metmuegclean false --options no_prop_lepjets  -l logss --n-recoil-jets 1 temp/recoil1 channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/WJetsToLNu_TuneCUETP8M1_13TeV-amcatnloFXFX-pythia8/Ntupler_v37_MC2016_Summer16_WJets_amcatnlo_ext2_v2/190211_115413/0000/MC2016_Summer16_WJets_amcatnlo_ext2_v2_177.root &
python channel_distrs_full_loop.py --do-W-stitching --metmuegclean false --options no_prop_lepjets  -l logss --n-recoil-jets 2 temp/recoil2 channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/WJetsToLNu_TuneCUETP8M1_13TeV-amcatnloFXFX-pythia8/Ntupler_v37_MC2016_Summer16_WJets_amcatnlo_ext2_v2/190211_115413/0000/MC2016_Summer16_WJets_amcatnlo_ext2_v2_177.root &
python channel_distrs_full_loop.py --do-W-stitching --metmuegclean false --options no_prop_lepjets  -l logss --n-recoil-jets 3 temp/recoil3 channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/WJetsToLNu_TuneCUETP8M1_13TeV-amcatnloFXFX-pythia8/Ntupler_v37_MC2016_Summer16_WJets_amcatnlo_ext2_v2/190211_115413/0000/MC2016_Summer16_WJets_amcatnlo_ext2_v2_177.root &
python channel_distrs_full_loop.py --do-W-stitching --metmuegclean false --options no_prop_lepjets  -l logss --n-recoil-jets 5 temp/recoil5 channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/WJetsToLNu_TuneCUETP8M1_13TeV-amcatnloFXFX-pythia8/Ntupler_v37_MC2016_Summer16_WJets_amcatnlo_ext2_v2/190211_115413/0000/MC2016_Summer16_WJets_amcatnlo_ext2_v2_177.root &

ttree_out->Draw("event_met_init2.pt()>>h(40,0,200)")
ttree_out->Draw("event_met_init.pt()>>h(40,0,200)")

ttree_out->Draw("event_met_lep_mt_init2.pt()>>h(40,0,200)")
h_ = (TH1D*) ttree_out->GetHistogram()
h_met = (TH1D*) h_->Clone()
h_met->SetDirectory(0)
h_met->SetName("mt_init2_recoiled")
h_met->SetLineColor(kRed)
ttree_out->Draw("event_met_lep_mt_init.pt()>>h(40,0,200)")
h_ = (TH1D*) ttree_out->GetHistogram()
h_met_init = (TH1D*) h_->Clone()
h_met_init->SetDirectory(0)
h_met_init->SetName("mt_init")

h_met_init->Draw()
h_met->Draw("same")

--- no effect from recoils on mT in this 1 file

* for MC both lep_pt and met are different, which is strange
  why lep_pt changed?
  I compare aMCatNLO with v27p1 --- was v27p1 aMCatNLO?(yes) how different lepton pT in madgraph and amcatnlo?
  yes v27p1 is amcatnlo but without extras!
  + compare without extras

python get_shapes.py --norm-binwidth --formula "v27p1:wjets_amc0" -d Mt_lep_met_f -c test_wjets_v37test1_v27p1 -p wjets_met_f  v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,wjets,NOMINAL,met           wjets_amc0:distrs/v37_test4_bunch1/all/MC2016_Summer16_WJets_amcatnlo.root:wjets_mu,wjets_other,NOMINAL,met_f
python get_shapes.py --norm-binwidth --formula "v27p1:wjets_amc0" -d Mt_lep_met_f -c test_wjets_v37test1_v27p1 -p wjets_lep_pt v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,wjets,NOMINAL,lep_pt        wjets_amc0:distrs/v37_test4_bunch1/all/MC2016_Summer16_WJets_amcatnlo.root:wjets_mu,wjets_other,NOMINAL,lep_pt
python get_shapes.py --norm-binwidth --formula "v27p1:wjets_amc0" -d Mt_lep_met_f -c test_wjets_v37test1_v27p1 -p wjets_Mt_f   v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,wjets,NOMINAL,Mt_lep_met_f  wjets_amc0:distrs/v37_test4_bunch1/all/MC2016_Summer16_WJets_amcatnlo.root:wjets_mu,wjets_other,NOMINAL,Mt_lep_met_f

  --- very minor difference in all distrs!
      probably due to the 1 jobfile missing (out of 28)
	  and some of the met propagations (jet cut 20GeV etc)
      so, the only diveregence is in the data met........... how?

* try the met propagation without lep-jet only
  + try full run -- test4, mc converges with v27p1, data has issues in met??

python get_shapes.py --norm-binwidth --formula "v27p1:wjets_amc0" -d Mt_lep_met_f -c test_wjets_v37test4_nolepjet_v27p1 -p wjets_met_f  v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,wjets,NOMINAL,met           wjets_amc0:distrs/v37_test4_bunch1/all/MC2016_Summer16_WJets_amcatnlo.root:wjets_mu,wjets_other,NOMINAL,met_f
python get_shapes.py --norm-binwidth --formula "v27p1:wjets_amc0" -d Mt_lep_met_f -c test_wjets_v37test4_nolepjet_v27p1 -p wjets_lep_pt v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,wjets,NOMINAL,lep_pt        wjets_amc0:distrs/v37_test4_bunch1/all/MC2016_Summer16_WJets_amcatnlo.root:wjets_mu,wjets_other,NOMINAL,lep_pt
python get_shapes.py --norm-binwidth --formula "v27p1:wjets_amc0" -d Mt_lep_met_f -c test_wjets_v37test4_nolepjet_v27p1 -p wjets_Mt_f   v27p1:v27p1_WJetsAmcatnlo1_SingleMuon.root:ctr_mu_wjet,wjets,NOMINAL,Mt_lep_met_f  wjets_amc0:distrs/v37_test4_bunch1/all/MC2016_Summer16_WJets_amcatnlo.root:wjets_mu,wjets_other,NOMINAL,Mt_lep_met_f


lep-jet only and rest jets

time python channel_distrs_full_loop.py --do-W-stitching --options no_prop_lepjets --metmuegclean true  -l logss temp/nolepjets/ channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/WJetsToLNu_TuneCUETP8M1_13TeV-amcatnloFXFX-pythia8/Ntupler_v37_MC2016_Summer16_WJets_amcatnlo/190206_135323/0000/MC2016_Summer16_WJets_amcatnlo_16.root &
time python channel_distrs_full_loop.py --do-W-stitching --options no_prop_jets    --metmuegclean true  -l logss temp/nojets/    channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/WJetsToLNu_TuneCUETP8M1_13TeV-amcatnloFXFX-pythia8/Ntupler_v37_MC2016_Summer16_WJets_amcatnlo/190206_135323/0000/MC2016_Summer16_WJets_amcatnlo_16.root &

-- effect from lepjets is significant, hard to say how relevent it is for all events at full selection

time python channel_distrs_full_loop.py --do-W-stitching --options no_prop_tau --metmuegclean true  -l logss temp/notau/   channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/WJetsToLNu_TuneCUETP8M1_13TeV-amcatnloFXFX-pythia8/Ntupler_v37_MC2016_Summer16_WJets_amcatnlo/190206_135323/0000/MC2016_Summer16_WJets_amcatnlo_16.root &
time python channel_distrs_full_loop.py --do-W-stitching --options no_prop_tau,no_prop_jets --metmuegclean true  -l logss temp/notaunojets/ channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/WJetsToLNu_TuneCUETP8M1_13TeV-amcatnloFXFX-pythia8/Ntupler_v37_MC2016_Summer16_WJets_amcatnlo/190206_135323/0000/MC2016_Summer16_WJets_amcatnlo_16.root &
time python channel_distrs_full_loop.py --do-W-stitching --metmuegclean true  -l logss temp/orig/ channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v37/WJetsToLNu_TuneCUETP8M1_13TeV-amcatnloFXFX-pythia8/Ntupler_v37_MC2016_Summer16_WJets_amcatnlo/190206_135323/0000/MC2016_Summer16_WJets_amcatnlo_16.root &


So now the question is one at it goes like this:
apparently the past good data-mc agreement was due to a mistake in handling data,
specifically due to double-propagating jes corrections to met of data,
now maybe there is a mistake-double somewhere which overlaped before but now it is on it's own and is evident.
What could it be? Propagation of lep-jets and tes? Substitution of a the lep-jet with the lepton?

At the moment only jer is propagated in MC.
And it is, supposedly, a small contribution, even for lep-matched jet. (Will see in the test.)
Substitution did not work before. Maybe due to this error?
Anyway, another good option is to remove jes correction of lep-matched jet.
It is physical for type1 met: return to unclustered particles.

Comparison with no lep-jets:

python get_shapes.py --norm-binwidth --formula "now:now_noljet" -d Mt_lep_met_f -c test_wjets_v37test1_v37test4 -p wjets_met_f  now:distrs/v37_test1_bunch6/init/MC2016_Summer16_WJets_amcatnlo.root:wjets_mu,wjets_other,NOMINAL,met_f         now_noljet:distrs/v37_test4_bunch1/all/MC2016_Summer16_WJets_amcatnlo.root:wjets_mu,wjets_other,NOMINAL,met_f
python get_shapes.py --norm-binwidth --formula "now:now_noljet" -d Mt_lep_met_f -c test_wjets_v37test1_v37test4 -p wjets_lep_pt now:distrs/v37_test1_bunch6/init/MC2016_Summer16_WJets_amcatnlo.root:wjets_mu,wjets_other,NOMINAL,lep_pt        now_noljet:distrs/v37_test4_bunch1/all/MC2016_Summer16_WJets_amcatnlo.root:wjets_mu,wjets_other,NOMINAL,lep_pt
python get_shapes.py --norm-binwidth --formula "now:now_noljet" -d Mt_lep_met_f -c test_wjets_v37test1_v37test4 -p wjets_mT_f   now:distrs/v37_test1_bunch6/init/MC2016_Summer16_WJets_amcatnlo.root:wjets_mu,wjets_other,NOMINAL,Mt_lep_met_f  now_noljet:distrs/v37_test4_bunch1/all/MC2016_Summer16_WJets_amcatnlo.root:wjets_mu,wjets_other,NOMINAL,Mt_lep_met_f

-- mT seems to be a bit smaller, closer to cover the gap.

Finish the test4 (no prop of lep-jet JER) with DY MC.

python stack_plot.py distrs/v37_test4_bunch1_mc.root distrs/v37_test1_bunch6/SingleMuon.root -o plots/v37_test4_bunch1/ -p -r -c wjets_mu --data-nick data_other -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd-factor 2.0 --overwrite --wjets 1.2

-- ok, though with a trend at high mT!!!

and a bunch of jobs failed?

[olek@fermi05 proc]$ ls lstore_outdirs/v37/test4/MC2016_Summer16_WJets_amcatnlo*/*root | wc -l
214
[olek@fermi05 proc]$ ls lstore_outdirs/v37/test1/MC2016_Summer16_WJets_amcatnlo*/*root | wc -l
251

--- not sure why? probably due to updating stage2.py while running.

now to finish test4 if test5 does not work better....


Start test5 with jes of lep-jet returned to met --- unclustering of the lep-matched jet.

which means

    proc_met -= p4 * (en_factor - 1.)

-- here p4*1. is the old jet and p4*en_factor is the correction factor,
   therefore jes uncor must be used for the correction

And the same correction is applied for JES and JER variations.
The lepjet is not varied by JES, JER, it is unclustered.
And the unclustering is propagated to the met.

python stack_plot.py distrs/v37_test5_bunch1_mc.root distrs/v37_test5_bunch1/SingleMuon.root     -o plots/v37_test5_bunch1/ -p -r -c wjets_mu --data-nick data_other -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd-factor 2.0 --overwrite --wjets 0.85

python stack_plot.py distrs/v37_test5_bunch1_mc.root distrs/v37_test5_bunch1/SingleElectron.root -o plots/v37_test5_bunch1/ -p -r -c wjets_el --data-nick data_other -d Mt_lep_met_f --bin-norm --lumi 35800 --qcd-factor 2.0 --overwrite --wjets 0.85

-- many data jobs failed, hence poor normalization
   but overall it looks like the same trend as in test4


## so, which corrections should be there and how to test it?

I'd say:

no TES propagation
and
all jets (20GeV or all?) without lep-matched
--- test this shape in 1 wjets file



## info on shapes

all WNJets, inclusive madgraph and amcatnlo

python get_shapes.py --formula "w0jets : w1jets : w2jets: w3jets:w4jets " -c wjets_mu -d Mt_lep_met_f -p wjets_other w0jets:distrs/v37_test1_bunch5/MC2016_Summer16_WJets_madgraph.root w1jets:distrs/v37_test1_bunch5/MC2016_Summer16_W1Jets_madgraph.root w2jets:distrs/v37_test1_bunch5/MC2016_Summer16_W2Jets_madgraph.root w3jets:distrs/v37_test1_bunch5/MC2016_Summer16_W3Jets_madgraph.root w4jets:distrs/v37_test1_bunch5/MC2016_Summer16_W4Jets_madgraph.root

-- w0jets is narrow, wNjets are broader

with amcatnlo

python get_shapes.py --formula "w0jets : w1jets : w2jets: w3jets:w4jets:wjets_amc" -c wjets_mu -d Mt_lep_met_f -p wjets_other w0jets:distrs/v37_test1_bunch5/MC2016_Summer16_WJets_madgraph.root w1jets:distrs/v37_test1_bunch5/MC2016_Summer16_W1Jets_madgraph.root w2jets:distrs/v37_test1_bunch5/MC2016_Summer16_W2Jets_madgraph.root w3jets:distrs/v37_test1_bunch5/MC2016_Summer16_W3Jets_madgraph.root w4jets:distrs/v37_test1_bunch5/MC2016_Summer16_W4Jets_madgraph.root wjets_amc:distrs/v37_test1_bunch5/MC2016_Summer16_WJets_amcatnlo.root

amcatnlo VS sum of WNJets

python get_shapes.py --formula "wNjets:wjets_amc" -c wjets_mu -d Mt_lep_met_f -p wjets_other wNjets:mc_norm/v37_test1_bunch5/w0jets_wNjets.root wjets_amc:distrs/v37_test1_bunch5/MC2016_Summer16_WJets_amcatnlo.root

-- very close


shape of all qcd




# looking for distrs, histosels files of last update and automating everything

python numbers_for_datacard.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -y -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --latex

elsel tt_eltau 3010

damn

the one from datacard:

python numbers_for_datacard.py histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -y -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --latex

-- no such directory now

[olek@fermi02 jobsums]$ find histosels -name "*objfix*"
[olek@fermi02 jobsums]$ 

no objfix...

[olek@fermi02 proc]$ find sw-dir/jobsums/histosels/ -name "*objfix*"
sw-dir/jobsums/histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root
sw-dir/jobsums/histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix_with_selOS.root
[olek@fermi02 proc]$ 

-- copied and got 2964 in tt_eltau at elsel!

also:

[olek@fermi02 jobsums]$ cmp histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root /lstore/cms/olek/CMSSW_8_1_0/src/HiggsAnalysis/CombinedLimit/fitting/ttxsec/HISTOSELS_redo_v25_v26_1_objfix.root 
[olek@fermi02 jobsums]$ 

match

and the distrs file?

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root     -p -r -o plots/tests/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root     -p -r -o plots/tests/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleElectron.root -p -r -o plots/tests/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleElectron.root -p -r -o plots/tests/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02

-- 3009.63
mc sum  6383.362342
instead 6307
and     7884 in ljout

factor of histosel
original tt_eltau: 0.104359 (entries of sel_lj = 10478, selVloose_lj = 13403)
after scales:      3009.63  (entries 13403)
3009.63 / 0.104359 = 28839.2
2964. / 28839.2 = 0.102777   --- looking for this

data: 6190 7906 (6280 8103) ../quick-test/redo-v25-v26_cats_hadds/SingleElectron.root
note: 6190 7906

distrs/distrs_redo_v25v26_mc.root    same
distrs/distrs_redo_v25v26_mc_*.root  same all

without full histosell cannot find the distrs file...

ok, distrs/distrs_redo_v25v26_mc_4.root is close enough


## the prefit plotting scripts

### input versioned files

nt
proc   (stage2)
distrs (batch plots, define channels, sys and distr)
mc and data file

distrs/distrs_redo_v25v26_mc_4.root
../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root

2 locations:
in  proc/jobsums/distrs/
and proc/quick-test/

move to proc/jobsums/distrs/
leave quick-test/ for tests

the standard out dir:
proc/jobsums/distrs/vNTID_procID_distrsID/all/

then hadd to
proc/jobsums/distrs/vNTID_procID_distrsID/

and the distrs files are:
proc/jobsums/distrs/vNTID_procID_distrsID_mc.root
proc/jobsums/distrs/vNTID_procID_distrsID/SingleMuon.root
proc/jobsums/distrs/vNTID_procID_distrsID/SingleElectron.root

### all the plotting scripts, definitions and run with xargs in parallel

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleElectron.root -p -r -o plots/tests/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02

output plots/vNTID_procID_distrsID/

el or mu set a distrs of constants: lumi, distrs data file.

then there are groups of plots where
channel, distr, distr shape, qcd handling and SYS might change
plus options of titles etc

let's just glob them in makefile tasks

for example v25v26_redo_4




# histosel loops with xargs for parallelism

cat syst-test.syst-list.1 | xargs -P 2 -I SYS ./no_error_stack_plot distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root -o histosels/redo-v25-v26_resub2_test-prallel --lumi 35800 -c mu_sel -d Mt_lep_met_c --wjet 0.8 --qcd 1.05 --systematic SYS

or

cat syst-test.syst-list.1 | xargs -P 2 -I SYS sh -c "python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root -o histosels/redo-v25-v26_resub2_test-prallel --lumi 35800 -c mu_sel -d Mt_lep_met_c --wjet 0.8 --qcd 1.05 --systematic SYS || true"






# yield distrs, nominal sys

python bunch_of_selections.py --set-sys nom --set-distrs "1,yield" lstore_outdirs/merge-sets/v37/test1/ quick-test/v37-test1/

python bunch_of_selections.py --set-sys nom --set-distrs "1,yield" lstore_outdirs/merge-sets/v25v26/resub4/ quick-test/v25v26-resub4-yield/

TODO: -- save this in some coherent script file!

python numbers_for_datacard.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout --no-sums -y --sqrt-unc

INFO:root:import ROOT

INFO:root:el_sel_lj
INFO:root:el_sel_ljout
                                 process    el_sel_lj   el_sel_ljout
                                tt_eltau   $      3010 \pm         29 $   $      4691 \pm         36 $
                             tt_taultauh   $       170 \pm          7 $   $       280 \pm          9 $
                                   tt_lj   $      2215 \pm         16 $   $      1457 \pm         13 $
                                tt_taulj   $       118 \pm          4 $   $        76 \pm          3 $
                                tt_other   $        60 \pm          3 $   $       100 \pm          4 $
                             s_top_eltau   $       152 \pm          5 $   $       274 \pm          6 $
                             s_top_other   $        21 \pm          1 $   $        31 \pm          2 $
                                s_top_lj   $       151 \pm          3 $   $       169 \pm          3 $
                               dy_tautau   $       103 \pm         13 $   $       190 \pm         14 $
                                dy_other   $        34 \pm          6 $   $       103 \pm          9 $
                             wjets_other   $       194 \pm         10 $   $       241 \pm          6 $
                              wjets_taul   $         7 \pm          1 $   $         7 \pm          1 $
                              wjets_tauh   $         0 \pm          0 $   $         1 \pm          1 $
                                dibosons   $        13 \pm          1 $   $        31 \pm          2 $
                                     qcd   $       136 \pm         21 $   $       327 \pm         24 $
aaa!
                                mc_resum     6383.362     7980.707
                                    data   $      6190 \pm         79 $   $      7906 \pm         90 $

python numbers_for_datacard.py histosels/redo-v25-v26_resub4_yields/distrs_v25v26resub4_yields_all_HISTOSEL.root -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout --no-sums -y --distr yield
INFO:root:import ROOT
INFO:root:el_sel_lj
INFO:root:el_sel_ljout
                                 process    el_sel_lj   el_sel_ljout
                                tt_eltau   $      3093 \pm         29 $   $      4858 \pm         36 $
                             tt_taultauh   $       171 \pm          7 $   $       284 \pm          9 $
                                   tt_lj   $      2216 \pm         16 $   $      1460 \pm         13 $
                                tt_taulj   $       118 \pm          4 $   $        76 \pm          3 $
                                tt_other   $        61 \pm          3 $   $       104 \pm          4 $
                             s_top_eltau   $       161 \pm          5 $   $       293 \pm          6 $
                             s_top_other   $        21 \pm          1 $   $        32 \pm          2 $
                                s_top_lj   $       151 \pm          3 $   $       169 \pm          3 $
                               dy_tautau   $       103 \pm         13 $   $       190 \pm         14 $
                                dy_other   $        20 \pm          4 $   $        62 \pm          7 $
                             wjets_other   $        91 \pm          7 $   $       111 \pm          4 $
                              wjets_taul   $         7 \pm          1 $   $         7 \pm          1 $
                              wjets_tauh   $         0 \pm          0 $   $         1 \pm          1 $
                                dibosons   $        13 \pm          1 $   $        32 \pm          2 $
                                     qcd   $       211 \pm         19 $   $       493 \pm         25 $
aaa!
                                mc_resum     6436.279     8171.649
                                    data   $      6455 \pm         80 $   $      8393 \pm         92 $


-- the stat unc with yield is practically the same as the shape with sqrt of sum of squares





# check b Frag weights, the variation seems to be too large

TFile**		gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/MC2016_Summer16_TTJets_powheg_98.root	
 TFile*		gstore_outdirs/v37/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v37_MC2016_Summer16_TTJets_powheg/190207_134619/0000/MC2016_Summer16_TTJets_powheg_98.root	
   KEY: TDirectoryFile	ntupler;1	ntupler
   root [2] ntupler->Get("reduced_ttree")
   (TObject *) 0x2fd8780
   root [3] ntupler->Get("reduced_ttree")->Draw("gen_weight_centralFrag")
   Info in <TCanvas::MakeDefCanvas>:  created default TCanvas with name c1
   root [4] 
   root [4] 
   root [4] 
   root [4] 0.983
   (double) 0.983000
   root [5] 
   root [5] ntupler->Get("reduced_ttree")->Draw("gen_weight_FragUp")
   root [6] 0.935
   (double) 0.935000
   root [7] 
   root [7] 
   root [7] ntupler->Get("reduced_ttree")->Draw("gen_weight_FragDown")
   root [8] 
   root [8] 
   root [8] 1.018
   (double) 1.01800
   root [9] 
   root [9] 
   root [9] ntupler->Get("reduced_ttree")->Draw("gen_weight_FragDown / gen_weight_centralFrag")
   root [10] 
   root [10] 1.042
   (double) 1.04200
   root [11] 
   root [11] 
   root [11] ntupler->Get("reduced_ttree")->Draw("gen_weight_FragUp / gen_weight_centralFrag")
   root [12] 0.943
   (double) 0.943000
   root [13] 
   root [13] 
   root [13] 
   root [13] 0.935000 / 0.983000
   (double) 0.951170
   root [14] 
   root [14] 1.01800 / 0.983000
   (double) 1.03561

-- in any case the variation is larger than what was used:
"FragUp":             1.001123,
"FragDown":           0.999304,

-- however, these numbers come from systs control histo
the histo contains averages of each weight, sadly not the ratio Up/Central
check the histo:

root [25] 601472. / 627313.
(double) 0.958807
root [26] 645793. / 627313.
(double) 1.02946

-- larger anyway!

check histo in merged set:

root [5] 5.72682e+07 / 5.97258e+07
(double) 0.958852
root [6] 6.14796e+07 / 5.97258e+07
(double) 1.02936

surpisingly close
and Up is the smaller one
-- yeah, these factors will reduce the variation!

## the ratio of the variations for quick fix in the fit

              "FragUp":             0.958852, # / 1.001123,
            "FragDown":             1.02936,  # / 0.999304,
         "SemilepBRUp":             1.002650, # / 1.008565,
       "SemilepBRDown":             1.035812, # / 0.987050,
          "PetersonUp":             0.990578, # / 1.000032,

              "FragUp":             0.958852 / 1.001123 = 0.9577764170836152 = 0.958
            "FragDown":             1.02936  / 0.999304 = 1.030076933545748  = 1.030
         "SemilepBRUp":             1.002650 / 1.008565 = 0.9941352317401457 = 0.994
       "SemilepBRDown":             1.035812 / 0.987050 = 1.0494017526974317 = 1.049
          "PetersonUp":             0.990578 / 1.000032 = 0.9905463025183193 = 0.991

refit impacts from the almost-old files:

cp ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.txt ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_bFrag.txt
cp ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.txt ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_bFrag.txt

Frag            shape          1.0    1.0   1.0   1.0   1.0        -        -     -     -        -     -        -     -        -                  1.0    1.0   1.0   1.0   1.0        -        -     -     -        -     -        -     -        -
SemilepBR       shape          1.0    1.0   1.0   1.0   1.0        -        -     -     -        -     -        -     -        -                  1.0    1.0   1.0   1.0   1.0        -        -     -     -        -     -        -     -        -
Peterson        shape          1.0    1.0   1.0   1.0   1.0        -        -     -     -        -     -        -     -        -                  1.0    1.0   1.0   1.0   1.0        -        -     -     -        -     -        -     -        -

Frag            shape          1.030/0.958    1.030/0.958   1.030/0.958   1.030/0.958   1.030/0.958        -        -     -     -        -     -        -     -        -                  1.030/0.958    1.030/0.958   1.030/0.958   1.030/0.958   1.030/0.958        -        -     -     -        -     -        -     -        -
SemilepBR       shape          1.049/0.994    1.049/0.994   1.049/0.994   1.049/0.994   1.049/0.994        -        -     -     -        -     -        -     -        -                  1.049/0.994    1.049/0.994   1.049/0.994   1.049/0.994   1.049/0.994        -        -     -     -        -     -        -     -        -
Peterson        shape          0.991    0.991   0.991   0.991   0.991        -        -     -     -        -     -        -     -        -                  0.991    0.991   0.991   0.991   0.991        -        -     -     -        -     -        -     -        -

-- nope..
RuntimeError: Error reading line 22 of file ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_bFrag.txt: Asymmetric errors are allowed only for Log-normals

so, 1 SF must fix both variations...
now: FragUp reduces the yield and FragDown rises it
     therefore, these 3-6% must reduce the overall variation
     3-6% = 4.5% -- 0.955 of the initial variation

Frag            shape          0.955    0.955   0.955   0.955   0.955        -        -     -     -        -     -        -     -        -                  0.955    0.955   0.955   0.955   0.955        -        -     -     -        -     -        -     -        -

by the same method for the others

PetersonUp reduces
-- ok

SemilepBR does not matter

../scripts/text2workspace.py ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_bFrag.txt
../scripts/text2workspace.py ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_bFrag.txt

make impacts nn=el_bFrag workspace=ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_bFrag.root   &
make impacts nn=mu_bFrag workspace=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_bFrag.root   &

python new_impact_table.py --merge-pdf latest_impacts_el_bFrag.json latest_impacts_mu_bFrag.json

          b fragmentation  &  2.6 &  2.6 \\

was 2.7 and 2.6

combineCards.py mu=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_bFrag.txt el=ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_bFrag.txt > ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_bFrag.txt

../scripts/text2workspace.py ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_bFrag.txt

make impacts nn=both_bFrag workspace=ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_bFrag.root   &


-- yep, the correction must be calculated differently

test 0.5 Frag in ele
Frag            shape          0.5    0.5   0.5   0.5   0.5        -        -     -     -        -     -        -     -        -                  0.5    0.5   0.5   0.5   0.5        -        -     -     -        -     -        -     -        -

overall b frag goes to
2.3



## correct correction

instead of just SF ratio:

corrected variation = (int.up/int.nom*SF ratio - 1) / (int.up/int.nom - 1)

for b Frag and Peterson

root -l ttxsec/HISTOSELS_v25v25redo_PUnormFix.root

((TH1D*) el_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->Integral()
((TH1D*) el_sel_lj->Get("sums_FragUp/mc_sum1_FragUp"))->Integral()
((TH1D*) el_sel_lj->Get("sums_FragDown/mc_sum1_FragDown"))->Integral()
((TH1D*) el_sel_lj->Get("sums_PetersonUp/mc_sum1_PetersonUp"))->Integral()

((TH1D*) el_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->Integral()
((TH1D*) el_sel_ljout->Get("sums_FragUp/mc_sum1_FragUp"))->Integral()
((TH1D*) el_sel_ljout->Get("sums_FragDown/mc_sum1_FragDown"))->Integral()
((TH1D*) el_sel_ljout->Get("sums_PetersonUp/mc_sum1_PetersonUp"))->Integral()

((TH1D*) mu_sel_lj->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->Integral()
((TH1D*) mu_sel_lj->Get("sums_FragUp/mc_sum1_FragUp"))->Integral()
((TH1D*) mu_sel_lj->Get("sums_FragDown/mc_sum1_FragDown"))->Integral()
((TH1D*) mu_sel_lj->Get("sums_PetersonUp/mc_sum1_PetersonUp"))->Integral()

((TH1D*) mu_sel_ljout->Get("sums_NOMINAL/mc_sum1_NOMINAL"))->Integral()
((TH1D*) mu_sel_ljout->Get("sums_FragUp/mc_sum1_FragUp"))->Integral()
((TH1D*) mu_sel_ljout->Get("sums_FragDown/mc_sum1_FragDown"))->Integral()
((TH1D*) mu_sel_ljout->Get("sums_PetersonUp/mc_sum1_PetersonUp"))->Integral()

6383.36
6246.32
6497.12
6270.42

7980.71
7828.99
8098.31
7868.96

10805.6
10581.9
10995.5
10607.8

13376.8
13175.3
13535.9
13194.9

julia> 6497.12 / 6383.36
1.0178213354722279

julia> 6246.32 / 6383.36
0.9785316823741729

julia> 6270.42 / 6383.36
0.982307123521155



julia> 7828.99/7980.71
0.9809891601123208

julia> 8098.31/7980.71
1.0147355310492425

julia> 7868.96/7980.71
0.9859974864391765



ratio_bFrag = 0.955

ratio_bFrag = 0.97
ratio_Peterson = 0.991

cor_ratio(sf, int_var, int_nom) = (sf*(int_var/int_nom) - 1)/(int_var/int_nom - 1)

cor_ratio(0.97, 6246.32, 6383.36)
cor_ratio(0.97, 6497.12, 6383.36)

cor_ratio(0.97, 7828.99, 7980.71)
cor_ratio(0.97, 8098.31, 7980.71)

julia> cor_ratio(0.97, 6246.32, 6383.36)
2.3674080560420334

julia> cor_ratio(0.97, 6497.12, 6383.36)
-0.7133755274261541

julia> cor_ratio(0.97, 7828.99, 7980.71)
2.548047060374377

julia> cor_ratio(0.97, 8098.31, 7980.71)
-1.0658954081632657

precise SF for
up
down
              "FragUp":             0.958852 / 1.001123 = 0.9577764170836152 = 0.958
            "FragDown":             1.02936  / 0.999304 = 1.030076933545748  = 1.030

-- I divide the yield by it, it must be reversed for the yield
              "FragUp":             1.001123 / 0.958852 = 1.0440850099911143 = 1.044
            "FragDown":             0.999304 / 1.02936  = 0.9708012745783787 = 0.971

cor_ratio(1.044, 6246.32, 6383.36)
cor_ratio(0.971, 6497.12, 6383.36)

cor_ratio(1.044, 7828.99, 7980.71)
cor_ratio(0.971, 8098.31, 7980.71)

julia> cor_ratio(1.044, 6246.32, 6383.36)
-1.0055318155283184

julia> cor_ratio(0.971, 6497.12, 6383.36)
-0.6562630098452819

julia> cor_ratio(1.044, 7828.99, 7980.71)
-1.2704690218824148

julia> cor_ratio(0.971, 8098.31, 7980.71)
-0.9970322278911566

so.. the variations should go exactly 1sigma the other way?

julia> 6246.32 * 1.044
6521.15808

julia> 6521.15808 / 6383.36
1.0215870763986366

julia> 6246.32 / 6383.36
0.9785316823741729


also, only TT MC had to be summed?

-- let's account for other 20% MC like this:

mc_cor_SF(mc_perc, SF) = mc_perc + (1-mc_perc) * SF

mc_cor_SF(0.2, 1.044)
mc_cor_SF(0.2, 0.971)

1.0352000000000001
0.9768000000000001

cor_ratio(1.035, 6246.32, 6383.36)
cor_ratio(0.977, 6497.12, 6383.36)

cor_ratio(1.035, 7828.99, 7980.71)
cor_ratio(0.977, 8098.31, 7980.71)

julia> cor_ratio(1.035, 6246.32, 6383.36)
-0.5953093987156977
julia> cor_ratio(0.977, 6497.12, 6383.36)
-0.31358790436005474

julia> cor_ratio(1.035, 7828.99, 7980.71)
-0.8060549037701036
julia> cor_ratio(0.977, 8098.31, 7980.71)
-0.583853146258502

-- different percentages of tt

julia> mean([-0.5953093987156977 -0.31358790436005474 -0.8060549037701036 -0.583853146258502])
-0.5747013382760895

the sign does not matter (1 correction for both Up and Down)


same for Peterson variation

          "PetersonUp":             0.990578 / 1.000032 = 0.9905463025183193 = 0.991
          "PetersonUp":             1.000032 / 0.990578 = 1.0095439228410081 = 1.0095

mc_cor_SF(0.2, 1.01)
1.008

mc_cor_SF(0.2, 1.0095)
1.0076

6270.42
7868.96

cor_ratio(1.008, 6270.42, 6383.36)
cor_ratio(1.008, 7868.96, 7980.71)

0.555840623339827
0.4366740044742675

and in muons

cor_ratio(1.008, 10607.8, 10805.6)
cor_ratio(1.008, 13194.9, 13376.8)

0.5709686552072842
0.4196855415063183


frag and peterson are redocued to 0.5:

  final   state radiation  &  2.4 &  1.6 \\
          b fragmentation  &  1.5 &  1.5 \\

also reduce semilep to 0.01:

  final   state radiation  &  2.3 &  1.6 \\
          b fragmentation  &  1.5 &  1.3 \\

with both:

python new_impact_table.py --merge-pdf latest_impacts_el_bFrag.json latest_impacts_mu_bFrag.json latest_impacts_both_bFrag.json

$\tauh$ jet identification  &  5.0 &  4.3 &  4.3 \\
       pileup uncertainty  &  2.9 &  2.5 &  2.7 \\
        top quark $p_{T}$  &  2.9 &  2.2 &  2.3 \\
$\tauh$ misidentification background  &  2.4 &  2.1 &  2.0 \\
        QCD normalization  &  0.2 &  1.3 &  1.6 \\
     b-tagging efficiency  &  1.6 &  1.3 &  1.3 \\
     W+jets normalization  &  0.4 &  1.1 &  1.1 \\
       muon ID efficiency  &  0.7 &  0.7 \\
         DY normalization  &  0.3 &  0.4 &  0.6 \\
electron trigger efficiency  &  2.6 &  0.5 \\
 Single Top normalization  &  0.6 &  0.5 &  0.4 \\
   electron ID efficiency  &  1.9 &  0.3 \\
  muon trigger efficiency  &  0.4 &  0.3 \\
     $\tauh$ Energy Scale  &  0.2 &  0.3 &  0.2 \\
    jet energy resolution  &  0.2 &  0.1 &  0.1 \\
         jet energy scale  &  0.3 &  0.2 &  0.0 \\
   Dibosons normalization  &  0.0 &  0.0 &  0.0 \\
               Luminosity  &  0.0 &  0.0 &  0.0 \\
  final   state radiation  &  2.3 &  1.6 &  1.8 \\
          b fragmentation  &  1.5 &  1.3 &  1.5 \\
  initial state radiation  &  1.8 &  1.3 &  1.1 \\
 ME Renormalization scale  &  0.8 &  1.2 &  0.7 \\
ME combined scale variation  &  0.5 &  1.1 &  0.7 \\
   ME-PS matching (hdamp)  &  0.2 &  0.7 &  0.7 \\
underlying event (Pythia tune)  &  0.6 &  0.5 &  0.6 \\
   ME Factorization scale  &  0.3 &  0.2 &  0.1 \\
semi-leptonic b-hadron BRs  &  0.0 &  0.0 &  0.0 \\
                      PDF  &  1.5 &  1.3 &  1.4 \\
            MC statistics  &  2.4 &  1.7 &  1.8 \\



## other sys weights

checked above?


# testing missing jobs on gstore or lstore

python sumup_ttree_draw.py "5" --histo-range 10,0,10 --cond-com "HLT_el && abs(leps_ID) == 11 && lep_matched_HLT[0] && no_iso_veto_leps && ntaus > 0" --output test1_v37el.root --histo-name test1v37el gstore_outdirs/v37/SingleElectron/Ntupler_v37_Data13TeV_SingleEl*/*/*/Data13*.root  &
python sumup_ttree_draw.py "5" --histo-range 10,0,10 --cond-com "HLT_el && abs(leps_ID) == 11 && lep_matched_HLT[0] && no_iso_veto_leps && ntaus > 0" --output test1_v25el.root --histo-name test1v25el gstore_outdirs/v25/SingleElectron/Ntupler_v25_Data13TeV_SingleEl*/*/*/Data13*.root  &

python sumup_ttree_draw.py "5" --histo-range 10,0,10 --cond-com "HLT_mu && abs(leps_ID) == 13 && lep_matched_HLT[0] && no_iso_veto_leps && ntaus > 0" --output test1_v37mu.root --histo-name test1v37mu gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMu*/*/*/Data13*.root      &
python sumup_ttree_draw.py "5" --histo-range 10,0,10 --cond-com "HLT_mu && abs(leps_ID) == 13 && lep_matched_HLT[0] && no_iso_veto_leps && ntaus > 0" --output test1_v25mu.root --histo-name test1v25mu gstore_outdirs/v25/SingleMuon/Ntupler_v25_Data13TeV_SingleMu*/*/*/Data13*.root      &

TH1.Print Name  = test1v25el_test1v25el, Entries= 14667126, Total sum= 1.46671e+07
root [4] 
root [4] 
root [4] test1v37el->Get("test1v37el_test1v37el")->Print()
TH1.Print Name  = test1v37el_test1v37el, Entries= 15462924, Total sum= 1.54629e+07
root [5] 1.54629e+07 / 1.46671e+07
(double) 1.05426
root [6] 
root [6] 
root [6] test1v25mu->Get("test1v25mu_test1v25mu")->Print()
TH1.Print Name  = test1v25mu_test1v25mu, Entries= 22411254, Total sum= 2.24112e+07
root [7] test1v37mu->Get("test1v37mu_test1v37mu")->Print()
TH1.Print Name  = test1v37mu_test1v37mu, Entries= 22133699, Total sum= 2.21337e+07
root [8] 

damn

python sumup_ttree_draw.py "5" --histo-range 10,0,10 --cond-com "HLT_mu && abs(leps_ID) == 13 && lep_matched_HLT[0] && no_iso_veto_leps && ntaus > 0" --output test1_v37muG.root --histo-name test1v37muG gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016G*/*/*/Data13*.root      &
python sumup_ttree_draw.py "5" --histo-range 10,0,10 --cond-com "HLT_mu && abs(leps_ID) == 13 && lep_matched_HLT[0] && no_iso_veto_leps && ntaus > 0" --output test1_v25muG.root --histo-name test1v25muG gstore_outdirs/v25/SingleMuon/Ntupler_v25_Data13TeV_SingleMuon2016G*/*/*/Data13*.root      &

python sumup_ttree_draw.py "5" --histo-range 10,0,10 --cond-com "HLT_mu && abs(leps_ID) == 13 && lep_matched_HLT[0] && no_iso_veto_leps && ntaus > 0" --output test1_v37muB.root --histo-name test1v37muB gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMuon2016B*/*/*/Data13*.root      &
python sumup_ttree_draw.py "5" --histo-range 10,0,10 --cond-com "HLT_mu && abs(leps_ID) == 13 && lep_matched_HLT[0] && no_iso_veto_leps && ntaus > 0" --output test1_v25muB.root --histo-name test1v25muB gstore_outdirs/v25/SingleMuon/Ntupler_v25_Data13TeV_SingleMuon2016B*/*/*/Data13*.root      &

muon w no veto

python sumup_ttree_draw.py "5" --histo-range 10,0,10 --cond-com "HLT_mu && abs(leps_ID) == 13 && lep_matched_HLT[0] && ntaus > 0" --output test1_v37muNoVeto.root --histo-name test1v37muNoVeto gstore_outdirs/v37/SingleMuon/Ntupler_v37_Data13TeV_SingleMu*/*/*/Data13*.root      &
python sumup_ttree_draw.py "5" --histo-range 10,0,10 --cond-com "HLT_mu && abs(leps_ID) == 13 && lep_matched_HLT[0] && ntaus > 0" --output test1_v25muNoVeto.root --histo-name test1v25muNoVeto gstore_outdirs/v25/SingleMuon/Ntupler_v25_Data13TeV_SingleMu*/*/*/Data13*.root      &

23112k -- missing couple jobs in v37
23116k






# fractions of jets in lj-ljout at preselection

ttree_out->Draw("abs(event_jets_b_genmatch[])", "selection_stage_presel > 0 && event_jets_lj_var >  20.")
histo = (TH1D*) ttree_out->GetHistogram()
genmatch_b_ljout = (TH1D*) histo->Clone()
genmatch_b_ljout->SetDirectory(0)
genmatch_b_ljout->SetName("b_ljout")

ttree_out->Draw("abs(event_jets_l_genmatch[])", "selection_stage_presel > 0 && event_jets_lj_var >  20.")
histo = (TH1D*) ttree_out->GetHistogram()
genmatch_l_ljout = (TH1D*) histo->Clone()
genmatch_l_ljout->SetDirectory(0)
genmatch_l_ljout->SetName("l_ljout")

ttree_out->Draw("abs(event_jets_r_genmatch[])", "selection_stage_presel > 0 && event_jets_lj_var >  20.")
histo = (TH1D*) ttree_out->GetHistogram()
genmatch_r_ljout = (TH1D*) histo->Clone()
genmatch_r_ljout->SetDirectory(0)
genmatch_r_ljout->SetName("r_ljout")

ttree_out->Draw("abs(event_jets_t_genmatch[])", "selection_stage_presel > 0 && event_jets_lj_var >  20.")
histo = (TH1D*) ttree_out->GetHistogram()
genmatch_t_ljout = (TH1D*) histo->Clone()
genmatch_t_ljout->SetDirectory(0)
genmatch_t_ljout->SetName("t_ljout")

genmatch_sum3_ljout = (TH1D*) genmatch_b_ljout->Clone()
genmatch_sum3_ljout->SetName("genmatch_3_ljout")
genmatch_sum3_ljout->Add(genmatch_l_ljout)
genmatch_sum3_ljout->Add(genmatch_r_ljout)

genmatch_sum2_ljout = (TH1D*) genmatch_b_ljout->Clone()
genmatch_sum2_ljout->SetName("genmatch_2_ljout")
genmatch_sum2_ljout->Add(genmatch_r_ljout)



ttree_out->Draw("event_jets_b_genmatch[]", "selection_stage_presel > 0 && event_jets_lj_var <= 20.")
histo = (TH1D*) ttree_out->GetHistogram()
genmatch_b_lj    = (TH1D*) histo->Clone()
genmatch_b_lj   ->SetDirectory(0)
genmatch_b_lj   ->SetName("b_lj")

ttree_out->Draw("event_jets_l_genmatch[]", "selection_stage_presel > 0 && event_jets_lj_var <= 20.")
histo = (TH1D*) ttree_out->GetHistogram()
genmatch_l_lj    = (TH1D*) histo->Clone()
genmatch_l_lj   ->SetDirectory(0)
genmatch_l_lj   ->SetName("l_lj")

ttree_out->Draw("event_jets_r_genmatch[]", "selection_stage_presel > 0 && event_jets_lj_var <= 20.")
histo = (TH1D*) ttree_out->GetHistogram()
genmatch_r_lj    = (TH1D*) histo->Clone()
genmatch_r_lj   ->SetDirectory(0)
genmatch_r_lj   ->SetName("r_lj")

ttree_out->Draw("event_jets_t_genmatch[]", "selection_stage_presel > 0 && event_jets_lj_var <= 20.")
histo = (TH1D*) ttree_out->GetHistogram()
genmatch_t_lj    = (TH1D*) histo->Clone()
genmatch_t_lj   ->SetDirectory(0)
genmatch_t_lj   ->SetName("t_lj")

genmatch_sum3_lj = (TH1D*) genmatch_b_lj->Clone()
genmatch_sum3_lj->SetName("genmatch_3_lj")
genmatch_sum3_lj->Add(genmatch_l_lj)
genmatch_sum3_lj->Add(genmatch_r_lj)

genmatch_sum2_lj = (TH1D*) genmatch_b_lj->Clone()
genmatch_sum2_lj->SetName("genmatch_2_lj")
genmatch_sum2_lj->Add(genmatch_r_lj)



## more info on effect of lj cut

the fraction of events in two categories at preselection:

ttree_out->Draw("5", "selection_stage_presel > 0")
ttree_out->Draw("5", "selection_stage_presel > 0 && event_jets_lj_var >  10.")
ttree_out->Draw("5", "selection_stage_presel > 0 && event_jets_lj_var >  20.")
ttree_out->Draw("5", "selection_stage_presel > 0 && event_jets_lj_var >  50.")
ttree_out->Draw("5", "selection_stage_presel > 0 && event_jets_lj_var >  55.")
ttree_out->Draw("5", "selection_stage_presel > 0 && event_jets_lj_var >  60.")
ttree_out->Draw("5", "selection_stage_presel > 0 && event_jets_lj_var >  80.")
ttree_out->Draw("5", "selection_stage_presel > 0 && event_jets_lj_var >  100.")
ttree_out->Draw("5", "selection_stage_presel > 0 && event_jets_lj_var >  150.")

5931938,0
5481995,10
4773972,20
3232763,50
3068227,55
2953961,59
2927319,60
2523223,80
2249709,100
1780300,150

half of all: 2.96597e+06

is this ratio in presel similar to the ratio at selection?

2927319.0 / 5931938.0 = 0.49

VS tt_lj at selection

2512.0 / (3727.0 + 2512.0) = 0.40

-- one of types of jets fakes less



fractions of W and b products

gen ID:
0 -- nothing
1 -- lep
2 -- tau
3 -- tau 3ch
4 -- tau lep
5 -- W product
6 -- b product

ttree_out->Draw("abs(event_jets_b_genmatch[])>>h(8,0,7)", "selection_stage_presel > 0")
histo = (TH1D*) ttree_out->GetHistogram()
genmatch_b_ljout = (TH1D*) histo->Clone()
genmatch_b_ljout->SetDirectory(0)
genmatch_b_ljout->SetName("b_ljout")

root [102] genmatch_b_ljout->GetBinContent(1+0)
(Double_t) 2.86629e+06
root [103] genmatch_b_ljout->GetBinContent(1+1)
(Double_t) 82065.0
root [104] genmatch_b_ljout->GetBinContent(1+2)
(Double_t) 66456.0
root [105] genmatch_b_ljout->GetBinContent(1+3)
(Double_t) 90529.0
root [106] genmatch_b_ljout->GetBinContent(1+4)
(Double_t) 14497.0
root [107] genmatch_b_ljout->GetBinContent(1+5)
(Double_t) 4.97446e+06
root [108] genmatch_b_ljout->GetBinContent(1+6)
(Double_t) 9.15139e+07

(Long64_t) 8385255
(Long64_t) 15331989

ttree_out->Draw("abs(event_jets_r_genmatch[])>>h(8,0,7)", "selection_stage_presel > 0")
histo = (TH1D*) ttree_out->GetHistogram()
genmatch_r_ljout = (TH1D*) histo->Clone()
genmatch_r_ljout->SetDirectory(0)
genmatch_r_ljout->SetName("r_ljout")

genmatch_sum2_ljout = (TH1D*) genmatch_b_ljout->Clone()
genmatch_sum2_ljout->SetName("genmatch_2_ljout")
genmatch_sum2_ljout->Add(genmatch_r_ljout)

genmatch_sum2_ljout->GetBinContent(1+5)
genmatch_sum2_ljout->GetBinContent(1+6)

(Double_t) 6.06022e+06
(Double_t) 1.11718e+07

6.06022e+06 / 1.11718e+07
(double) 0.542457

-- less W than b, is it strange? W product has less energy?


ttree_out->Draw("abs(event_jets_b_genmatch[])>>h(8,0,7)", "selection_stage_presel > 0 && event_jets_lj_var >  -10.")
histo = (TH1D*) ttree_out->GetHistogram()
genmatch_b_ljout = (TH1D*) histo->Clone()
genmatch_b_ljout->SetDirectory(0)
genmatch_b_ljout->SetName("b_ljout")

ttree_out->Draw("abs(event_jets_r_genmatch[])>>h(8,0,7)", "selection_stage_presel > 0 && event_jets_lj_var >  -10.")
histo = (TH1D*) ttree_out->GetHistogram()
genmatch_r_ljout = (TH1D*) histo->Clone()
genmatch_r_ljout->SetDirectory(0)
genmatch_r_ljout->SetName("r_ljout")

genmatch_sum2_ljout = (TH1D*) genmatch_b_ljout->Clone()
genmatch_sum2_ljout->SetName("genmatch_2_ljout")
genmatch_sum2_ljout->Add(genmatch_r_ljout)

genmatch_sum2_ljout->GetBinContent(1+5)
genmatch_sum2_ljout->GetBinContent(1+6)

0,   6.06022e+06, 1.11718e+07

20,  4.47499e+06, 8.96564e+06, 0.499127, 0.718547
50,  2.72059e+06, 6.04154e+06, 0.450314, 0.650967
55,  2.55413e+06, 5.73003e+06, 0.445745, 0.644292
59,  2.44006e+06, 5.51436e+06, 0.442492, 0.639894
60,  2.41387e+06, 5.46428e+06, 0.441754, 0.638868
80,  2.02832e+06, 4.70613e+06, 0.430995, 0.623586
150, 1.35824e+06, 3.33164e+06, 0.407679, 0.599730
250, 923469.,     2.41826e+06, 0.381873, 0.586820

so, the ratios in ljout:

4.47499e+06 / 8.96564e+06
2.72059e+06 / 6.04154e+06
2.55413e+06 / 5.73003e+06
2.44006e+06 / 5.51436e+06
2.41387e+06 / 5.46428e+06
2.02832e+06 / 4.70613e+06
1.35824e+06 / 3.33164e+06
923469.     / 2.41826e+06

in lj:

(6.06022e+06 - 4.47499e+06) / (1.11718e+07 - 8.96564e+06)
(6.06022e+06 - 2.72059e+06) / (1.11718e+07 - 6.04154e+06)
(6.06022e+06 - 2.55413e+06) / (1.11718e+07 - 5.73003e+06)
(6.06022e+06 - 2.44006e+06) / (1.11718e+07 - 5.51436e+06)
(6.06022e+06 - 2.41387e+06) / (1.11718e+07 - 5.46428e+06)
(6.06022e+06 - 2.02832e+06) / (1.11718e+07 - 4.70613e+06)
(6.06022e+06 - 1.35824e+06) / (1.11718e+07 - 3.33164e+06)
(6.06022e+06 - 923469.    ) / (1.11718e+07 - 2.41826e+06)











# substitution of the abstract in AN

A measurement of the cross section of the process $t\bar{t}\rightarrow (\ell\nu_\ell) (\tau_h \nu_\tau) b\bar{b}$, ($\ell=e, \mu$) is performed.
The data sample corresponds to an integrated luminosity of 31.3~fb$^{-1}$ and 35.8~fb$^{-1}$ for the $e\tau_{h}$ and $\mu\tau_{h}$ final states,
respectively, and collected by the CMS detector in proton-proton collisions at $\sqrt{s}=13$~TeV.
The measured value is $\sigma_{t\bar{t}} = 783 \pm  7 \rm{(stat.)} \pm 60 \rm{(syst.)} \pm 20 \rm{(lumi.)}$~pb.

The cross section of the process $t\bar{t}\rightarrow (b\ell\nu_{\ell})(b\tau_{h}\nu_{\tau})$ is measured,
where the $\tau$ decays into hadrons ($\tau_{h}$), and $\ell$ ($e$ or $\mu$) includes $\ell$ from $\tau$ decays.
The data sample corresponds to an integrated luminosity of 31.3~fb$^{-1}$ and 35.8~fb$^{-1}$ for the $e\tau_{h}$ and $\mu\tau_{h}$ final states,
respectively, and it was collected by the CMS detector in proton-proton collisions at $\sqrt{s}=13$~TeV.
The measured value is $\sigma_{t\bar{t}} = 783 \pm  7 \rm{(stat.)} \pm 60 \rm{(syst.)} \pm 20 \rm{(lumi.)}$~pb.
The measurement of the ratio of the cross sections in the lepton-tau final state divided by the dilepton cross section yields a value
$R_{\ell\tau_{h}/\ell\ell}=0.974 \pm 0.007 \rm{(stat.)} \pm 0.072 \rm{(syst.)} \pm 0.001 \rm{(lumi.)}$, consistent with lepton universality.
The ratio of the partial to the total width
$\Gamma(t\rightarrow\tau_{h}\nu_{\tau}b)/\Gamma_{\rm total}=0.1047 \pm 0.0008 \rm{(stat.)} \pm 0.0077 \rm{(syst.)} \pm 0.0001 \rm{(lumi.)}$ is also measured.




# check the recent impacts?

datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_lepMETprop.root
datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop.root
datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.root

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.root   --freezeParameters lumi_13TeV -m 125  --name MuImpactsRecent   --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.root   --freezeParameters lumi_13TeV -m 125  --name MuImpactsRecent   --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.root   --freezeParameters lumi_13TeV -m 125  --name MuImpactsRecent   -o latest_el_impacts_recent.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts_recent.json -o postfit_el_impacts_recent

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop.root   --freezeParameters lumi_13TeV -m 125  --name ElImpactsRecent   --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop.root   --freezeParameters lumi_13TeV -m 125  --name ElImpactsRecent   --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop.root   --freezeParameters lumi_13TeV -m 125  --name ElImpactsRecent   -o latest_mu_impacts_recent.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_recent.json -o postfit_mu_impacts_recent

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_lepMETprop.root --freezeParameters lumi_13TeV -m 125  --name BothImpactsRecent --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_lepMETprop.root --freezeParameters lumi_13TeV -m 125  --name BothImpactsRecent --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_lepMETprop.root --freezeParameters lumi_13TeV -m 125  --name BothImpactsRecent -o latest_both_impacts_recent.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_recent.json -o postfit_both_impacts_recent

-- a bit of a shift in results, not like the original test with fixedPUnorms...

latest_both_impacts_recent.json
latest_mu_impacts_recent.json
latest_el_impacts_recent.json

python new_impact_table.py --merge-pdf latest_el_impacts_recent.json latest_mu_impacts_recent.json latest_both_impacts_recent.json

$\tauh$ jet identification  &  5.1 &  4.8 &  4.8 \\
        top quark $p_{T}$  &  2.8 &  3.6 &  2.8 \\
$\tauh$ misidentification background  &  2.6 &  2.8 &  2.7 \\
        QCD normalization  &  0.4 &  1.7 &  2.3 \\
     b-tagging efficiency  &  1.9 &  2.0 &  2.2 \\
       pileup uncertainty  &  2.6 &  2.1 &  2.2 \\
     W+jets normalization  &  0.4 &  1.4 &  1.5 \\
     $\tauh$ Energy Scale  &  1.0 &  1.3 &  1.3 \\
electron trigger efficiency  &  2.7 &  1.1 \\
         jet energy scale  &  1.3 &  1.7 &  1.0 \\
       muon ID efficiency  &  0.8 &  0.8 \\
   electron ID efficiency  &  2.1 &  0.7 \\
 Single Top normalization  &  0.7 &  0.5 &  0.5 \\
         DY normalization  &  0.3 &  0.3 &  0.5 \\
  muon trigger efficiency  &  0.4 &  0.3 \\
    jet energy resolution  &  0.2 &  0.3 &  0.1 \\
   Dibosons normalization  &  0.0 &  0.0 &  0.0 \\
               Luminosity  &  0.0 &  0.0 &  0.0 \\
          b fragmentation  &  2.8 &  2.5 &  2.8 \\
  final   state radiation  &  2.0 &  2.1 &  2.0 \\
  initial state radiation  &  2.0 &  1.6 &  1.5 \\
underlying event (Pythia tune)  &  0.6 &  0.7 &  0.8 \\
ME combined scale variation  &  0.5 &  0.9 &  0.8 \\
 ME Renormalization scale  &  0.8 &  0.9 &  0.6 \\
   ME Factorization scale  &  0.3 &  0.4 &  0.4 \\
semi-leptonic b-hadron BRs  &  0.5 &  0.2 &  0.3 \\
   ME-PS matching (hdamp)  &  0.0 &  0.1 &  0.2 \\
                      PDF  &  1.4 &  1.2 &  1.3 \\
            MC statistics  &  2.9 &  1.8 &  2.4 \\


ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms.root
ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root
ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root   --freezeParameters lumi_13TeV -m 125  --name MuImpactsRecent   --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root   --freezeParameters lumi_13TeV -m 125  --name MuImpactsRecent   --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root   --freezeParameters lumi_13TeV -m 125  --name MuImpactsRecent   -o latest_el_impacts_recentOrig1.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts_recentOrig1.json -o postfit_el_impacts_recentOrig1

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root   --freezeParameters lumi_13TeV -m 125  --name ElImpactsRecent   --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root   --freezeParameters lumi_13TeV -m 125  --name ElImpactsRecent   --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root   --freezeParameters lumi_13TeV -m 125  --name ElImpactsRecent   -o latest_mu_impacts_recentOrig1.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_recentOrig1.json -o postfit_mu_impacts_recentOrig1

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms.root --freezeParameters lumi_13TeV -m 125  --name BothImpactsRecent --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms.root --freezeParameters lumi_13TeV -m 125  --name BothImpactsRecent --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms.root --freezeParameters lumi_13TeV -m 125  --name BothImpactsRecent -o latest_both_impacts_recentOrig1.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_recentOrig1.json -o postfit_both_impacts_recentOrig1

seems ok

python new_impact_table.py --merge-pdf latest_el_impacts_recentOrig1.json latest_mu_impacts_recentOrig1.json latest_both_impacts_recentOrig1.json

$\tauh$ jet identification  &  5.1 &  4.7 &  4.5 \\
       pileup uncertainty  &  2.9 &  2.4 &  2.5 \\
$\tauh$ misidentification background  &  2.8 &  2.5 &  2.4 \\
        top quark $p_{T}$  &  2.9 &  3.0 &  2.3 \\
        QCD normalization  &  0.2 &  1.2 &  1.4 \\
     b-tagging efficiency  &  1.6 &  1.5 &  1.4 \\
     W+jets normalization  &  0.3 &  1.1 &  1.1 \\
       muon ID efficiency  &  0.7 &  0.7 \\
         DY normalization  &  0.3 &  0.3 &  0.6 \\
 Single Top normalization  &  0.6 &  0.5 &  0.4 \\
electron trigger efficiency  &  2.6 &  0.4 \\
  muon trigger efficiency  &  0.4 &  0.3 \\
   electron ID efficiency  &  1.9 &  0.3 \\
     $\tauh$ Energy Scale  &  0.3 &  0.4 &  0.3 \\
    jet energy resolution  &  0.1 &  0.1 &  0.2 \\
         jet energy scale  &  0.3 &  0.2 &  0.1 \\
   Dibosons normalization  &  0.0 &  0.0 &  0.0 \\
               Luminosity  &  0.0 &  0.0 &  0.0 \\
          b fragmentation  &  2.7 &  2.6 &  2.7 \\
  final   state radiation  &  2.2 &  1.6 &  1.8 \\
  initial state radiation  &  1.9 &  1.3 &  1.3 \\
ME combined scale variation  &  0.6 &  1.1 &  0.9 \\
 ME Renormalization scale  &  0.8 &  1.2 &  0.9 \\
   ME-PS matching (hdamp)  &  0.2 &  0.6 &  0.6 \\
underlying event (Pythia tune)  &  0.5 &  0.4 &  0.5 \\
semi-leptonic b-hadron BRs  &  0.5 &  0.3 &  0.3 \\
   ME Factorization scale  &  0.3 &  0.3 &  0.1 \\
                      PDF  &  1.5 &  1.2 &  1.4 \\
            MC statistics  &  2.4 &  1.7 &  1.8 \\

damn






# covariance, correlation matrix

The last results were with PU fixed

ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root
ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root
ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms.root

correlations without PDFs:

combine -M FitDiagnostics ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root   --freezeNuisanceGroup tt_th_pdf --plots --saveShapes --saveWithUncertainties --name ElCorrel
mv covariance_fit_s.png covariance_fit_s_ElCorrel.png
combine -M FitDiagnostics ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root   --freezeNuisanceGroup tt_th_pdf --plots --saveShapes --saveWithUncertainties --name MuCorrel
mv covariance_fit_s.png covariance_fit_s_MuCorrel.png
combine -M FitDiagnostics ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms.root --freezeNuisanceGroup tt_th_pdf --plots --saveShapes --saveWithUncertainties --name BothCorrel
mv covariance_fit_s.png covariance_fit_s_BothCorrel.png

(aside: so how to do a version control?)

make it without MC stat too?

cp ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.txt   ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_noMC.txt  
cp ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.txt   ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_noMC.txt
cp ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms.txt ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_noMC.txt

vim -p ttxsec/datacard_v25v26redo_*_lnU_noQCDpu_fixPUnorms_noMC.txt

./scripts/text2workspace.py ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_noMC.txt  
./scripts/text2workspace.py ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_noMC.txt
./scripts/text2workspace.py ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_noMC.txt

combine -M FitDiagnostics ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_noMC.root   --freezeNuisanceGroup tt_th_pdf --plots --saveShapes --saveWithUncertainties --name ElCorrel
mv covariance_fit_s.png covariance_fit_s_ElCorrel.png
combine -M FitDiagnostics ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_noMC.root   --freezeNuisanceGroup tt_th_pdf --plots --saveShapes --saveWithUncertainties --name MuCorrel
mv covariance_fit_s.png covariance_fit_s_MuCorrel.png
combine -M FitDiagnostics ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_noMC.root --freezeNuisanceGroup tt_th_pdf --plots --saveShapes --saveWithUncertainties --name BothCorrel
mv covariance_fit_s.png covariance_fit_s_BothCorrel.png







# repeate acceptance study properly, the files were removed for space issues, acceptance breakdown

make merge_proc dtags=sw-dir/merge-sets/jobs_hadd.dtags.tt               nt=v34 proc=t1 merge_dir=lstore_outdirs/merge-sets/
make merge_proc dtags=sw-dir/merge-sets/jobs_hadd.dtags.tt-updowns.extra nt=v34 proc=t1 merge_dir=lstore_outdirs/merge-sets/

hadd the extras

the acceptances with systematic variations:

python print_acceptances.py --sys-weights lstore_outdirs/merge-sets/v34/t1/MC2016_Summer16_TTJets_powheg.root

nominal acceptances in all files:
python print_acceptances.py               lstore_outdirs/merge-sets/v34/t1/MC2016_Summer16_TTJets_powheg*.root

also stats:
python print_acceptances.py --sys-weights lstore_outdirs/merge-sets/v34/t1/MC2016_Summer16_TTJets_powheg.root --with-stat

"all process" of TT, not only signals, does not work in v34 which recorded only signal:
python print_acceptances.py lstore_outdirs/merge-sets/v34/t1/MC2016_Summer16_TTJets_powheg.root --sys-weights --all-procs


               eltau           0.1687     0.1689     0.1686     0.1684     0.1691     0.1685     0.1690     0.1688     0.1686     0.1687     0.1688     0.1683     0.1684     0.1690     0.1686     0.1686     0.1685     0.1683     0.1691     0.1689     0.1686     0.1681     0.1691     0.1687     0.1687     0.1686     0.1688     0.1692     0.1682     0.1688     0.1684     0.1684     0.1690     0.1691     0.1683     0.1687     0.1688     0.1687     0.1687     0.1688     0.1686     0.1685     0.1691     0.1686     0.1689     0.1689     0.1683     0.1689     0.1686     0.1684     0.1691     0.1682     0.1693     0.1688     0.1687     0.1686     0.1681     0.1682     0.1683     0.1688     0.1687     0.1689     0.1688     0.1687     0.1687     0.0000     0.0000     0.0000     0.0000     0.0000     0.0000     0.0000     0.0000     0.0000
               mutau           0.1756     0.1759     0.1756     0.1754     0.1761     0.1756     0.1760     0.1758     0.1756     0.1757     0.1758     0.1753     0.1754     0.1760     0.1755     0.1757     0.1755     0.1752     0.1762     0.1759     0.1755     0.1749     0.1762     0.1757     0.1757     0.1756     0.1758     0.1763     0.1751     0.1759     0.1754     0.1754     0.1760     0.1761     0.1753     0.1756     0.1758     0.1756     0.1757     0.1758     0.1756     0.1755     0.1761     0.1756     0.1759     0.1760     0.1753     0.1759     0.1756     0.1754     0.1761     0.1752     0.1763     0.1757     0.1757     0.1755     0.1751     0.1752     0.1752     0.1757     0.1757     0.1760     0.1758     0.1757     0.1758     0.0000     0.0000     0.0000     0.0000     0.0000     0.0000     0.0000     0.0000     0.0000
                 sum           0.1722     0.1724     0.1721     0.1719     0.1726     0.1721     0.1725     0.1723     0.1721     0.1722     0.1723     0.1718     0.1719     0.1725     0.1721     0.1722     0.1720     0.1717     0.1727     0.1724     0.1721     0.1715     0.1726     0.1722     0.1722     0.1721     0.1723     0.1727     0.1717     0.1724     0.1719     0.1719     0.1725     0.1726     0.1718     0.1722     0.1723     0.1721     0.1722     0.1723     0.1721     0.1720     0.1726     0.1721     0.1724     0.1725     0.1718     0.1724     0.1721     0.1719     0.1726     0.1717     0.1728     0.1722     0.1722     0.1720     0.1716     0.1717     0.1717     0.1723     0.1722     0.1725     0.1723     0.1722     0.1722     0.0000     0.0000     0.0000     0.0000     0.0000     0.0000     0.0000     0.0000     0.0000

               eltau           0.1687     0.1689     0.1686     0.1684     0.1691     0.1685     0.1690     0.1688     0.1686     0.1687     0.1688     0.1683     0.1684     0.1690     0.1686     0.1686     0.1685     0.1683     0.1691     0.1689     0.1686     0.1681     0.1691     0.1687     0.1687     0.1686     0.1688     0.1692     0.1682     0.1688     0.1684     0.1684     0.1690     0.1691     0.1683     0.1687     0.1688     0.1687     0.1687     0.1688     0.1686     0.1685     0.1691     0.1686     0.1689     0.1689     0.1683     0.1689     0.1686     0.1684     0.1691     0.1682     0.1693     0.1688     0.1687     0.1686     0.1681     0.1682     0.1683     0.1688     0.1687     0.1689     0.1688     0.1687     0.1687
               mutau           0.1756     0.1759     0.1756     0.1754     0.1761     0.1756     0.1760     0.1758     0.1756     0.1757     0.1758     0.1753     0.1754     0.1760     0.1755     0.1757     0.1755     0.1752     0.1762     0.1759     0.1755     0.1749     0.1762     0.1757     0.1757     0.1756     0.1758     0.1763     0.1751     0.1759     0.1754     0.1754     0.1760     0.1761     0.1753     0.1756     0.1758     0.1756     0.1757     0.1758     0.1756     0.1755     0.1761     0.1756     0.1759     0.1760     0.1753     0.1759     0.1756     0.1754     0.1761     0.1752     0.1763     0.1757     0.1757     0.1755     0.1751     0.1752     0.1752     0.1757     0.1757     0.1760     0.1758     0.1757     0.1758
                 sum           0.1722     0.1724     0.1721     0.1719     0.1726     0.1721     0.1725     0.1723     0.1721     0.1722     0.1723     0.1718     0.1719     0.1725     0.1721     0.1722     0.1720     0.1717     0.1727     0.1724     0.1721     0.1715     0.1726     0.1722     0.1722     0.1721     0.1723     0.1727     0.1717     0.1724     0.1719     0.1719     0.1725     0.1726     0.1718     0.1722     0.1723     0.1721     0.1722     0.1723     0.1721     0.1720     0.1726     0.1721     0.1724     0.1725     0.1718     0.1724     0.1721     0.1719     0.1726     0.1717     0.1728     0.1722     0.1722     0.1720     0.1716     0.1717     0.1717     0.1723     0.1722     0.1725     0.1723     0.1722     0.1722


nice table is done
-- merge groups of systematics
   Done

$ python print_acceptances.py --sys-weights lstore_outdirs/merge-sets/v34/t1/MC2016_Summer16_TTJets_powheg*.root --devs merge_files --with-stat
INFO:root:import ROOT
INFO:root:done
                               eltau      mutau        sum
 nominal_0 nom                           0.1687 +- 0.0004     0.1756 +- 0.0004     0.1722 +- 0.0003
 nominal_0 scales                        0.0006 +- 0.0000     0.0008 +- 0.0000     0.0007 +- 0.0000
 nominal_0 alphas                        0.0002 +- 0.0000     0.0002 +- 0.0000     0.0002 +- 0.0000
 nominal_0 pdfs                          0.0022 +- 0.0000     0.0025 +- 0.0000     0.0023 +- 0.0000
      tune nom                           0.0006 +- 0.0004     0.0005 +- 0.0004     0.0005 +- 0.0003
     hdamp nom                           0.0020 +- 0.0004     0.0026 +- 0.0004     0.0023 +- 0.0003
       isr nom                           0.0012 +- 0.0003     0.0006 +- 0.0003     0.0008 +- 0.0002
       fsr nom                           0.0047 +- 0.0003     0.0049 +- 0.0003     0.0048 +- 0.0002

separated scales:

$ python print_acceptances.py --sys-weights lstore_outdirs/merge-sets/v34/t1/MC2016_Summer16_TTJets_powheg*.root --devs merge_files_rel --how-print cols
INFO:root:import ROOT
INFO:root:done
                               eltau      mutau        sum
 nominal_0 nom                           0.1687     0.1756     0.1722
 nominal_0 scales_renorm                 0.0010     0.0018     0.0014
 nominal_0 scales_refact                 0.0029     0.0030     0.0029
 nominal_0 scales_both                   0.0021     0.0025     0.0022
 nominal_0 pdfs                          0.0129     0.0141     0.0133
      tune nom                           0.0035     0.0027     0.0030
     hdamp nom                           0.0119     0.0147     0.0133
       isr nom                           0.0071     0.0035     0.0047
       fsr nom                           0.0280     0.0281     0.0281

python print_acceptances.py --sys-weights lstore_outdirs/merge-sets/v34/t1/MC2016_Summer16_TTJets_powheg*.root --devs merge_files

INFO:root:import ROOT
INFO:root:done
             channel               nominal_0 nom      nominal_0 scales      nominal_0 alphas        nominal_0 pdfs              tune nom             hdamp nom               isr nom               fsr nom
               eltau                      0.1687                0.0006                0.0002                0.0022                0.0006                0.0020                0.0012                0.0047
               mutau                      0.1756                0.0008                0.0002                0.0025                0.0005                0.0026                0.0006                0.0049
                 sum                      0.1722                0.0007                0.0002                0.0023                0.0005                0.0023                0.0008                0.0048

sqrt(sum([0.0006                0.0002                0.0022                0.0006                0.0020                0.0012                0.0047].^2))
0.005755866572463264

sqrtsum(x) = sqrt(sum(x.^2))

acc_el_err = sqrtsum([0.0006                0.0002                0.0022                0.0006                0.0020                0.0012                0.0047])
0.005755866572463264

acc_mu_err = sqrtsum([0.0008                0.0002                0.0025                0.0005                0.0026                0.0006                0.0049])
0.006189507250177513

sacc_bt_err = qrtsum([0.0007                0.0002                0.0023                0.0005                0.0023                0.0008                0.0048])
0.0059194594347794964



found a mistake in AN: the electron and muon systematics are flipped!

acc_mu_err = sum(([0.1759     0.1756     0.1754     0.1761     0.1756     0.1760     0.1758     0.1756     0.1757     0.1758     0.1753     0.1754     0.1760     0.1755     0.1757     0.1755     0.1752     0.1762     0.1759     0.1755     0.1749     0.1762     0.1757     0.1757     0.1756     0.1758     0.1763     0.1751     0.1759     0.1754     0.1754     0.1760     0.1761     0.1753     0.1756     0.1758     0.1756     0.1757     0.1758     0.1756     0.1755     0.1761     0.1756     0.1759     0.1760     0.1753     0.1759     0.1756     0.1754     0.1761     0.1752     0.1763     0.1757     0.1757     0.1755     0.1751     0.1752     0.1752     0.1757     0.1757     0.1760     0.1758     0.1757     0.1758] - 0.1756) .^ 2) ^ 0.5
0.0025455844122715655

acc_el_err = sum(([0.1689     0.1686     0.1684     0.1691     0.1685     0.1690     0.1688     0.1686     0.1687     0.1688     0.1683     0.1684     0.1690     0.1686     0.1686     0.1685     0.1683     0.1691     0.1689     0.1686     0.1681     0.1691     0.1687     0.1687     0.1686     0.1688     0.1692     0.1682     0.1688     0.1684     0.1684     0.1690     0.1691     0.1683     0.1687     0.1688     0.1687     0.1687     0.1688     0.1686     0.1685     0.1691     0.1686     0.1689     0.1689     0.1683     0.1689     0.1686     0.1684     0.1691     0.1682     0.1693     0.1688     0.1687     0.1686     0.1681     0.1682     0.1683     0.1688     0.1687     0.1689     0.1688     0.1687     0.1687] - 0.1687) .^ 2) ^ 0.5
0.0022605309110914646

but the AN reports reversed numbers: 25 for electron and 22 for muon channels

Also, clearly if does not include the FSR-ISR?
-- where do I normalize to FSR-ISR acceptance?
   in stack_plot, and the FSR-ISR acceptance deviations are a bit smaller, by about factor of 2 -- different handling of up-down?




# fix of met propagation in jes and jer

python jobsums/get_shapes.py  --norm-binwidth --formula " OLD : NEW " -c el_selVloose -d Mt_lep_met_f -p tt_lj    NEW:quick-test/v25v26-resub4_hadds/MC2016_Summer16_TTJets_powheg.root OLD:quick-test/v25v26-resub3_hadds/MC2016_Summer16_TTJets_powheg.root
python jobsums/get_shapes.py  --norm-binwidth --formula " OLD : NEW " -c el_selVloose -d Mt_lep_met_f -p tt_eltau NEW:quick-test/v25v26-resub4_hadds/MC2016_Summer16_TTJets_powheg.root OLD:quick-test/v25v26-resub3_hadds/MC2016_Summer16_TTJets_powheg.root

-- same OK

python jobsums/get_shapes.py  --norm-binwidth --formula " OLD : NEW " -c el_selVloose -s JESUp   -d Mt_lep_met_f -p tt_lj    NEW:quick-test/v25v26-resub4_hadds/MC2016_Summer16_TTJets_powheg.root OLD:quick-test/v25v26-resub3_hadds/MC2016_Summer16_TTJets_powheg.root
python jobsums/get_shapes.py  --norm-binwidth --formula " OLD : NEW " -c el_selVloose -s JESUp   -d Mt_lep_met_f -p tt_eltau NEW:quick-test/v25v26-resub4_hadds/MC2016_Summer16_TTJets_powheg.root OLD:quick-test/v25v26-resub3_hadds/MC2016_Summer16_TTJets_powheg.root

python jobsums/get_shapes.py  --norm-binwidth --formula " OLD : NEW " -c el_selVloose -s JESDown -d Mt_lep_met_f -p tt_lj    NEW:quick-test/v25v26-resub4_hadds/MC2016_Summer16_TTJets_powheg.root OLD:quick-test/v25v26-resub3_hadds/MC2016_Summer16_TTJets_powheg.root
python jobsums/get_shapes.py  --norm-binwidth --formula " OLD : NEW " -c el_selVloose -s JESDown -d Mt_lep_met_f -p tt_eltau NEW:quick-test/v25v26-resub4_hadds/MC2016_Summer16_TTJets_powheg.root OLD:quick-test/v25v26-resub3_hadds/MC2016_Summer16_TTJets_powheg.root


python jobsums/get_shapes.py  --norm-binwidth --formula " OLD : NEW " -c el_selVloose -s JERUp   -d Mt_lep_met_f -p tt_lj    NEW:quick-test/v25v26-resub4_hadds/MC2016_Summer16_TTJets_powheg.root OLD:quick-test/v25v26-resub3_hadds/MC2016_Summer16_TTJets_powheg.root
python jobsums/get_shapes.py  --norm-binwidth --formula " OLD : NEW " -c el_selVloose -s JERUp   -d Mt_lep_met_f -p tt_eltau NEW:quick-test/v25v26-resub4_hadds/MC2016_Summer16_TTJets_powheg.root OLD:quick-test/v25v26-resub3_hadds/MC2016_Summer16_TTJets_powheg.root

python jobsums/get_shapes.py  --norm-binwidth --formula " OLD : NEW " -c el_selVloose -s JERDown -d Mt_lep_met_f -p tt_lj    NEW:quick-test/v25v26-resub4_hadds/MC2016_Summer16_TTJets_powheg.root OLD:quick-test/v25v26-resub3_hadds/MC2016_Summer16_TTJets_powheg.root
python jobsums/get_shapes.py  --norm-binwidth --formula " OLD : NEW " -c el_selVloose -s JERDown -d Mt_lep_met_f -p tt_eltau NEW:quick-test/v25v26-resub4_hadds/MC2016_Summer16_TTJets_powheg.root OLD:quick-test/v25v26-resub3_hadds/MC2016_Summer16_TTJets_powheg.root

python mc_per_sys.py v25v26resub3_tt.root -p tt_lj    -c el_sel -d Mt_lep_met_f -s JESUp,JESDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]"
python mc_per_sys.py v25v26resub3_tt.root -p tt_eltau -c el_sel -d Mt_lep_met_f -s JESUp,JESDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]"

python mc_per_sys.py v25v26resub4_tt.root -p tt_lj    -c el_sel -d Mt_lep_met_f -s JESUp,JESDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]"
python mc_per_sys.py v25v26resub4_tt.root -p tt_eltau -c el_sel -d Mt_lep_met_f -s JESUp,JESDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]"

-- all the same!
python jobsums/get_shapes.py  --norm-binwidth --formula " OLD : NEW " -c el_selVloose -s JERDown -d Mt_lep_met_f -p tt_eltau NEW:quick-test/v25v26-resub4_hadds/MC2016_Summer16_TTJets_powheg.root OLD:quick-test/v25v26-resub2_hadds/MC2016_Summer16_TTJets_powheg.root

-- also the same....

root -l lstore_outdirs/merge-sets/v26/resub2/MC2016_Summer16_TTJets_powheg.root lstore_outdirs/merge-sets/v25v26/resub4/MC2016_Summer16_TTJets_powheg.root

_file0->Get("ttree_out")->Draw("event_met_lep_mt_JERUp>>h(200,0,400)")
TH1D* h0 = (TH1D*) ((TTree*) _file0->Get("ttree_out"))->GetHistogram()
h0->SetDirectory(0)
h0->SetName("old")

_file1->Get("ttree_out")->Draw("event_met_lep_mt_JERUp>>h(200,0,400)")
TH1D* h1 = (TH1D*) ((TTree*) _file1->Get("ttree_out"))->GetHistogram()
h1->SetDirectory(0)
h1->SetName("new")

h0->SetLineColor(kRed)

h0->Draw()
h1->Draw("same")

-- they are slightly different..

h0->Divide(h1)
h0->Draw()

-- indeed there is a difference

ratio in plotting:

h0 = (TH1D*) _file0->Get("el_selVloose/tt_eltau/NOMINAL/el_selVloose_tt_eltau_NOMINAL_Mt_lep_met_f")
h1 = (TH1D*) _file1->Get("el_selVloose/tt_eltau/NOMINAL/el_selVloose_tt_eltau_NOMINAL_Mt_lep_met_f")

h0->SetLineColor(kRed)

h0->Draw()
h1->Draw("same")

h0->Divide(h1)
h0->Draw()

-- exactly the same, = 1


Check the original difference in a final selection:

((TTree*) _file0->Get("ttree_out"))->Draw("event_met_lep_mt_JERUp>>h(200,0,400)", "selection_stage==9 || selection_stage==7")
TH1D* h0 = (TH1D*) ((TTree*) _file0->Get("ttree_out"))->GetHistogram()
h0->SetDirectory(0)
h0->SetName("old")

((TTree*) _file1->Get("ttree_out"))->Draw("event_met_lep_mt_JERUp>>h(200,0,400)", "selection_stage==9 || selection_stage==7")
TH1D* h1 = (TH1D*) ((TTree*) _file1->Get("ttree_out"))->GetHistogram()
h1->SetDirectory(0)
h1->SetName("new")

-- practically no difference

((TTree*) _file0->Get("ttree_out"))->Draw("event_met_lep_mt_JESUp>>h(200,0,400)", "selection_stage==9 || selection_stage==7")
TH1D* h0 = (TH1D*) ((TTree*) _file0->Get("ttree_out"))->GetHistogram()
h0->SetDirectory(0)
h0->SetName("old")

((TTree*) _file1->Get("ttree_out"))->Draw("event_met_lep_mt_JESUp>>h(200,0,400)", "selection_stage==9 || selection_stage==7")
TH1D* h1 = (TH1D*) ((TTree*) _file1->Get("ttree_out"))->GetHistogram()
h1->SetDirectory(0)
h1->SetName("new")

-- practically no difference here too






# uncertainties with ratio to 17-001

elmu

804.1  2.3 ( stat )  31.2 ( syst )  19.6 ( lum ) pb.

\sigma_{\ttbar}(\ell\tau) &= 783 \pm  7 \rm{(stat.)} \pm 60 \rm{(syst.)} \pm 20 \rm{(lumi.)} pb.

dilep  = 804.1
leptau = 783.
ratio = leptau / dilep
0.9737594826514114

lumi_dilep  = 2.44
lumi_leptau = 2.5
unc_lumi = sqrt((lumi_dilep - lumi_leptau)^2)
0.06000000000000005

stat_dilep  = 0.29
stat_leptau = 0.7
unc_stats = sqrt(stat_dilep^2 + stat_leptau^2)
0.7576938695805846

Combined systematic =
unc_syst = 7.44

ratio .* [unc_stats unc_syst unc_lumi] ./ 100
 0.00737812  0.0724477  0.000584256


and text

\subsection{Ratio to the dilepton cross section and partial width}
\label{sec:ratio_dilep}

The ratio of the cross-section of the simultaneous fit in the lepton-tau final state %$\sigma_{\ttbar}(\ell\tau)$
divided by the dilepton cross section measurement~\cite{Sirunyan:2018goh} from the same 2016 data-taking period is calculated
by accounting for the uncertainties correlated as in the Table~\ref{tab:ratiosyscorr}.
The ratio provides the cancellation of the common uncertainties.
%The ratio provides access to $Br(W\rightarrow\tau)/Br(W\rightarrow\ell)$
% Say somethings about the cancelation of systematics?
% Better about the method overal
For the combined systematic uncertainty of the ratio,
the uncorrelated sources of uncertainty are added in quadrature, while
the combined uncertainty of the correlated sources is estimated as the difference $|\delta_{\ell\tau} - \delta_{\ell\ell}|$,
where $\delta_{\ell\tau}$ and $\delta_{\ell\ell}$ are the relative uncertainties in the lepton-tau and dilepton cross section measurements, respectively.
The ratio is estimated to be $R_{\ell\tauh/\ell\ell}=0.974 \pm 0.007 \rm{(stat.)} \pm 0.072 \rm{(syst.)} \pm 0.001 \rm{(lumi.)}$, consistent with lepton universality.

We also estimate the ratio of the partial to the total width, $R_{\Gamma}=\Gamma(t\rightarrow\tauh\nu_{\tau}b)/\Gamma_{\rm total}$.
In the measurement, the cross section in the $\ell\tauh$ final state is multiplied by the BR($W\rightarrow\tauh\nu_\tau$)~\cite{PDG2016}
and divided by the \ttbar dilepton cross section~\cite{Sirunyan:2018goh}.
%The measurement is in the channel $\ttbar\rightarrow (b\ell\nu_{\ell})(b\tauh\nu_{\tauh})$, where $\tau$ decays into hadrons ($\tauh$), and \ell (\ell=e,\mu$) include \ell from \tau decays.
The result yields the value $R_{\Gamma}=0.1047 \pm 0.0008 \rm{(stat.)} \pm 0.0077 \rm{(syst.)} \pm 0.0001 \rm{(lumi.)}$.


((TTree*) ntupler->Get("reduced_ttree"))->GetEntries()
((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(gen_t_w_decay_id)  > 14")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(gen_tb_w_decay_id) > 14")







# fir with tight, shaped and not shaped

./scripts/text2workspace.py ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight.txt
./scripts/text2workspace.py ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c.txt
./scripts/text2workspace.py ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c2.txt

./scripts/text2workspace.py ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c.txt
./scripts/text2workspace.py ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_shaped_Tight_c.txt

just get the impacts in
mt_f and mt_c
el   and mu

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit           --name ElImpactsTight
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5    --name ElImpactsTight
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight.root   --freezeParameters lumi_13TeV  -m 125 -o latest_el_impacts_resub3_Tight.json --name ElImpactsTight
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts_resub3_Tight.json -o postfit_el_impacts_resub3_Tight

0.924 +- 0.109

high qcd norm, which is pulled, and mc stat bins, which are also constrained

python ttxsec/fit-stuff/new_impact_table.py --merge-pdf latest_el_impacts_resub3_Tight.json

$\tauh$ jet identification  &  4.9 \\
        QCD normalization  &  4.4 \\
        top quark $p_{T}$  &  3.7 \\
electron trigger efficiency  &  2.1 \\
       pileup uncertainty  &  2.0 \\
     $\tauh$ Energy Scale  &  2.0 \\
   electron ID efficiency  &  1.6 \\
     b-tagging efficiency  &  1.0 \\
         jet energy scale  &  1.0 \\
 Single Top normalization  &  0.7 \\
$\tauh$ misidentification background  &  0.6 \\
    jet energy resolution  &  0.5 \\
         DY normalization  &  0.1 \\
     W+jets normalization  &  0.0 \\
   Dibosons normalization  &  0.0 \\
               Luminosity  &  0.0 \\
          b fragmentation  &  2.8 \\
  final   state radiation  &  2.6 \\
  initial state radiation  &  1.8 \\
semi-leptonic b-hadron BRs  &  0.4 \\
 ME Renormalization scale  &  0.4 \\
   ME-PS matching (hdamp)  &  0.4 \\
underlying event (Pythia tune)  &  0.3 \\
ME combined scale variation  &  0.2 \\
   ME Factorization scale  &  0.2 \\
                      PDF  &  1.3 \\
            MC statistics  & 12.8 \\

-- check mt_c and check shaped



../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c2.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit              --name ElImpactsTight

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c2.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5       --name ElImpactsTight
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c2.root --freezeParameters lumi_13TeV  -m 125 -o latest_el_impacts_resub3_Tight_c2.json --name ElImpactsTight
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts_resub3_Tight_c2.json -o postfit_el_impacts_resub3_Tight_c2

   r :    +0.992   -0.103/+0.115 (68%)

$\tauh$ jet identification  &  5.1 \\
         jet energy scale  &  4.1 \\
        top quark $p_{T}$  &  3.9 \\
        QCD normalization  &  3.8 \\
       pileup uncertainty  &  2.3 \\
     $\tauh$ Energy Scale  &  1.6 \\
electron trigger efficiency  &  1.4 \\
$\tauh$ misidentification background  &  1.3 \\
   electron ID efficiency  &  1.1 \\
 Single Top normalization  &  0.7 \\
     b-tagging efficiency  &  0.5 \\
    jet energy resolution  &  0.4 \\
         DY normalization  &  0.2 \\
     W+jets normalization  &  0.1 \\
   Dibosons normalization  &  0.0 \\
               Luminosity  &  0.0 \\
          b fragmentation  &  3.5 \\
  final   state radiation  &  2.7 \\
  initial state radiation  &  1.7 \\
   ME Factorization scale  &  0.6 \\
 ME Renormalization scale  &  0.6 \\
semi-leptonic b-hadron BRs  &  0.5 \\
   ME-PS matching (hdamp)  &  0.4 \\
underlying event (Pythia tune)  &  0.4 \\
ME combined scale variation  &  0.1 \\
                      PDF  &  1.5 \\
            MC statistics  &  7.6 \\

just c then?


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit              --name ElImpactsTight
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5       --name ElImpactsTight
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c.root --freezeParameters lumi_13TeV  -m 125 -o latest_el_impacts_resub3_Tight_c.json --name ElImpactsTight
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts_resub3_Tight_c.json -o postfit_el_impacts_resub3_Tight_c

0.973 +- 0.104

python ttxsec/fit-stuff/new_impact_table.py --merge-pdf latest_el_impacts_resub3_Tight_c.json

$\tauh$ jet identification  &  5.1 \\
        top quark $p_{T}$  &  3.3 \\
         jet energy scale  &  3.2 \\
        QCD normalization  &  3.2 \\
       pileup uncertainty  &  2.4 \\
electron trigger efficiency  &  2.1 \\
   electron ID efficiency  &  1.6 \\
$\tauh$ misidentification background  &  1.3 \\
     $\tauh$ Energy Scale  &  1.3 \\
     b-tagging efficiency  &  1.2 \\
 Single Top normalization  &  0.7 \\
    jet energy resolution  &  0.5 \\
         DY normalization  &  0.2 \\
     W+jets normalization  &  0.1 \\
   Dibosons normalization  &  0.0 \\
               Luminosity  &  0.0 \\
          b fragmentation  &  2.9 \\
  final   state radiation  &  2.7 \\
  initial state radiation  &  1.8 \\
   ME Factorization scale  &  0.7 \\
 ME Renormalization scale  &  0.7 \\
semi-leptonic b-hadron BRs  &  0.5 \\
underlying event (Pythia tune)  &  0.4 \\
   ME-PS matching (hdamp)  &  0.2 \\
ME combined scale variation  &  0.1 \\
                      PDF  &  1.5 \\
            MC statistics  &  6.2 \\

-- vloose shapes?


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_shaped_Tight_c.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit              --name ElImpactsTight
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_shaped_Tight_c.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5       --name ElImpactsTight
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_shaped_Tight_c.root --freezeParameters lumi_13TeV  -m 125 -o latest_el_impacts_resub3_shaped_Tight_c.json --name ElImpactsTight
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts_resub3_shaped_Tight_c.json -o postfit_el_impacts_resub3_shaped_Tight_c

   r :    +1.023   -0.105/+0.112 (68%)

python ttxsec/fit-stuff/new_impact_table.py --merge-pdf latest_el_impacts_resub3_shaped_Tight_c.json

$\tauh$ jet identification  &  5.5 \\
         jet energy scale  &  4.0 \\
        top quark $p_{T}$  &  3.8 \\
       pileup uncertainty  &  2.7 \\
electron trigger efficiency  &  2.5 \\
     b-tagging efficiency  &  2.4 \\
$\tauh$ misidentification background  &  2.4 \\
   electron ID efficiency  &  1.9 \\
        QCD normalization  &  1.5 \\
     $\tauh$ Energy Scale  &  0.9 \\
 Single Top normalization  &  0.6 \\
     W+jets normalization  &  0.6 \\
    jet energy resolution  &  0.5 \\
         DY normalization  &  0.1 \\
   Dibosons normalization  &  0.0 \\
               Luminosity  &  0.0 \\
  final   state radiation  &  3.7 \\
          b fragmentation  &  2.9 \\
  initial state radiation  &  2.3 \\
   ME Factorization scale  &  0.8 \\
semi-leptonic b-hadron BRs  &  0.7 \\
 ME Renormalization scale  &  0.6 \\
underlying event (Pythia tune)  &  0.4 \\
ME combined scale variation  &  0.4 \\
   ME-PS matching (hdamp)  &  0.4 \\
                      PDF  &  1.6 \\
            MC statistics  &  2.3 \\

-- as before

(error in jes btw?)

for muons and both, only mt_c, noshape and shape

shaped

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_shaped_Tight_c.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit              --name ElImpactsTight
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_shaped_Tight_c.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5       --name ElImpactsTight
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_shaped_Tight_c.root --freezeParameters lumi_13TeV  -m 125 -o latest_mu_impacts_resub3_shaped_Tight_c.json --name ElImpactsTight
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_resub3_shaped_Tight_c.json -o postfit_mu_impacts_resub3_shaped_Tight_c

   r :    +0.973   -0.096/+0.095 (68%)

python ttxsec/fit-stuff/new_impact_table.py --merge-pdf latest_mu_impacts_resub3_shaped_Tight_c.json

$\tauh$ jet identification  &  5.0 \\
         jet energy scale  &  4.4 \\
        top quark $p_{T}$  &  2.7 \\
$\tauh$ misidentification background  &  2.7 \\
     b-tagging efficiency  &  2.4 \\
     W+jets normalization  &  2.3 \\
       pileup uncertainty  &  1.5 \\
     $\tauh$ Energy Scale  &  1.1 \\
       muon ID efficiency  &  0.9 \\
 Single Top normalization  &  0.6 \\
    jet energy resolution  &  0.4 \\
  muon trigger efficiency  &  0.3 \\
         DY normalization  &  0.2 \\
        QCD normalization  &  0.1 \\
   Dibosons normalization  &  0.0 \\
               Luminosity  &  0.0 \\
  final   state radiation  &  4.2 \\
          b fragmentation  &  3.0 \\
  initial state radiation  &  2.1 \\
underlying event (Pythia tune)  &  2.0 \\
   ME-PS matching (hdamp)  &  1.6 \\
ME combined scale variation  &  0.8 \\
 ME Renormalization scale  &  0.5 \\
semi-leptonic b-hadron BRs  &  0.3 \\
   ME Factorization scale  &  0.3 \\
                      PDF  &  2.8 \\
            MC statistics  &  4.6 \\

damn...
but it must be smaller than electron!!!


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit              --name ElImpactsTight
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5       --name ElImpactsTight
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c.root --freezeParameters lumi_13TeV  -m 125 -o latest_mu_impacts_resub3_Tight_c.json --name ElImpactsTight
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_resub3_Tight_c.json -o postfit_mu_impacts_resub3_Tight_c

python ttxsec/fit-stuff/new_impact_table.py --merge-pdf latest_mu_impacts_resub3_Tight_c.json

   r :    +0.962   -0.081/+0.097 (68%)

$\tauh$ jet identification  &  5.1 \\
        top quark $p_{T}$  &  3.5 \\
     $\tauh$ Energy Scale  &  2.4 \\
$\tauh$ misidentification background  &  2.4 \\
     b-tagging efficiency  &  1.8 \\
       pileup uncertainty  &  1.7 \\
         jet energy scale  &  1.3 \\
       muon ID efficiency  &  0.9 \\
 Single Top normalization  &  0.6 \\
        QCD normalization  &  0.6 \\
     W+jets normalization  &  0.5 \\
    jet energy resolution  &  0.3 \\
  muon trigger efficiency  &  0.3 \\
         DY normalization  &  0.1 \\
   Dibosons normalization  &  0.0 \\
               Luminosity  &  0.0 \\
  final   state radiation  &  2.8 \\
          b fragmentation  &  2.3 \\
  initial state radiation  &  1.9 \\
 ME Renormalization scale  &  0.9 \\
underlying event (Pythia tune)  &  0.7 \\
ME combined scale variation  &  0.5 \\
semi-leptonic b-hadron BRs  &  0.3 \\
   ME Factorization scale  &  0.2 \\
   ME-PS matching (hdamp)  &  0.2 \\
                      PDF  &  1.4 \\
            MC statistics  &  3.6 \\

????
some nonesense happened

python stack_plot.py distrs/distrs_v25v26_resub3_mc.root ../quick-test/v25v26-resub3_hadds/SingleMuon.root -r -p -o plots/redo-v25-v26_resub3_check-for-histosels/ --lumi 35800 -c mu_selTight_lj    -x mu_selVloose_lj    -d Mt_lep_met_c --wjet 0.8 --qcd 1.05 --sys NOMINAL
python stack_plot.py distrs/distrs_v25v26_resub3_mc.root ../quick-test/v25v26-resub3_hadds/SingleMuon.root -r -p -o plots/redo-v25-v26_resub3_check-for-histosels/ --lumi 35800 -c mu_selTight_ljout -x mu_selVloose_ljout -d Mt_lep_met_c --wjet 0.8 --qcd 1.05 --sys NOMINAL

python stack_plot.py distrs/distrs_v25v26_resub3_mc.root ../quick-test/v25v26-resub3_hadds/SingleMuon.root -r -p -o plots/redo-v25-v26_resub3_check-for-histosels/ --lumi 35800 -c mu_selTight_lj    -d Mt_lep_met_c --wjet 0.8 --qcd 1.05 --sys NOMINAL
python stack_plot.py distrs/distrs_v25v26_resub3_mc.root ../quick-test/v25v26-resub3_hadds/SingleMuon.root -r -p -o plots/redo-v25-v26_resub3_check-for-histosels/ --lumi 35800 -c mu_selTight_ljout -d Mt_lep_met_c --wjet 0.8 --qcd 1.05 --sys NOMINAL


python stack_plot.py distrs/distrs_v25v26_resub3_mc.root ../quick-test/v25v26-resub3_hadds/SingleMuon.root -r -p -o plots/redo-v25-v26_resub3_check-for-histosels/ --lumi 35800 -c mu_selTight_lj    -d Mt_lep_met_c --wjet 0.8 --qcd 1.05 --sys NOMINAL --cumulative-fractions
python stack_plot.py distrs/distrs_v25v26_resub3_mc.root ../quick-test/v25v26-resub3_hadds/SingleMuon.root -r -p -o plots/redo-v25-v26_resub3_check-for-histosels/ --lumi 35800 -c mu_selTight_ljout -d Mt_lep_met_c --wjet 0.8 --qcd 1.05 --sys NOMINAL --cumulative-fractions


both, shaped

./scripts/text2workspace.py ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight.txt
./scripts/text2workspace.py ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c.txt
./scripts/text2workspace.py ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c2.txt


./scripts/text2workspace.py ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c.txt
./scripts/text2workspace.py ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_shaped_Tight_c.txt

combineCards.py mu=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_shaped_Tight_c.txt el=ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_shaped_Tight_c.txt > ttxsec/both_tight_shaped_c.txt

./scripts/text2workspace.py ttxsec/both_tight_shaped_c.txt

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/both_tight_shaped_c.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit              --name BothTightShapedC
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/both_tight_shaped_c.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5       --name BothTightShapedC
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/both_tight_shaped_c.root --freezeParameters lumi_13TeV  -m 125 -o latest_impacts_resub3_both_Tight_shaped_c.json  --name BothTightShapedC
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_impacts_resub3_both_Tight_shaped_c.json -o postfit_impacts_both_resub3_Tight_shaped_c

   r :    +1.000   -0.086/+0.092 (68%)

(wow)

python ttxsec/fit-stuff/new_impact_table.py --merge-pdf latest_impacts_resub3_both_Tight_shaped_c.json

$\tauh$ jet identification  &  5.3 \\
         jet energy scale  &  4.7 \\
        top quark $p_{T}$  &  2.8 \\
$\tauh$ misidentification background  &  2.7 \\
     b-tagging efficiency  &  2.2 \\
       pileup uncertainty  &  1.9 \\
     W+jets normalization  &  1.1 \\
     $\tauh$ Energy Scale  &  0.9 \\
       muon ID efficiency  &  0.8 \\
 Single Top normalization  &  0.6 \\
    jet energy resolution  &  0.5 \\
electron trigger efficiency  &  0.4 \\
        QCD normalization  &  0.3 \\
  muon trigger efficiency  &  0.3 \\
         DY normalization  &  0.2 \\
   electron ID efficiency  &  0.2 \\
   Dibosons normalization  &  0.0 \\
               Luminosity  &  0.0 \\
  final   state radiation  &  3.3 \\
          b fragmentation  &  2.2 \\
  initial state radiation  &  2.0 \\
underlying event (Pythia tune)  &  0.8 \\
 ME Renormalization scale  &  0.5 \\
   ME Factorization scale  &  0.4 \\
semi-leptonic b-hadron BRs  &  0.3 \\
   ME-PS matching (hdamp)  &  0.3 \\
ME combined scale variation  &  0.1 \\
                      PDF  &  1.5 \\
            MC statistics  &  2.2 \\

-- how???


combineCards.py mu=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c.txt el=ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_Tight_c.txt > ttxsec/both_tight_c.txt

./scripts/text2workspace.py ttxsec/both_tight_c.txt

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/both_tight_c.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit              --name BothTightC
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/both_tight_c.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5       --name BothTightC
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/both_tight_c.root --freezeParameters lumi_13TeV  -m 125 -o latest_impacts_resub3_both_Tight_c.json  --name BothTightC
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_impacts_resub3_both_Tight_c.json -o postfit_impacts_both_resub3_Tight_c

   r :    +0.967   -0.080/+0.088 (68%)

python ttxsec/fit-stuff/new_impact_table.py --merge-pdf latest_impacts_resub3_both_Tight_c.json

$\tauh$ jet identification  &  5.0 \\
        top quark $p_{T}$  &  2.8 \\
     $\tauh$ Energy Scale  &  2.7 \\
$\tauh$ misidentification background  &  2.0 \\
       pileup uncertainty  &  2.0 \\
         jet energy scale  &  1.7 \\
     b-tagging efficiency  &  1.1 \\
        QCD normalization  &  0.7 \\
 Single Top normalization  &  0.6 \\
       muon ID efficiency  &  0.5 \\
electron trigger efficiency  &  0.4 \\
   electron ID efficiency  &  0.3 \\
         DY normalization  &  0.3 \\
    jet energy resolution  &  0.2 \\
  muon trigger efficiency  &  0.2 \\
     W+jets normalization  &  0.1 \\
   Dibosons normalization  &  0.0 \\
               Luminosity  &  0.0 \\
          b fragmentation  &  2.8 \\
  final   state radiation  &  2.6 \\
  initial state radiation  &  1.7 \\
 ME Renormalization scale  &  0.9 \\
ME combined scale variation  &  0.5 \\
underlying event (Pythia tune)  &  0.5 \\
   ME Factorization scale  &  0.5 \\
semi-leptonic b-hadron BRs  &  0.4 \\
   ME-PS matching (hdamp)  &  0.2 \\
                      PDF  &  1.3 \\
            MC statistics  &  6.1 \\





## goodness of fit of shaped distrs


combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_shaped_Tight_c.root --algo=KS         -s 123                    --freezeParameters lumi_13TeV -n  TightShapedCMuKS
combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_shaped_Tight_c.root --algo=KS -t 10   -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n  TightShapedCMuKS10 &
combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_shaped_Tight_c.root --algo=KS -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n  TightShapedCMuKS100 &

Kolmogorov-Smirnov test statistic: 0.0120288

mean   expected limit: r < 0.0121905 +/- 0.00123997 @ 95%CL (10 toyMC)
median expected limit: r < 0.010545 @ 95%CL (10 toyMC)
   68% expected band : 0.00859677 < r < 0.0217569
   95% expected band : 0.00846185 < r < 0.0217569


combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_shaped_Tight_c.root --algo=KS         -s 123                    --freezeParameters lumi_13TeV -n  TightShapedCelKS
combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_shaped_Tight_c.root --algo=KS -t 10   -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n  TightShapedCelKS10 &
combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop_resub3_shaped_Tight_c.root --algo=KS -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n  TightShapedCelKS100 &

Kolmogorov-Smirnov test statistic: 0.0166176
mean   expected limit: r < 0.0117649 +/- 0.00117353 @ 95%CL (10 toyMC)
median expected limit: r < 0.0122476 @ 95%CL (10 toyMC)
   68% expected band : 0.00755183 < r < 0.0188912
   95% expected band : 0.00516761 < r < 0.0188912


limit->Draw("limit")
h = (TH1D*) limit->GetHistogram()
h_c = (TH1D*) h->GetCumulative(kFALSE)
h_c->Draw()
h_c->GetBinContent(h_c->FindBin(0.0166576))


KS100:
mu 0.25
el 0.18


combine -M GoodnessOfFit ttxsec/both_tight_shaped_c.root --algo=KS         -s 123                    --freezeParameters lumi_13TeV -n  TightShapedCbothKS
combine -M GoodnessOfFit ttxsec/both_tight_shaped_c.root --algo=KS -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n  TightShapedCbothKS100 &

Kolmogorov-Smirnov test statistic: 0.028867

mean   expected limit: r < 0.0242662 +/- 0.000611384 @ 95%CL (100 toyMC)
median expected limit: r < 0.0236975 @ 95%CL (100 toyMC)
   68% expected band : 0.0186415 < r < 0.0307812
   95% expected band : 0.0136383 < r < 0.0362143

root [6] h_c->GetBinContent(h_c->FindBin(0.02886))
(Double_t) 24.0000







# foobar

bash batch_jobs/j_MC2016_Summer16_TTJets_powheg_el_selTight_lj,el_selTight_lj_ss,mu_selTight_lj,mu_selTight_lj_ss_tt_pdf30           &
bash batch_jobs/j_MC2016_Summer16_TTJets_powheg_el_selTight_lj,el_selTight_lj_ss,mu_selTight_lj,mu_selTight_lj_ss_tt_pdf40           &
bash batch_jobs/j_MC2016_Summer16_TTJets_powheg_el_selTight_lj,el_selTight_lj_ss,mu_selTight_lj,mu_selTight_lj_ss_tt_pdf50,tt_alpha  &
bash batch_jobs/j_MC2016_Summer16_TTJets_powheg_el_selTight_lj,el_selTight_lj_ss,mu_selTight_lj,mu_selTight_lj_ss_tt_weights         &

bash batch_jobs/j_MC2016_Summer16_TTJets_powheg_el_selTight_ljout,el_selTight_ljout_ss,mu_selTight_ljout,mu_selTight_ljout_ss_tt_pdf50,tt_alpha  &
bash batch_jobs/j_MC2016_Summer16_TTJets_powheg_el_selTight_ljout,el_selTight_ljout_ss,mu_selTight_ljout,mu_selTight_ljout_ss_tt_weights         &
bash batch_jobs/j_MC2016_Summer16_TTJets_powheg_el_selVloose,el_selVloose_ss,mu_selVloose,mu_selVloose_ss_nom,common                             &
bash batch_jobs/j_MC2016_Summer16_TTJets_powheg_el_selVloose,el_selVloose_ss,mu_selVloose,mu_selVloose_ss_obj                                    &

bash batch_jobs/j_MC2016_Summer16_TTJets_powheg_el_sel_ljout,el_sel_ljout_ss,mu_sel_ljout,mu_sel_ljout_ss_tt_pdf30 &
bash batch_jobs/j_MC2016_Summer16_TTJets_powheg_el_sel_ljout,el_sel_ljout_ss,mu_sel_ljout,mu_sel_ljout_ss_tt_pdf40 &
bash batch_jobs/j_MC2016_Summer16_TTJets_powheg_el_sel_ljout,el_sel_ljout_ss,mu_sel_ljout,mu_sel_ljout_ss_tt_pdf50,tt_alpha &
bash batch_jobs/j_MC2016_Summer16_TTJets_powheg_el_sel_ljout,el_sel_ljout_ss,mu_sel_ljout,mu_sel_ljout_ss_tt_weights &


foreach p ( `ps -u olek | grep python | sed 's/^[ ]*\([0-9][0-9]*\)[ ]*.*$/\1/'` )
echo $p 
cat /proc/$p/cmdline
echo
end


hadd quick-test/v25v26-resub3_hadds/MC2016_Summer16_TTJets_powheg_Mt_lep_met_f.root  quick-test/v25v26-resub3/MC2016_Summer16_TTJets_powheg*Mt_lep_met_f.root  &
hadd quick-test/v25v26-resub3_hadds/MC2016_Summer16_TTJets_powheg_Mt_lep_met_c.root  quick-test/v25v26-resub3/MC2016_Summer16_TTJets_powheg*Mt_lep_met_c.root  &
hadd quick-test/v25v26-resub3_hadds/MC2016_Summer16_TTJets_powheg_Mt_lep_met_c2.root quick-test/v25v26-resub3/MC2016_Summer16_TTJets_powheg*Mt_lep_met_c2.root &




# tests for L1 ECAL prefiring

in endcaps excess of electrons and jets at some pt-s

check at final selection (Medium WP)
2D histo of pt-eta
for electrons and for jets

check number of jets with event_jets_n_jets

python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_n_jets"                            --ttree ttree_out --histo-range 10,0,10              --output temp//SingleElectron_el_sel_n_jets.root          --std-histos --histo-name el_sel/std_procs/nom/n_jets  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*

python -W ignore sumup_ttree_draw.py --cut-w0jets "event_leptons[0].pt():event_leptons[0].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_electron_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/electron_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*


python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_b[0].pt():event_jets_b[0].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_jets_b_0_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_b_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_b[1].pt():event_jets_b[1].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_jets_b_1_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_b_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_b[2].pt():event_jets_b[2].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_jets_b_2_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_b_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_b[3].pt():event_jets_b[3].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_jets_b_3_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_b_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_b[4].pt():event_jets_b[4].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_jets_b_4_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_b_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*  &


python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_r[0].pt():event_jets_r[0].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_jets_r_0_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_r_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_r[1].pt():event_jets_r[1].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_jets_r_1_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_r_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_r[2].pt():event_jets_r[2].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_jets_r_2_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_r_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_r[3].pt():event_jets_r[3].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_jets_r_3_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_r_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_r[4].pt():event_jets_r[4].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_jets_r_4_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_r_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*  &


python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_l[0].pt():event_jets_l[0].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_jets_l_0_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_l_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_l[1].pt():event_jets_l[1].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_jets_l_1_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_l_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_l[2].pt():event_jets_l[2].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_jets_l_2_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_l_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_l[3].pt():event_jets_l[3].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_jets_l_3_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_l_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_l[4].pt():event_jets_l[4].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_jets_l_4_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_l_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*  &


python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_t[0].pt():event_jets_t[0].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_jets_t_0_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_t_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_t[1].pt():event_jets_t[1].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_jets_t_1_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_t_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_t[2].pt():event_jets_t[2].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_jets_t_2_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_t_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_t[3].pt():event_jets_t[3].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_jets_t_3_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_t_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_t[4].pt():event_jets_t[4].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//SingleElectron_el_sel_jets_t_4_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_t_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*SingleElectron*  &


and in TT:

python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_b[0].pt():event_jets_b[0].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//MC2016_Summer16_TTJets_powheg_el_sel_jets_b_0_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_b_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*MC2016_Summer16_TTJets_powheg*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_b[1].pt():event_jets_b[1].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//MC2016_Summer16_TTJets_powheg_el_sel_jets_b_1_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_b_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*MC2016_Summer16_TTJets_powheg*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_b[2].pt():event_jets_b[2].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//MC2016_Summer16_TTJets_powheg_el_sel_jets_b_2_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_b_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*MC2016_Summer16_TTJets_powheg*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_b[3].pt():event_jets_b[3].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//MC2016_Summer16_TTJets_powheg_el_sel_jets_b_3_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_b_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*MC2016_Summer16_TTJets_powheg*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_b[4].pt():event_jets_b[4].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//MC2016_Summer16_TTJets_powheg_el_sel_jets_b_4_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_b_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*MC2016_Summer16_TTJets_powheg*  &

python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_r[0].pt():event_jets_r[0].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//MC2016_Summer16_TTJets_powheg_el_sel_jets_r_0_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_r_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*MC2016_Summer16_TTJets_powheg*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_r[1].pt():event_jets_r[1].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//MC2016_Summer16_TTJets_powheg_el_sel_jets_r_1_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_r_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*MC2016_Summer16_TTJets_powheg*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_r[2].pt():event_jets_r[2].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//MC2016_Summer16_TTJets_powheg_el_sel_jets_r_2_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_r_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*MC2016_Summer16_TTJets_powheg*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_r[3].pt():event_jets_r[3].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//MC2016_Summer16_TTJets_powheg_el_sel_jets_r_3_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_r_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*MC2016_Summer16_TTJets_powheg*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_r[4].pt():event_jets_r[4].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//MC2016_Summer16_TTJets_powheg_el_sel_jets_r_4_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_r_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*MC2016_Summer16_TTJets_powheg*  &


python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_l[0].pt():event_jets_l[0].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//MC2016_Summer16_TTJets_powheg_el_sel_jets_l_0_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_l_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*MC2016_Summer16_TTJets_powheg*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_l[1].pt():event_jets_l[1].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//MC2016_Summer16_TTJets_powheg_el_sel_jets_l_1_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_l_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*MC2016_Summer16_TTJets_powheg*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_l[2].pt():event_jets_l[2].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//MC2016_Summer16_TTJets_powheg_el_sel_jets_l_2_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_l_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*MC2016_Summer16_TTJets_powheg*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_l[3].pt():event_jets_l[3].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//MC2016_Summer16_TTJets_powheg_el_sel_jets_l_3_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_l_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*MC2016_Summer16_TTJets_powheg*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_l[4].pt():event_jets_l[4].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//MC2016_Summer16_TTJets_powheg_el_sel_jets_l_4_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_l_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*MC2016_Summer16_TTJets_powheg*  &


python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_t[0].pt():event_jets_t[0].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//MC2016_Summer16_TTJets_powheg_el_sel_jets_t_0_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_t_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*MC2016_Summer16_TTJets_powheg*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_t[1].pt():event_jets_t[1].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//MC2016_Summer16_TTJets_powheg_el_sel_jets_t_1_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_t_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*MC2016_Summer16_TTJets_powheg*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_t[2].pt():event_jets_t[2].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//MC2016_Summer16_TTJets_powheg_el_sel_jets_t_2_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_t_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*MC2016_Summer16_TTJets_powheg*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_t[3].pt():event_jets_t[3].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//MC2016_Summer16_TTJets_powheg_el_sel_jets_t_3_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_t_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*MC2016_Summer16_TTJets_powheg*  &
python -W ignore sumup_ttree_draw.py --cut-w0jets "event_jets_t[4].pt():event_jets_t[4].eta()" --ttree ttree_out --histo-range 50,-2.5,2.5,20,0,200 --output temp//MC2016_Summer16_TTJets_powheg_el_sel_jets_t_4_pt_eta.root --std-histos --histo-name el_sel/std_procs/nom/jets_t_pt_eta  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25v26/resub3/*MC2016_Summer16_TTJets_powheg*  &

ttree_out->Draw("event_jets_b[].pt():event_jets_b[].eta()", "(selection_stage==17 || selection_stage==19) && !(abs(event_jets_t[0].eta()) > 2.25 && event_jets_t[0].pt() > 100)", "col")

ttree_out->Draw("@event_jets_b.size()", "(selection_stage==17 || selection_stage==19) && !(abs(event_jets_t[0].eta()) > 2.25 && event_jets_t[0].pt() > 100)")

ttree_out->Draw("5", "(selection_stage==17 || selection_stage==19)")
41272
ttree_out->Draw("5", "(selection_stage==17 || selection_stage==19) && !(abs(event_leptons[0].eta()) > 2.25 && event_leptons[0].pt() > 50)")
40957


ttree_out->Draw("5", "(selection_stage==17 || selection_stage==19) && !(abs(event_leptons[0].eta()) > 2.25 && event_leptons[0].pt() > 50) && !(abs(event_jets_t[0].eta()) > 2.25 && event_jets_t[0].pt() > 100)")
40657
ttree_out->Draw("5", "(selection_stage==17 || selection_stage==19) && !(abs(event_leptons[0].eta()) > 2.25 && event_leptons[0].pt() > 50) && !(abs(event_jets_t[].eta()) > 2.25 && event_jets_t[].pt() > 100)")
40657
ttree_out->Draw("5", "(selection_stage==17 || selection_stage==19) && !(abs(event_leptons[0].eta()) > 2.25 && event_leptons[0].pt() > 50) && !(abs(event_jets_t[].eta()) > 2.25 && event_jets_t[].pt() > 100) && !(abs(event_jets_b[0].eta()) > 2.25 && event_jets_b[0].pt() > 100)")
40539
ttree_out->Draw("5", "(selection_stage==17 || selection_stage==19) && !(abs(event_leptons[0].eta()) > 2.25 && event_leptons[0].pt() > 50) && !(abs(event_jets_t[].eta()) > 2.25 && event_jets_t[].pt() > 100) && !(abs(event_jets_b[].eta()) > 2.25 && event_jets_b[].pt() > 100)")
40539
ttree_out->Draw("5", "(selection_stage==17 || selection_stage==19) && !(abs(event_leptons[0].eta()) > 2.25 && event_leptons[0].pt() > 50) && !(abs(event_jets_t[].eta()) > 2.25 && event_jets_t[].pt() > 100) && !(abs(event_jets_b[].eta()) > 2.25 && event_jets_b[].pt() > 100) && !(abs(event_jets_r[0].eta()) > 2.25 && event_jets_r[0].pt() > 100)")
34195
ttree_out->Draw("5", "(selection_stage==17 || selection_stage==19) && !(abs(event_leptons[0].eta()) > 2.25 && event_leptons[0].pt() > 50) && !(abs(event_jets_t[].eta()) > 2.25 && event_jets_t[].pt() > 100) && !(abs(event_jets_b[].eta()) > 2.25 && event_jets_b[].pt() > 100) && !(abs(event_jets_r[].eta()) > 2.25 && event_jets_r[].pt() > 100)")
34195
ttree_out->Draw("5", "(selection_stage==17 || selection_stage==19) && !(abs(event_leptons[0].eta()) > 2.25 && event_leptons[0].pt() > 50) && !(abs(event_jets_t[].eta()) > 2.25 && event_jets_t[].pt() > 100) && !(abs(event_jets_b[].eta()) > 2.25 && event_jets_b[].pt() > 100) && !(abs(event_jets_r[].eta()) > 2.25 && event_jets_r[].pt() > 100) && !(abs(event_jets_l[].eta()) > 2.25 && event_jets_l[].pt() > 100)")
31477

ttree_out->Draw("event_met_lep_mt", "(selection_stage==17 || selection_stage==19)")
ttree_out->Draw("event_met_lep_mt", "(selection_stage==17 || selection_stage==19) && !(abs(event_leptons[0].eta()) > 2.25 && event_leptons[0].pt() > 50) && !(abs(event_jets_t[].eta()) > 2.25 && event_jets_t[].pt() > 100) && !(abs(event_jets_b[].eta()) > 2.25 && event_jets_b[].pt() > 100) && !(abs(event_jets_r[].eta()) > 2.25 && event_jets_r[].pt() > 100) && !(abs(event_jets_l[].eta()) > 2.25 && event_jets_l[].pt() > 100)")

h = (TH1D*) ttree_out->GetHistogram()

h_all = (TH1D*) h->Clone()
h_all->SetDirectory(0)
h_all->SetName("all")

h_cut = (TH1D*) h->Clone()
h_cut->SetDirectory(0)
h_cut->SetName("cut")
h_cut->SetLineColor(kRed)

h_cut->Scale(1./h_cut->Integral())
h_all->Scale(1./h_all->Integral())

h_all->Draw()
h_cut->Draw("same")

root -l lstore_outdirs/merge-sets/v25v26/resub3/SingleElectron.root

ttree_out->Draw("event_met_lep_mt", "(gen_proc_id == 41 || gen_proc_id == 42) && (selection_stage==17 || selection_stage==19)")
ttree_out->Draw("event_met_lep_mt", "(gen_proc_id == 41 || gen_proc_id == 42) && (selection_stage==17 || selection_stage==19) && !(abs(event_leptons[0].eta()) > 2.25 && event_leptons[0].pt() > 50) && !(abs(event_jets_t[].eta()) > 2.25 && event_jets_t[].pt() > 100) && !(abs(event_jets_b[].eta()) > 2.25 && event_jets_b[].pt() > 100) && !(abs(event_jets_r[].eta()) > 2.25 && event_jets_r[].pt() > 100) && !(abs(event_jets_l[].eta()) > 2.25 && event_jets_l[].pt() > 100)")

all events:                      27164
no jets, but lep and tau jet in: 23945
and no lep jet:                  20013
and no tau jet:                  19911





# resub3

foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.all-tt-systs_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.small_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main`)
foreach dtag (SingleMuon SingleElectron)
hadd quick-test/v27-dilep2_hadds/$dtag.root quick-test/v27-dilep2/$dtag*root &
end



make hadds_distrs dtag_file=sw-dir/merge-sets/jobs_hadd.dtags.tt            distr_dir=quick-test/v25v26-resub4
make hadds_distrs dtag_file=sw-dir/merge-sets/jobs_hadd.dtags.small_main    distr_dir=quick-test/v25v26-resub4
make hadds_distrs dtag_file=sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main distr_dir=quick-test/v25v26-resub4
make hadds_distrs dtag_file=sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main distr_dir=quick-test/v25v26-resub4
make hadds_distrs dtag_file=sw-dir/merge-sets/jobs_hadd.dtags.data          distr_dir=quick-test/v25v26-resub4


python stack_plot.py distrs/distrs_v25v26_resub3_mc.root ../quick-test/v25v26-resub3_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub3/ --lumi 31300 -c el_sel  -x el_selVloose   -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --title "" --title-x "M_{T}(e, E^{miss}_{T})"

python stack_plot.py distrs/distrs_v25v26_resub3_mc.root ../quick-test/v25v26-resub3_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub3/ --lumi 31300 -c el_selTight                  -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --title "" --title-x "M_{T}(e, E^{miss}_{T})"

python stack_plot.py distrs/distrs_v25v26_resub3_mc.root ../quick-test/v25v26-resub3_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub3/ --lumi 31300 -c el_selTight  -x el_selVloose -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --title "" --title-x "M_{T}(e, E^{miss}_{T})"

not much loss, but noticeable 10% missing data -- lstore? yep


python stack_plot.py distrs/distrs_v25v26_resub3_mc.root ../quick-test/v25v26-resub3_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub3/ --lumi 31300 -c el_selTight_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --title "" --title-x "M_{T}(e, E^{miss}_{T})"
python stack_plot.py distrs/distrs_v25v26_resub3_mc.root ../quick-test/v25v26-resub3_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub3/ --lumi 31300 -c el_selTight_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --title "" --title-x "M_{T}(e, E^{miss}_{T})"

python stack_plot.py distrs/distrs_v25v26_resub3_mc.root ../quick-test/v25v26-resub3_hadds/SingleMuon.root -p -r -o plots/redo-v25-v26_resub3/ --lumi 35800 -c mu_selTight_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --title "" --title-x "M_{T}(#mu, E^{miss}_{T})"
python stack_plot.py distrs/distrs_v25v26_resub3_mc.root ../quick-test/v25v26-resub3_hadds/SingleMuon.root -p -r -o plots/redo-v25-v26_resub3/ --lumi 35800 -c mu_selTight_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --title "" --title-x "M_{T}(#mu, E^{miss}_{T})"

source histos_1_shaped &
source histos_2_shaped &
source histos_3_shaped &
source histos_4_shaped &
source histos_5_shaped &
source histos_6_shaped &





# just some notes on brilcalc

brilcalc lumi -i /afs/cern.ch/user/o/otoldaie/work/private/16/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/LSforPath_HLT_Ele27_WPTight_Gsf_withLowestSeed_L1_SingleIsoEG26_OR_L1_SingleIsoEG28.json --normtag /afs/cern.ch/user/l/lumipro/public/normtag_file/normtag_DATACERT.json -u /pb --hltpath="HLT_Ele27_WPTight_Gsf_v*" | tee -a logs.brilcalc


checking a prescaled trigger

brilcalc lumi -i /afs/cern.ch/work/o/otoldaie/public/Cert_271036-284044_13TeV_23Sep2016ReReco_Collisions16_JSON.txt --normtag /cvmfs/cms-bril.cern.ch/cms-lumi-pog/Normtags/normtag_DATACERT.json -u /pb --hltpath "HLT_PFHT125_*"
...
#Summary: 
#+----------------+-------+------+--------+-------------------+------------------+
#| hltpath        | nfill | nrun | ncms   | totdelivered(/pb) | totrecorded(/pb) |
#+----------------+-------+------+--------+-------------------+------------------+
#| HLT_PFHT125_v1 | 23    | 66   | 29602  | 1.231             | 1.183            |
#| HLT_PFHT125_v2 | 48    | 149  | 100900 | 1.645             | 1.583            |
#| HLT_PFHT125_v3 | 41    | 92   | 54253  | 0.473             | 0.454            |
#| HLT_PFHT125_v5 | 32    | 86   | 47447  | 0.393             | 0.378            |
#+----------------+-------+------+--------+-------------------+------------------+
##Check JSON:
##(run,ls) in json but not in results: []

brilcalc lumi -i /afs/cern.ch/work/o/otoldaie/public/Cert_271036-284044_13TeV_23Sep2016ReReco_Collisions16_JSON.txt --normtag /cvmfs/cms-bril.cern.ch/cms-lumi-pog/Normtags/normtag_DATACERT.json -u /pb
...
#Summary: 
#+-------+------+--------+--------+-------------------+------------------+
#| nfill | nrun | nls    | ncms   | totdelivered(/pb) | totrecorded(/pb) |
#+-------+------+--------+--------+-------------------+------------------+
#| 144   | 393  | 232259 | 232241 | 37381.753         | 35863.818        |
#+-------+------+--------+--------+-------------------+------------------+
##Check JSON:
##(run,ls) in json but not in results: []
#


also info on prescales by run:

brilcalc trg --hltpath "HLT_Ele27_WPTight_Gsf_v*" --prescale





# redo sel Mt plots

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2/ --lumi 31300 -c el_sel  -x el_selVloose   -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --title "" --title-x "M_{T}(e, E^{miss}_{T})"
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root     -p -r -o plots/redo-v25-v26_resub2/ --lumi 35800 -c mu_sel  -x mu_selVloose   -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --title "" --title-x "M_{T}(#mu, E^{miss}_{T})"

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2/ --lumi 31300 -c el_sel  -x el_selVloose   -d Mt_lep_met_c --wjet 0.8 --qcd 1.05 --title "" --title-x "M_{T}(e, E^{miss}_{T})"   --title-y "[Events/GeV]" --bin-norm
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root     -p -r -o plots/redo-v25-v26_resub2/ --lumi 35800 -c mu_sel  -x mu_selVloose   -d Mt_lep_met_c --wjet 0.8 --qcd 1.05 --title "" --title-x "M_{T}(#mu, E^{miss}_{T})" --title-y "[Events/GeV]" --bin-norm
>
# test with eta and other distrs

hadd quick-test/distrs_v25v26resub2_mc_test1.root quick-test/v25v26-resub2_tests1_hadds/MC2016*.root

python stack_plot.py distrs/distrs_v25v26resub2_mc_test1.root ../quick-test/v25v26-resub2_tests1_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2_test1/ --lumi 31300 -c el_sel_ljout    -x el_selVloose_ljout    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05

python stack_plot.py distrs/distrs_v25v26resub2_mc_test1.root ../quick-test/v25v26-resub2_tests1_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2_test1/ --lumi 31300 -c el_sel_ljout    -x el_selVloose_ljout    -d lep_eta --wjet 0.8 --qcd 1.05
python stack_plot.py distrs/distrs_v25v26resub2_mc_test1.root ../quick-test/v25v26-resub2_tests1_hadds/SingleMuon.root     -p -r -o plots/redo-v25-v26_resub2_test1/ --lumi 35800 -c mu_sel_ljout    -x mu_selVloose_ljout    -d lep_eta --wjet 0.8 --qcd 1.05

--- no problems with electron or muon eta

python stack_plot.py distrs/distrs_v25v26resub2_mc_test1.root ../quick-test/v25v26-resub2_tests1_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2_test1/ --lumi 31300 -c el_sel_ljout    -x el_selVloose_ljout    -d met_c   --wjet 0.8 --qcd 1.05
python stack_plot.py distrs/distrs_v25v26resub2_mc_test1.root ../quick-test/v25v26-resub2_tests1_hadds/SingleMuon.root     -p -r -o plots/redo-v25-v26_resub2_test1/ --lumi 35800 -c mu_sel_ljout    -x mu_selVloose_ljout    -d met_c   --wjet 0.8 --qcd 1.05

--- electron met ok, muon is not (?? this is new)

python stack_plot.py distrs/distrs_v25v26resub2_mc_test1.root ../quick-test/v25v26-resub2_tests1_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2_test1/ --lumi 31300 -c el_sel_ljout -d met_c   --wjet 0.8 --qcd 1.05
python stack_plot.py distrs/distrs_v25v26resub2_mc_test1.root ../quick-test/v25v26-resub2_tests1_hadds/SingleMuon.root     -p -r -o plots/redo-v25-v26_resub2_test1/ --lumi 35800 -c mu_sel_ljout -d met_c   --wjet 0.8 --qcd 1.05

python stack_plot.py distrs/distrs_v25v26resub2_mc_test1.root ../quick-test/v25v26-resub2_tests1_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2_test1/ --lumi 31300 -c el_sel       -d met_c   --wjet 0.8 --qcd 1.05
python stack_plot.py distrs/distrs_v25v26resub2_mc_test1.root ../quick-test/v25v26-resub2_tests1_hadds/SingleMuon.root     -p -r -o plots/redo-v25-v26_resub2_test1/ --lumi 35800 -c mu_sel       -d met_c   --wjet 0.8 --qcd 1.05

--- not so bad without Vloose and in inclusive selection
    and el channel is all the same


python stack_plot.py distrs/distrs_v25v26resub2_mc_test1.root ../quick-test/v25v26-resub2_tests1_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2_test1/ --lumi 31300 -c el_sel_ljout    -d tau_eta --wjet 0.8 --qcd 1.05
python stack_plot.py distrs/distrs_v25v26resub2_mc_test1.root ../quick-test/v25v26-resub2_tests1_hadds/SingleMuon.root     -p -r -o plots/redo-v25-v26_resub2_test1/ --lumi 35800 -c mu_sel_ljout    -d tau_eta --wjet 0.8 --qcd 1.05

--- variations, but ok too





# test1 of the shape in el-tau

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_NOMINAL.root    --std-histos --histo-name el_sel_lj,el_sel_ljout/std_procs/NOMINAL/Mt_lep_met_m  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt(((event_met - 0.03*event_leptons[0]).Px()*(event_met - 0.03*event_leptons[0]).Px() + (event_met - 0.03*event_leptons[0]).Py()*(event_met - 0.03*event_leptons[0]).Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - ((event_met - 0.03*event_leptons[0]).Px()*event_leptons[0].Px() + (event_met - 0.03*event_leptons[0]).Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/elsel_shape_test1/MC2016_Summer16_TTJets_powheg_el_sel_NOMINAL_minus.root    --std-histos --histo-name el_sel_lj,el_sel_ljout/std_procs/NOMINAL/Mt_lep_met_m  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &

won't compile the object differences

event_met.Px()
event_leptons[0].Px()

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt(((event_met.Px() - 0.03*event_leptons[0].Px())*(event_met.Px() - 0.03*event_leptons[0].Px()) + (event_met.Py() - 0.03*event_leptons[0].Py())*(event_met.Py() - 0.03*event_leptons[0].Py()))*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - ((event_met.Px() - 0.03*event_leptons[0].Px())*event_leptons[0].Px() + (event_met.Py() - 0.03*event_leptons[0].Py())*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/elsel_shape_test1/MC2016_Summer16_TTJets_powheg_el_sel_NOMINAL_minus.root    --std-histos --histo-name el_sel_lj,el_sel_ljout/std_procs/NOMINAL/Mt_lep_met_m  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt(((event_met.Px() + 0.03*event_leptons[0].Px())*(event_met.Px() + 0.03*event_leptons[0].Px()) + (event_met.Py() + 0.03*event_leptons[0].Py())*(event_met.Py() + 0.03*event_leptons[0].Py()))*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - ((event_met.Px() + 0.03*event_leptons[0].Px())*event_leptons[0].Px() + (event_met.Py() + 0.03*event_leptons[0].Py())*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/elsel_shape_test1/MC2016_Summer16_TTJets_powheg_el_sel_NOMINAL_plus.root    --std-histos --histo-name el_sel_lj,el_sel_ljout/std_procs/NOMINAL/Mt_lep_met_p  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &


## and test2

foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.all-tt-systs_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.small_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main`)
foreach dtag (SingleMuon SingleElectron)
hadd quick-test/v27-dilep2_hadds/$dtag.root quick-test/v27-dilep2/$dtag*root &
end

hadd quick-test/v27-dilep2_hadds/MC2016_Summer16_TTJets_powheg.root quick-test/v27-dilep2/MC2016_Summer16_TTJets_powheg*root

make hadds_distrs distr_dir=quick-test/v25v26-resub2 dtag_file=sw-dir/merge-sets/jobs_hadd.dtags.tt

compare tt shapes

python jobsums/get_shapes.py  --norm-binwidth --formula " OLD : NEW " -c el_selVloose_ljout -d Mt_lep_met_f -p tt_lj NEW:quick-test/v25v26-resub2_hadds/MC2016_Summer16_TTJets_powheg.root:el_selVloose_ljout,tt_eltau,NOMINAL,Mt_lep_met_c OLD:jobsums/distrs/distrs_redo_v25v26_alldata_4.root:el_selVloose_ljout,tt_eltau,NOMINAL

seems like it's worse now


## full new stack

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/redo-v25-v26_cats_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 31300 -c el_sel_ljout    -x el_selVloose_ljout    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05

hadd quick-test/v25v26-resub2_hadds/SingleElectron.root quick-test/v25v26-resub2_data_resub1/SingleElectron*
hadd quick-test/v25v26-resub2_hadds/SingleMuon.root     quick-test/v25v26-resub2_data_resub1/SingleMuon*

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 31300 -c el_sel_ljout    -d Mt_lep_met_f --wjet 0.8 --skip-QCD 

-- nope, resub1 has wrong cuts!

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_data_resub2_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 31300 -c el_sel_ljout    -d Mt_lep_met_f --wjet 0.8 --skip-QCD 
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_data_resub2_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 31300 -c el_sel_lj       -d Mt_lep_met_f --wjet 0.8 --skip-QCD 

-- absent tt in el_sel_lj! the hadd is broken
hadd quick-test/v25v26-resub2_tests1_hadds/MC2016_Summer16_TTJets_powheg_mu_sel_.root        quick-test/v25v26-resub2_tests1/*TTJe*mu_sel_*       &
hadd quick-test/v25v26-resub2_tests1_hadds/MC2016_Summer16_TTJets_powheg_mu_selVloose_.root  quick-test/v25v26-resub2_tests1/*TTJe*mu_selVloose_* &
hadd quick-test/v25v26-resub2_tests1_hadds/MC2016_Summer16_TTJets_powheg_el_sel_.root        quick-test/v25v26-resub2_tests1/*TTJe*el_sel_*       &
hadd quick-test/v25v26-resub2_tests1_hadds/MC2016_Summer16_TTJets_powheg_el_selVloose_.root  quick-test/v25v26-resub2_tests1/*TTJe*el_selVloose_* &


foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.qcd`)

foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.all-tt-systs_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.small_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main`)
foreach dtag (SingleMuon SingleElectron)
hadd quick-test/v25v26-resub2_tests1_hadds/${dtag}_mu_sel_.root       quick-test/v25v26-resub2_tests1/$dtag*mu_sel_*root &
hadd quick-test/v25v26-resub2_tests1_hadds/${dtag}_mu_selVloose_.root quick-test/v25v26-resub2_tests1/$dtag*mu_selVloose_*root &
hadd quick-test/v25v26-resub2_tests1_hadds/${dtag}_el_sel_.root       quick-test/v25v26-resub2_tests1/$dtag*el_sel_*root &
hadd quick-test/v25v26-resub2_tests1_hadds/${dtag}_el_selVloose_.root quick-test/v25v26-resub2_tests1/$dtag*el_selVloose_*root &
end

hadd quick-test/v25v26-resub2_tests1_hadds/${dtag}.root       quick-test/v25v26-resub2_tests1/${dtag}_*root &
end

hadd quick-test/v25v26-resub2_tests1_hadds/${dtag}.root       quick-test/v25v26-resub2_tests1_hadds/parts/${dtag}_*root &
end

hadd quick-test/v25v26-resub2_tests1_hadds/${dtag}.root       quick-test/v25v26-resub2_tests1_hadds/${dtag}_*root &
end

hadd quick-test/v25v26-resub2_tests1_hadds/MC2016_Summer16_TTJets_powheg.root quick-test/v25v26-resub2_tests1_hadds/MC2016_Summer16_TTJets_powheg_*root &

foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.small_main`)
hadd quick-test/v25v26-resub2_tests1_hadds/${dtag}.root       quick-test/v25v26-resub2_tests1_hadds/parts/${dtag}_*root &
end
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main`)
hadd quick-test/v25v26-resub2_tests1_hadds/${dtag}.root       quick-test/v25v26-resub2_tests1_hadds/parts/${dtag}_*root &
end
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main`)
hadd quick-test/v25v26-resub2_tests1_hadds/${dtag}.root       quick-test/v25v26-resub2_tests1_hadds/parts/${dtag}_*root &
end
foreach dtag (SingleMuon SingleElectron)
hadd quick-test/v25v26-resub2_tests1_hadds/${dtag}.root       quick-test/v25v26-resub2_tests1_hadds/parts/${dtag}_*root &
end

hadd quick-test/v25v26-resub2_tests1_hadds/MC2016_Summer16_TTJets_powheg.root quick-test/v25v26-resub2_tests1_hadds/parts/MC2016_Summer16_TTJets_powheg_*root &


effect on mu shapes:

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_data_resub2_hadds/SingleMuon.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 35800 -c mu_sel_ljout    -d Mt_lep_met_f --wjet 0.8 --skip-QCD 
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_data_resub2_hadds/SingleMuon.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 35800 -c mu_sel_lj       -d Mt_lep_met_f --wjet 0.8 --skip-QCD 


python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_data_resub2_hadds/SingleMuon.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 35800 -c mu_sel_ljout  -x mu_selVloose_ljout  -d Mt_lep_met_f --wjet 0.8 --skip-QCD 
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_data_resub2_hadds/SingleMuon.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 35800 -c mu_sel_lj     -x mu_selVloose_lj     -d Mt_lep_met_f --wjet 0.8 --skip-QCD 


python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_data_resub2_hadds/SingleMuon.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 35800 -c mu_sel_ljout  -x mu_selVloose_ljout  -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_data_resub2_hadds/SingleMuon.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 35800 -c mu_sel_lj     -x mu_selVloose_lj     -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 

still
DEBUG:root:absent NOMINAL mu_selVloose_lj_ss_tt_mutau_NOMINAL_Mt_lep_met_f
DEBUG:root:mu_selVloose_lj_ss_tt_taultauh_NOMINAL_Mt_lep_met_f


python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_data_resub2_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 31300 -c el_sel_ljout   -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_data_resub2_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 31300 -c el_sel_lj      -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_data_resub2_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 31300 -c el_sel_ljout  -x el_selVloose_ljout   -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_data_resub2_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 31300 -c el_sel_lj     -x el_selVloose_lj      -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 

DEBUG:root:absent NOMINAL
DEBUG:root:absent NOMINAL el_sel_lj_tt_taulj_NOMINAL_Mt_lep_met_f
DEBUG:root:el_sel_lj_tt_taultauh_NOMINAL_Mt_lep_met_f

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_data_resub2_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 31300 -c el_sel_ljout_ss     -d Mt_lep_met_f --wjet 0.8 --skip-QCD
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_data_resub2_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 31300 -c el_sel_lj_ss        -d Mt_lep_met_f --wjet 0.8 --skip-QCD

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_data_resub2_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 31300 -c el_selVloose_ljout_ss -d Mt_lep_met_f --wjet 0.8 --skip-QCD
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_data_resub2_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 31300 -c el_selVloose_lj_ss    -d Mt_lep_met_f --wjet 0.8 --skip-QCD

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_data_resub2_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 31300 -c el_sel_ljout  -x el_selVloose_ljout   -d Mt_lep_met_c --wjet 0.8 --qcd 1.05 
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_data_resub2_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 31300 -c el_sel_lj     -x el_selVloose_lj      -d Mt_lep_met_c --wjet 0.8 --qcd 1.05 


python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 35800 -c mu_sel_ljout  -x mu_selVloose_ljout  -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 35800 -c mu_sel_lj     -x mu_selVloose_lj     -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 35800 -c mu_sel_ljout  -x mu_selVloose_ljout  -d Mt_lep_met_c --wjet 0.8 --qcd 1.05 
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 35800 -c mu_sel_lj     -x mu_selVloose_lj     -d Mt_lep_met_c --wjet 0.8 --qcd 1.05 

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 31300 -c el_sel_ljout  -x el_selVloose_ljout   -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 31300 -c el_sel_lj     -x el_selVloose_lj      -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 

python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 31300 -c el_sel_ljout  -x el_selVloose_ljout   -d Mt_lep_met_c --wjet 0.8 --qcd 1.05 
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_resub2/el-shapes/ --lumi 31300 -c el_sel_lj     -x el_selVloose_lj      -d Mt_lep_met_c --wjet 0.8 --qcd 1.05 



## numbers VS old ones

python numbers_for_datacard.py  histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root  -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout --no-sums -y

python numbers_for_datacard.py  histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root  -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout --no-sums -y

                                 process    el_sel_lj   el_sel_ljout
                                tt_eltau   $      3010 \pm         88 $   $      4691 \pm        111 $
                             tt_taultauh   $       170 \pm         20 $   $       280 \pm         26 $
                                   tt_lj   $      2215 \pm         43 $   $      1457 \pm         34 $
                                tt_taulj   $       118 \pm          8 $   $        76 \pm          7 $
                                tt_other   $        60 \pm          9 $   $       100 \pm         11 $
                             s_top_eltau   $       152 \pm         14 $   $       274 \pm         19 $
                             s_top_other   $        21 \pm          3 $   $        31 \pm          5 $
                                s_top_lj   $       151 \pm          8 $   $       169 \pm          8 $
                               dy_tautau   $       103 \pm         28 $   $       190 \pm         29 $
                                dy_other   $        34 \pm         14 $   $       103 \pm         25 $
                             wjets_other   $       194 \pm         22 $   $       241 \pm         15 $
                              wjets_taul   $         7 \pm          3 $   $         7 \pm          3 $
                              wjets_tauh   $         0 \pm          0 $   $         1 \pm          1 $
                                dibosons   $        13 \pm          4 $   $        31 \pm          6 $
                                     qcd   $       136 \pm         57 $   $       327 \pm         68 $
aaa!
                                mc_resum     6383.362     7980.707
                                    data   $      6190 \pm        236 $   $      7906 \pm        273 $


                                 process    mu_sel_lj   mu_sel_ljout
                                tt_mutau   $      5136 \pm        116 $   $      7926 \pm        144 $
                             tt_taultauh   $       328 \pm         27 $   $       517 \pm         34 $
                                   tt_lj   $      3757 \pm         57 $   $      2532 \pm         46 $
                                tt_taulj   $       240 \pm         13 $   $       161 \pm         10 $
                                tt_other   $       104 \pm         12 $   $       181 \pm         15 $
                             s_top_mutau   $       232 \pm         17 $   $       450 \pm         25 $
                             s_top_other   $        40 \pm          5 $   $        61 \pm          7 $
                                s_top_lj   $       235 \pm         10 $   $       296 \pm         11 $
                               dy_tautau   $       200 \pm         32 $   $       424 \pm         52 $
                                dy_other   $        22 \pm         14 $   $        62 \pm         18 $
                             wjets_other   $       303 \pm         22 $   $       434 \pm         22 $
                              wjets_taul   $        11 \pm          3 $   $        16 \pm          4 $
                              wjets_tauh   $         0 \pm          0 $   $         0 \pm          0 $
                                dibosons   $        25 \pm          5 $   $        58 \pm         10 $
                                     qcd   $       173 \pm         42 $   $       258 \pm         53 $
aaa!
                                mc_resum    10805.584    13376.781
                                    data   $     10251 \pm        298 $   $     13550 \pm        352 $



python numbers_for_datacard.py  histosels/redo-v25-v26_resub2/HISTOSELS_v25v25redo_resub2.root  -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout --no-sums -y
python numbers_for_datacard.py  histosels/redo-v25-v26_resub2/HISTOSELS_v25v25redo_resub2.root  -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout --no-sums -y

                                 process    el_sel_lj   el_sel_ljout
                                tt_eltau   $      3007 \pm        124 $   $      4685 \pm        157 $
                             tt_taultauh   $       170 \pm         26 $   $       279 \pm         35 $
                                   tt_lj   $      2215 \pm         57 $   $      1457 \pm         46 $
                                tt_taulj   $       118 \pm         11 $   $        76 \pm          9 $
                                tt_other   $        60 \pm         13 $   $       100 \pm         16 $
                             s_top_eltau   $       152 \pm         20 $   $       274 \pm         27 $
                             s_top_other   $        21 \pm          4 $   $        31 \pm          6 $
                                s_top_lj   $       151 \pm         11 $   $       169 \pm         11 $
                               dy_tautau   $       104 \pm         35 $   $       190 \pm         36 $
                                dy_other   $        21 \pm         14 $   $        58 \pm         23 $
                             wjets_other   $        90 \pm         19 $   $       112 \pm         14 $
                              wjets_taul   $         7 \pm          3 $   $         7 \pm          3 $
                              wjets_tauh   $         0 \pm          0 $   $         1 \pm          1 $
                                dibosons   $        13 \pm          5 $   $        31 \pm          8 $
                                     qcd   $       173 \pm         72 $   $       431 \pm         94 $
aaa!
                                mc_resum     6301.395     7901.348
                                    data   $      6190 \pm        325 $   $      7906 \pm        379 $

                                 process    mu_sel_lj   mu_sel_ljout
                                tt_mutau   $      5133 \pm        162 $   $      7922 \pm        201 $
                             tt_taultauh   $       328 \pm         36 $   $       517 \pm         46 $
                                   tt_lj   $      3757 \pm         76 $   $      2532 \pm         61 $
                                tt_taulj   $       240 \pm         16 $   $       161 \pm         13 $
                                tt_other   $       104 \pm         17 $   $       180 \pm         21 $
                             s_top_mutau   $       232 \pm         24 $   $       449 \pm         35 $
                             s_top_other   $        40 \pm          6 $   $        61 \pm          9 $
                                s_top_lj   $       235 \pm         13 $   $       296 \pm         15 $
                               dy_tautau   $       196 \pm         40 $   $       426 \pm         67 $
                                dy_other   $        10 \pm         12 $   $        33 \pm         17 $
                             wjets_other   $       144 \pm         21 $   $       213 \pm         22 $
                              wjets_taul   $        11 \pm          4 $   $        16 \pm          5 $
                              wjets_tauh   $         0 \pm          0 $   $         0 \pm          0 $
                                dibosons   $        25 \pm          7 $   $        58 \pm         13 $
                                     qcd   $       246 \pm         66 $   $       413 \pm         83 $
aaa!
                                mc_resum    10700.527    13276.558
                                    data   $     10251 \pm        409 $   $     13550 \pm        486 $


python numbers_for_datacard.py  histosels/redo-v25-v26_resub2/HISTOSELS_v25v25redo_resub2.root  -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout --no-sums
python numbers_for_datacard.py  histosels/redo-v25-v26_resub2/HISTOSELS_v25v25redo_resub2.root  -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout --no-sums


combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.root --algo=KS        -s 123 --freezeParameters lumi_13TeV -n  lepMETpropElKS
combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.root --algo=KS -t 10  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n  lepMETpropElKS10 &

Kolmogorov-Smirnov test statistic: 0.0166576

mean   expected limit: r < 0.0112927 +/- 0.00124536 @ 95%CL (10 toyMC)
median expected limit: r < 0.0101835 @ 95%CL (10 toyMC)
   68% expected band : 0.00855458 < r < 0.0192469
   95% expected band : 0.00606694 < r < 0.0192469

combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.root --algo=KS -t 100   -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n  lepMETpropElKS100   &
combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.root --algo=KS -t 1000  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n  lepMETpropElKS1000  &


in 100

h = (TH1D*) limit->GetHistogram()
h_c = (TH1D*) h->GetCumulative(kFALSE)
h_c->Draw()
h_c->GetBinContent(h_c->FindBin(0.0166576))
7.00000

not that great...

but 110 in 1000!



### ok, same datacards with AD and saturated

datafile HISTOSELS_v25v25redo_resub2.root
datacard ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.txt
copy muons:
ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop.txt

./scripts/text2workspace.py ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop.txt

no FragUp in mu_sel_lj
and some pdfs are missing

ls histosels/redo-v25-v26_resub2/distrs | grep -i mu_sel | wc -l; ls histosels/redo-v25-v26_resub2/distrs | grep -i el_sel | wc -l

ls histosels/redo-v25-v26_resub2/distrs | grep -i "mu_sel.*PDF" | sed 's/.*\(PDF[^_]*\).*/\1/' | sort > tmp.mu_pdfs
ls histosels/redo-v25-v26_resub2/distrs | grep -i "el_sel.*PDF" | sed 's/.*\(PDF[^_]*\).*/\1/' | sort > tmp.el_pdfs
diff tmp.mu_pdfs tmp.el_pdfs

ls histosels/redo-v25-v26_resub2/distrs | grep -i "mu_sel.*PDFCT14n9Up"
ls histosels/redo-v25-v26_resub2/distrs | grep -i "el_sel.*PDFCT14n9Up"

ls histosels/redo-v25-v26_resub2/distrs | grep -i mu_sel | sed 's/.*_\([^_]*\)_data-qcd.*/\1/' | sort > tmp.mu_systs
ls histosels/redo-v25-v26_resub2/distrs | grep -i el_sel | sed 's/.*_\([^_]*\)_data-qcd.*/\1/' | sort > tmp.el_systs
diff tmp.mu_systs tmp.el_systs

foreach sys (`cat syst-test.syst-list.1`)
foreach sys (FragUp FragDown)
foreach sys (PDFCT14n10Up PDFCT14n11Up PDFCT14n12Up PDFCT14n13Up PDFCT14n14Up PDFCT14n15Up PDFCT14n16Up PDFCT14n17Up PDFCT14n18Up PDFCT14n19Up PDFCT14n1Up PDFCT14n20Up PDFCT14n21Up PDFCT14n22Up PDFCT14n23Up PDFCT14n24Up PDFCT14n25Up PDFCT14n26Up PDFCT14n27Up PDFCT14n28Up PDFCT14n29Up PDFCT14n2Up PDFCT14n30Up PDFCT14n31Up PDFCT14n32Up PDFCT14n33Up PDFCT14n34Up PDFCT14n35Up PDFCT14n36Up PDFCT14n37Up PDFCT14n38Up PDFCT14n39Up PDFCT14n3Up PDFCT14n40Up PDFCT14n41Up PDFCT14n42Up PDFCT14n43Up PDFCT14n44Up PDFCT14n45Up PDFCT14n46Up PDFCT14n47Up PDFCT14n48Up PDFCT14n49Up PDFCT14n4Up PDFCT14n50Up PDFCT14n51Up PDFCT14n52Up PDFCT14n53Up PDFCT14n54Up PDFCT14n55Up PDFCT14n56Up PDFCT14n5Up PDFCT14n6Up PDFCT14n7Up PDFCT14n8Up PDFCT14n9Up)
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root     -o histosels/redo-v25-v26_resub2/ --lumi 35800 -c mu_sel_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --systematic $sys
end

foreach sys (PDFCT14n10Up PDFCT14n11Up PDFCT14n12Up PDFCT14n13Up PDFCT14n14Up PDFCT14n15Up PDFCT14n16Up PDFCT14n17Up PDFCT14n18Up PDFCT14n19Up PDFCT14n1Up PDFCT14n20Up PDFCT14n21Up PDFCT14n22Up PDFCT14n23Up PDFCT14n24Up PDFCT14n25Up PDFCT14n26Up PDFCT14n27Up PDFCT14n28Up PDFCT14n29Up PDFCT14n2Up PDFCT14n30Up PDFCT14n31Up PDFCT14n32Up PDFCT14n33Up PDFCT14n34Up PDFCT14n35Up PDFCT14n36Up PDFCT14n37Up PDFCT14n38Up PDFCT14n39Up PDFCT14n3Up PDFCT14n40Up PDFCT14n41Up PDFCT14n42Up PDFCT14n43Up PDFCT14n44Up PDFCT14n45Up PDFCT14n46Up PDFCT14n47Up PDFCT14n48Up PDFCT14n49Up PDFCT14n4Up PDFCT14n50Up PDFCT14n51Up PDFCT14n52Up PDFCT14n53Up PDFCT14n54Up PDFCT14n55Up PDFCT14n56Up PDFCT14n5Up PDFCT14n6Up PDFCT14n7Up PDFCT14n8Up PDFCT14n9Up)
python stack_plot.py distrs/distrs_v25v26resub2_mc_noqcd.root ../quick-test/v25v26-resub2_hadds/SingleMuon.root     -o histosels/redo-v25-v26_resub2/ --lumi 35800 -c mu_sel_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --systematic $sys
end

foreach sys (AlphaSDown AlphaSUp FragDown FragUp MfDown MfUp MfrDown MfrUp MrDown MrUp PetersonDown PetersonUp SemilepBRDown SemilepBRUp TOPPTDown TOPPTUp)

source histos_tmp_mu_pdf1 &
source histos_tmp_mu_pdf2 &

combineCards.py mu=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop.txt el=ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.txt > ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_lepMETprop.txt

./scripts/text2workspace.py ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_lepMETprop.txt

finally!

combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.root --algo=AD         -s 123 --freezeParameters lumi_13TeV -n  lepMETprop_el_AD
combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.root --algo=AD -t 1000 -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n  lepMETprop_el_AD1000
Anderson-Darling test statistic: 2.22412

mean   expected limit: r < 1.03373 +/- 0.0181239 @ 95%CL (1000 toyMC)
median expected limit: r < 0.89925 @ 95%CL (1000 toyMC)
   68% expected band : 0.53467 < r < 1.53498
   95% expected band : 0.366707 < r < 2.61621

h_c->GetBinContent(h_c->FindBin(2.22412))
48

combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.root --algo=AD -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n  lepMETprop_el_AD100

h_c->GetBinContent(h_c->FindBin(2.22412))
2

combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop.root --algo=AD         -s 123 --freezeParameters lumi_13TeV -n  lepMETprop_mu_AD
combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop.root --algo=AD -t 1000 -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n  lepMETprop_mu_AD1000
Anderson-Darling test statistic: 0.868249

mean   expected limit: r < 1.04414 +/- 0.0170752 @ 95%CL (1000 toyMC)
median expected limit: r < 0.929795 @ 95%CL (1000 toyMC)
   68% expected band : 0.575564 < r < 1.47665
   95% expected band : 0.381466 < r < 2.48017

h_c->GetBinContent(h_c->FindBin(0.868249))
571


combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop.root --algo=AD -t 100  -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n  lepMETprop_mu_AD100

h_c->GetBinContent(h_c->FindBin(0.868249))
57

combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_lepMETprop.root --algo=AD         -s 123 --freezeParameters lumi_13TeV -n  lepMETprop_both_AD
combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_lepMETprop.root --algo=AD -t 1000 -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n  lepMETprop_both_AD1000
Anderson-Darling test statistic: 3.36603

both 100
Done in 0.46 min (cpu), 0.47 min (real)
mean   expected limit: r < 2.36336 +/- 0.0965533 @ 95%CL (100 toyMC)
median expected limit: r < 2.17736 @ 95%CL (100 toyMC)
   68% expected band : 1.52079 < r < 3.45352
      95% expected band : 0.941743 < r < 5.61603

h_c->GetBinContent(h_c->FindBin(3.36603))
17.0000


saturated

combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.root --algo=saturated         -s 123 --freezeParameters lumi_13TeV -n  lepMETprop_el_saturated
combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms_lepMETprop.root --algo=saturated -t 1000 -s 123 --toysFreq --expectSignal 1.0 --freezeParameters lumi_13TeV -n  lepMETprop_el_saturated1000
Best fit test statistic: 51.843

Done in 0.37 min (cpu), 0.37 min (real)
mean   expected limit: r < 38.7258 +/- 0.290528 @ 95%CL (1000 toyMC)
median expected limit: r < 38.1894 @ 95%CL (1000 toyMC)
   68% expected band : 29.8957 < r < 47.2548
      95% expected band : 23.8485 < r < 58.7099

h_c->GetBinContent(h_c->FindBin(51.843))
89.0000


combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop.root --algo=saturated         -s 123 --freezeParameters lumi_13TeV -n  lepMETprop_mu_saturated
combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop.root --algo=saturated -t 1000 -s 123 --toysFreq --expectSignal 1.0 --freezeParameters lumi_13TeV -n  lepMETprop_mu_saturated1000
Best fit test statistic: 41.6766

mean   expected limit: r < 38.4835 +/- 0.275204 @ 95%CL (1000 toyMC)
median expected limit: r < 37.7171 @ 95%CL (1000 toyMC)
   68% expected band : 29.8359 < r < 47.3778
   95% expected band : 23.5349 < r < 57.8657

370

combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms_lepMETprop.root --algo=saturated -t 100  -s 123 --toysFreq --expectSignal 1.0 --freezeParameters lumi_13TeV -n  lepMETprop_mu_saturated100

mean   expected limit: r < 38.1009 +/- 0.895594 @ 95%CL (100 toyMC)
median expected limit: r < 38.1994 @ 95%CL (100 toyMC)
   68% expected band : 28.459 < r < 46.9401
      95% expected band : 21.2939 < r < 58.6912

h_c->GetBinContent(h_c->FindBin(41.6766))
35



combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_lepMETprop.root --algo=saturated         -s 123 --freezeParameters lumi_13TeV -n  lepMETprop_both_saturated
combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms_lepMETprop.root --algo=saturated -t 1000 -s 123 --toysFreq --expectSignal 1.0 --freezeParameters lumi_13TeV -n  lepMETprop_both_saturated1000
Best fit test statistic: 92.1385

mean   expected limit: r < 78.6697 +/- 0.405327 @ 95%CL (1000 toyMC)
median expected limit: r < 77.8688 @ 95%CL (1000 toyMC)
   68% expected band : 65.277 < r < 91.6886
   95% expected band : 56.4439 < r < 104.386

156


both in 100

Done in 0.15 min (cpu), 0.15 min (real)
mean   expected limit: r < 78.0232 +/- 1.24656 @ 95%CL (100 toyMC)
median expected limit: r < 76.0517 @ 95%CL (100 toyMC)
   68% expected band : 65.6768 < r < 93.0271
      95% expected band : 55.2496 < r < 105.175

limit->Draw("limit")
h = (TH1D*) limit->GetHistogram()
h_c = (TH1D*) h->GetCumulative(kFALSE)
h_c->Draw()

h_c->GetBinContent(h_c->FindBin(92.1385))
17.0000




### numbers for the new reseb2 run 1, failed lstore jobs

                                 process    el_sel_lj   el_sel_ljout
                                tt_eltau   $      3010 \pm        126 $   $      4688 \pm        160 $
                             tt_taultauh   $       168 \pm         27 $   $       279 \pm         35 $
                                   tt_lj   $      2218 \pm         58 $   $      1456 \pm         47 $
                                tt_taulj   $       118 \pm         11 $   $        78 \pm          9 $
                                tt_other   $        59 \pm         13 $   $        98 \pm         16 $
                             s_top_eltau   $        78 \pm         11 $   $       137 \pm         15 $
                             s_top_other   $        12 \pm          3 $   $        15 \pm          3 $
                                s_top_lj   $        86 \pm          7 $   $       129 \pm          9 $
                               dy_tautau   $        97 \pm         35 $   $       186 \pm         36 $
                                dy_other   $        22 \pm         15 $   $        61 \pm         24 $
                             wjets_other   $        93 \pm         34 $   $       112 \pm         86 $
                              wjets_taul   $         7 \pm          7 $   $         0 \pm          0 $
                              wjets_tauh   $         0 \pm          0 $   $         0 \pm          0 $
                                dibosons   $        12 \pm          6 $   $        18 \pm          7 $
                                     qcd   $       132 \pm         89 $   $       355 \pm         92 $
aaa!
                                mc_resum     6113.805     7612.033
                                    data   $      5759 \pm        314 $   $      7290 \pm        363 $

                                 process    mu_sel_lj   mu_sel_ljout
                                tt_mutau   $      5133 \pm        165 $   $      7932 \pm        205 $
                             tt_taultauh   $       328 \pm         37 $   $       511 \pm         46 $
                                   tt_lj   $      3754 \pm         77 $   $      2536 \pm         62 $
                                tt_taulj   $       240 \pm         16 $   $       161 \pm         13 $
                                tt_other   $       107 \pm         18 $   $       179 \pm         21 $
                             s_top_mutau   $       115 \pm         19 $   $       446 \pm         39 $
                             s_top_other   $        22 \pm          5 $   $        62 \pm         10 $
                                s_top_lj   $       143 \pm         11 $   $       296 \pm         16 $
                               dy_tautau   $       208 \pm         40 $   $       428 \pm         69 $
                                dy_other   $        10 \pm         13 $   $        46 \pm         22 $
                             wjets_other   $        23 \pm         14 $   $        14 \pm          7 $
                              wjets_taul   $         0 \pm          0 $   $         0 \pm          0 $
                              wjets_tauh   $         0 \pm          0 $   $         0 \pm          0 $
                                dibosons   $        28 \pm         12 $   $        63 \pm         20 $
                                     qcd   $        74 \pm         32 $   $       326 \pm         92 $
aaa!
                                mc_resum    10186.293    13002.965
                                    data   $      9255 \pm        388 $   $     12203 \pm        461 $

less data???
-- less in lstore!!!!




#  remainders

! "Please show the compoistion for all control regions"
table of event composition in other control regions?
event yields in other control regions?

QCD calculation plots?

! the fake rates per number of jets

is tau-candidate required in the preselection?
do we have the plots with jets-only preselection and MC QCD?

! PU is too large:
variation plots for dominant systematics (variations in lep_pt and met for PU?)
check PU normalization
--- checked, indeed there is a corrections to be done,
    the result is as predicted slightly smalle r in mu-tau
	and slightly smaller PU impact

! goodness of fit
muon-tau ok
electron-tau not so great --- all 3 methods show about the same 0.02 p value
indeed prefit and postfit distrs look weird --> maybe met propagation? --> before full run plot recalc Mt with shifted met




## goodness of fit tests

add in a table?
add next tot the post-fit distrs

combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root   --algo=saturated -n FixPUnormEl


combine -M GoodnessOfFit ttxsec/latest_datacard_el.root   --algo=KS -s 123 --freezeParameters lumi_13TeV -n  ElKS &
combine -M GoodnessOfFit ttxsec/latest_datacard_mu.root   --algo=KS -s 123 --freezeParameters lumi_13TeV -n  MuKS &
combine -M GoodnessOfFit ttxsec/latest_datacard_both.root --algo=KS -s 123 --freezeParameters lumi_13TeV -n  BothKS &

combine -M GoodnessOfFit ttxsec/latest_datacard_el.root   --algo=KS -t 100 -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n  ElKS100 &
combine -M GoodnessOfFit ttxsec/latest_datacard_mu.root   --algo=KS -t 100 -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n  MuKS100 &
combine -M GoodnessOfFit ttxsec/latest_datacard_both.root --algo=KS -t 100 -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n  BothKS100 &

Kolmogorov-Smirnov test statistic: 0.016415
Kolmogorov-Smirnov test statistic: 0.00763032
Kolmogorov-Smirnov test statistic: 0.0277083




combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root   --algo=KS -s 123 --freezeParameters lumi_13TeV -n  PUfixElKS &
combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root   --algo=KS -s 123 --freezeParameters lumi_13TeV -n  PUfixMuKS &

combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root   --algo=KS -t 100 -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n  PUfixElKS100 &
combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root   --algo=KS -t 100 -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n  PUfixMuKS100 &


combineCards.py mu=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.txt el=ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.txt > ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms.txt
./scripts/text2workspace.py ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms.txt

combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms.root --algo=KS -t 100 -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n  PUfixBothKS100 &

combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_both_lnU_noQCDpu_fixPUnorms.root --algo=KS -s 123 --freezeParameters lumi_13TeV -n  PUfixBothKS &




## composition of all control regions

I have dileptons and elmu in not so good condition
but where is wjets?

find . -name "*ctr_mu_wjet*png"

v27p1

./mc_v27p1_amcatnlo1.root

merged data is gone
but
../lstore_outdirs/v27/p1/Data13TeV_SingleMuon2016G_03Feb2017_v1/Data13TeV_SingleMuon2016G_03Feb2017_v1_58.root

make merge_proc dtags=sw-dir/merge-sets/jobs_hadd.dtags.single-muon nt=v27 proc=p1 merge_dir=lstore_outdirs/merge-sets/

now it's here

lstore_outdirs/merge-sets//v27/p1/SingleMuon.root

ls -lh lstore_outdirs/merge-sets//v27/p1/SingleMuon.root sw-dir/jobsums/./mc_v27p1_amcatnlo1.root

hadd
jobsums/v27p1_WJetsAmcatnlo1_SingleMuon.root

python numbers_for_datacard.py v27p1_WJetsAmcatnlo1_SingleMuon.root -d Mt_lep_met_f -c ctr_mu_wjet --no-sums
python numbers_for_datacard.py v27p1_WJetsAmcatnlo1_SingleMuon.root -d Mt_lep_met_f -c ctr_mu_wjet --no-sums -y --scale 35800 --latex



from dilep runs

hadd distrs/distrs_v27dilep2_mc_and_data.root distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root

DY -> mumu
python numbers_for_datacard.py distrs/distrs_v27dilep2_mc_and_data.root -d lep_pt       -c dy_mumu --no-sums -y --scale 35800 --latex
python numbers_for_datacard.py distrs/distrs_v27dilep2_mc_and_data.root -d Mt_lep_met_f -c dy_mumu --no-sums -y --scale 35800 --latex

bin           dy_mumu     dy_mumu     dy_mumu     dy_mumu     dy_mumu     dy_mumu     dy_mumu     dy_mumu     dy_mumu     dy_mumu     dy_mumu     dy_mumu     dy_mumu     dy_mumu
process       tt_mutau    tt_lj       tt_taulj    tt_taultauh tt_other    dibosons    s_top_lj    s_top_other s_top_mutau wjets_tauh  wjets_taul  wjets_other dy_other    dy_tautau
process       0           3           4           5           6           7           8           9           11          13          14          15          16          17
rate          19.351      202.984     17.686      2.408       18935.508   9759.452    51.542      1619.548    1.043       0.000       4.300       73.288      7562485.076 4639.072

not signal tt
single top
wjets
sum([202.984,     17.686,      2.408,       18935.508])
sum([51.542,      1619.548,    1.043])
sum([0.000 ,      4.300,       73.288])

19158.586000000003
1672.1329999999998
77.588

   sqrt(sum([i**2 for i in [2, 36, 8, 361 ]))

and elmu

python numbers_for_datacard.py distrs/distrs_v27dilep2_mc_and_data.root -d lep_pt       -c tt_elmu --no-sums -y --scale 35800
python numbers_for_datacard.py distrs/distrs_v27dilep2_mc_and_data.root -d lep_pt       -c tt_elmu --no-sums -y --scale 35800 --latex

-- this one has b-tag!!!!!!! using old one

python numbers_for_datacard.py v27p1_WJetsAmcatnlo1_SingleMuon.root -d Mt_lep_met_f -c ctr_mu_tt_em --no-sums
python numbers_for_datacard.py v27p1_WJetsAmcatnlo1_SingleMuon.root -d Mt_lep_met_f -c ctr_mu_tt_em --no-sums -y --scale 35800
python numbers_for_datacard.py v27p1_WJetsAmcatnlo1_SingleMuon.root -d Mt_lep_met_f -c ctr_mu_tt_em --no-sums -y --scale 35800 --latex



## systematic variations


python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -p tt_lj -c el_sel_lj    -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]"
python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -p tt_lj -c el_sel_ljout -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio  --add-titles --title-x "M_{T} [GeV]"

foreach sys (PUUp,PUDown bSFUp,bSFDown TOPPTUp,TOPPTDown FragUp,FragDown)

foreach sys (FragUp,FragDown TOPPTUp,TOPPTDown)
foreach el_chan (el_sel_lj el_sel_ljout)
foreach proc (tt_eltau tt_lj)
python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -p $proc -c $el_chan -d Mt_lep_met_f -s $sys --no-data --ratio  --add-titles --title-x "M_{T} [GeV]"
end
end

foreach mu_chan (mu_sel_lj mu_sel_ljout)
foreach proc (tt_mutau tt_lj)
python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -p $proc -c $mu_chan -d Mt_lep_met_f -s $sys --no-data --ratio  --add-titles --title-x "M_{T} [GeV]"
end
end
end


variations for mc sum:

python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root  -c el_sel_lj    -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio --ratio-range 0.2 --add-titles --title-x "M_{T} [GeV]"
python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root  -c el_sel_ljout -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio --ratio-range 0.2 --add-titles --title-x "M_{T} [GeV]"

python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root  -c el_sel_lj    -d Mt_lep_met_f -s bSFUp,bSFDown --no-data --ratio --ratio-range 0.2 --add-titles --title-x "M_{T} [GeV]"
python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root  -c el_sel_ljout -d Mt_lep_met_f -s bSFUp,bSFDown --no-data --ratio --ratio-range 0.2 --add-titles --title-x "M_{T} [GeV]"

python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root  -c el_sel_lj    -d Mt_lep_met_f -s FragUp,FragDown --no-data --ratio --ratio-range 0.2 --add-titles --title-x "M_{T} [GeV]"
python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root  -c el_sel_ljout -d Mt_lep_met_f -s FragUp,FragDown --no-data --ratio --ratio-range 0.2 --add-titles --title-x "M_{T} [GeV]"


python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root  -c mu_sel_lj    -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio --ratio-range 0.1 --add-titles --title-x "M_{T} [GeV]  "
python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root  -c mu_sel_ljout -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio --ratio-range 0.1 --add-titles --title-x "M_{T} [GeV]  "

python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root  -c mu_sel_lj    -d Mt_lep_met_f -s bSFUp,bSFDown --no-data --ratio --ratio-range 0.1 --add-titles --title-x "M_{T} [GeV]  "
python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root  -c mu_sel_ljout -d Mt_lep_met_f -s bSFUp,bSFDown --no-data --ratio --ratio-range 0.1 --add-titles --title-x "M_{T} [GeV]  "

python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root  -c mu_sel_lj    -d Mt_lep_met_f -s FragUp,FragDown --no-data --ratio --ratio-range 0.1 --add-titles --title-x "M_{T} [GeV]  "
python mc_per_sys.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root  -c mu_sel_ljout -d Mt_lep_met_f -s FragUp,FragDown --no-data --ratio --ratio-range 0.1 --add-titles --title-x "M_{T} [GeV]  "





## quick test of eltau?

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_1_PUnorm/el-shapes/ --lumi 31300 -c el_sel    -x el_selVloose    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05
python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_1_PUnorm/el-shapes/ --lumi 31300 -c el_sel    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_1_PUnorm/el-shapes/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05
python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_1_PUnorm/el-shapes/ --lumi 31300 -c el_sel_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_1_PUnorm/el-shapes/ --lumi 31300 -c el_sel_ljout    -x el_selVloose_ljout    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05
python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleElectron.root -p -r -o plots/redo-v25-v26_1_PUnorm/el-shapes/ --lumi 31300 -c el_sel_ljout    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05

the trend in ljout is more pronounced
the step in QCD at low Mt and at the peak


python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root -p -r -o plots/redo-v25-v26_1_PUnorm/mu-shapes/ --lumi 35800 -c mu_sel       -x mu_selVloose       -d Mt_lep_met_f --wjet 0.8 --qcd 1.05
python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root -p -r -o plots/redo-v25-v26_1_PUnorm/mu-shapes/ --lumi 35800 -c mu_sel    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root -p -r -o plots/redo-v25-v26_1_PUnorm/mu-shapes/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05
python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root -p -r -o plots/redo-v25-v26_1_PUnorm/mu-shapes/ --lumi 35800 -c mu_sel_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root -p -r -o plots/redo-v25-v26_1_PUnorm/mu-shapes/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05
python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root -p -r -o plots/redo-v25-v26_1_PUnorm/mu-shapes/ --lumi 35800 -c mu_sel_ljout    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05


root -l gstore_outdirs/v26/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v26_MC2016_Summer16_TTJets_powheg/180412_180008/0000/MC2016_Summer16_TTJets_powheg_91.root

((TTree*) ntupler->Get("reduced_ttree"))->Draw("jet_matching_lep[0]*jet_initial_p4[0].pt() + jet_matching_lep[1]*jet_initial_p4[1].pt() + jet_matching_lep[2]*jet_initial_p4[2].pt() + jet_matching_lep[3]*jet_initial_p4[3].pt() + jet_matching_lep[4]*jet_initial_p4[4].pt()", "abs(leps_ID) == 13")

((TTree*) ntupler->Get("reduced_ttree"))->Draw("jet_matching_lep[0]*jet_initial_p4[0].pt()*(1 - jet_jer_factor[0]) + jet_matching_lep[1]*jet_initial_p4[1].pt()*(1 - jet_jer_factor[1]) + jet_matching_lep[2]*jet_initial_p4[2].pt()*(1 - jet_jer_factor[2]) + jet_matching_lep[3]*jet_initial_p4[3].pt()*(1 - jet_jer_factor[3]) + jet_matching_lep[4]*jet_initial_p4[4].pt()*(1 - jet_jer_factor[4])", "(jet_matching_lep[0] + jet_matching_lep[1] + jet_matching_lep[2] + jet_matching_lep[3] + jet_matching_lep[4] > 0) && abs(leps_ID) == 11")

((TTree*) ntupler->Get("reduced_ttree"))->Draw("jet_matching_lep[0]*jet_initial_p4[0].pt()*(1 - jet_jer_factor[0]) + jet_matching_lep[1]*jet_initial_p4[1].pt()*(1 - jet_jer_factor[1]) + jet_matching_lep[2]*jet_initial_p4[2].pt()*(1 - jet_jer_factor[2]) + jet_matching_lep[3]*jet_initial_p4[3].pt()*(1 - jet_jer_factor[3]) + jet_matching_lep[4]*jet_initial_p4[4].pt()*(1 - jet_jer_factor[4])", "(jet_matching_lep[0] + jet_matching_lep[1] + jet_matching_lep[2] + jet_matching_lep[3] + jet_matching_lep[4] > 0) && abs(leps_ID) == 13")

approximately the same distrsm skewed towards negative values, mean = -1
-- must decrease met and slightly correct the Mt distr!



NCG machines don't work -- stop this, finish the rest of simple questions
(if NCG machines are not needed there)





## PU normalization re-check

the result for now:
indeed it seems there is a mistake in PU normalization,
correction will reduce the yield variation by 1% or less
and it will shift the nominal MC a bit up in both channels,
which probably will make the yields agree more,
but will diverge even more in muon-tau at high Mt values


v26 resub1
MC TT

nominal
7.70812e+07

mu pu
7.81511e+07
up
7.66839e+07
down
7.99003e+07

7.81511e+07 / 7.70812e+07
1.01388
7.66839e+07 / 7.70812e+07
0.994846
7.99003e+07 / 7.70812e+07
1.03657

el pu
7.94754e+07
up
7.77688e+07
down
8.14887e+07

7.94754e+07 / 7.70812e+07
1.03106
7.77688e+07 / 7.70812e+07
1.00892
8.14887e+07 / 7.70812e+07
1.05718


differences
               Up    Down
in electrons: -2.2  +2.6%
in muons:     -2.0  +2.3%



'NOMINAL': 'event_weight',
'PUUp'   : "event_weight*event_weight_PUUp/event_weight_PU"    ,
'PUDown' : "event_weight*event_weight_PUDown/event_weight_PU"    ,

        event_weight[0] = nom_sys_weight * weight_bSF_to_apply
        nom_sys_weight            = weight_init * weight_th * weight_pu * weight_top_pt_NOM
        event_weight_PU[0]    = weight_pu

-- PU weight is ok (!=1)


pu_factor = 1.
if 'PUUp' in fixed_sys_name:
    pu_factor = 1. / (1.01995 if '_el_' in channel or 'el_sel' in channel else 0.9979) # 0.97 # 1./ 0.9979
elif 'PUDown' in fixed_sys_name:
    pu_factor = 1. / (1.07766 if '_el_' in channel or 'el_sel' in channel else 1.0485) # 1.17 # 1./ 1.485
else:
    pu_factor = 1. / (1.04678 if '_el_' in channel or 'el_sel' in channel else 1.022)  # 1.06 # 1./ 1.02135 an 1/1.014 with weight counter..
    #pu_factor = 1. / (1.04678 if '_el_' in channel else 1.014)

very close, but how much

differences
               Up    Down
in electrons: -3.5  +3.0%
in muons:     -2.3  +2.6%

change in nominals:

electrons to 1.5% more mc
muons     to 0.8% more mc

-- practically perfect match in event yields with these?
   but the Mt shape will be even worse in muons?


python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root     -p -r -o plots/v25v26redo_more-info --lumi 35800 -c mu_sel -x mu_selVloose -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --y-max 250.

mc
23949.749168
data
24147.0

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root     -p -r -o plots/v25v26redo_more-info --lumi 35800 -c mu_sel_lj -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --y-max 250.
python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root     -p -r -o plots/v25v26redo_more-info --lumi 35800 -c mu_sel_lj -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --y-max 250. --systematic PUUp
python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root     -p -r -o plots/v25v26redo_more-info --lumi 35800 -c mu_sel_lj -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --y-max 250. --systematic PUDown

10671.760896
10847.128083
10478.456504



python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleElectron.root -p -r -o plots/v25v26redo_more-info --lumi 31300 -c el_sel -x el_selVloose -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --y-max 150.

mc
13986.815900
data
14383.0



and rerun histosel


foreach sys (`cat syst-test.syst-list.1`)
python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1_PUnorm/ --lumi 35800 -c mu_sel    -x mu_selVloose    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --systematic $sys
end

foreach sys (`cat syst-test.syst-list.1`)
python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1_PUnorm/ --lumi 31300 -c el_sel    -x el_selVloose    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --systematic $sys
end

foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1_PUnorm/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --sys $sys &
end

foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1_PUnorm/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --sys $sys &
end

foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1_PUnorm/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --sys $sys &
end

foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1_PUnorm/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --sys $sys &
end

source histos_1 &
source histos_2 &
source histos_3 &
source histos_4 &
source histos_5 &
source histos_6 &

hadd histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root  histosels/redo-v25-v26_1_PUnorm/distrs/*root

python numbers_for_datacard.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout --no-sums

python numbers_for_datacard.py histosels/redo-v25-v26_1_PUnorm/HISTOSELS_v25v25redo_PUnormFix.root -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout --no-sums


./scripts/text2workspace.py ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.txt

remove the damaged pdf systs
PDFCT14n11      shape     1.0    1.0 1.0 1.0    1.0      -    -    -  -  - - - -     -      1.0    1.0 1.0 1.0    1.0           -           -           -       -            -             -           -           -               -
PDFCT14n21      shape     1.0    1.0 1.0 1.0    1.0      -    -    -  -  - - - -     -      1.0    1.0 1.0 1.0    1.0           -           -           -       -            -             -           -           -               -
PDFCT14n44      shape     1.0    1.0 1.0 1.0    1.0      -    -    -  -  - - - -     -      1.0    1.0 1.0 1.0    1.0           -           -           -       -            -             -           -           -               -

tt_th_pdf   group = Mr Mf Mfr AlphaS PDFCT14n1 PDFCT14n2 PDFCT14n3 PDFCT14n4 PDFCT14n5 PDFCT14n6 PDFCT14n7 PDFCT14n8 PDFCT14n9 PDFCT14n11 PDFCT14n12 PDFCT14n13 PDFCT14n14 PDFCT14n15 PDFCT14n16 PDFCT14n17 PDFCT14n18 PDFCT14n19 PDFCT14n21 PDFCT14n22 PDFCT14n23 PDFCT14n24 PDFCT14n25 PDFCT14n26 PDFCT14n27 PDFCT14n28 PDFCT14n29 PDFCT14n31 PDFCT14n32 PDFCT14n33 PDFCT14n34 PDFCT14n35 PDFCT14n36 PDFCT14n37 PDFCT14n38 PDFCT14n39 PDFCT14n41 PDFCT14n42 PDFCT14n43 PDFCT14n44 PDFCT14n45 PDFCT14n46 PDFCT14n47 PDFCT14n48 PDFCT14n49 PDFCT14n51 PDFCT14n52 PDFCT14n53 PDFCT14n54 PDFCT14n55 PDFCT14n56


./scripts/text2workspace.py ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.txt

-- notice there is no lnU in both of these

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root --freezeParameters lumi_13TeV -m 125 --robustFit 1 --doInitialFit           -n FixNormEl
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root --freezeParameters lumi_13TeV -m 125 --robustFit 1 --doFits --parallel 5    -n FixNormEl
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root --freezeParameters lumi_13TeV -m 125 -o latest_el_impacts_FixNormEl.json    -n FixNormEl
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts_FixNormEl.json -o latest_el_impacts_FixNormEl

-- and PU is very marginaly after the TOP

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root --freezeParameters lumi_13TeV -m 125 --robustFit 1 --doInitialFit            -n FixNormMu
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root --freezeParameters lumi_13TeV -m 125 --robustFit 1 --doFits --parallel 5     -n FixNormMu
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root --freezeParameters lumi_13TeV -m 125 -o latest_mu_impacts_FixNormMu.json     -n FixNormMu
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_FixNormMu.json -o latest_mu_impacts_FixNormMu

-- PU is 4th in mu-tau, TOPPT is still not pulled
r = 0.908 +- 0.072
--slightly smaller



goodness of fit after PU norm fix:


combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root   --algo=saturated -n FixPUnormEl
Best fit test statistic: 33.938

same stuff

combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root   --algo=saturated -n FixPUnormMu

combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root   --algo=saturated -t 10 -s 123 --expectSignal 1.0 --toysFreq --freezeParameters lumi_13TeV -n FixPUnormElToys
combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu_fixPUnorms.root   --algo=saturated -t 10 -s 123 --expectSignal 1.0 --toysFreq --freezeParameters lumi_13TeV -n FixPUnormMuToys

combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root   --algo=AD -n FixPUnormEl_AD
Anderson-Darling test statistic: 2.49251

combine -M GoodnessOfFit ttxsec/datacard_v25v26redo_el_lnU_noQCDpu_fixPUnorms.root   --algo=AD -t 10 -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n FixPUnormEl_AD_Toys
mean   expected limit: r < 1.20274 +/- 0.201028 @ 95%CL (10 toyMC)
median expected limit: r < 1.00493 @ 95%CL (10 toyMC)
   68% expected band : 0.667163 < r < 2.38349
      95% expected band : 0.564572 < r < 2.38349

-- something weird with electron-tau fit over whole range of bins.
   it is weird, since by eye the electron-tau looks ok!

   check the postfit distrs? --- indeed postfit is weird!
   and same pattern in prefit! was it there before?



# second round of questions

(the update to 1 round did not get to github..)

Tabs 8 and 9
-- no, muon is indeed strange, the signal-dominated region has more data than MC?
   it must be effect of the shape in muon-tau,
   the bins in region of large Mt have less or equal amount of data per MC

it must be the effect of the shape in muon-tau. The bins in the region of large Mt have less or equal amount of data per MC. Therefore they pull the overall signal strength down. The channels are compatible within the uncertainty. An investigation of the shape differences probably will be inconclusive, since we'll run into lack of statistics and large systematic uncertainties.


Sec 4.3 fraction of signal and other ttbar in SS
-- compositions for all control regions
(the table for anti-iso QCD is there
 include wjets and dy control regions?
 add plots on QCD calculation?)


-- table 7
   are electron and muon labels flipped?
   very small contribution of signal events -- in anti-iso

v27 contains antiiso
v27p1 has the channels

presel mu-tau alliso
tt_lj
515158.

el-tau
304581.
ss
242454.

the caption is flipped
but p1 is wrong? -- !! it's not only anti-iso

the el-tau preselection, tt_lj yield in AN:
325667
mutau:
551462

-- both larger than all-iso for QCD, definitely larger than the iso-region in QCD study
   does it include the tau-candidate requirement?
   probably no, but not sure

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c mu_sel_ss -x mu_selVloose_ss -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --y-max 250.

python numbers_for_datacard.py distrs/distrs_redo_v25v26_alldata_4.root -d Mt_lep_met_f -c mu_sel,mu_sel_ss -y  --no-sums

In the application of this procedure in the main selection the contribution of signal events in SS region is still on order of 2%.

bin           mu_sel_ss                mu_sel_ss                mu_sel_ss                mu_sel_ss                mu_sel_ss                mu_sel_ss                mu_sel_ss                mu_sel_ss                mu_sel_ss                mu_sel_ss                mu_sel_ss                mu_sel_ss                mu_sel_ss                mu_sel_ss                
process       tt_mutau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons                 s_top_lj                 s_top_other              s_top_mutau              wjets_taul               wjets_other              dy_other                 dy_tautau                qcd                      
process       0                        3                        4                        5                        6                        7                        8                        9                        11                       14                       15                       16                       17                       18                       
rate          188.106                  2546.372                 162.211                  12.239                   193.481                  23.434                   214.561                  22.494                   6.867                    8.320                    456.641                  96.920                   23.105                   2.136                    
mu_sel_ss/data/NOMINAL/mu_sel_ss_data_NOMINAL_Mt_lep_met_f
obs 4208.000000

-- and QCD is

l = [188.106                  2546.372                 162.211                  12.239                   193.481                  23.434                   214.561                  22.494                   6.867                    8.320                    456.641                  96.920                   23.105]

sum(l)
3954.7510000000016

250 events


l 408 mis-identification, rough estimate, should depend on number of jets
-- did not address this,
   the dependency on number of jets is "integrated over"
   it is embedded in the physical process

-- need the old study with numbers of b and W jets
   and the calculation of fake rate of lj categories from preselection to final selection in MC


pile-up variation plots (CHECK normalization?) -- the variation of Mt and MET with lep_pt
and other systematics

python mc_per_sys.py histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix_with_selOS.root -p tt_lj -c el_sel -d Mt_lep_met_f -s PUUp,PUDown

python mc_per_sys.py histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix_with_selOS.root -p tt_lj -c el_sel_lj    -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio
python mc_per_sys.py histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix_with_selOS.root -p tt_lj -c el_sel_ljout -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio

python mc_per_sys.py histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix_with_selOS.root -p tt_eltau -c el_sel_lj    -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio
python mc_per_sys.py histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix_with_selOS.root -p tt_eltau -c el_sel_ljout -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio


python mc_per_sys.py histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix_with_selOS.root -p tt_lj    -c mu_sel_lj    -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio
python mc_per_sys.py histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix_with_selOS.root -p tt_lj    -c mu_sel_ljout -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio

python mc_per_sys.py histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix_with_selOS.root -p tt_mutau -c mu_sel_lj    -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio
python mc_per_sys.py histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix_with_selOS.root -p tt_mutau -c mu_sel_ljout -d Mt_lep_met_f -s PUUp,PUDown --no-data --ratio



python mc_per_sys.py distrs/distrs_redo_v25v26_alldata_4.root -p tt_lj -c el_sel_lj    -d lep_pt -s PUUp,PUDown --no-data --ratio
python mc_per_sys.py distrs/distrs_redo_v25v26_alldata_4.root -p tt_lj -c el_sel_ljout -d lep_pt -s PUUp,PUDown --no-data --ratio

python mc_per_sys.py distrs/distrs_redo_v25v26_alldata_4.root -p tt_eltau -c el_sel_lj    -d lep_pt -s PUUp,PUDown --no-data --ratio
python mc_per_sys.py distrs/distrs_redo_v25v26_alldata_4.root -p tt_eltau -c el_sel_ljout -d lep_pt -s PUUp,PUDown --no-data --ratio

python mc_per_sys.py distrs/distrs_redo_v25v26_alldata_4.root -p tt_eltau -c el_sel_lj    -d lep_pt -s bSFUp,bSFDown --no-data --ratio
python mc_per_sys.py distrs/distrs_redo_v25v26_alldata_4.root -p tt_eltau -c el_sel_ljout -d lep_pt -s bSFUp,bSFDown --no-data --ratio






# questions

 - About the Ele27 trigger: I think for pT > 34 GeV there exists a L1
seed for the whole 2016 period and above pT > 30 GeV you only loose a
very small fraction of the data. Did you consider this?

%BLUE% >> initially we decided the reduced certificate is good enough
since the analysis is not statistically bound
and did not consider the seed for Ele27.


- Sec. 4.3 What is the fraction of signal events and other ttbar events
in the SS region? How do you treat those? Please show the compositions
for all control regions.

%BLUE% >> contribution of signal events is negligible, especially in anti-isolated region.
Added tables and the plots of rel iso.

{QCD control in pre-selection event yields in data:
158k OS and 142k SS in muon,
66k and 60k in electron.
The main preselection, data event yields:
600k in electron-tau, 998k in muon-tau.
--- CHECK THIS TABLE CAPTION! ELECTRON AND MUON ARE FLIPED
CHECK THE lep-tau YIELDS IN THE TABLE, are they TOO LOW?}

python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c mu_sel -x mu_selVloose -d dilep_mass --wjet 0.8 --skip-QCD --ratio-range 0.3 --bin-norm --title "" --title-x "M(#mu, #tau) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02

python numbers_for_datacard.py histosels/histosels_v27dilep2_5.root -d Mt_lep_met_f -c el_sel --no-sums

distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c mu_sel_ss -x mu_selVloose_ss -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --y-max 250.

python numbers_for_datacard.py distrs/distrs_redo_v25v26_alldata_4.root -d Mt_lep_met_f -c mu_sel,mu_sel_ss    --no-sums --scale 358000 -y

                                 process    mu_sel mu_sel_ss
                                tt_mutau$     13940 \pm        223 $$       188 \pm         25 $
                             tt_taultauh$       902 \pm         52 $$        12 \pm          6 $
                                   tt_lj$      6376 \pm        130 $$      2546 \pm         82 $
                                tt_taulj$       407 \pm         28 $$       162 \pm         18 $
                                tt_other$       289 \pm         31 $$       193 \pm         26 $
                             s_top_mutau$       728 \pm         36 $$         7 \pm          3 $
                             s_top_other$       103 \pm         12 $$        22 \pm          5 $
                                s_top_lj$       539 \pm         26 $$       215 \pm         17 $
                               dy_tautau$       666 \pm         75 $$        23 \pm         13 $
                                dy_other$        85 \pm         62 $$        97 \pm         36 $
                             wjets_other$       935 \pm         72 $$       457 \pm         49 $
                              wjets_taul$        34 \pm         10 $$         8 \pm          5 $
                                dibosons$        85 \pm         15 $$        23 \pm          7 $
                                     qcd$        76 \pm         73 $$         2 \pm          2 $
                                    data$     23801 \pm        462 $$      4208 \pm        181 $

python numbers_for_datacard.py distrs/distrs_redo_v25v26_alldata_4.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_lj_ss    --no-sums --scale 35800 -y

                                tt_mutau$      5481 \pm        140 $$        68 \pm         15 $
                             tt_taultauh$       350 \pm         32 $$         3 \pm          3 $
                                   tt_lj$      3809 \pm        100 $$      1384 \pm         60 $
                                tt_taulj$       243 \pm         21 $$       100 \pm         14 $
                                tt_other$       106 \pm         19 $$        63 \pm         14 $
                             s_top_mutau$       248 \pm         21 $$         2 \pm          2 $
                             s_top_other$        40 \pm          7 $$         9 \pm          3 $
                                s_top_lj$       238 \pm         17 $$        81 \pm         10 $
                               dy_tautau$       213 \pm         40 $$        13 \pm         10 $
                                dy_other$        22 \pm         43 $$        21 \pm         11 $
                             wjets_other$       385 \pm         48 $$       163 \pm         31 $
                              wjets_taul$        14 \pm          7 $$         4 \pm          3 $
                                dibosons$        26 \pm          7 $$         9 \pm          4 $
                                     qcd$         0 \pm          0 $$         0 \pm          0 $
                                    data$     10251 \pm        298 $$      2022 \pm        124 $

python numbers_for_datacard.py distrs/distrs_redo_v25v26_alldata_4.root -d Mt_lep_met_f -c mu_sel_ljout,mu_sel_ljout_ss    --no-sums --scale 35800 -y

                                tt_mutau$      8459 \pm        174 $$       120 \pm         20 $
                             tt_taultauh$       552 \pm         41 $$         9 \pm          5 $
                                   tt_lj$      2567 \pm         82 $$      1162 \pm         55 $
                                tt_taulj$       164 \pm         18 $$        62 \pm         11 $
                                tt_other$       183 \pm         25 $$       130 \pm         22 $
                             s_top_mutau$       480 \pm         29 $$         5 \pm          3 $
                             s_top_other$        62 \pm         10 $$        13 \pm          4 $
                                s_top_lj$       300 \pm         19 $$       134 \pm         13 $
                               dy_tautau$       453 \pm         62 $$        10 \pm          6 $
                                dy_other$        63 \pm         36 $$        76 \pm         33 $
                             wjets_other$       550 \pm         52 $$       294 \pm         36 $
                              wjets_taul$        20 \pm          8 $$         5 \pm          4 $
                                dibosons$        59 \pm         13 $$        14 \pm          5 $
                                     qcd$        76 \pm         73 $$         2 \pm          2 $
                                    data$     13550 \pm        352 $$      2186 \pm        131 $


- Fig. 11. I am confused about the QCD background for the pre-selection.
Do not you need the tau requirement to define the SS/OS regions? For the
pre-selection you only require jets, right?

%BLUE% >> in QCD study a "tau candidate" is required,
a jet which passes all the requirements of tau object except the final anti-jet discrimination ID.

- Figs 21/22: the right plots are signal-rich?

%BLUE% >> yes, corrected the caption.


- l. 408 tau mis-identification: here you say Gaussian constraint, while
in Tab. 10 it is LnU. Are there no better estimates than 50% of the
rate. For a dominant uncertainty the estimate seems rather rough. It
should depend on the number of jets per event ...

%BLUE% >> the AN is outdated. Three methods were tried: 1) lnN 50%, 2) free parameter and lnU parameter with 50% variation.
They yield similar results, lnN was left as the most convenient in higgsCombine.

{We could implement more complicated model of the fake rates,
 but 1) it is integrated in the final shape,
 2) how higgsCombine treats the nuisances in the estimation of systematic effects.}


- Figs 25/28: it seems surprising that PU has a dominant impact. Does it
play an important role for the tau identification? Please include plots
of the dominant shape variations and correlation plots of the fit
parameters.

%BLUE% >> PU slightly affects the shape, add the variation plots.


- Looking at the Tabs 8 and 9 the expected number of events in all
categories are close to the expected yields. In addition, the ratio in
the electron and muon channels seem to be similar. This makes it
surprising that there is a 12% difference in the final cross sections.
Are the two channels compatible, given that most of their uncertainties
are correlated?

%BLUE% >> if the tables in AN are updated then the event yields should be similar to the fitted signal strength
(remember from the plots of Mt)





# goodness of fit

combine -M GoodnessOfFit ttxsec/latest_datacard_el.root   --algo=saturated
combine -M GoodnessOfFit ttxsec/latest_datacard_mu.root   --algo=saturated
combine -M GoodnessOfFit ttxsec/latest_datacard_both.root --algo=saturated

combine -M GoodnessOfFit ttxsec/latest_datacard_el.root   --algo=saturated -t 100 -s 123


for electron
Best fit test statistic: 33.7334

muon
Best fit test statistic: 18.8882

both
Best fit test statistic: 53.1044




toys are between 10-20

combine -M GoodnessOfFit ttxsec/latest_datacard_el.root   --algo=saturated -t 10 -s 123
mean   expected limit: r < 17.1208 +/- 0.986556 @ 95%CL (10 toyMC)
median expected limit: r < 17.6656 @ 95%CL (10 toyMC)
   68% expected band : 14.5446 < r < 21.179
   95% expected band : 10.3705 < r < 21.179

combine -M GoodnessOfFit ttxsec/latest_datacard_el.root   --algo=saturated -t 10 -s 123 --expectSignal 1.0
mean   expected limit: r < 18.7988 +/- 2.79837 @ 95%CL (10 toyMC)
median expected limit: r < 16.57 @ 95%CL (10 toyMC)
   68% expected band : 11.7623 < r < 36.4192
   95% expected band : 9.91369 < r < 36.4192



combine -M GoodnessOfFit ttxsec/latest_datacard_el.root   --algo=saturated -t 100 -s 123 --expectSignal 1.0 --toysFreq
mean   expected limit: r < 16.1015 +/- 0.584242 @ 95%CL (100 toyMC)
median expected limit: r < 14.5195 @ 95%CL (100 toyMC)
   68% expected band : 10.6021 < r < 21.6731
   95% expected band : 7.73915 < r < 33.9236

mv higgsCombineTest.GoodnessOfFit.mH120.123.root higgsCombineTest.GoodnessOfFit.mH120.123.el.root

combine -M GoodnessOfFit ttxsec/latest_datacard_el.root   --algo=saturated -t 1000 -s 123 --expectSignal 1.0 --toysFreq --freezeParameters lumi_13TeV
mv higgsCombineTest.GoodnessOfFit.mH120.123.root higgsCombineTest.GoodnessOfFit.mH120.123.el1000.root


combine -M GoodnessOfFit ttxsec/latest_datacard_mu.root   --algo=saturated -t 100 -s 123 --expectSignal 1.0 --toysFreq
mv higgsCombineTest.GoodnessOfFit.mH120.123.root higgsCombineTest.GoodnessOfFit.mH120.123.mu.root

mean   expected limit: r < 17.2454 +/- 0.619727 @ 95%CL (100 toyMC)
median expected limit: r < 16.9058 @ 95%CL (100 toyMC)
   68% expected band : 10.8435 < r < 23.3768
   95% expected band : 8.26929 < r < 34.6872


combine -M GoodnessOfFit ttxsec/latest_datacard_both.root --algo=saturated -t 100 -s 123 --expectSignal 1.0 --toysFreq
mv higgsCombineTest.GoodnessOfFit.mH120.123.root higgsCombineTest.GoodnessOfFit.mH120.123.both.root

mean   expected limit: r < 34.1409 +/- 0.813827 @ 95%CL (100 toyMC)
median expected limit: r < 32.6283 @ 95%CL (100 toyMC)
   68% expected band : 26.2625 < r < 41.2145
   95% expected band : 21.0095 < r < 59.1942


full script:

combine -M GoodnessOfFit ttxsec/latest_datacard_el.root   --algo=saturated -t 1000 -s 123 --expectSignal 1.0 --toysFreq --freezeParameters lumi_13TeV
mv higgsCombineTest.GoodnessOfFit.mH120.123.root higgsCombineTest.GoodnessOfFit.mH120.123.el1000.root
combine -M GoodnessOfFit ttxsec/latest_datacard_el.root   --algo=KS -t 1000 -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV
mv higgsCombineTest.GoodnessOfFit.mH120.123.root higgsCombineTest.GoodnessOfFit.mH120.123.el1000KS.root
combine -M GoodnessOfFit ttxsec/latest_datacard_el.root   --algo=AD -t 1000 -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV
mv higgsCombineTest.GoodnessOfFit.mH120.123.root higgsCombineTest.GoodnessOfFit.mH120.123.el1000AD.root

combine -M GoodnessOfFit ttxsec/latest_datacard_mu.root   --algo=saturated -t 1000 -s 123 --expectSignal 1.0 --toysFreq --freezeParameters lumi_13TeV
mv higgsCombineTest.GoodnessOfFit.mH120.123.root higgsCombineTest.GoodnessOfFit.mH120.123.mu1000.root
combine -M GoodnessOfFit ttxsec/latest_datacard_mu.root   --algo=KS -t 1000 -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV
mv higgsCombineTest.GoodnessOfFit.mH120.123.root higgsCombineTest.GoodnessOfFit.mH120.123.mu1000KS.root
combine -M GoodnessOfFit ttxsec/latest_datacard_mu.root   --algo=AD -t 1000 -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV
mv higgsCombineTest.GoodnessOfFit.mH120.123.root higgsCombineTest.GoodnessOfFit.mH120.123.mu1000AD.root


combine -M GoodnessOfFit ttxsec/latest_datacard_both.root --algo=saturated -t 100 -s 123 --expectSignal 1.0 --toysFreq --freezeParameters lumi_13TeV -n BothSaturated100 &
combine -M GoodnessOfFit ttxsec/latest_datacard_both.root --algo=KS -t 100 -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n BothKS100 &
combine -M GoodnessOfFit ttxsec/latest_datacard_both.root --algo=AD -t 100 -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV -n BothAD100 &



limit->Draw("limit")
h = (TH1D*) limit->GetHistogram()
h_c = (TH1D*) h->GetCumulative(kFALSE)
h_c->Draw()

h_c->GetBinContent(h_c->FindBin(33.7))
2.0

el1000
15.0000

combine -M GoodnessOfFit ttxsec/latest_datacard_el.root   --algo=saturated -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV
Best fit test statistic: 33.7364


combine -M GoodnessOfFit ttxsec/latest_datacard_el.root   --algo=KS -s 123 --expectSignal 1.0 --freezeParameters lumi_13TeV
Kolmogorov-Smirnov test statistic: 0.0179

combine -M GoodnessOfFit ttxsec/latest_datacard_el.root   --algo=KS -s 123                    --freezeParameters lumi_13TeV
Kolmogorov-Smirnov test statistic: 0.0179

h_c->GetBinContent(h_c->FindBin(0.0179))
38.0000




--- but it was reported slightly below 95% band!
   95% expected band : 7.73915 < r < 33.9236

h_c->GetBinContent(h_c->FindBin(18.8882))
37.000


damn are these correct datacards?






## checking the datacards


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec//latest_datacard_el.root --freezeParameters lumi_13TeV -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec//latest_datacard_el.root --freezeParameters lumi_13TeV -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec//latest_datacard_el.root --freezeParameters lumi_13TeV -m 125 -o latest_el_impacts.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts.json -o latest_el_impacts

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec//latest_datacard_mu.root --freezeParameters lumi_13TeV -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec//latest_datacard_mu.root --freezeParameters lumi_13TeV -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec//latest_datacard_mu.root --freezeParameters lumi_13TeV -m 125 -o latest_mu_impacts.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts.json -o latest_mu_impacts

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec//latest_datacard_both.root --freezeParameters lumi_13TeV -m 125 --robustFit 1 --doInitialFit         --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec//latest_datacard_both.root --freezeParameters lumi_13TeV -m 125 --robustFit 1 --doFits --parallel 5  --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec//latest_datacard_both.root --freezeParameters lumi_13TeV -m 125 -o latest_both_impacts.json          --name BothImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts.json -o latest_both_impacts


-rw-r--r-- 1 olek t3cms 37922 Nov  8 17:51 postfit_both_impacts.pdf
-rw------- 1 olek t3cms 34916 Nov  8 17:37 postfit_el_impacts.pdf
-rw------- 1 olek t3cms 35004 Nov  8 17:31 postfit_mu_impacts.pdf

./latest_el_impacts.pdf
./latest_mu_impacts.pdf
./latest_both_impacts.pdf

el same (indeed PU is dominant)
mu same (PU third after TOPPT)
both same


--- what if PU incorrectly normalized???




# plots in the SV tau selections

python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -p -r -o plots/v27dilep2_6fixed/ --lumi 35800 -c dy_mumu              -d lep_pt --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "p_{T}(#mu) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -p -r -o plots/v27dilep2_6fixed/ --lumi 35800 -c dy_mutau             -d lep_pt --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "p_{T}(#mu) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02

python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -p -r -o plots/v27dilep2_6fixed/ --lumi 31300 -c el_selSV             -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -p -r -o plots/v27dilep2_6fixed/ --lumi 31300 -c tt_elmu              -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02



# new bins and normalization to 100 fb^-1

hadd quick-test/distrs_v27dilep2_mc_6.root quick-test/v27-dilep2_hadds/MC*root
cp   quick-test/distrs_v27dilep2_mc_6.root jobsums/distrs/


foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -o histosels/v27dilep2/ --lumi 35800 -c mu_selSV      -d Mt_lep_met_f --wjet 0.8 --skip-QCD --systematic $sys
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o histosels/v27dilep2/ --lumi 31300 -c el_selSV      -d Mt_lep_met_f --wjet 0.8 --skip-QCD --systematic $sys
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -o histosels/v27dilep2/ --lumi 35800 -c mu_sel        -d Mt_lep_met_f --wjet 0.8 --skip-QCD --systematic $sys
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o histosels/v27dilep2/ --lumi 31300 -c el_sel        -d Mt_lep_met_f --wjet 0.8 --skip-QCD --systematic $sys
end

foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -o histosels/v27dilep2/ --lumi 35800 -c mu_selSV      -d Mt_lep_met_c --wjet 0.8 --skip-QCD --systematic $sys
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o histosels/v27dilep2/ --lumi 31300 -c el_selSV      -d Mt_lep_met_c --wjet 0.8 --skip-QCD --systematic $sys
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -o histosels/v27dilep2/ --lumi 35800 -c mu_sel        -d Mt_lep_met_c --wjet 0.8 --skip-QCD --systematic $sys
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o histosels/v27dilep2/ --lumi 31300 -c el_sel        -d Mt_lep_met_c --wjet 0.8 --skip-QCD --systematic $sys
end

foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -o histosels/v27dilep2/ --lumi 35800 -c mu_selSV      -d Mt_lep_met_c2 --wjet 0.8 --skip-QCD --systematic $sys
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o histosels/v27dilep2/ --lumi 31300 -c el_selSV      -d Mt_lep_met_c2 --wjet 0.8 --skip-QCD --systematic $sys
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -o histosels/v27dilep2/ --lumi 35800 -c mu_sel        -d Mt_lep_met_c2 --wjet 0.8 --skip-QCD --systematic $sys
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o histosels/v27dilep2/ --lumi 31300 -c el_sel        -d Mt_lep_met_c2 --wjet 0.8 --skip-QCD --systematic $sys
end

foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o histosels/v27dilep2/ --lumi 31300 -c tt_elmu       -d Mt_lep_met_f --wjet 0.8 --skip-QCD --systematic $sys
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o histosels/v27dilep2/ --lumi 31300 -c tt_elmu       -d Mt_lep_met_c --wjet 0.8 --skip-QCD --systematic $sys
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o histosels/v27dilep2/ --lumi 31300 -c tt_elmu       -d Mt_lep_met_c2 --wjet 0.8 --skip-QCD --systematic $sys
end

foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -o histosels/v27dilep2/ --lumi 35800 -c dy_mutau      -d lep_pt     --wjet 0.8 --skip-QCD --systematic $sys
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -o histosels/v27dilep2/ --lumi 35800 -c dy_mutau      -d dilep_mass --wjet 0.8 --skip-QCD --systematic $sys
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -o histosels/v27dilep2/ --lumi 35800 -c dy_mumu       -d lep_pt     --wjet 0.8 --skip-QCD --systematic $sys
end

source histos_1 &
source histos_2 &
source histos_3 &
source histos_4 &
source histos_5 &

cp histos_1 histos_100fb_1
cp histos_2 histos_100fb_2
cp histos_3 histos_100fb_3
cp histos_4 histos_100fb_4
cp histos_5 histos_100fb_5

vim -p histos_100fb_?

source histos_100fb_1 &
source histos_100fb_2 &
source histos_100fb_3 &
source histos_100fb_4 &
source histos_100fb_5 &


hadd histosels/histosels_v27dilep2_6.root       histosels/v27dilep2/distrs_6/*root
hadd histosels/histosels_v27dilep2_6_100fb.root histosels/v27dilep2_100fb/distrs_6/*root

-- not added all the files?

hadd histosels/histosels_v27dilep2_6_Mt_lep_met_f.root    histosels/v27dilep2/distrs_6/*Mt_lep_met_f*root &
hadd histosels/histosels_v27dilep2_6_Mt_lep_met_c.root    histosels/v27dilep2/distrs_6/*Mt_lep_met_c*root &
hadd histosels/histosels_v27dilep2_6_Mt_lep_met_c2.root   histosels/v27dilep2/distrs_6/*Mt_lep_met_c2*root &
hadd histosels/histosels_v27dilep2_6_lep_pt.root          histosels/v27dilep2/distrs_6/*lep_pt*root &
hadd histosels/histosels_v27dilep2_6_dilep_mass.root      histosels/v27dilep2/distrs_6/*dilep_mass*root &


hadd histosels/histosels_v27dilep2_6_100fb_Mt_lep_met_f.root    histosels/v27dilep2_100fb/distrs_6/*Mt_lep_met_f*root &
hadd histosels/histosels_v27dilep2_6_100fb_Mt_lep_met_c.root    histosels/v27dilep2_100fb/distrs_6/*Mt_lep_met_c*root &
hadd histosels/histosels_v27dilep2_6_100fb_Mt_lep_met_c2.root   histosels/v27dilep2_100fb/distrs_6/*Mt_lep_met_c2*root &
hadd histosels/histosels_v27dilep2_6_100fb_lep_pt.root          histosels/v27dilep2_100fb/distrs_6/*lep_pt*root &
hadd histosels/histosels_v27dilep2_6_100fb_dilep_mass.root      histosels/v27dilep2_100fb/distrs_6/*dilep_mass*root &

hadd histosels/histosels_v27dilep2_6_100fb.root histosels/histosels_v27dilep2_6_100fb_*.root &
hadd histosels/histosels_v27dilep2_6.root       histosels/histosels_v27dilep2_6_Mt*.root histosels/histosels_v27dilep2_6_lep_pt*.root histosels/histosels_v27dilep2_6_dilep_mass*.root &





## repeat the hybrid with new selection

no SV in tt, usual SV in DY

python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -p -r -o plots/v27dilep2_6/ --lumi 31300 -c el_sel               -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -p -r -o plots/v27dilep2_6/ --lumi 31300 -c el_sel               -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5            --title "" --title-x "M_{T}(e, MET) [GeV]"  --title-y "[Events]"     --draw-overflows 5 --legend-shift 0.02

python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -p -r -o plots/v27dilep2_6/ --lumi 31300 -c el_selSV             -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5            --title "" --title-x "M_{T}(e, MET) [GeV]"  --title-y "[Events]"     --draw-overflows 5 --legend-shift 0.02

-- broken SV selection!!!


python numbers_for_datacard.py histosels/histosels_v27dilep2_6.root -d Mt_lep_met_f -c el_sel,tt_elmu   --no-sums

Mt _f not done?

python numbers_for_datacard.py histosels/histosels_v27dilep2_6.root -d Mt_lep_met_c -c el_sel,tt_elmu   --no-sums





combineCards.py el=ttxsec/v27dilep2_ratio_6_el.txt elmu=ttxsec/v27dilep2_ratio_6_elmu.txt > ttxsec/v27dilep2_ratio_6_multi_el_elmu.txt
combineCards.py el=ttxsec/v27dilep2_ratio_6_el.txt elmu=ttxsec/v27dilep2_ratio_6_elmu.txt dy_mumu=ttxsec/v27dilep2_ratio_dy_mumu.txt dy_mutau=ttxsec/v27dilep2_ratio_dy_mutau.txt > ttxsec/v27dilep2_ratio_6_all.txt

vim -p ttxsec/v27dilep2_ratio_6_all.txt ttxsec/v27dilep2_ratio_6_multi_el_elmu.txt ttxsec/v27dilep2_ratio_el_elmu.txt

with simple ratio

./scripts/text2workspace.py ttxsec/v27dilep2_ratio_6_multi_el_elmu.txt
./scripts/text2workspace.py ttxsec/v27dilep2_ratio_6_all.txt


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6_multi_el_elmu.root -m 125 --robustFit 1 --doInitialFit                  -n RatioElMuShapesExpect6noSV

was:

best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.074/+0.075 (68%)
Done in 0.04 min (cpu), 0.04 min (real)

in 5:

best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.088/+0.094 (68%)
Done in 0.02 min (cpu), 0.02 min (real)

in 6:

   tau_ratio :    +1.000   -0.054/+0.058 (68%)


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6_multi_el_elmu.root -m 125 --robustFit 1 --doFits --parallel 5           -n RatioElMuShapesExpect6noSV
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6_multi_el_elmu.root -m 125 -o latest_ratioElMu_toys_asimov_impacts6noSV.json -n RatioElMuShapesExpect6noSV
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioElMu_toys_asimov_impacts6noSV.json -o latest_ratioElMu_toys_asimov_impacts6noSV

in 5:

1. tau ID 5%
2. fakes  3-3.5%  <---- ?
3. bSF    3%
4. JES   1-1.2%

TES small and asymetric
wjets even smaller

in 6:

sharp tau ID

1. tau ID  5%
2. TES     1%
3. LEPmuID 1%
4. Frag    less 1%

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6_all.root -m 125 --robustFit 1 --doInitialFit                      -n RatioAllShapesExpect6noSV

in 6:

   tau_ratio :    +1.000   -0.035/+0.035 (68%)

works as the hybrid!

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6_all.root -m 125 --robustFit 1 --doFits --parallel 5               -n RatioAllShapesExpect6noSV
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6_all.root -m 125 -o latest_ratioAll_toys_asimov_impacts6noSV.json  -n RatioAllShapesExpect6noSV
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioAll_toys_asimov_impacts6noSV.json -o latest_ratioAll_toys_asimov_impacts6noSV

1. tauID_eff a bit more than 2%
2. bSF                       2%
3. wjets                     1%
4. fakes     a bit less than 1%





## no-SV selections with 100fb

python numbers_for_datacard.py histosels/histosels_v27dilep2_6_100fb.root -d Mt_lep_met_f -c el_sel,tt_elmu   --no-sums
python numbers_for_datacard.py histosels/histosels_v27dilep2_6_100fb.root -d lep_pt       -c dy_mutau,dy_mumu --no-sums

el_sel
rate          13156.181  8209.409   431.232    767.114         373.153         113.186         856.831         116.311         796.256         33.218          846.863         332.194         856.135
rate          42032.528  26228.145  1377.737   2450.843        1192.183        361.616         2737.479        371.600         2543.948        106.128         2705.632        1061.322        2735.255                  

tt_elmu
rate          88.789     1097.015   39.987     12.309        284724.702    578.982       94.384        16081.926     4.799         0.000         45.171        94.639        672.317                                 

dy_mumu
rate          50.491       529.639      46.148       6.282        49407.719    25464.975    134.488      4225.826     2.722        8.976        152.982      19732512.179 12104.558                                    

dy_mutau
rate          469.616      352.860      67.211       67.155       42.065       394.544      124.754      34.305       70.227       311.053      2535.520     521.460      29487.984                                    



cp ttxsec/v27dilep2_ratio_6_el.txt      ttxsec/v27dilep2_ratio_6_100fb_el.txt    
cp ttxsec/v27dilep2_ratio_6_elmu.txt    ttxsec/v27dilep2_ratio_6_100fb_elmu.txt
cp ttxsec/v27dilep2_ratio_dy_mumu.txt   ttxsec/v27dilep2_ratio_6_100fb_dy_mumu.txt
cp ttxsec/v27dilep2_ratio_dy_mutau.txt  ttxsec/v27dilep2_ratio_6_100fb_dy_mutau.txt

combineCards.py el=ttxsec/v27dilep2_ratio_6_100fb_el.txt elmu=ttxsec/v27dilep2_ratio_6_100fb_elmu.txt > ttxsec/v27dilep2_ratio_6_100fb_multi_el_elmu.txt
combineCards.py el=ttxsec/v27dilep2_ratio_6_100fb_el.txt elmu=ttxsec/v27dilep2_ratio_6_100fb_elmu.txt dy_mumu=ttxsec/v27dilep2_ratio_6_100fb_dy_mumu.txt dy_mutau=ttxsec/v27dilep2_ratio_6_100fb_dy_mutau.txt > ttxsec/v27dilep2_ratio_6_100fb_all.txt

vim -p ttxsec/v27dilep2_ratio_6_100fb_all.txt ttxsec/v27dilep2_ratio_6_100fb_multi_el_elmu.txt ttxsec/v27dilep2_ratio_el_elmu.txt

./scripts/text2workspace.py ttxsec/v27dilep2_ratio_6_100fb_multi_el_elmu.txt
./scripts/text2workspace.py ttxsec/v27dilep2_ratio_6_100fb_all.txt



../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6_100fb_multi_el_elmu.root -m 125 --robustFit 1 --doInitialFit                            -n RatioElMuShapesExpect6noSV_100fb

in 6 100fb:
   tau_ratio :    +1.000   -0.049/+0.051 (68%)

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6_100fb_multi_el_elmu.root -m 125 --robustFit 1 --doFits --parallel 5                     -n RatioElMuShapesExpect6noSV_100fb
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6_100fb_multi_el_elmu.root -m 125 -o latest_ratioElMu_toys_asimov_impacts6noSV_100fb.json -n RatioElMuShapesExpect6noSV_100fb
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioElMu_toys_asimov_impacts6noSV_100fb.json -o latest_ratioElMu_toys_asimov_impacts6noSV_100fb

sharp tau ID again

1. tau ID close to 5%
2. TES around 1%
3. dy norm    1%
4. mu ID      1%
5 wjets       1%


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6_100fb_all.root -m 125 --robustFit 1 --doInitialFit                      -n RatioAllShapesExpect6noSV_100fb

in 6 100fb:
   tau_ratio :    +1.000   -0.027/+0.027 (68%)

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6_100fb_all.root -m 125 --robustFit 1 --doFits --parallel 5               -n RatioAllShapesExpect6noSV_100fb
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6_100fb_all.root -m 125 -o latest_ratioAll_toys_asimov_impacts6noSV_100fb.json  -n RatioAllShapesExpect6noSV_100fb
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioAll_toys_asimov_impacts6noSV_100fb.json -o latest_ratioAll_toys_asimov_impacts6noSV_100fb

1. tau ID 2%
2. bSF    2%
3. wjets  1%
3. TES
4. Frag

kind of the same but smaller



### uncertainty breakdown, does systematic change together with the statistics or they are independent?





## SV selections, with 100fb and with finer binning

need to re-run plotting due to broken SV requirement
-- new scripts, better bunch script


hadd quick-test/distrs_v27dilep2_mc_6fixed.root quick-test/v27-dilep2_hadds/MC*root
cp quick-test/distrs_v27dilep2_mc_6fixed.root jobsums/distrs/distrs_v27dilep2_mc_6fixed.root

python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o plots/v27dilep2_6fixed/ --lumi 31300 -c el_selSV        -d Mt_lep_met_f  --wjet 0.8 --skip-QCD -p -r
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o plots/v27dilep2_6fixed/ --lumi 31300 -c el_selSV        -d Mt_lep_met_c  --bin-norm --wjet 0.8 --skip-QCD -p -r
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o plots/v27dilep2_6fixed/ --lumi 31300 -c el_selSV        -d Mt_lep_met_c2 --bin-norm --wjet 0.8 --skip-QCD -p -r


foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -o histosels/v27dilep2_100fb/ --lumi 100000 -c dy_mutau      -d lep_pt --wjet 0.8 --skip-QCD --systematic $sys
end

foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o histosels/v27dilep2_100fb/ --lumi 100000 -c el_selSV        -d Mt_lep_met_c  --wjet 0.8 --skip-QCD --systematic $sys
end


foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o histosels/v27dilep2_100fb/ --lumi 100000 -c tt_elmu       -d Mt_lep_met_c --wjet 0.8 --skip-QCD --systematic $sys
end

foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -o histosels/v27dilep2_100fb/ --lumi 100000 -c mu_selSV        -d Mt_lep_met_c --wjet 0.8 --skip-QCD --systematic $sys
end

foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -o histosels/v27dilep2_100fb/ --lumi 100000 -c dy_mumu       -d lep_pt --wjet 0.8 --skip-QCD --systematic $sys
end

source histos_100fb_1 &
source histos_100fb_2 &
source histos_100fb_3 &
source histos_100fb_4 &
source histos_100fb_5 &


foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o histosels/v27dilep2_100fb/ --lumi 100000 -c el_selSV        -d Mt_lep_met_f  --wjet 0.8 --skip-QCD --systematic $sys
end

foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o histosels/v27dilep2_100fb/ --lumi 100000 -c el_selSV        -d Mt_lep_met_c2 --wjet 0.8 --skip-QCD --systematic $sys
end

foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o histosels/v27dilep2_100fb/ --lumi 1000000 -c el_selSV        -d Mt_lep_met_f  --wjet 0.8 --skip-QCD --systematic $sys
end

foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o histosels/v27dilep2_100fb/ --lumi 1000000 -c el_selSV        -d Mt_lep_met_c2 --wjet 0.8 --skip-QCD --systematic $sys
end


 muIDDown
8053.767696
elTRGDown
7550.191207

2 PDFs
7625.199135
7740.192730

check it agains NOMINAL for all distrs


10k true SV taus in electron-tau channel

foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o histosels/v27dilep2_10kSV/ --lumi 225000 -c el_selSV        -d Mt_lep_met_f  --wjet 0.8 --skip-QCD --systematic $sys
end

foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o histosels/v27dilep2_10kSV/ --lumi 225000 -c el_selSV        -d Mt_lep_met_c2 --wjet 0.8 --skip-QCD --systematic $sys
end

foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o histosels/v27dilep2_10kSV/ --lumi 225000 -c el_selSV        -d Mt_lep_met_c  --wjet 0.8 --skip-QCD --systematic $sys
end

source histos_10kSV_1 &
source histos_10kSV_2 &
source histos_10kSV_3 &

hadd histosels/histosels_v27dilep2_6fixed_10kSV.root histosels/v27dilep2_10kSV//distrs/*

python numbers_for_datacard.py histosels/histosels_v27dilep2_6fixed_10kSV.root -d Mt_lep_met_c2 -c el_selSV --no-sums



mv histosels/v27dilep2_100fb/distrs histosels/v27dilep2_100fb/distrs_6fixed

hadd histosels/histosels_v27dilep2_100fb_6fixed.root histosels/v27dilep2_100fb/distrs_6fixed/*root

python numbers_for_datacard.py histosels/histosels_v27dilep2_100fb_6fixed.root -d Mt_lep_met_f -c el_sel,tt_elmu   --no-sums

regular and with SV

observation  29777.000000
obs 2268.000000

bin           el_sel     el_sel     el_sel     el_sel          el_sel          el_sel          el_sel          el_sel          el_sel          el_sel          el_sel          el_sel          el_sel
process       tt_eltau   tt_lj      tt_taulj   tt_taultauh     tt_other        dibosons        s_top_lj        s_top_other     s_top_eltau     wjets_taul      wjets_other     dy_other        dy_tautau                
process       0          3          4          5               -1              7               8               9               12              14              15              16              17                       
rate          42032.528  26228.145  1377.737   2450.843        1192.183        361.616         2737.479        371.600         2543.948        106.128         2705.632        1061.322        2735.255                 

bin           el_selSV      el_selSV      el_selSV      el_selSV      el_selSV      el_selSV      el_selSV      el_selSV      el_selSV      el_selSV      el_selSV      el_selSV      el_selSV                                               process       tt_eltau      tt_lj         tt_taulj      tt_taultauh   tt_other      dibosons      s_top_lj      s_top_other   s_top_eltau   wjets_taul    wjets_other   dy_other      dy_tautau                      
process       0             3             4             5             6             7             8             9             12            14            15            16            17                                                     rate          4474.943      1846.215      109.259       266.666       89.286        24.929        174.936       29.349        269.531       4.675         78.869        24.794        226.260                      

-- almost 10 times less true taus


combineCards.py el=ttxsec/v27dilep2_ratio_6fixed_100fb_el.txt elmu=ttxsec/v27dilep2_ratio_6_100fb_elmu.txt > ttxsec/v27dilep2_ratio_6fixed1_100fb_multi_el_elmu.txt
combineCards.py el=ttxsec/v27dilep2_ratio_6fixed_100fb_el.txt elmu=ttxsec/v27dilep2_ratio_6_100fb_elmu.txt dy_mumu=ttxsec/v27dilep2_ratio_6_100fb_dy_mumu.txt dy_mutau=ttxsec/v27dilep2_ratio_6_100fb_dy_mutau.txt > ttxsec/v27dilep2_ratio_6fixed1_100fb_all.txt

vim -p ttxsec/v27dilep2_ratio_6fixed1_100fb_all.txt ttxsec/v27dilep2_ratio_6fixed1_100fb_multi_el_elmu.txt ttxsec/v27dilep2_ratio_el_elmu.txt

./scripts/text2workspace.py ttxsec/v27dilep2_ratio_6fixed1_100fb_multi_el_elmu.txt
./scripts/text2workspace.py ttxsec/v27dilep2_ratio_6fixed1_100fb_all.txt


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed1_100fb_multi_el_elmu.root -m 125 --robustFit 1 --doInitialFit                            -n RatioElMuShapesExpect6noSV_100fbSV

in 6 100fb:
was
   tau_ratio :    +1.000   -0.049/+0.051 (68%)

now
   tau_ratio :    +1.000   -0.069/+0.072 (68%)

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed1_100fb_multi_el_elmu.root -m 125 --robustFit 1 --doFits --parallel 5                     -n RatioElMuShapesExpect6noSV_100fbSV
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed1_100fb_multi_el_elmu.root -m 125 -o latest_ratioElMu_toys_asimov_impacts6noSV_100fbSV.json -n RatioElMuShapesExpect6noSV_100fbSV
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioElMu_toys_asimov_impacts6noSV_100fbSV.json -o latest_ratioElMu_toys_asimov_impacts6noSV_100fbSV


all channels

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed1_100fb_all.root -m 125 --robustFit 1 --doInitialFit                            -n RatioAllShapesExpect6noSV_100fbSV

in 6 100fb:
was
   tau_ratio :    +1.000   -0.027/+0.027 (68%)

now
   tau_ratio :    +1.000   -0.043/+0.041 (68%)

damn!

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed1_100fb_all.root -m 125 --robustFit 1 --doFits --parallel 5                     -n RatioAllShapesExpect6noSV_100fbSV
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed1_100fb_all.root -m 125 -o latest_ratioAll_toys_asimov_impacts6noSV_100fb.json  -n RatioAllShapesExpect6noSV_100fbSV
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioAll_toys_asimov_impacts6noSV_100fb.json -o latest_ratioAll_toys_asimov_impacts6noSV_100fb

there are some errors
 ---------------------------

 WARNING: MultiDimFit failed

 ---------------------------

and

File higgsCombine_paramFit_RatioAllShapesExpect6noSV_100fbSV_LEPelTRG.MultiDimFit.mH125.root did not contain a sufficient number of entries, skipping
File higgsCombine_paramFit_RatioAllShapesExpect6noSV_100fbSV_PU.MultiDimFit.mH125.root did not contain a sufficient number of entries, skipping
File higgsCombine_paramFit_RatioAllShapesExpect6noSV_100fbSV_wjets_norm.MultiDimFit.mH125.root did not contain a sufficient number of entries, skipping
Missing inputs: LEPelTRG,PU,wjets_norm

similar picture to before:

1. fakes 2%
2. TES   1.5%
3. ID    1.2%
4. mu ID 1%



### fine binning

python numbers_for_datacard.py histosels/histosels_v27dilep2_100fb_6fixed.root -d Mt_lep_met_f -c el_selSV   --no-sums

-- same as _c, the range is the same

combineCards.py el=ttxsec/v27dilep2_ratio_6fixed_100fb_el.txt elmu=ttxsec/v27dilep2_ratio_6_100fb_elmu.txt > ttxsec/v27dilep2_ratio_6fixed2_100fb_multi_el_elmu.txt
combineCards.py el=ttxsec/v27dilep2_ratio_6fixed_100fb_el.txt elmu=ttxsec/v27dilep2_ratio_6_100fb_elmu.txt dy_mumu=ttxsec/v27dilep2_ratio_6_100fb_dy_mumu.txt dy_mutau=ttxsec/v27dilep2_ratio_6_100fb_dy_mutau.txt > ttxsec/v27dilep2_ratio_6fixed2_100fb_all.txt

vim -p ttxsec/v27dilep2_ratio_6fixed2_100fb_all.txt ttxsec/v27dilep2_ratio_6fixed2_100fb_multi_el_elmu.txt ttxsec/v27dilep2_ratio_el_elmu.txt

./scripts/text2workspace.py ttxsec/v27dilep2_ratio_6fixed2_100fb_multi_el_elmu.txt
./scripts/text2workspace.py ttxsec/v27dilep2_ratio_6fixed2_100fb_all.txt


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_100fb_all.root -m 125 --robustFit 1 --doInitialFit                            -n RatioAllShapesExpect6noSV_100fbSV

   tau_ratio :    +1.000   -0.039/+0.039 (68%)

eeh, still 1% to go?

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_100fb_all.root -m 125 --robustFit 1 --doFits --parallel 5                     -n RatioAllShapesExpect6noSV_100fbSV
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_100fb_all.root -m 125 -o latest_ratioAll_toys_asimov_impacts6SV_100fb_Mt_f.json  -n RatioAllShapesExpect6noSV_100fbSV
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioAll_toys_asimov_impacts6SV_100fb_Mt_f.json -o latest_ratioAll_toys_asimov_impacts6SV_100fb_Mt_f

tau_ratio +- 0.042 ????

1. fakes  1.5%
2. wjets  1.5%
3. TES    1%
4. tau ID 1%




### custom binning 2

combineCards.py el=ttxsec/v27dilep2_ratio_6fixed2_100fb_el_Mt_c2.txt elmu=ttxsec/v27dilep2_ratio_6_100fb_elmu.txt dy_mumu=ttxsec/v27dilep2_ratio_6_100fb_dy_mumu.txt dy_mutau=ttxsec/v27dilep2_ratio_6_100fb_dy_mutau.txt > ttxsec/v27dilep2_ratio_6fixed2_100fb_all_c2.txt

vim -p ttxsec/v27dilep2_ratio_6fixed2_100fb_all_c2.txt ttxsec/v27dilep2_ratio_el_elmu.txt

./scripts/text2workspace.py ttxsec/v27dilep2_ratio_6fixed2_100fb_all_c2.txt

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_100fb_all_c2.root -m 125 --robustFit 1 --doInitialFit                            -n RatioAllShapesExpect6noSV_100fbSV

   tau_ratio :    +1.000   -0.041/+0.039 (68%)
... same

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_100fb_all_c2.root -m 125 --robustFit 1 --doFits --parallel 5                     -n RatioAllShapesExpect6noSV_100fbSV
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_100fb_all_c2.root -m 125 -o latest_ratioAll_toys_asimov_impacts6SV_100fb_Mt_c2.json  -n RatioAllShapesExpect6noSV_100fbSV
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioAll_toys_asimov_impacts6SV_100fb_Mt_c2.json -o latest_ratioAll_toys_asimov_impacts6SV_100fb_Mt_c2

same systs





### 1000 lumi (42k SV taus)

hadd histosels/histosels_v27dilep2_1000fb_6fixed2_elSV.root histosels/v27dilep2_1000fb/distrs/*root

python numbers_for_datacard.py histosels/histosels_v27dilep2_1000fb_6fixed2_elSV.root -d Mt_lep_met_f  -c el_selSV --no-sums

bin           el_selSV                 el_selSV                 el_selSV                 el_selSV                 el_selSV                 el_selSV                 el_selSV                 el_selSV                 el_selSV                 el_selSV                 el_selSV                 el_selSV                 el_selSV                 
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons                 s_top_lj                 s_top_other              s_top_eltau              wjets_taul               wjets_other              dy_other                 dy_tautau                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       14                       15                       16                       17                       
rate          44749.425                18462.149                1092.586                 2666.657                 892.859                  249.290                  1749.360                 293.490                  2695.312                 46.749                   788.694                  247.940                  2262.598                 


python numbers_for_datacard.py histosels/histosels_v27dilep2_1000fb_6fixed2_elSV.root -d Mt_lep_met_c2 -c el_selSV --no-sums

bin           el_selSV                 el_selSV                 el_selSV                 el_selSV                 el_selSV                 el_selSV                 el_selSV                 el_selSV                 el_selSV                 el_selSV                 el_selSV                 el_selSV                 el_selSV                 
process       tt_eltau                 tt_lj                    tt_taulj                 tt_taultauh              tt_other                 dibosons                 s_top_lj                 s_top_other              s_top_eltau              wjets_taul               wjets_other              dy_other                 dy_tautau                
process       0                        3                        4                        5                        6                        7                        8                        9                        12                       14                       15                       16                       17                       
rate          45740.548                18472.102                1092.586                 2681.068                 896.895                  248.620                  1749.360                 306.835                  2813.050                 46.749                   788.694                  247.940                  2262.598                 


combineCards.py el=ttxsec/v27dilep2_ratio_6fixed2_1000fb_el_Mt_f.txt elmu=ttxsec/v27dilep2_ratio_6_100fb_elmu.txt dy_mumu=ttxsec/v27dilep2_ratio_6_100fb_dy_mumu.txt dy_mutau=ttxsec/v27dilep2_ratio_6_100fb_dy_mutau.txt > ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_f.txt

vim -p ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_f.txt ttxsec/v27dilep2_ratio_el_elmu.txt

./scripts/text2workspace.py ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_f.txt

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_f.root -m 125 --robustFit 1 --doInitialFit                               -n RatioAllShapesExpect6noSV_1000fbSV


 ---------------------------

 WARNING: MultiDimFit failed

 ---------------------------



../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_f.root -m 125 --robustFit 1 --doFits --parallel 5                        -n RatioAllShapesExpect6noSV_1000fbSV
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_f.root -m 125 -o latest_ratioAll_toys_asimov_impacts6SV_1000fb_Mt_f.json -n RatioAllShapesExpect6noSV_1000fbSV
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioAll_toys_asimov_impacts6SV_1000fb_Mt_f.json -o latest_ratioAll_toys_asimov_impacts6SV_1000fb_Mt_f



ok, c2:

combineCards.py el=ttxsec/v27dilep2_ratio_6fixed2_1000fb_el_Mt_c2.txt elmu=ttxsec/v27dilep2_ratio_6_100fb_elmu.txt dy_mumu=ttxsec/v27dilep2_ratio_6_100fb_dy_mumu.txt dy_mutau=ttxsec/v27dilep2_ratio_6_100fb_dy_mutau.txt > ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_c2.txt

vim -p ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_c2.txt ttxsec/v27dilep2_ratio_el_elmu.txt

./scripts/text2workspace.py ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_c2.txt

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_c2.root -m 125 --robustFit 1 --doInitialFit                                -n RatioAllShapesExpect6noSV_1000fbSVc2

   tau_ratio :    +1.000   -0.021/+0.017 (68%)

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_c2.root -m 125 --robustFit 1 --doFits --parallel 5                         -n RatioAllShapesExpect6noSV_1000fbSVc2
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_c2.root -m 125 -o latest_ratioAll_toys_asimov_impacts6SV_1000fb_Mt_c2.json -n RatioAllShapesExpect6noSV_1000fbSVc2
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioAll_toys_asimov_impacts6SV_1000fb_Mt_c2.json -o latest_ratioAll_toys_asimov_impacts6SV_1000fb_Mt_c2


1. TES 1%
2. tau ID less 1%
3. mu ID less 1%
4. JER about 0.7%
5. wjets 0.6%


the breakdown of uncertainties


combine -M MultiDimFit --algo none -t -1 --redefineSignalPOIs tau_ratio --setParameters r=1.0 --rMin 0.5 --rMax 1.5 ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_c2.root --saveWorkspace -n ExpectedRatio1000Bestfit --freezeParameters r

combine -M MultiDimFit --algo grid -t -1 --redefineSignalPOIs tau_ratio --setParameters r=1.0 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedRatio1000Bestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters "tauID_eff,tau_fakes,lumi_13TeV,r" -n ExpectedRatio1000NoTau

[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!
for 0.925 - 1.055

combine -M MultiDimFit --algo grid -t -1 --redefineSignalPOIs tau_ratio --setParameters r=1.0 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedRatio1000Bestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters all --fastScan -n ExpectedRatio1000NoSys
combine -M MultiDimFit --algo grid -t -1 --redefineSignalPOIs tau_ratio --setParameters r=1.0 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedRatio1000Bestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit -n ExpectedRatio1000FullUncertaintyNoLumi --freezeParameters lumi_13TeV,r
combine -M MultiDimFit --algo grid -t -1 --redefineSignalPOIs tau_ratio --setParameters r=1.0 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedRatio1000Bestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit -n ExpectedRatio1000FullUncertainty --freezeParameters r

plot1DScan.py --POI tau_ratio higgsCombineExpectedRatio1000FullUncertainty.MultiDimFit.mH120.root --others 'higgsCombineExpectedRatio1000FullUncertaintyNoLumi.MultiDimFit.mH120.root:lumi:4' 'higgsCombineExpectedRatio1000NoSys.MultiDimFit.mH120.root:stat:2' --breakdown lumi,syst,stat

mv scan.png scan_SV1000_c2.png
mv scan.pdf scan_SV1000_c2.pdf

1 +- 0.001lumi +- 0.017-0.020syst +- 0.006stat

stat = 1/3 of syst





### double ratio with dy in ?? distr

dilep_norm              extArg                   1.         [0.8,1.2]
tau_ratio               extArg                   1.         [0.85,1.15]
rate_elmu               rateParam  elmu     tt_other  (@0)   dilep_norm
rate_eltau              rateParam  el       tt_eltau (@0*@1) dilep_norm,tau_ratio

dy_other  (mumu)
dy_tautau (taul tauh)

norm_tt                 extArg                   1.         [0.8,1.2]
norm_dy                 extArg                   1.         [0.8,1.2]
dy_ratio                extArg                   1.         [0.85,1.15]
tt_per_dy               extArg                   1.         [0.85,1.15]

rate_elmu               rateParam  elmu     tt_other  (@0)       norm_tt
rate_eltau              rateParam  el       tt_eltau  (@0*@1*@2) norm_tt,dy_ratio,tt_per_dy

rate_mumu               rateParam  dy_mumu     dy_other  (@0)    norm_dy
rate_mutau              rateParam  dy_mutau    dy_tautau (@0*@1) norm_dy,dy_ratio


./scripts/text2workspace.py ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_c2_double.txt

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tt_per_dy --freezeParameters r,dy_norm --setParameters r=1.0,dy_norm=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_c2_double.root -m 125 --robustFit 1 --doInitialFit                                -n RatioAllShapesExpect6noSV_1000fbSVc2Double

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tt_per_dy --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_c2_double.root -m 125 --robustFit 1 --doInitialFit                                -n RatioAllShapesExpect6noSV_1000fbSVc2Double

in simple:
   tau_ratio :    +1.000   -0.021/+0.017 (68%)

now
   tt_per_dy :    +1.000   -0.021/+0.018 (68%)

same

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tt_per_dy --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_c2_double.root -m 125 --robustFit 1 --doFits --parallel 5                         -n RatioAllShapesExpect6noSV_1000fbSVc2Double
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tt_per_dy --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_1000fbElSV_all_c2_double.root -m 125 -o latest_ratioAll_toys_asimov_impacts6SV_1000fb_Mt_c2_double.json -n RatioAllShapesExpect6noSV_1000fbSVc2Double
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioAll_toys_asimov_impacts6SV_1000fb_Mt_c2_double.json -o latest_ratioAll_toys_asimov_impacts6SV_1000fb_Mt_c2_double

1+-0.0196

TES, muID, wjets, fakes, PU



and in 100fb:

was
   tau_ratio :    +1.000   -0.041/+0.039 (68%)

./scripts/text2workspace.py ttxsec/v27dilep2_ratio_6fixed2_100fb_all_c2_double.txt

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tt_per_dy --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_100fb_all_c2_double.root -m 125 --robustFit 1 --doInitialFit                            -n RatioAllShapesExpect6noSV_100fbSVdouble

best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tt_per_dy
 Warning - No valid low-error found, will report difference to minimum of range for : tt_per_dy
   tt_per_dy :    +1.000   -0.150/+0.150 (68%)
Done in 0.00 min (cpu), 0.01 min (real)


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tt_per_dy --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_100fb_all_c2_double.root -m 125 --robustFit 1 --doFits --parallel 5                     -n RatioAllShapesExpect6noSV_100fbSVdouble
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tt_per_dy --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_100fb_all_c2_double.root -m 125 -o latest_ratioAll_toys_asimov_impacts6SV_100fb_Mt_c2_double.json  -n RatioAllShapesExpect6noSV_100fbSVdouble
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioAll_toys_asimov_impacts6SV_100fb_Mt_c2_double.json -o latest_ratioAll_toys_asimov_impacts6SV_100fb_Mt_c2_double


currently:

in hybrid I have 10k taus in TT and it works,
DY has 10k taus everywhere
4.5k taus (100fb) are not enough
   tau_ratio :    +1.000   -0.041/+0.039 (68%)

TODO:
1. confirm this statistical thing
2. how many taus are needed? (10k can be done with mutau and 140fb)



### 10k true SV taus in tt

combineCards.py el=ttxsec/v27dilep2_ratio_6fixed2_10kSV_el_Mt_c2.txt elmu=ttxsec/v27dilep2_ratio_6_100fb_elmu.txt dy_mumu=ttxsec/v27dilep2_ratio_6_100fb_dy_mumu.txt dy_mutau=ttxsec/v27dilep2_ratio_6_100fb_dy_mutau.txt > ttxsec/v27dilep2_ratio_6fixed2_10kSV_all.txt

vim -p ttxsec/v27dilep2_ratio_6fixed2_10kSV_all.txt ttxsec/v27dilep2_ratio_el_elmu.txt

./scripts/text2workspace.py ttxsec/v27dilep2_ratio_6fixed2_10kSV_all.txt


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_10kSV_all.root -m 125 --robustFit 1 --doInitialFit                            -n RatioAllShapesExpect6_10kSV

one of old runs:
   tau_ratio :    +1.000   -0.039/+0.039 (68%)

   tau_ratio :    +1.000   -0.031/+0.028 (68%)

so we get 3%

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_10kSV_all.root -m 125 --robustFit 1 --doFits --parallel 5                     -n RatioAllShapesExpect6_10kSV
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_6fixed2_10kSV_all.root -m 125 -o latest_ratioAll_toys_asimov_impacts6SV_10k_Mt_c2.json  -n RatioAllShapesExpect6_10kSV
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioAll_toys_asimov_impacts6SV_10k_Mt_c2.json -o latest_ratioAll_toys_asimov_impacts6SV_10k_Mt_c2

1 +- 0.0299

1. TES about 1.3%
2. wjets     1.1%
3. tau ID    1  %
4. fakes     1  %
5. mu ID     1  %



### toy study of cross-section measurement in 35fb and 1000fb -- how do stats affect the systematics?



### max lumi 140fb



### VLoose + SV taus?










# new questioning

wjets correlate very similar to hybrid
fakes-tauID-ratio -- no

freeze fakes:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,tau_fakes --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 --robustFit 1 --doInitialFit                  -n RatioAllShapesExpectNoFakes
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,tau_fakes --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 --robustFit 1 --doFits --parallel 5           -n RatioAllShapesExpectNoFakes
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,tau_fakes --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 -o latest_ratioAll_toys_asimov_impacts_NoFakes.json  -n RatioAllShapesExpectNoFakes
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioAll_toys_asimov_impacts_NoFakes.json -o latest_ratioAll_toys_asimov_impacts_NoFakes

   tau_ratio :    +1.000   -0.057/+0.057 (68%)

suddenly
1. Frag  3% <-- was less than 1% in normal run
2. wjets 2% <-- from 3%

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,dilep_norm --setParameters r=1.0,dilep_norm=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 --robustFit 1 --doInitialFit                         -n RatioAllShapesExpectNoDilepNorm
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,dilep_norm --setParameters r=1.0,dilep_norm=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 --robustFit 1 --doFits --parallel 5                  -n RatioAllShapesExpectNoDilepNorm
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,dilep_norm --setParameters r=1.0,dilep_norm=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 -o latest_ratioAll_toys_asimov_impacts_NoDilepNorm.json  -n RatioAllShapesExpectNoDilepNorm
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioAll_toys_asimov_impacts_NoDilepNorm.json -o latest_ratioAll_toys_asimov_impacts_NoDilepNorm

   tau_ratio :    +1.000   -0.070/+0.069 (68%)

and warnings are there



../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,tau_fakes,Frag --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 --robustFit 1 --doInitialFit                             -n RatioAllShapesExpectNoFakesNoFrag
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,tau_fakes,Frag --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 --robustFit 1 --doFits --parallel 5                      -n RatioAllShapesExpectNoFakesNoFrag
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,tau_fakes,Frag --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 -o latest_ratioAll_toys_asimov_impacts_NoFakesNoFrag.json  -n RatioAllShapesExpectNoFakesNoFrag
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioAll_toys_asimov_impacts_NoFakesNoFrag.json -o latest_ratioAll_toys_asimov_impacts_NoFakesNoFrag

   tau_ratio :    +1.000   -0.048/+0.047 (68%)

bSF 1%
and a number of similar 1% systematics, like Peterson, TES, wjets, elTRG
-- all were very small in the initial run




check Frag and JES

python get_shapes.py  --norm-binwidth --formula " NOM : FragUp : FragDown " -c el_sel -d Mt_lep_met_f -p tt_lj NOM:distrs/distrs_v27dilep2_mc_5.root:el_sel,tt_eltau,NOMINAL FragUp:distrs/distrs_v27dilep2_mc_5.root:el_sel,tt_eltau,FragUp FragDown:distrs/distrs_v27dilep2_mc_5.root:el_sel,tt_eltau,FragDown 

python get_shapes.py  --norm-binwidth --formula " NOM : JESUp : JESDown " -c el_sel -d Mt_lep_met_f -p tt_lj NOM:distrs/distrs_v27dilep2_mc_5.root:el_sel,tt_eltau,NOMINAL JESUp:distrs/distrs_v27dilep2_mc_5.root:el_sel,tt_eltau,JESUp JESDown:distrs/distrs_v27dilep2_mc_5.root:el_sel,tt_eltau,JESDown 

-- small, insignificant variations

python get_shapes.py  --norm-binwidth --formula " NOM : FragUp : FragDown " -c el_sel -d Mt_lep_met_f -p tt_lj NOM:distrs/distrs_v27dilep2_mc_5.root:el_sel,tt_lj,NOMINAL FragUp:distrs/distrs_v27dilep2_mc_5.root:el_sel,tt_lj,FragUp FragDown:distrs/distrs_v27dilep2_mc_5.root:el_sel,tt_lj,FragDown 

python get_shapes.py  --norm-binwidth --formula " NOM : JESUp : JESDown " -c el_sel -d Mt_lep_met_f -p tt_lj NOM:distrs/distrs_v27dilep2_mc_5.root:el_sel,tt_lj,NOMINAL JESUp:distrs/distrs_v27dilep2_mc_5.root:el_sel,tt_lj,JESUp JESDown:distrs/distrs_v27dilep2_mc_5.root:el_sel,tt_lj,JESDown 

-- Frag is not negligible but small, shows up in 2 bins
   JESDown is very noticeable, JESUp no --- events lost on the edge of 21 GeV?


python get_shapes.py  --norm-binwidth --formula " NOM : FragUp : FragDown " -c tt_elmu -d Mt_lep_met_f -p tt_lj NOM:distrs/distrs_v27dilep2_mc_5.root:tt_elmu,tt_other,NOMINAL FragUp:distrs/distrs_v27dilep2_mc_5.root:tt_elmu,tt_other,FragUp FragDown:distrs/distrs_v27dilep2_mc_5.root:tt_elmu,tt_other,FragDown 

python get_shapes.py  --norm-binwidth --formula " NOM : JESUp : JESDown " -c tt_elmu -d Mt_lep_met_f -p tt_lj NOM:distrs/distrs_v27dilep2_mc_5.root:tt_elmu,tt_other,NOMINAL JESUp:distrs/distrs_v27dilep2_mc_5.root:tt_elmu,tt_other,JESUp JESDown:distrs/distrs_v27dilep2_mc_5.root:tt_elmu,tt_other,JESDown 

-- negligible Frag and barely noticeable JES


python get_shapes.py  --norm-binwidth --formula " eltau : elj " -c tt_elmu -d Mt_lep_met_f -p tt_lj eltau:distrs/distrs_v27dilep2_mc_5.root:el_sel,tt_eltau,NOMINAL  elj:distrs/distrs_v27dilep2_mc_5.root:el_sel,tt_lj,NOMINAL 

-- ok shapes

Frag and JES vars:

python stack_plot.py distrs/distrs_v27dilep2_mc_5.root ../quick-test/v27-dilep2_hadds/5/SingleElectron.root -p -r -o plots/v27dilep2/ --lumi 31300 -c el_sel               -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02

python stack_plot.py distrs/distrs_v27dilep2_mc_5.root ../quick-test/v27-dilep2_hadds/5/SingleElectron.root -p -r -o plots/v27dilep2/ --lumi 31300 -c el_sel               -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --systematic TESDown
python stack_plot.py distrs/distrs_v27dilep2_mc_5.root ../quick-test/v27-dilep2_hadds/5/SingleElectron.root -p -r -o plots/v27dilep2/ --lumi 31300 -c el_sel               -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --systematic TESUp

python stack_plot.py distrs/distrs_v27dilep2_mc_5.root ../quick-test/v27-dilep2_hadds/5/SingleElectron.root -p -r -o plots/v27dilep2/ --lumi 31300 -c el_sel               -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --systematic JESDown
python stack_plot.py distrs/distrs_v27dilep2_mc_5.root ../quick-test/v27-dilep2_hadds/5/SingleElectron.root -p -r -o plots/v27dilep2/ --lumi 31300 -c el_sel               -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --systematic JESUp

python stack_plot.py distrs/distrs_v27dilep2_mc_5.root ../quick-test/v27-dilep2_hadds/5/SingleElectron.root -p -r -o plots/v27dilep2/ --lumi 31300 -c el_sel               -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --systematic FragDown
python stack_plot.py distrs/distrs_v27dilep2_mc_5.root ../quick-test/v27-dilep2_hadds/5/SingleElectron.root -p -r -o plots/v27dilep2/ --lumi 31300 -c el_sel               -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --systematic FragUp

-- Frag quite noticeable by the normalization

python mc_per_sys.py histosels/histosels_v27dilep2_5.root -p tt_lj    -c el_sel -d Mt_lep_met_f -s FragUp,FragDown
python mc_per_sys.py histosels/histosels_v27dilep2_5.root -p tt_eltau -c el_sel -d Mt_lep_met_f -s FragUp,FragDown

-- eltau within stat uncertainties. lj has larger variation



python get_shapes.py  --norm-binwidth --formula " eltau : elj " -c tt_elmu -d dilep_mass -p tt_lj eltau:distrs/distrs_v27dilep2_mc_5.root:el_sel,tt_eltau,NOMINAL  elj:distrs/distrs_v27dilep2_mc_5.root:el_sel,tt_lj,NOMINAL 

-- slight difference

python mc_per_sys.py histosels/histosels_v27dilep2_5.root -p tt_other -c tt_elmu -d Mt_lep_met_f -s PetersonUp,PetersonDown
python mc_per_sys.py histosels/histosels_v27dilep2_5.root -p tt_other -c tt_elmu -d Mt_lep_met_f -s bSFUp,bSFDown
python mc_per_sys.py histosels/histosels_v27dilep2_5.root -p tt_other -c tt_elmu -d Mt_lep_met_f -s LEPelTRGUp,LEPelTRGDown

Peterson is noticeable,  ~1%
same bSF
and TRG is very well seen


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,tau_fakes,dilep_norm --setParameters r=1.0,dilep_norm=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 --robustFit 1 --doInitialFit                              -n RatioAllShapesExpectNoFakesNoDilep
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,tau_fakes,dilep_norm --setParameters r=1.0,dilep_norm=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 --robustFit 1 --doFits --parallel 5                       -n RatioAllShapesExpectNoFakesNoDilep
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,tau_fakes,dilep_norm --setParameters r=1.0,dilep_norm=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 -o latest_ratioAll_toys_asimov_impacts_NoFakesNoDilep.json -n RatioAllShapesExpectNoFakesNoDilep
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioAll_toys_asimov_impacts_NoFakesNoDilep.json -o latest_ratioAll_toys_asimov_impacts_NoFakesNoDilep

   tau_ratio :    +1.000   -0.051/+0.051 (68%)

what now? -- Frag 2.5% -- why not constrained in elmu?

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,tau_fakes,dilep_norm,Frag --setParameters r=1.0,dilep_norm=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 --robustFit 1 --doInitialFit                                     -n RatioAllShapesExpectNoFakesNoDilepNoFrag
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,tau_fakes,dilep_norm,Frag --setParameters r=1.0,dilep_norm=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 --robustFit 1 --doFits --parallel 5                              -n RatioAllShapesExpectNoFakesNoDilepNoFrag
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,tau_fakes,dilep_norm,Frag --setParameters r=1.0,dilep_norm=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 -o latest_ratioAll_toys_asimov_impacts_NoFakesNoDilepNoFrag.json -n RatioAllShapesExpectNoFakesNoDilepNoFrag
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioAll_toys_asimov_impacts_NoFakesNoDilepNoFrag.json -o latest_ratioAll_toys_asimov_impacts_NoFakesNoDilepNoFrag

1. muID more than 1%
2. TES       1% (asym)
3. SemilepBR 1% (asym)
4. wjets     1%

pulls are constrained as usual, their impact on tau_ratio is larger


fixing dilepton is wrong?

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,tau_fakes,dilep_norm,Frag --setParameters r=1.0,dilep_norm=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 --robustFit 1 --doInitialFit                                     -n RatioAllShapesExpectNoFakesNoDilepNoFrag
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,tau_fakes,dilep_norm,Frag --setParameters r=1.0,dilep_norm=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 --robustFit 1 --doFits --parallel 5                              -n RatioAllShapesExpectNoFakesNoDilepNoFrag
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,tau_fakes,dilep_norm,Frag --setParameters r=1.0,dilep_norm=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 -o latest_ratioAll_toys_asimov_impacts_NoFakesNoDilepNoFrag.json -n RatioAllShapesExpectNoFakesNoDilepNoFrag
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioAll_toys_asimov_impacts_NoFakesNoDilepNoFrag.json -o latest_ratioAll_toys_asimov_impacts_NoFakesNoDilepNoFrag



bin                               el                  el                  el                  el                  el                  el                  el                  el                  el                  el                  el                  el                  el                  elmu                elmu                elmu                elmu                elmu                elmu                elmu                elmu                elmu                elmu                elmu                elmu                elmu                dy_mumu             dy_mumu             dy_mumu             dy_mumu             dy_mumu             dy_mumu             dy_mumu             dy_mumu             dy_mumu             dy_mumu             dy_mumu             dy_mumu             dy_mumu             dy_mutau            dy_mutau            dy_mutau            dy_mutau            dy_mutau            dy_mutau            dy_mutau            dy_mutau            dy_mutau            dy_mutau            dy_mutau            dy_mutau            dy_mutau           
process                           tt_eltau            tt_other            tt_lj               s_top_eltau         wjets_taul          s_top_other         s_top_lj            dy_other            dibosons            dy_tautau           wjets_other         tt_taultauh         tt_taulj            tt_other            tt_lj               tt_mutau            s_top_mutau         wjets_taul          s_top_other         s_top_lj            dibosons            dy_tautau           wjets_other         tt_taultauh         tt_taulj            dy_other            tt_other            tt_lj               tt_mutau            s_top_mutau         wjets_taul          s_top_other         s_top_lj            dibosons            dy_tautau           wjets_other         tt_taultauh         tt_taulj            dy_other            tt_other            tt_lj               tt_mutau            s_top_mutau         wjets_taul          s_top_other         s_top_lj            dibosons            dy_tautau           wjets_other         tt_taultauh         tt_taulj            dy_other           
Frag                    shape     1.0                 1.0                 1.0                 -                   -                   -                   -                   -                   -                   -                   -                   1.0                 1.0                 1.0                 1.0                 1.0                 -                   -                   -                   -                   -                   -                   -                   1.0                 1.0                 -                   1.0                 1.0                 1.0                 -                   -                   -                   -                   -                   -                   -                   1.0                 1.0                 -                   1.0                 1.0                 1.0                 -                   -                   -                   -                   -                   -                   -                   1.0                 1.0                 -                  








# the issues with fakes, wjets and TES

python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -p -r -o plots/v27dilep2/ --lumi 35800 -c dy_mumu              -d lep_pt --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "p_{T}(#mu) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -p -r -o plots/v27dilep2/ --lumi 35800 -c dy_mutau             -d lep_pt --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "p_{T}(#mu) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02

python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -p -r -o plots/v27dilep2/ --lumi 31300 -c el_sel               -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -p -r -o plots/v27dilep2/ --lumi 31300 -c tt_elmu              -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02

python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -p -r -o plots/v27dilep2/ --lumi 31300 -c el_sel -x el_selVloose              -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"    --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -p -r -o plots/v27dilep2/ --lumi 35800 -c mu_sel -x mu_selVloose              -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02

python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -p -r -o plots/v27dilep2/ --lumi 31300 -c el_sel               -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --systematic TESUp
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -p -r -o plots/v27dilep2/ --lumi 31300 -c el_sel               -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --systematic TESDown

python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -p -r -o plots/v27dilep2/ --lumi 35800 -c dy_mutau             -d lep_pt --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "p_{T}(#mu) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --systematic TESUp
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -p -r -o plots/v27dilep2/ --lumi 35800 -c dy_mutau             -d lep_pt --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "p_{T}(#mu) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --systematic TESDown

python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -p -r -o plots/v27dilep2/ --lumi 31300 -c tt_elmu              -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --systematic TESUp
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -p -r -o plots/v27dilep2/ --lumi 31300 -c tt_elmu              -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --systematic TESDown

-- in el channel the number of wjets events is within stat unc of MC
   the tail of Mt is still there, with mostly signal events
   Vloose does not change the distr (not acounted in stage2 or in drawing?)

   noticeable disagreement in elmu at the peak -- data>mc -- better efficiency than SFs?
   something similar in mumu at low pt muons, plus 10% factor
   and 10-20% factor in dy_mutau?
   ok agreement in tt_mutau

   TES in tt_eltau and dy_mutau give usual variation, Down -- a bit less events, Up -- a bit more
   don't see how it is asymetric

TES was in elmu datacard -- should not mater (indeed it is negligible in the plots)


try elmu only, without DY

combineCards.py el=ttxsec/v27dilep2_ratio_el.txt elmu=ttxsec/v27dilep2_ratio_elmu.txt > ttxsec/v27dilep2_ratio_multi_el_elmu.txt
combineCards.py el=ttxsec/v27dilep2_ratio_el.txt elmu=ttxsec/v27dilep2_ratio_elmu.txt dy_mumu=ttxsec/v27dilep2_ratio_dy_mumu.txt dy_mutau=ttxsec/v27dilep2_ratio_dy_mutau.txt > ttxsec/v27dilep2_ratio_all.txt

vim -p ttxsec/v27dilep2_ratio_all.txt ttxsec/v27dilep2_ratio_multi_el_elmu.txt ttxsec/v27dilep2_ratio_el_elmu.txt

with simple ratio

./scripts/text2workspace.py ttxsec/v27dilep2_ratio_multi_el_elmu.txt
./scripts/text2workspace.py ttxsec/v27dilep2_ratio_all.txt

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_multi_el_elmu.root -m 125 --robustFit 1 --doInitialFit                  -n RatioElMuShapesExpect3

was:

best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.074/+0.075 (68%)
Done in 0.04 min (cpu), 0.04 min (real)

now:

best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.088/+0.094 (68%)
Done in 0.02 min (cpu), 0.02 min (real)

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_multi_el_elmu.root -m 125 --robustFit 1 --doFits --parallel 5          -n RatioElMuShapesExpect3
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_multi_el_elmu.root -m 125 -o latest_ratioElMu_toys_asimov_impacts3.json -n RatioElMuShapesExpect3
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioElMu_toys_asimov_impacts3.json -o latest_ratioElMu_toys_asimov_impacts3

1. tau ID 5%
2. fakes  3-3.5%  <---- ?
3. bSF    3%
4. JES   1-1.2%

TES small and asymetric
wjets even smaller


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 --robustFit 1 --doInitialFit                  -n RatioAllShapesExpect3
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 --robustFit 1 --doFits --parallel 5           -n RatioAllShapesExpect3
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 -o latest_ratioAll_toys_asimov_impacts3.json -n RatioAllShapesExpect3
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioAll_toys_asimov_impacts3.json -o latest_ratioAll_toys_asimov_impacts3











## where were wjets and tau fakes in hybrid?

bin                                 tt_mu          tt_mu          tt_mu          tt_mu          tt_mu          tt_mu          tt_mu          tt_mu          tt_mu          tt_mu          tt_mu          tt_mu          tt_mu          tt_mu          tt_elmu        tt_elmu        tt_elmu        tt_elmu        tt_elmu        tt_elmu        tt_elmu        tt_elmu        tt_elmu        tt_elmu        tt_elmu        dy_mumu        dy_mumu        dy_mumu        dy_mumu        dy_mumu        dy_mumu        dy_mumu        dy_mumu        dy_mumu        dy_mumu        dy_mumu        dy_mumu        dy_mumu        dy_mutau       dy_mutau       dy_mutau       dy_mutau       dy_mutau       dy_mutau       dy_mutau       dy_mutau       dy_mutau       dy_mutau       dy_mutau       dy_mutau       dy_mutau
process                             tt_mutau       tt_lj          dibosons       s_top_mutau    wjets_taul     s_top_other    wjets          s_top_lj       qcd            dy_tautau      tt_taultauh    tt_taulj       dy_other       tt_other       tt_elmu        tt_taueltaumu  dy_tautau      tt_ltaul       qcd            s_top_other    s_top_elmu     wjets          dibosons       dy_other       tt_other       tt_mutau       tt_lj          s_top_mutau    wjets_taul     s_top_other    s_top_lj       dibosons       dy_tautau      wjets_other    tt_taultauh    tt_taulj       dy_other       tt_other       tt_mutau       tt_lj          s_top_mutau    wjets_taul     s_top_other    s_top_lj       dibosons       dy_tautau      wjets_other    tt_taultauh    tt_taulj       dy_other       tt_other
process                             -1             1              2              3              4              5              6              7              8              9              10             11             12             13             0              14             9              15             8              5              16             6              2              12             13             -1             1              3              4              5              7              2              9              17             10             11             12             13             -1             1              3              4              5              7              2              9              17             10             11             12             13
rate                                13609.554      6583.035       117.452        720.598        62.449         108.384        1005.552       562.979        737.137        848.502        877.928        424.22         60.678         303.063        81280.968      287.865        185.081        9220.067       0              568.062        3911.655       18.387         190.315        3.889          304.056        0.000519       0.005498       2.6e-05        0.000115       0.043112       0.001379       0.258938       0.122357       0.001954       6.1e-05        0.000476       201.582247     0.504077       0.005035       0.003621       0.000767       0.003974       0.000354       0.001268       0.003777       0.317911       0.032391       0.000705       0.00067        0.005839       0.000459
wjets_norm              lnN         -              -              -              -              1.1            -              1.1            -              -              -              -              -              -              -              -              -              -              -              -              -              -              1.1            -              -              -              -              -              -              1.5            -              -              -              -              1.5            -              -              -              -              -              -              -              1.5            -              -              -              -              1.5            -              -              -              -
tau_fakes               lnN         -              1.5            -              -              -              1.5            -              -              -              -              -              1.5            -              1.5            -              -              -              -              -              -              -              -              -              -              -              -              -              -              -              -              -              -              -              -              -              -              -              -              -              1.5            -              -              -              1.5            1.5            -              -              -              1.5            -              1.5

new with wjets 1.5 variation
   tau_ratio :    +1.000   -0.067/+0.065 (68%)

1. fakes  0.04
2. TES    0.02
3. wjets  0.02
4. tau ID 0.01-0.015

   tau_ratio :    +1.000   -0.070/+0.069 (68%)

1. fakes
2. wjets   0.035
3. TES
4. tau ID

hybrid run:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 --freezeNuisanceGroup tt_th_pdf -d ttxsec/27dilep2_ratio_hybrid.root -m 125 --robustFit 1 --doInitialFit                  -n RatioElMuShapesExpectHybrid
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 --freezeNuisanceGroup tt_th_pdf -d ttxsec/27dilep2_ratio_hybrid.root -m 125 --robustFit 1 --doFits --parallel 5           -n RatioElMuShapesExpectHybrid
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 --freezeNuisanceGroup tt_th_pdf -d ttxsec/27dilep2_ratio_hybrid.root -m 125 -o latest_ratioElMu_toys_asimov_impactsHybrid.json -n RatioElMuShapesExpectHybrid
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioElMu_toys_asimov_impactsHybrid.json -o latest_ratioElMu_toys_asimov_impactsHybrid

   tau_ratio :    +1.000   -0.038/+0.038 (68%)

a lot of
[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!
not sure for which systematics

-- same as before, dominant LEP uncert = 2%, tau ID = 2%, TES = 1.5%, fakes and wjets = 1%

frozen LEP:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,LEP --setParameters r=1.0 -t -1 --freezeNuisanceGroup tt_th_pdf -d ttxsec/27dilep2_ratio_hybrid.root -m 125 --robustFit 1 --doInitialFit                       -n RatioElMuShapesExpectHybridNoLEP
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,LEP --setParameters r=1.0 -t -1 --freezeNuisanceGroup tt_th_pdf -d ttxsec/27dilep2_ratio_hybrid.root -m 125 --robustFit 1 --doFits --parallel 5                -n RatioElMuShapesExpectHybridNoLEP
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,LEP --setParameters r=1.0 -t -1 --freezeNuisanceGroup tt_th_pdf -d ttxsec/27dilep2_ratio_hybrid.root -m 125 -o latest_ratioElMu_toys_asimov_impactsHybridNoLEP.json -n RatioElMuShapesExpectHybridNoLEP
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioElMu_toys_asimov_impactsHybridNoLEP.json -o latest_ratioElMu_toys_asimov_impactsHybridNoLEP

   tau_ratio :    +1.000   -0.032/+0.031 (68%)

also
[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!

consistent systematics

-- LEP is in the old part, which had good LEP calculation, the problem was in the newer stage2
   it could not affect much





## redo the hybrid without rateParams

hadd histosels/histosels_v27dilep2_1forhybrid.root histosels/v27dilep2/distrs_1/*root

python numbers_for_datacard.py histosels/histosels_v27dilep2_1forhybrid.root -d Mt_lep_met_f -c el_sel,tt_elmu   --no-sums
python numbers_for_datacard.py histosels/histosels_v27dilep2_1forhybrid.root -d lep_pt       -c dy_mutau,dy_mumu --no-sums

python numbers_for_datacard.py histosels/histosels_v27dilep2_5.root -d Mt_lep_met_f -c el_sel,tt_elmu   --no-sums
python numbers_for_datacard.py histosels/histosels_v27dilep2_5.root -d lep_pt       -c dy_mutau,dy_mumu --no-sums

-- numbers are practically the same as now

cp v27dilep2_ratio_dy_mumu.txt  v27dilep2_ratio_dy_mumu_histosel.txt
cp v27dilep2_ratio_dy_mutau.txt v27dilep2_ratio_dy_mutau_histosel.txt

vim -p v27dilep2_ratio_dy_mumu_histosel.txt v27dilep2_ratio_dy_mutau_histosel.txt

combineCards.py tt=ttxsec/fit-stuff/ratio_both_2.txt dy_mumu=ttxsec/v27dilep2_ratio_dy_mumu_histosel.txt dy_mutau=ttxsec/v27dilep2_ratio_dy_mutau_histosel.txt > ttxsec/27dilep2_ratio_hybrid_HISTOSEL.txt

./scripts/text2workspace.py ttxsec/27dilep2_ratio_hybrid_HISTOSEL.txt

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 --freezeNuisanceGroup tt_th_pdf -d ttxsec/27dilep2_ratio_hybrid_HISTOSEL.root -m 125 --robustFit 1 --doInitialFit                         -n RatioElMuShapesExpectReHybrid
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 --freezeNuisanceGroup tt_th_pdf -d ttxsec/27dilep2_ratio_hybrid_HISTOSEL.root -m 125 --robustFit 1 --doFits --parallel 5                  -n RatioElMuShapesExpectReHybrid
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 --freezeNuisanceGroup tt_th_pdf -d ttxsec/27dilep2_ratio_hybrid_HISTOSEL.root -m 125 -o latest_ratioElMu_toys_asimov_impactsReHybrid.json -n RatioElMuShapesExpectReHybrid
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioElMu_toys_asimov_impactsReHybrid.json -o latest_ratioElMu_toys_asimov_impactsReHybrid

   tau_ratio :    +1.000   -0.038/+0.038 (68%)

same impacts as in hybrid!!!

the numbers, the shape is the same, the impacts of hybrid are reasonable, the new ones - no
is it due to less events in new tt->leptau selection?

freeze lep, tauID and TES -- see the wjets and fakes

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,LEP,tauID_eff,TES --setParameters r=1.0 -t -1 --freezeNuisanceGroup tt_th_pdf -d ttxsec/27dilep2_ratio_hybrid_HISTOSEL.root -m 125 --robustFit 1 --doInitialFit                         -n RatioElMuShapesExpectReHybridNoLEPtauIDTES
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,LEP,tauID_eff,TES --setParameters r=1.0 -t -1 --freezeNuisanceGroup tt_th_pdf -d ttxsec/27dilep2_ratio_hybrid_HISTOSEL.root -m 125 --robustFit 1 --doFits --parallel 5                  -n RatioElMuShapesExpectReHybridNoLEPtauIDTES
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,LEP,tauID_eff,TES --setParameters r=1.0 -t -1 --freezeNuisanceGroup tt_th_pdf -d ttxsec/27dilep2_ratio_hybrid_HISTOSEL.root -m 125 -o latest_ratioElMu_toys_asimov_impactsReHybridNoLEPtauIDTES.json -n RatioElMuShapesExpectReHybridNoLEPtauIDTES
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioElMu_toys_asimov_impactsReHybridNoLEPtauIDTES.json -o latest_ratioElMu_toys_asimov_impactsReHybridNoLEPtauIDTES

   tau_ratio :    +1.000   -0.025/+0.027 (68%)

1. TauES 1%
2. fakes 1%
...
wjets much lower at less than 0.5%


new with wjets 1.1/1.5 difference between tt and dy

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 --robustFit 1 --doInitialFit                          -n RatioAllShapesExpect3WJetRatio
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 --robustFit 1 --doFits --parallel 5                   -n RatioAllShapesExpect3WJetRatio
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 -o latest_ratioAll_toys_asimov_impacts3WJetRatio.json -n RatioAllShapesExpect3WJetRatio
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioAll_toys_asimov_impacts3WJetRatio.json -o latest_ratioAll_toys_asimov_impacts3WJetRatio

   tau_ratio :    +1.000   -0.070/+0.070 (68%)

still 1) fakes 4%, 2) wjets 3%

hybrid with 1.5 wjet norm

-- same low wjets!


effect of DY wjets can affect only via tau ID eff in DY
-- save them in NLL

combine -M MultiDimFit ttxsec/v27dilep2_ratio_all.root -t -1 --algo grid --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 --rMin 0.5 --rMax 1.5 --name RatioAllShapes --forceRecreateNLL --saveSpecifiedNuis wjets_norm,tauID_eff
all have
[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!

combine -M MultiDimFit ttxsec/27dilep2_ratio_hybrid_HISTOSEL.root -t -1 --algo grid --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 --rMin 0.5 --rMax 1.5 --forceRecreateNLL --saveSpecifiedNuis wjets_norm,tauID_eff --name RatioShapesReHybrid
same warnings

 --parameters TOPPT

limit->Draw("2*deltaNLL:tau_ratio", "deltaNLL>0 && 2*deltaNLL<10", "L")
limit->Draw("2*deltaNLL:tauID_eff", "deltaNLL>0 && 2*deltaNLL<10", "L")
limit->Draw("2*deltaNLL:wjets_norm", "deltaNLL>0 && 2*deltaNLL<10", "L")

in hybrid all smooth
in new a bit of a zigzag in tauID

limit->Draw("wjets_norm:tauID_eff", "deltaNLL>0 && 2*deltaNLL<10", "L")

-- smooth, anticorrelated,   wjets/tauID_eff = 0.05/0.1
   a bit of zigzag, anticor, wjets/tauID_eff = 0.1 /0.05

limit->Draw("tau_ratio:tauID_eff", "deltaNLL>0 && 2*deltaNLL<10", "L")






## correlations and stat uncertainty in new and re-hybrid

combine -M FitDiagnostics ttxsec/v27dilep2_ratio_all.root            -t -1 --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 --plots --saveShapes --saveWithUncertainties --name RatioNewCovar
mv covariance_fit_s.png covariance_fit_s_RatioNew.png

a lot of this stuff:

[#0] WARNING:Plotting -- RooHist::addBin(dy_mumu_plot__CMS_th1x) WARNING: non-integer bin entry 4126.6 with Poisson errors, interpolating between Poisson errors of adjacent integer
[#0] WARNING:Plotting -- RooHist::addBin(dy_mumu_plot__CMS_th1x) WARNING: non-integer bin entry 2972.09 with Poisson errors, interpolating between Poisson errors of adjacent integer
[#0] ERROR:Plotting -- RooAbsPdf::plotOn(pdf_bindy_mumu_bonly) ERROR: component selection expression 'shapeSig*' does not select any components of p.d.f.
[#0] ERROR:Plotting -- RooAbsPdf::plotOn(pdf_bindy_mumu_bonly) ERROR: component selection expression 'shapeSig*' does not select any components of p.d.f.
[utils::makePlots] Number of events for pdf in dy_mumu_CMS_th1x, pdf pdf_bindy_mumu_bonly = 7.07951e+06
[#0] WARNING:Plotting -- RooHist::addBin(dy_mumu_plot__CMS_th1x) WARNING: non-integer bin entry 0.00709722 with Poisson errors, interpolating between Poisson errors of adjacent integer
[#0] WARNING:Plotting -- RooHist::addBin(dy_mumu_plot__CMS_th1x) WARNING: non-integer bin entry 0.00709722 with Poisson errors, interpolating between Poisson errors of adjacent integer

and

Best fit tau_ratio: 1  -0.15/+0.0664832  (68% CL)

zoom in:
combine -M FitDiagnostics ttxsec/v27dilep2_ratio_all.root            -t -1 --redefineSignalPOIs tau_ratio --freezeParameters r,AlphaS,Mf,Mfr,Mr,JER,JES --setParameters r=1.0 --plots --saveShapes --saveWithUncertainties --name RatioNewCovar

Best fit tau_ratio: 1  -0.15/+0.0510891  (68% CL)

-- ?

mv covariance_fit_s.png covariance_fit_s_RatioNew.png


combine -M FitDiagnostics ttxsec/27dilep2_ratio_hybrid_HISTOSEL.root -t -1 --redefineSignalPOIs tau_ratio --freezeParameters r,AlphaS,Mf,Mfr,Mr,JER,JES,ISR,FSR,HDAMP,TuneCUETP8M2T4,qcd_norm --freezeNuisanceGroup tt_th_pdf --setParameters r=1.0 --plots --saveShapes --saveWithUncertainties --name RatioReHybridCovar

Best fit tau_ratio: 1  -0.1/+0.0283452  (68% CL)
with frozen ISR,FSR,HDAMP,TuneCUETP8M2T4,qcd_norm:
Best fit tau_ratio: 1  -0.1/+0.0366497  (68% CL)

mv covariance_fit_s.png covariance_fit_s_RatioReHybrid.png

nonesense, different correlations, some strange ones in muID and TRG with PU and dilep_norm, dy_norm
the target ones:
tauID, tau_fakes, tau_ratio, wjets_norm
differ slightly between the two:

in rehybrid the correlations between them are all small
tau_ratio +0.5 correlates with LEP, +0.1-0.2 with wjets, -0.4-0.5 with tauID, not much with fakes

in new all the correlation with leptons is weak, weak with tauID,
but -0.8 anti-cor with fakes and +0.5 with wjets

how is this and how on earth can it be connected with event yields in tt?



combine -M MultiDimFit --algo grid -t -1 --expectSignal 1 --redefineSignalPOIs tau_ratio --freezeParameters r,AlphaS,Mf,Mfr,Mr,JER,JES,ISR,FSR,HDAMP,TuneCUETP8M2T4,qcd_norm --freezeNuisanceGroup tt_th_pdf   --setParameters r=1.0 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedRatioNewBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit  --fastScan -n ExpectedRatioNewBestfit








uncertainties:

combine -M MultiDimFit --algo none -t -1 --redefineSignalPOIs tau_ratio --setParameters r=1.0 --rMin 0.5 --rMax 1.5 ttxsec/v27dilep2_ratio_all.root --saveWorkspace -n ExpectedRatioBestfit --freezeParameters r

combine -M MultiDimFit --algo grid -t -1 --redefineSignalPOIs tau_ratio --setParameters r=1.0 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedRatioBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters "tauID_eff,tau_fakes,lumi_13TeV,r" -n ExpectedRatioNoTau
combine -M MultiDimFit --algo grid -t -1 --redefineSignalPOIs tau_ratio --setParameters r=1.0 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedRatioBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters all --fastScan -n ExpectedRatioNoSys
combine -M MultiDimFit --algo grid -t -1 --redefineSignalPOIs tau_ratio --setParameters r=1.0 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedRatioBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit -n ExpectedRatioFullUncertaintyNoLumi --freezeParameters lumi_13TeV,r
combine -M MultiDimFit --algo grid -t -1 --redefineSignalPOIs tau_ratio --setParameters r=1.0 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedRatioBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit -n ExpectedRatioFullUncertainty --freezeParameters r

-- with lumi there are a lot of
[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!
and one
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max


    plot1DScan.py --POI tau_ratio higgsCombineExpectedRatioFullUncertainty.MultiDimFit.mH120.root --others 'higgsCombineExpectedRatioFullUncertaintyNoLumi.MultiDimFit.mH120.root:lumi:4' 'higgsCombineExpectedRatioNoSys.MultiDimFit.mH120.root:stat:2' --breakdown lumi,syst,stat

mv scan.pdf scan_expected_ratio.pdf
mv scan.png scan_expected_ratio.png

1 +- 0.071
1 +- 0.002lumi +- 0.062syst +- 0.034stat

without stat it's still 0.062 from systematics
and it's without mc stat


combine -M MultiDimFit --algo none -t -1 --redefineSignalPOIs tau_ratio --setParameters r=1.0 --rMin 0.5 --rMax 1.5 ttxsec/27dilep2_ratio_hybrid_HISTOSEL.root --saveWorkspace -n ExpectedHybridRatioBestfit --freezeParameters r --freezeNuisanceGroup tt_th_pdf

combine -M MultiDimFit --algo grid -t -1 --redefineSignalPOIs tau_ratio --setParameters r=1.0 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedHybridRatioBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters "tauID_eff,tau_fakes,lumi_13TeV,r" -n ExpectedHybridRatioNoTau --freezeNuisanceGroup tt_th_pdf
combine -M MultiDimFit --algo grid -t -1 --redefineSignalPOIs tau_ratio --setParameters r=1.0 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedHybridRatioBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters all --fastScan -n ExpectedHybridRatioNoSys --freezeNuisanceGroup tt_th_pdf
combine -M MultiDimFit --algo grid -t -1 --redefineSignalPOIs tau_ratio --setParameters r=1.0 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedHybridRatioBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit -n ExpectedHybridRatioFullUncertaintyNoLumi --freezeParameters lumi_13TeV,r --freezeNuisanceGroup tt_th_pdf
combine -M MultiDimFit --algo grid -t -1 --redefineSignalPOIs tau_ratio --setParameters r=1.0 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedHybridRatioBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit -n ExpectedHybridRatioFullUncertainty --freezeParameters r --freezeNuisanceGroup tt_th_pdf

a lot of the same warnings around 1.0

    plot1DScan.py --POI tau_ratio higgsCombineExpectedHybridRatioFullUncertainty.MultiDimFit.mH120.root --others 'higgsCombineExpectedHybridRatioFullUncertaintyNoLumi.MultiDimFit.mH120.root:lumi:4' 'higgsCombineExpectedHybridRatioNoSys.MultiDimFit.mH120.root:stat:2' --breakdown lumi,syst,stat

mv scan.pdf scan_expected_HybridRatio.pdf
mv scan.png scan_expected_HybridRatio.png

1. +- 0.038
1. +- 0.002lumi +- 0.037sys +- 0.012stat

-- the fraction of stats is about the same
but how does that interact with the systematics?



in elmu now

ttxsec/v27dilep2_ratio_multi_el_elmu.root

combine -M MultiDimFit --algo none -t -1 --redefineSignalPOIs tau_ratio --setParameters r=1.0 --rMin 0.5 --rMax 1.5 ttxsec/v27dilep2_ratio_multi_el_elmu.root --saveWorkspace -n ExpectedRatioElMuBestfit --freezeParameters r

combine -M MultiDimFit --algo grid -t -1 --redefineSignalPOIs tau_ratio --setParameters r=1.0 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedRatioElMuBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters "tauID_eff,tau_fakes,lumi_13TeV,r" -n ExpectedRatioElMuNoTau
combine -M MultiDimFit --algo grid -t -1 --redefineSignalPOIs tau_ratio --setParameters r=1.0 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedRatioElMuBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters all --fastScan -n ExpectedRatioElMuNoSys
combine -M MultiDimFit --algo grid -t -1 --redefineSignalPOIs tau_ratio --setParameters r=1.0 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedRatioElMuBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit -n ExpectedRatioElMuFullUncertaintyNoLumi --freezeParameters lumi_13TeV,r
combine -M MultiDimFit --algo grid -t -1 --redefineSignalPOIs tau_ratio --setParameters r=1.0 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedRatioElMuBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit -n ExpectedRatioElMuFullUncertainty --freezeParameters r

-- suddenly no warnings etc

-- with lumi there are a lot of
[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!
and one
Info in <Minuit2>: Minuit2Minimizer::Minimize : Minimization did NOT converge, Edm is above max


    plot1DScan.py --POI tau_ratio higgsCombineExpectedRatioElMuFullUncertainty.MultiDimFit.mH120.root --others 'higgsCombineExpectedRatioElMuFullUncertaintyNoLumi.MultiDimFit.mH120.root:lumi:4' 'higgsCombineExpectedRatioElMuNoSys.MultiDimFit.mH120.root:stat:2' --breakdown lumi,syst,stat

mv scan.pdf scan_expected_ratioElMu.pdf
mv scan.png scan_expected_ratioElMu.png

1 +- 0.094
1 +- 0.001 +- 0.088 +- 0.034

same stat









## shapes of lep pt and tau pt

dy_lep     = (TH1D*) dy_mutau->Get("dy_tautau/NOMINAL/dy_mutau_dy_tautau_NOMINAL_lep_pt")
dy_tau     = (TH1D*) dy_mutau->Get("dy_tautau/NOMINAL/dy_mutau_dy_tautau_NOMINAL_tau_pt")
dy_mass    = (TH1D*) dy_mutau->Get("dy_tautau/NOMINAL/dy_mutau_dy_tautau_NOMINAL_dilep_mass")
wjets_lep  = (TH1D*) dy_mutau->Get("wjets_other/NOMINAL/dy_mutau_wjets_other_NOMINAL_lep_pt")
wjets_tau  = (TH1D*) dy_mutau->Get("wjets_other/NOMINAL/dy_mutau_wjets_other_NOMINAL_tau_pt")
wjets_mass = (TH1D*) dy_mutau->Get("wjets_other/NOMINAL/dy_mutau_wjets_other_NOMINAL_dilep_mass")

dy_lep ->Scale(1./dy_lep->Integral())
dy_tau ->Scale(1./dy_tau->Integral())
dy_mass->Scale(1./dy_mass->Integral())

wjets_lep ->Scale(1./wjets_lep->Integral())
wjets_tau ->Scale(1./wjets_tau->Integral())
wjets_mass->Scale(1./wjets_mass->Integral())

dy_lep ->Draw()
wjets_lep ->Draw("same")

dy_tau ->Draw()
wjets_tau ->Draw("same")

dy_mass ->Draw()
wjets_mass ->Draw("same")

all have some separation

lep pt     DY is at low edge
tau pt     WJets are low, DY has a peak at 30GeV
dilep mass DY sharp peak, when normalized to 1 wjets reach 1/2 of the peak and have larger tail





# systematic weights in dilepton channels

the statement of the problem:

root -l jobsums/histosels/histosels_v27dilep2.root

tt_elmu->Get("dy_other/NOMINAL/tt_elmu_dy_other_NOMINAL_Mt_lep_met_f")->Print()
tt_elmu->Get("dy_other/LEPmuIDUp/tt_elmu_dy_other_LEPmuIDUp_Mt_lep_met_f")->Print()
tt_elmu->Get("dy_other/LEPmuIDDown/tt_elmu_dy_other_LEPmuIDDown_Mt_lep_met_f")->Print()
TH1.Print Name  = tt_elmu_dy_other_NOMINAL_Mt_lep_met_f, Entries= 2, Total sum= 8.32739
TH1.Print Name  = tt_elmu_dy_other_LEPmuIDUp_Mt_lep_met_f, Entries= 2, Total sum= 8.24471
TH1.Print Name  = tt_elmu_dy_other_LEPmuIDDown_Mt_lep_met_f, Entries= 2, Total sum= 7.82908

tt_elmu->Get("tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f")->Print()
tt_elmu->Get("tt_other/LEPmuIDUp/tt_elmu_tt_other_LEPmuIDUp_Mt_lep_met_f")->Print()
tt_elmu->Get("tt_other/LEPmuIDDown/tt_elmu_tt_other_LEPmuIDDown_Mt_lep_met_f")->Print()
TH1.Print Name  = tt_elmu_tt_other_NOMINAL_Mt_lep_met_f, Entries= 289232, Total sum= 100550
TH1.Print Name  = tt_elmu_tt_other_LEPmuIDUp_Mt_lep_met_f, Entries= 289232, Total sum= 99932.1
TH1.Print Name  = tt_elmu_tt_other_LEPmuIDDown_Mt_lep_met_f, Entries= 289232, Total sum= 94833.5

-- issues in tt_elmu leps, at stage2 they are incorrectly calculated
   fixed and switched to el-triggered elmu

this:

python -W ignore sumup_ttree_draw.py --cut-w0jets "std_mt_vars"           --ttree ttree_out --histo-range std  --output quick-test/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_dy_mumu_nom,leps_11.root  --std-histos --histo-name dy_mumu/std_procs/nom,LEPmuIDUp,LEPmuIDDown/Mt_lep_met_f --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*MC2016_Summer16_DYJetsToLL_50toInf_madgraph*.root

is fine



after fix

tt_elmu->Get("dy_other/NOMINAL/tt_elmu_dy_other_NOMINAL_dilep_mass")->Print()
tt_elmu->Get("dy_other/LEPmuIDUp/tt_elmu_dy_other_LEPmuIDUp_dilep_mass")->Print()
tt_elmu->Get("dy_other/LEPmuIDDown/tt_elmu_dy_other_LEPmuIDDown_dilep_mass")->Print()
TH1.Print Name  = tt_elmu_dy_other_NOMINAL_dilep_mass, Entries= 1, Total sum= 4.48389e-05
TH1.Print Name  = tt_elmu_dy_other_LEPmuIDUp_dilep_mass, Entries= 1, Total sum= 4.51831e-05
TH1.Print Name  = tt_elmu_dy_other_LEPmuIDDown_dilep_mass, Entries= 1, Total sum= 4.44536e-05

tt_elmu->Get("tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_dilep_mass")->Print()
tt_elmu->Get("tt_other/LEPmuIDUp/tt_elmu_tt_other_LEPmuIDUp_dilep_mass")->Print()
tt_elmu->Get("tt_other/LEPmuIDDown/tt_elmu_tt_other_LEPmuIDDown_dilep_mass")->Print()
TH1.Print Name  = tt_elmu_tt_other_NOMINAL_dilep_mass, Entries= 287401, Total sum= 2.90965
TH1.Print Name  = tt_elmu_tt_other_LEPmuIDUp_dilep_mass, Entries= 287401, Total sum= 2.88584
TH1.Print Name  = tt_elmu_tt_other_LEPmuIDDown_dilep_mass, Entries= 287401, Total sum= 2.8347

same crap

-- seen in the ttree

muon ID variation included muon trig SF, the nominal has only el trg
-- rerun is ok

in elel:

dy_elel->Get("dy_other/NOMINAL/dy_elel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
dy_elel->Get("dy_other/LEPmuIDUp/dy_elel_dy_other_LEPmuIDUp_Mt_lep_met_f")->Print()
dy_elel->Get("dy_other/LEPmuIDDown/dy_elel_dy_other_LEPmuIDDown_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_elel_dy_other_NOMINAL_Mt_lep_met_f, Entries= 882400, Total sum= 103.491
TH1.Print Name  = dy_elel_dy_other_LEPmuIDUp_Mt_lep_met_f, Entries= 882400, Total sum= 110.101
TH1.Print Name  = dy_elel_dy_other_LEPmuIDDown_Mt_lep_met_f, Entries= 882400, Total sum= 110.101

dy_elel->Get("dy_other/NOMINAL/dy_elel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
dy_elel->Get("dy_other/LEPelIDUp/dy_elel_dy_other_LEPelIDUp_Mt_lep_met_f")->Print()
dy_elel->Get("dy_other/LEPelIDDown/dy_elel_dy_other_LEPelIDDown_Mt_lep_met_f")->Print()
dy_elel->Get("dy_other/LEPelTRGUp/dy_elel_dy_other_LEPelTRGUp_Mt_lep_met_f")->Print()
dy_elel->Get("dy_other/LEPelTRGDown/dy_elel_dy_other_LEPelTRGDown_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_elel_dy_other_NOMINAL_Mt_lep_met_f, Entries= 882400, Total sum= 103.491
TH1.Print Name  = dy_elel_dy_other_LEPelIDUp_Mt_lep_met_f, Entries= 882400, Total sum= 105.015
TH1.Print Name  = dy_elel_dy_other_LEPelIDDown_Mt_lep_met_f, Entries= 882400, Total sum= 101.979
TH1.Print Name  = dy_elel_dy_other_LEPelTRGUp_Mt_lep_met_f, Entries= 882400, Total sum= 105.966
TH1.Print Name  = dy_elel_dy_other_LEPelTRGDown_Mt_lep_met_f, Entries= 882400, Total sum= 101.016

-- the negative nominal lep weight?

After the final fix in the merged TT the tt_elmu selection shows good LEP Up/Down variations.

hadd quick-test/distrs_v27dilep2_mc_5.root quick-test/v27-dilep2_hadds/MC*root
cp quick-test/distrs_v27dilep2_mc_5.root jobsums/distrs/distrs_v27dilep2_mc.root

dy_mumu->Get("dy_other/NOMINAL/dy_mumu_dy_other_NOMINAL_Mt_lep_met_f")->Print()
dy_mumu->Get("dy_other/LEPmuIDUp/dy_mumu_dy_other_LEPmuIDUp_Mt_lep_met_f")->Print()
dy_mumu->Get("dy_other/LEPmuIDDown/dy_mumu_dy_other_LEPmuIDDown_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_mumu_dy_other_NOMINAL_Mt_lep_met_f, Entries= 1806111, Total sum= 202.03
TH1.Print Name  = dy_mumu_dy_other_LEPmuIDUp_Mt_lep_met_f, Entries= 1806111, Total sum= 203.617
TH1.Print Name  = dy_mumu_dy_other_LEPmuIDDown_Mt_lep_met_f, Entries= 1806111, Total sum= 200.447

TH1.Print Name  = tt_elmu_tt_other_NOMINAL_Mt_lep_met_f, Entries= 290424, Total sum= 2.90989
TH1.Print Name  = tt_elmu_tt_other_LEPmuIDUp_Mt_lep_met_f, Entries= 290424, Total sum= 2.93594
TH1.Print Name  = tt_elmu_tt_other_LEPmuIDDown_Mt_lep_met_f, Entries= 290424, Total sum= 2.88393

hadd histosels/histosels_v27dilep2.root histosels/v27dilep2/distrs/*

combineCards.py el=ttxsec/v27dilep2_ratio_el.txt elmu=ttxsec/v27dilep2_ratio_elmu.txt dy_mumu=ttxsec/v27dilep2_ratio_dy_mumu.txt dy_mutau=ttxsec/v27dilep2_ratio_dy_mutau.txt > ttxsec/v27dilep2_ratio_all.txt

vim -p ttxsec/v27dilep2_ratio_all.txt ttxsec/v27dilep2_ratio_el_elmu.txt

with simple ratio

./scripts/text2workspace.py ttxsec/v27dilep2_ratio_all.txt

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 --robustFit 1 --doInitialFit                  -n RatioAllShapesExpect3

best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.074/+0.075 (68%)
Done in 0.04 min (cpu), 0.04 min (real)

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 --robustFit 1 --doFits --parallel 5           -n RatioAllShapesExpect3
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_all.root -m 125 -o latest_ratioAll_toys_asimov_impacts3.json -n RatioAllShapesExpect3
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioAll_toys_asimov_impacts3.json -o latest_ratioAll_toys_asimov_impacts3

-- no asymetry, but strange systematics:
1. tau fakes (?),         constrained to 0.4sigma, impact 0.04
2. LEP el TRG,        not constrained at all,             0.03 (did I add it in datacard? -- no!)
3. wjets norm (???),      constrained to 0.2-0.3sigma,    0.03
4. TES,        asymetric, constrained to 0.5sigma,        0.02 one-sided
5. tau ID (finally),      constrained to 0.5-0.6sigma,    less then 0.02 (cool!)

  Parameter :   Best-fit               tau_ratio
  tauID_eff :   -0.000  -0.529/+0.589[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!
[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!
  +0.009/-0.016

  Parameter  :   Best-fit               tau_ratio
  wjets_norm :   +0.000  -0.288/+0.260[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!
[WARNING] Minimisation finished with status 1 (covariance forced positive definite), this could indicate a problem with the minimim!
  -0.029/+0.028

with corrected el trigger:

best fit parameter values and profile-likelihood uncertainties: 
   tau_ratio :    +1.000   -0.070/+0.069 (68%)
Done in 0.04 min (cpu), 0.04 min (real)

-- el trg is far sub-percent

1. fakes
2. wjets
3. TES
4. tau ID

with same impacts
hmm... wat?








# demonstration fit, all systematics and tau SV sign cut

setenv DTAGS   "sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main  sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main sw-dir/merge-sets/jobs_hadd.dtags.small_main_noqcd sw-dir/merge-sets/jobs_hadd.dtags.data-and-tt"

tt channels and with tau only
setenv CHANS   "el_sel el_selVloose el_sel_ss el_selVloose_ss mu_sel mu_selVloose mu_sel_ss mu_selVloose_ss tt_elmu"
setenv CHANS   "el_sel el_selVloose el_sel_ss el_selVloose_ss mu_sel mu_selVloose mu_sel_ss mu_selVloose_ss"
dy channels and with tau only
setenv CHANS   "dy_mutau dy_eltau dy_mumu dy_elel"
setenv CHANS   "dy_mutau dy_eltau"

setenv SYSTS   "nom"
setenv SYSTS   "nom,common obj tt_weights tt_hard tt_pdf1 tt_pdf10 tt_pdf20 tt_pdf30 tt_pdf40 tt_pdf50,tt_alpha"

-- updowns were processed separately?

setenv DISTRS  "std_mt_vars event_dilep_mass event_leptons[0].pt()"
setenv DISTRS  "event_taus[0].pt()"
setenv DISTRS  "event_taus[0].pt() event_taus_sv_sign[0]"

setenv CONDS   
setenv CONDS   '--cond-com "event_taus_sv_sign[0] > 2.5 && std_mt_vars < 40."'
setenv CONDS   '--cond-com "event_taus_sv_sign[0] > 2.5"'
setenv CONDS   "--cond-com '"'"std_mt_vars < 40."'"'"




important difference in dtags and systematics:
data  is nominal only,
ttbar is all
other mc is standard weights

also split them in channels (DY and tt, tau and dilep) with different conditions




for data
setenv DTAGS   "sw-dir/merge-sets/jobs_hadd.dtags.data"
setenv SYSTS   "nom"

tt dilep channels
setenv CHANS   "tt_elmu"
setenv DISTRS  "std_mt_vars event_dilep_mass event_leptons[0].pt()"
setenv CONDS   

dy dilep channels
setenv CHANS   "dy_mumu dy_elel"
setenv DISTRS  "std_mt_vars event_dilep_mass event_leptons[0].pt()"
setenv CONDS   "--cond-com '"'"std_mt_vars < 40."'"'"


tt lep-tau channel
setenv CHANS   "el_sel el_selVloose el_sel_ss el_selVloose_ss mu_sel mu_selVloose mu_sel_ss mu_selVloose_ss"
setenv DISTRS  "event_taus[0].pt() event_taus_sv_sign[0]"
setenv CONDS   '--cond-com "event_taus_sv_sign[0] > 2.5"'

dy lep-tau channel
setenv CHANS   "dy_mutau dy_eltau"
setenv DISTRS  "event_taus[0].pt() event_taus_sv_sign[0]"
setenv CONDS   '--cond-com "event_taus_sv_sign[0] > 2.5 && std_mt_vars < 40."'



 ---------------- damn! had to use std systematics!




data ttbar dileptons:
setenv DTAGS   "sw-dir/merge-sets/jobs_hadd.dtags.data"
setenv SYSTS   "nom"
setenv CHANS   "tt_elmu"
setenv DISTRS  "std_mt_vars event_dilep_mass event_leptons[0].pt()"
setenv CONDS   

     ttbar leptau:
setenv DTAGS   "sw-dir/merge-sets/jobs_hadd.dtags.data"
setenv SYSTS   "nom"
setenv CHANS   "el_sel el_selVloose el_sel_ss el_selVloose_ss mu_sel mu_selVloose mu_sel_ss mu_selVloose_ss"
setenv DISTRS  "std_mt_vars event_dilep_mass event_leptons[0].pt() event_taus[0].pt() event_taus_sv_sign[0]"
setenv CONDS   '--cond-com "event_taus_sv_sign[0] > 2.5"'

     dy dileptons:
setenv DTAGS   "sw-dir/merge-sets/jobs_hadd.dtags.data"
setenv SYSTS   "nom"
setenv CHANS   "dy_mumu dy_elel"
setenv DISTRS  "std_mt_vars event_dilep_mass event_leptons[0].pt()"
setenv CONDS   "--cond-com '"'"std_mt_vars < 40."'"'"

     dy leptau:
setenv DTAGS   "sw-dir/merge-sets/jobs_hadd.dtags.data"
setenv SYSTS   "nom"
setenv CHANS   "dy_mutau dy_eltau dy_mumu dy_elel"
setenv DISTRS  "std_mt_vars event_dilep_mass event_leptons[0].pt() event_taus[0].pt() event_taus_sv_sign[0]"
setenv CONDS   '--cond-com "event_taus_sv_sign[0] > 2.5 && std_mt_vars < 40."'






ttbar in ttbar dileptons:
setenv DTAGS   "sw-dir/merge-sets/jobs_hadd.dtags.tt"
setenv CHANS   "tt_elmu"
setenv SYSTS   "nom,common obj tt_weights tt_hard tt_pdf1 tt_pdf10 tt_pdf20 tt_pdf30 tt_pdf40 tt_pdf50,tt_alpha"
setenv DISTRS  "std_mt_vars event_dilep_mass event_leptons[0].pt()"
setenv CONDS   

      in ttbar leptau:
setenv DTAGS   "sw-dir/merge-sets/jobs_hadd.dtags.tt"
setenv CHANS   "el_sel el_selVloose el_sel_ss el_selVloose_ss mu_sel mu_selVloose mu_sel_ss mu_selVloose_ss"
setenv SYSTS   "nom,common obj tt_weights tt_hard tt_pdf1 tt_pdf10 tt_pdf20 tt_pdf30 tt_pdf40 tt_pdf50,tt_alpha"
setenv DISTRS  "std_mt_vars event_dilep_mass event_leptons[0].pt() event_taus[0].pt() event_taus_sv_sign[0]"
setenv CONDS   '--cond-com "event_taus_sv_sign[0] > 2.5"'

      in dy dileptons:
setenv DTAGS   "sw-dir/merge-sets/jobs_hadd.dtags.tt"
setenv CHANS   "dy_mumu dy_elel"
setenv SYSTS   "nom,common obj tt_weights tt_hard tt_pdf1 tt_pdf10 tt_pdf20 tt_pdf30 tt_pdf40 tt_pdf50,tt_alpha"
setenv DISTRS  "std_mt_vars event_dilep_mass event_leptons[0].pt()"
setenv CONDS   "--cond-com '"'"std_mt_vars < 40."'"'"

      in dy dileptons:
setenv DTAGS   "sw-dir/merge-sets/jobs_hadd.dtags.tt"
setenv CHANS   "dy_mutau dy_eltau"
setenv SYSTS   "nom,common obj tt_weights tt_hard tt_pdf1 tt_pdf10 tt_pdf20 tt_pdf30 tt_pdf40 tt_pdf50,tt_alpha"
setenv DISTRS  "std_mt_vars event_dilep_mass event_leptons[0].pt() event_taus[0].pt() event_taus_sv_sign[0]"
setenv CONDS   '--cond-com "event_taus_sv_sign[0] > 2.5 && std_mt_vars < 40."'




other MC in ttbar dileptons
setenv DTAGS   "sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main  sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main sw-dir/merge-sets/jobs_hadd.dtags.small_main_noqcd"
setenv CHANS   "tt_elmu"
setenv SYSTS   "nom common obj"
setenv DISTRS  "std_mt_vars event_dilep_mass event_leptons[0].pt()"
setenv CONDS   

         in ttbar leptau:
setenv DTAGS   "sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main  sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main sw-dir/merge-sets/jobs_hadd.dtags.small_main_noqcd"
setenv CHANS   "el_sel el_selVloose el_sel_ss el_selVloose_ss mu_sel mu_selVloose mu_sel_ss mu_selVloose_ss"
setenv SYSTS   "nom common obj"
setenv DISTRS  "std_mt_vars event_dilep_mass event_leptons[0].pt() event_taus[0].pt() event_taus_sv_sign[0]"
setenv CONDS   '--cond-com "event_taus_sv_sign[0] > 2.5"'

         in dy dileptons:
setenv DTAGS   "sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main  sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main sw-dir/merge-sets/jobs_hadd.dtags.small_main_noqcd"
setenv CHANS   "dy_mumu dy_elel"
setenv SYSTS   "nom common obj"
setenv DISTRS  "std_mt_vars event_dilep_mass event_leptons[0].pt()"
setenv CONDS   "--cond-com '"'"std_mt_vars < 40."'"'"

         in dy leptau
setenv DTAGS   "sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main  sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main sw-dir/merge-sets/jobs_hadd.dtags.small_main_noqcd"
setenv CHANS   "dy_mutau dy_eltau"
setenv SYSTS   "nom common obj"
setenv DISTRS  "std_mt_vars event_dilep_mass event_leptons[0].pt() event_taus[0].pt() event_taus_sv_sign[0]"
setenv CONDS   '--cond-com "event_taus_sv_sign[0] > 2.5 && std_mt_vars < 40."'



 ------ done

shell languages must burn in hell,
i had to write it up in python and forget it

automation loops:

foreach dtag (`cat $DTAGS`)
  echo ${dtag}
  foreach chans ($CHANS)
    foreach systs ($SYSTS)

    echo \#\!/bin/sh                                          > batch_jobs/j_${dtag}_${chans}_${systs}
    echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo cmsenv                                              >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/j_${dtag}_${chans}_${systs}

    echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"std_mt_vars"'           --ttree ttree_out --histo-range std  --output quick-test/v27-dilep2/${dtag}_${chans}_${systs}_11.root  --std-histos --histo-name $chans/std_procs/${systs}/$distr --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"event_dilep_mass"'      --ttree ttree_out --histo-range std  --output quick-test/v27-dilep2/${dtag}_${chans}_${systs}_12.root  --std-histos --histo-name $chans/std_procs/${systs}/$distr --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"event_leptons[0].pt()"' --ttree ttree_out --histo-range std  --output quick-test/v27-dilep2/${dtag}_${chans}_${systs}_13.root  --std-histos --histo-name $chans/std_procs/${systs}/$distr --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/j_${dtag}_${chans}_${systs}
    end
  end
end


    foreach distr (std_mt_vars event_dilep_mass '"event_leptons[0].pt()"' '"event_taus[0].pt()"' '"event_taus_sv_sign[0]"')

foreach dtag (`cat $DTAGS`)
  echo ${dtag}
  foreach chans ($CHANS)
    foreach systs ($SYSTS)

    echo \#\!/bin/sh                                          > batch_jobs/j_${dtag}_${chans}_${systs}
    echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo cmsenv                                              >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/j_${dtag}_${chans}_${systs}

    echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"std_mt_vars"'           --ttree ttree_out --histo-range std  --output quick-test/v27-dilep2/${dtag}_${chans}_${systs}_1.root  --std-histos --histo-name $chans/std_procs/${systs}/$distr --cond-com '"event_taus_sv_sign[0] > 2.5"' --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"event_dilep_mass"'      --ttree ttree_out --histo-range std  --output quick-test/v27-dilep2/${dtag}_${chans}_${systs}_2.root  --std-histos --histo-name $chans/std_procs/${systs}/$distr --cond-com '"event_taus_sv_sign[0] > 2.5"' --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"event_leptons[0].pt()"' --ttree ttree_out --histo-range std  --output quick-test/v27-dilep2/${dtag}_${chans}_${systs}_3.root  --std-histos --histo-name $chans/std_procs/${systs}/$distr --cond-com '"event_taus_sv_sign[0] > 2.5"' --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"event_taus[0].pt()"'    --ttree ttree_out --histo-range std  --output quick-test/v27-dilep2/${dtag}_${chans}_${systs}_4.root  --std-histos --histo-name $chans/std_procs/${systs}/$distr --cond-com '"event_taus_sv_sign[0] > 2.5"' --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"event_taus_sv_sign[0]"' --ttree ttree_out --histo-range std  --output quick-test/v27-dilep2/${dtag}_${chans}_${systs}_5.root  --std-histos --histo-name $chans/std_procs/${systs}/$distr --cond-com '"event_taus_sv_sign[0] > 2.5"' --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/j_${dtag}_${chans}_${systs}
    end
  end
end

    foreach distr (std_mt_vars event_dilep_mass '"event_leptons[0].pt()"')


foreach dtag (`cat $DTAGS`)
  echo ${dtag}
  foreach chans ($CHANS)
    foreach systs ($SYSTS)

    echo \#\!/bin/sh                                          > batch_jobs/j_${dtag}_${chans}_${systs}
    echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo cmsenv                                              >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/j_${dtag}_${chans}_${systs}

    echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"std_mt_vars"'           --ttree ttree_out --histo-range std  --output quick-test/v27-dilep2/${dtag}_${chans}_${systs}_11.root  --std-histos --histo-name $chans/std_procs/${systs}/$distr --cond-com '"std_mt_vars < 40."' --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"event_dilep_mass"'      --ttree ttree_out --histo-range std  --output quick-test/v27-dilep2/${dtag}_${chans}_${systs}_12.root  --std-histos --histo-name $chans/std_procs/${systs}/$distr --cond-com '"std_mt_vars < 40."' --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"event_leptons[0].pt()"' --ttree ttree_out --histo-range std  --output quick-test/v27-dilep2/${dtag}_${chans}_${systs}_13.root  --std-histos --histo-name $chans/std_procs/${systs}/$distr --cond-com '"std_mt_vars < 40."' --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/j_${dtag}_${chans}_${systs}
    end
  end
end

    foreach distr (std_mt_vars event_dilep_mass '"event_leptons[0].pt()"' '"event_taus[0].pt()"' '"event_taus_sv_sign[0]"')

foreach dtag (`cat $DTAGS`)
  echo ${dtag}
  foreach chans ($CHANS)
    foreach systs ($SYSTS)

    echo \#\!/bin/sh                                          > batch_jobs/j_${dtag}_${chans}_${systs}
    echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo cmsenv                                              >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/j_${dtag}_${chans}_${systs}

    echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"std_mt_vars"'           --ttree ttree_out --histo-range std  --output quick-test/v27-dilep2/${dtag}_${chans}_${systs}_1.root  --std-histos --histo-name $chans/std_procs/${systs}/$distr --cond-com '"event_taus_sv_sign[0] > 2.5 && std_mt_vars < 40."' --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"event_dilep_mass"'      --ttree ttree_out --histo-range std  --output quick-test/v27-dilep2/${dtag}_${chans}_${systs}_2.root  --std-histos --histo-name $chans/std_procs/${systs}/$distr --cond-com '"event_taus_sv_sign[0] > 2.5 && std_mt_vars < 40."' --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"event_leptons[0].pt()"' --ttree ttree_out --histo-range std  --output quick-test/v27-dilep2/${dtag}_${chans}_${systs}_3.root  --std-histos --histo-name $chans/std_procs/${systs}/$distr --cond-com '"event_taus_sv_sign[0] > 2.5 && std_mt_vars < 40."' --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"event_taus[0].pt()"'    --ttree ttree_out --histo-range std  --output quick-test/v27-dilep2/${dtag}_${chans}_${systs}_4.root  --std-histos --histo-name $chans/std_procs/${systs}/$distr --cond-com '"event_taus_sv_sign[0] > 2.5 && std_mt_vars < 40."' --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/j_${dtag}_${chans}_${systs}
    echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"event_taus_sv_sign[0]"' --ttree ttree_out --histo-range std  --output quick-test/v27-dilep2/${dtag}_${chans}_${systs}_5.root  --std-histos --histo-name $chans/std_procs/${systs}/$distr --cond-com '"event_taus_sv_sign[0] > 2.5 && std_mt_vars < 40."' --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/j_${dtag}_${chans}_${systs}
    end
  end
end



ls batch_jobs/ | wc -l
936

ls batch_jobs/ | sed -e 's,^\(.*\)$,qsub -l h_vmem=512M "/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/batch_jobs/\1",' | grep -v submit > batch_jobs/submit

ls batch_jobs/ > batch_jobs/submit


wc -l batch_jobs/submit
529 batch_jobs/submit
wc -l batch_jobs/submit
1058 batch_jobs/submit

% s,^,qsub -l h_vmem=1G '/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/batch_jobs/,
% s/$/'/

quick-test/v27-dilep2/

foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.all-tt-systs_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.small_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main`)
foreach dtag (SingleMuon SingleElectron)
hadd quick-test/v27-dilep2_hadds/$dtag.root quick-test/v27-dilep2/$dtag*root &
end

hadd quick-test/v27-dilep2_hadds/MC2016_Summer16_TTJets_powheg.root quick-test/v27-dilep2/MC2016_Summer16_TTJets_powheg*root

python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -p -r -o plots/v27dilep2/ --lumi 35800 -c dy_mumu               -d lep_pt --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "p_{T}(#mu) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -p -r -o plots/v27dilep2/ --lumi 35800 -c dy_mutau              -d lep_pt --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "p_{T}(#mu) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02

python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -p -r -o plots/v27dilep2/ --lumi 35800 -c mu_sel               -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -p -r -o plots/v27dilep2/ --lumi 35800 -c tt_elmu              -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02

python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -p -r -o plots/v27dilep2/ --lumi 31300 -c el_sel -x el_selVloose              -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"    --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -p -r -o plots/v27dilep2/ --lumi 35800 -c mu_sel -x mu_selVloose              -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02


ok
and strait to the fit, without histosels (ignoring qcd)

hadd distrs/distrs_v27dilep2_mc_data.root distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root

-- I won't use the data, so any channels in mc will work fine, no need to worry about singlemu singleel mixing


python numbers_for_datacard.py distrs/distrs_v27dilep2_mc_data.root -d Mt_lep_met_f -c el_sel,tt_elmu   --no-sums
python numbers_for_datacard.py distrs/distrs_v27dilep2_mc_data.root -d lep_pt       -c dy_mutau,dy_mumu --no-sums


-- problems without histosel:
   the histos are not scaled
   PDF DOWN is not there


ratio fit construction in

ttxsec/fit-stuff/ratio_both_2.txt

separate cards:

./scripts/text2workspace.py ttxsec/v27dilep2_ratio_mu.txt
./scripts/text2workspace.py ttxsec/v27dilep2_ratio_dy_mutau.txt
./scripts/text2workspace.py ttxsec/v27dilep2_ratio_elmu.txt
./scripts/text2workspace.py ttxsec/v27dilep2_ratio_dy_mumu.txt

merge them

combineCards.py el=ttxsec/v27dilep2_ratio_el.txt elmu=ttxsec/v27dilep2_ratio_elmu.txt dy_mumu=ttxsec/v27dilep2_ratio_dy_mumu.txt dy_mutau=ttxsec/v27dilep2_ratio_dy_mutau.txt > ttxsec/27dilep2_ratio_all.txt


and add the ratio construction

./scripts/text2workspace.py ttxsec/27dilep2_ratio_all.txt

reformulate the POIs

combine -M MultiDimFit ttxsec/27dilep2_ratio_all.root --algo grid -t -1 --points 100 --redefineSignalPOIs tau_ratio --freezeParameters r --expectSignal 1 --rMin 0.5 --rMax 1.5 --name RatioElMuDYShapes

Warning: option --expectSignal only applies to models with the POI "r", use --setParameters to set the values of the POIs for toy generation in this model
Computing results starting from expected outcome (a-priori)
  [WARNING] Found [dilep_norm] at boundary. 



combine -M MultiDimFit ttxsec/27dilep2_ratio_all.root --algo grid -t -1 --points 100 --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 --rMin 0.5 --rMax 1.5 --name RatioElMuDYShapes

-- very shallow?


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1  -d ttxsec/27dilep2_ratio_all.root -m 125 --robustFit 1 --doInitialFit                  -n RatioElMuDYShapesExpect5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1  -d ttxsec/27dilep2_ratio_all.root -m 125 --robustFit 1 --doFits --parallel 5           -n RatioElMuDYShapesExpect5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1  -d ttxsec/27dilep2_ratio_all.root -m 125 -o latest_ratio_toys_asimov_impacts.json      -n RatioElMuDYShapesExpect5
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratio_toys_asimov_impacts.json -o latest_ratio_toys_asimov_impacts

-- with rateParam for lumi

Error: closed range without finding crossing.
Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.100/+0.100 (68%)
Done in 0.04 min (cpu), 0.04 min (real)

-- same crap




## searching for solution

--expectSignal 1

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 -o latest_ratio_toys_asimov_impacts.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratio_toys_asimov_impacts.json -o latest_ratio_toys_asimov_impacts



../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters tau_ratio=1.0,r=1.0 -t -1  -d ttxsec/27dilep2_ratio_all.root -m 125 --robustFit 1 --doInitialFit             -n RatioElMuDYShapesExpect
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters tau_ratio=1.0,r=1.0 -t -1  -d ttxsec/27dilep2_ratio_all.root -m 125 --robustFit 1 --doFits --parallel 5      -n RatioElMuDYShapesExpect
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters tau_ratio=1.0,r=1.0 -t -1  -d ttxsec/27dilep2_ratio_all.root -m 125 -o latest_ratioFull_toys_asimov_impacts.json -n RatioElMuDYShapesExpect
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioFull_toys_asimov_impacts.json -o latest_ratioFull_toys_asimov_impacts


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters dilep_norm=1.0,r=1.0 -t -1  -d ttxsec/27dilep2_ratio_all.root -m 125 --robustFit 1 --doInitialFit                 -n RatioElMuDYShapesExpect2
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters dilep_norm=1.0,r=1.0 -t -1  -d ttxsec/27dilep2_ratio_all.root -m 125 --robustFit 1 --doFits --parallel 5          -n RatioElMuDYShapesExpect2
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters dilep_norm=1.0,r=1.0 -t -1  -d ttxsec/27dilep2_ratio_all.root -m 125 -o latest_ratioFull_toys_asimov_impacts2.json -n RatioElMuDYShapesExpect2
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioFull_toys_asimov_impacts2.json -o latest_ratioFull_toys_asimov_impacts2



../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1  -d ttxsec/27dilep2_ratio_all.root -m 125 --robustFit 1 --doInitialFit                 -n RatioElMuDYShapesExpect2

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1  -d ttxsec/27dilep2_ratio_all.root -m 125 --robustFit 1 --doInitialFit                 -n RatioElMuDYShapesExpect2
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1  -d ttxsec/27dilep2_ratio_all.root -m 125 --robustFit 1 --doFits --parallel 5          -n RatioElMuDYShapesExpect2
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1  -d ttxsec/27dilep2_ratio_all.root -m 125 -o latest_ratioFull_toys_asimov_impacts2.json -n RatioElMuDYShapesExpect2
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioFull_toys_asimov_impacts2.json -o latest_ratioFull_toys_asimov_impacts2


combine -M MultiDimFit ttxsec/27dilep2_ratio_all.root --algo grid -t -1 --points 100 --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters tau_ratio=1.0,r=1.0 --rMin 0.5 --rMax 1.5 --name RatioElMuDYShapes


rerun old test:

combine -M MultiDimFit ttxsec/fit-stuff/ratio_both_2.txt --algo grid -t -1 --points 100 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 --name RatioElMuShapes

./scripts/text2workspace.py ttxsec/fit-stuff/ratio_both_2.txt

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r  -t -1  -d ttxsec/fit-stuff/ratio_both_2.root -m 125 --robustFit 1 --doInitialFit                  -n RatioElMuShapesExpect
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r  -t -1  -d ttxsec/fit-stuff/ratio_both_2.root -m 125 --robustFit 1 --doFits --parallel 5           -n RatioElMuShapesExpect
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r  -t -1  -d ttxsec/fit-stuff/ratio_both_2.root -m 125 -o latest_ratio_toys_asimov_impacts2.json -n RatioElMuShapesExpect
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratio_toys_asimov_impacts2.json -o latest_ratio_toys_asimov_impacts2

   tau_ratio :    +1.000   -0.058/+0.062 (68%)

rerun with root wspace:

   tau_ratio :    +1.100   -0.013/+0.000 (68%)
Done in 0.13 min (cpu), 0.13 min (real)
  [WARNING] Found [tau_fakes] at boundary. 
  [WARNING] Found [dilep_norm] at boundary. 
Error: closed range without finding crossing.

combine -M MultiDimFit ttxsec/fit-stuff/ratio_both_2.root --algo grid -t -1 --points 100 --redefineSignalPOIs tau_ratio --freezeParameters r --rMin 0.5 --rMax 1.5 --name RatioElMuShapes

combine -M MultiDimFit ttxsec/fit-stuff/ratio_both_2.root --algo grid -t -1 --points 100 --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 --rMin 0.5 --rMax 1.5 --name RatioElMuShapes

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1  -d ttxsec/fit-stuff/ratio_both_2.root -m 125 --robustFit 1 --doInitialFit                  -n RatioElMuShapesExpect
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1  -d ttxsec/fit-stuff/ratio_both_2.root -m 125 --robustFit 1 --doFits --parallel 5           -n RatioElMuShapesExpect
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1  -d ttxsec/fit-stuff/ratio_both_2.root -m 125 -o latest_ratio_toys_asimov_impacts2.json -n RatioElMuShapesExpect
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratio_toys_asimov_impacts2.json -o latest_ratio_toys_asimov_impacts2

again

   tau_ratio :    +1.000   -0.058/+0.062 (68%)

-- impacts ok



wrong combination:

dilep_norm              extArg                   1.         [0.8,1.2]
dy_norm                 extArg                   1.         [0.8,1.2]
tau_ratio               extArg                   1.         [0.9,1.1]
rate_elmu               rateParam  elmu     tt_other  (@0)   dilep_norm
rate_eltau              rateParam  el       tt_eltau (@0*@1) dilep_norm,tau_ratio
rate_dy_mumu            rateParam  dy_mumu  dy_other  (@0)    dy_norm
rate_dy_mutau           rateParam  dy_mutau dy_tautau (@0*@1) dy_norm,tau_ratio

let's try simple

dilep_norm              extArg                   1.         [0.8,1.2]
tau_ratio               extArg                   1.         [0.9,1.1]
rate_elmu               rateParam  elmu     tt_other  (@0)   dilep_norm
rate_eltau              rateParam  el       tt_eltau (@0*@1) dilep_norm,tau_ratio

-- and DY constrains ID nuis

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1  -d ttxsec/27dilep2_ratio_all.root -m 125 --robustFit 1 --doInitialFit                  -n RatioElMuDYShapesExpect3
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1  -d ttxsec/27dilep2_ratio_all.root -m 125 --robustFit 1 --doFits --parallel 5           -n RatioElMuDYShapesExpect3
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1  -d ttxsec/27dilep2_ratio_all.root -m 125 -o latest_ratioFull_toys_asimov_impacts3.json -n RatioElMuDYShapesExpect3
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioFull_toys_asimov_impacts3.json -o latest_ratioFull_toys_asimov_impacts3


Set Default Value of Parameter r To : 1
Computing results starting from expected outcome (a-priori)
  [WARNING] Found [dilep_norm] at boundary. 
Error: closed range without finding crossing.
Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.100/+0.100 (68%)

...

try elmu only?

combineCards.py el=ttxsec/v27dilep2_ratio_el.txt elmu=ttxsec/v27dilep2_ratio_elmu.txt > ttxsec/27dilep2_ratio_elmu.txt

./scripts/text2workspace.py ttxsec/27dilep2_ratio_elmu.txt

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1  -d ttxsec/27dilep2_ratio_elmu.root -m 125 --robustFit 1 --doInitialFit                  -n RatioElMuShapesExpect3
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1  -d ttxsec/27dilep2_ratio_elmu.root -m 125 --robustFit 1 --doFits --parallel 5           -n RatioElMuShapesExpect3
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1  -d ttxsec/27dilep2_ratio_elmu.root -m 125 -o latest_ratioElMu_toys_asimov_impacts3.json -n RatioElMuShapesExpect3
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioElMu_toys_asimov_impacts3.json -o latest_ratioElMu_toys_asimov_impacts3

  [WARNING] Found [dilep_norm] at boundary. 
Error: closed range without finding crossing.
Error: closed range without finding crossing.

 --- MultiDimFit ---
best fit parameter values and profile-likelihood uncertainties: 
 Warning - No valid high-error found, will report difference to maximum of range for : tau_ratio
 Warning - No valid low-error found, will report difference to minimum of range for : tau_ratio
   tau_ratio :    +1.000   -0.100/+0.100 (68%)
Done in 0.01 min (cpu), 0.01 min (real)


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r,dilep_norm,rate_elmu --setParameters r=1.0,dilep_norm=1.0 -t -1 -d ttxsec/27dilep2_ratio_elmu.root -m 125 --robustFit 1 --doInitialFit -n RatioElMuShapesExpect3

tt_other is problem???

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0,rate_elmu=1.0 -t -1 -d ttxsec/27dilep2_ratio_elmu.root -m 125 --robustFit 1 --doInitialFit -n RatioElMuShapesExpect3



combineCards.py tt=ttxsec/fit-stuff/ratio_both_2.txt dy_mumu=ttxsec/v27dilep2_ratio_dy_mumu.txt dy_mutau=ttxsec/v27dilep2_ratio_dy_mutau.txt > ttxsec/27dilep2_ratio_hybrid.txt

combineCards.py el=ttxsec/v27dilep2_ratio_el.txt elmu=ttxsec/v27dilep2_ratio_elmu.txt > ttxsec/27dilep2_ratio_hybrid.txt

combineCards.py tt=ttxsec/fit-stuff/ratio_both_2.txt dy_mumu=ttxsec/v27dilep2_ratio_dy_mumu.txt dy_mutau=ttxsec/v27dilep2_ratio_dy_mutau.txt > ttxsec/27dilep2_ratio_hybrid.txt

./scripts/text2workspace.py ttxsec/27dilep2_ratio_hybrid.txt

bSF                     lnN      1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           -              1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           -              1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.03           1.0

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/27dilep2_ratio_hybrid.root -m 125 --robustFit 1 --doInitialFit -n RatioElMuShapesExpectHybrid

maybe rates are too small without the scale?

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 --freezeNuisanceGroup tt_th_pdf -d ttxsec/27dilep2_ratio_hybrid.root -m 125 --robustFit 1 --doInitialFit                  -n RatioElMuShapesExpectHybrid
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 --freezeNuisanceGroup tt_th_pdf -d ttxsec/27dilep2_ratio_hybrid.root -m 125 --robustFit 1 --doFits --parallel 5           -n RatioElMuShapesExpectHybrid
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 --freezeNuisanceGroup tt_th_pdf -d ttxsec/27dilep2_ratio_hybrid.root -m 125 -o latest_ratioElMu_toys_asimov_impactsHybrid.json -n RatioElMuShapesExpectHybrid
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioElMu_toys_asimov_impactsHybrid.json -o latest_ratioElMu_toys_asimov_impactsHybrid

-- hybrid with lumi factor for DY channels works!

why the factors don't work in the original datacard of all channels?






## try histosels with the re-scale

foreach sys (`cat syst-test.syst-list.1`)
foreach sys (`cat syst-test.syst-list.1_aa`)
foreach sys (`cat syst-test.syst-list.1_ab`)
foreach sys (`cat syst-test.syst-list.1_ac`)

the old run1 for hybrid fit

python stack_plot.py distrs/distrs_v27dilep2_mc_data.root distrs/distrs_v27dilep2_mc_data.root     -o histosels/v27dilep2/ --lumi 31300 -c el_sel        -d Mt_lep_met_f --wjet 0.8 --skip-QCD --systematic $sys

foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_v27dilep2_mc_data.root distrs/distrs_v27dilep2_mc_data.root     -o histosels/v27dilep2/ --lumi 35800 -c mu_sel        -d Mt_lep_met_f --wjet 0.8 --skip-QCD --systematic $sys
python stack_plot.py distrs/distrs_v27dilep2_mc_data.root distrs/distrs_v27dilep2_mc_data.root     -o histosels/v27dilep2/ --lumi 35800 -c tt_elmu       -d Mt_lep_met_f --wjet 0.8 --skip-QCD --systematic $sys
python stack_plot.py distrs/distrs_v27dilep2_mc_data.root distrs/distrs_v27dilep2_mc_data.root     -o histosels/v27dilep2/ --lumi 35800 -c dy_mutau      -d lep_pt --wjet 0.8 --skip-QCD --systematic $sys
python stack_plot.py distrs/distrs_v27dilep2_mc_data.root distrs/distrs_v27dilep2_mc_data.root     -o histosels/v27dilep2/ --lumi 35800 -c dy_mumu       -d lep_pt --wjet 0.8 --skip-QCD --systematic $sys
end


foreach sys (`cat syst-test.syst-list.1 syst-test.syst-list.2_pdfs`)
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -o histosels/v27dilep2/ --lumi 35800 -c mu_sel        -d Mt_lep_met_f --wjet 0.8 --skip-QCD --systematic $sys
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o histosels/v27dilep2/ --lumi 31300 -c el_sel        -d Mt_lep_met_f --wjet 0.8 --skip-QCD --systematic $sys
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleElectron.root -o histosels/v27dilep2/ --lumi 31300 -c tt_elmu       -d Mt_lep_met_f --wjet 0.8 --skip-QCD --systematic $sys
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -o histosels/v27dilep2/ --lumi 35800 -c dy_mutau      -d lep_pt --wjet 0.8 --skip-QCD --systematic $sys
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -o histosels/v27dilep2/ --lumi 35800 -c dy_mumu       -d lep_pt --wjet 0.8 --skip-QCD --systematic $sys
end

out:
python stack_plot.py distrs/distrs_v27dilep2_mc.root ../quick-test/v27-dilep2_hadds/SingleMuon.root     -o histosels/v27dilep2/ --lumi 35800 -c tt_elmu       -d Mt_lep_met_f --wjet 0.8 --skip-QCD --systematic $sys

hadd histosels/histosels_v27dilep2.root histosels/v27dilep2/distrs/*


python numbers_for_datacard.py histosels/histosels_v27dilep2.root -d Mt_lep_met_f -c el_sel,tt_elmu   --no-sums
python numbers_for_datacard.py histosels/histosels_v27dilep2.root -d lep_pt       -c dy_mutau,dy_mumu --no-sums

./scripts/text2workspace.py ttxsec/v27dilep2_ratio_el.txt
./scripts/text2workspace.py ttxsec/v27dilep2_ratio_elmu.txt
./scripts/text2workspace.py ttxsec/v27dilep2_ratio_dy_mutau.txt
./scripts/text2workspace.py ttxsec/v27dilep2_ratio_dy_mumu.txt

combineCards.py el=ttxsec/v27dilep2_ratio_el.txt elmu=ttxsec/v27dilep2_ratio_elmu.txt > ttxsec/v27dilep2_ratio_el_elmu.txt
combineCards.py el=ttxsec/v27dilep2_ratio_el.txt elmu=ttxsec/v27dilep2_ratio_elmu.txt dy_mumu=ttxsec/v27dilep2_ratio_dy_mumu.txt dy_mutau=ttxsec/v27dilep2_ratio_dy_mutau.txt > ttxsec/v27dilep2_ratio_all.txt

./scripts/text2workspace.py ttxsec/v27dilep2_ratio_el_elmu.txt

--saveSpecifiedNuis dilep_norm
 --setParameters r=1.0 --expectSignal 1.0

combine -M MultiDimFit ttxsec/fit-stuff/ratio_both_2.root  --algo grid -t -1 --points 100 --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0  --rMin 0.5 --rMax 1.5 --name RatioElMuShapesOLD1
combine -M MultiDimFit ttxsec/v27dilep2_ratio_el_elmu.root --algo grid -t -1 --points 100 --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0  --rMin 0.5 --rMax 1.5 --name RatioElMuShapes

root -l higgsCombineRatioElMuShapesOLD1.MultiDimFit.mH120.root higgsCombineRatioElMuShapes.MultiDimFit.mH120.root

-- the new is like 10 times flatter
   after no tau ID in elmu and it's 2 times flatter

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_el_elmu.root -m 125 --robustFit 1 --doInitialFit -n RatioElMuShapesExpect3

-- after no tau ID in elmu
   tau_ratio :    +1.000   -0.096/+0.096 (68%)

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_el_elmu.root -m 125 --robustFit 1 --doInitialFit                  -n RatioElMuShapesExpect3
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_el_elmu.root -m 125 --robustFit 1 --doFits --parallel 5           -n RatioElMuShapesExpect3
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --setParameters r=1.0 -t -1 -d ttxsec/v27dilep2_ratio_el_elmu.root -m 125 -o latest_ratioElMu_toys_asimov_impacts3.json -n RatioElMuShapesExpect3
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratioElMu_toys_asimov_impacts3.json -o latest_ratioElMu_toys_asimov_impacts3

-- after no tau ID in elmu, the elID is too high and asymetric, why does'nt it cancel out?

(added muon ID and TRG and separated from electron ID and TRG)

-- after mu-el separation: larger uncertainty
   tau_ratio :    +1.000   -0.112/+0.098 (68%)

-- muon ID (asym) is 1 systematic, then tau ID, then el ID (asym), el TRG, mu TRG is very small

root [7] tt_elmu->Get("tt_other/LEPelIDDown/tt_elmu_tt_other_LEPelIDDown_Mt_lep_met_f")->Print()
TH1.Print Name  = tt_elmu_tt_other_LEPelIDDown_Mt_lep_met_f, Entries= 289232, Total sum= 94833.5
root [8] tt_elmu->Get("tt_other/LEPelIDUp/tt_elmu_tt_other_LEPelIDUp_Mt_lep_met_f")->Print()
TH1.Print Name  = tt_elmu_tt_other_LEPelIDUp_Mt_lep_met_f, Entries= 289232, Total sum= 99932.1
root [9] 
root [9] tt_elmu->Get("tt_other/NOMINAL/tt_elmu_tt_other_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = tt_elmu_tt_other_NOMINAL_Mt_lep_met_f, Entries= 289232, Total sum= 100550



dilep_norm              extArg                   1.         [0.8,1.2]
tau_ratio               extArg                   1.         [0.9,1.1]
rate_elmu               rateParam  elmu     tt_other  (@0)   dilep_norm
rate_eltau              rateParam  el       tt_eltau (@0*@1) dilep_norm,tau_ratio

---------------
  el           
  tt_other     
  0            
  29.428       
---------------
  1.0          
  1.0          
  1.0          
  1.0          
  1.0          
  1.0          
  1.0          
  1.0          
  1.0          
  1.0          
  1.0          
  1.0          
  1.0          
  1.0          
  1.0          
  -            
  -            
  1.025        
  -            
  -            
  1.5          
  -            

















## and try with MC stats

















# problem with tau SV again?

1) the index of refit_tau? = 0 or no?     -- the refit index is correctly matched to the tau in stage2
                                             second tau passes very rarely
2) did the W)Jet cut work?                -- looks like implemented correctly, but run a test:
                                             yeah, it works
3) large difference with data in the tail?
   what's in dy mumu and elel, is there xsec norm error?
   (what's with electron yield? wasn't there the mistake with their impacts?)
                                          -- looks like overal DY xsec is ok
                                             (and mumu yield / elel yield ~= 2.5 / 1)
                                             and in any case it cannot fill up the missing data
4) old numbers, from the test and the very old ones
   scrap/v40_tt-dy/  v14raw and quick
5) test directly on gstore files


## w0jet cut test

the event yield with and without the cut

from the job
batch_jobs/j_MC2016_Summer16_WJets_madgraph_dy_mutau

python -W ignore sumup_ttree_draw.py --cut-w0jets "event_dilep_mass" --ttree ttree_out --histo-range 200,0,400 --cond-com "" --output quick-test/v27-dilep1/MC2016_Summer16_WJets_madgraph_dy_mutau_dilep_mass_WITHCUT.root --std-histos --histo-name dy_mutau/std_procs/nom/dilep_mass --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/MC2016_Summer16_WJets_madgraph.root &
python -W ignore sumup_ttree_draw.py              "event_dilep_mass" --ttree ttree_out --histo-range 200,0,400 --cond-com "" --output quick-test/v27-dilep1/MC2016_Summer16_WJets_madgraph_dy_mutau_dilep_mass_NOCUT.root   --std-histos --histo-name dy_mutau/std_procs/nom/dilep_mass --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/MC2016_Summer16_WJets_madgraph.root &

without cut
root [6] dy_mutau->Get("wjets_other/NOMINAL/dy_mutau_wjets_other_NOMINAL_dilep_mass")->Print()
TH1.Print Name  = dy_mutau_wjets_other_NOMINAL_dilep_mass, Entries= 4221, Total sum= 7.68553

with cut
root [1] dy_mutau->Get("wjets_other/NOMINAL/dy_mutau_wjets_other_NOMINAL_dilep_mass")->Print()
TH1.Print Name  = dy_mutau_wjets_other_NOMINAL_dilep_mass, Entries= 598, Total sum= 1.01035



## discrepancy with data

python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c dy_mumu                -d dilep_mass --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M(#mu, #mu) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleElectron.root -p -r -o plots/ --lumi 31300 -c dy_elel                -d dilep_mass --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M(e, e) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02

-- in mumu data 10% larger
   in elel it's  5% larger
   -- maybe the trigger is more efficient in dilep case?

python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c tt_elmu                -d dilep_mass --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M(#mu, e) [GeV]"    --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c dy_mutau               -d dilep_mass --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "M(#mu, #tau) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02

-- elmu is perfect, the slight shape tilt is due to toppt
   mutau missing about 50%

tail of SV Sign:

python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c mu_sel -x mu_selVloose -d tau_sv_sign --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "SV Sign" --title-y "[Events]" --draw-overflows 0.5 --legend-shift 0.02
python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c dy_mutau               -d tau_sv_sign --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "SV Sign" --title-y "[Events]" --draw-overflows 0.5 --legend-shift 0.02

-- at 3sigma, dy_mutau misses about 40%, ttbar is spot on,
   but the tail in dy does converge around 10sigma

from SV tail mismatch:
1) either SV underperforms and there is indeed a tail of QCD upto 5sigma and significant WJets
2) some contribution of DY->tautau is missing -- but what's with the converging tail then?

python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c dy_mutau               -d tau_sv_sign --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "SV Sign" --title-y "[Events]" --draw-overflows 0.5 --legend-shift 0.02 --cumulative-fractions

-- wjets fraction is constant 20-30% in the whole distribution!




## old quick tests

final selection for final quick test on stage2 results:

python sumup_ttree_draw.py "event_taus_sv_sign[0]" --ttree ttree_out --histo-range 42,-1,20 --cond-com "((selection_stage_dy==102 || selection_stage_dy==103) && event_met_lep_mt < 40.)"   --per-weight --try-xsec --std-histo-name geom_tau_sv_sign  --save-weight --histo-name "dy_tautau_sel/dy_all/NOMINAL/dy_tautau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/u4test_Mt40/$dtag.root lstore_outdirs/merge-sets/v40/u4test/$dtag.root

and plots

python stack_quick.py quick-test/foobar_v40u4test_Mt40.root --chan dy_tautau_sel --sys NOMINAL --distr geom_tau_sv_sign --stack ttbar,wjets,dibosons,single_top,dy --debug quick-test/test_f_v40u4test_Mt40.root --scale-stack 35800


also the good results on gstore files:

without Mt<40

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 42,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 21 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"   --per-weight --try-xsec --std-histo-name geom_tau_sv_sign  --save-weight --histo-name "dy_tautau_sel/dy_all/NOMINAL/dy_tautau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/u2_inputs/$dtag.root gstore_outdirs/v40/*/Ntupler_v40_$dtag/*/*/MC*root

python stack_quick.py quick-test/foobar_v40u2_inputs.root --chan dy_tautau_sel --sys NOMINAL --distr geom_tau_sv_sign --stack ttbar,wjets,dibosons,single_top,dy --debug test_f_inputs.root --scale-stack 35800

and with Mt<40:

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 42,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 21 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40."   --per-weight --try-xsec --std-histo-name geom_tau_sv_sign  --save-weight --histo-name "dy_tautau_sel/dy_all/NOMINAL/dy_tautau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/u2_inputs_Mt40/$dtag.root gstore_outdirs/v40/*/Ntupler_v40_$dtag/*/*/MC*root &

python stack_quick.py quick-test/foobar_v40u2_inputs_Mt40.root --chan dy_tautau_sel --sys NOMINAL --distr geom_tau_sv_sign --stack ttbar,wjets,dibosons,single_top,dy --debug test_f_inputs_Mt40.root --scale-stack 35800

sw-dir/test_f_inputs.root
sw-dir/test_f_inputs_Mt40.root

-- wjets in cumulative fractions of SV tail with Mt40 and without?

root -l sw-dir/quick-test/foobar_v40u2_inputs.root
root -l sw-dir/quick-test/foobar_v40u2_inputs_Mt40.root

dy    = (TH1D*) dy_tautau_sel->Get("dy/NOMINAL/dy_tautau_sel_dy_NOMINAL_geom_tau_sv_sign")
wjets = (TH1D*) dy_tautau_sel->Get("wjets/NOMINAL/dy_tautau_sel_wjets_NOMINAL_geom_tau_sv_sign")

TH1D* sum = (TH1D*) (dy->Clone())
sum->SetName("sum")
sum->SetDirectory(0)
sum->Add(wjets)

dy_cum    = dy->GetCumulative(kFALSE)
wjets_cum = wjets->GetCumulative(kFALSE)
sum_cum   = sum->GetCumulative(kFALSE)

dy_cum->Divide(sum_cum)
wjets_cum->Divide(sum_cum)
sum_cum->Divide(sum_cum)

sum_cum->Draw()
dy_cum->Draw("same")
wjets_cum->Draw("same")

c1->SaveAs("studies/dy_mutau_tests/foobar_v40u2_inputs_wjets_tail_cumulative-fractions.png")
c1->SaveAs("studies/dy_mutau_tests/foobar_v40u2_inputs_Mt40_wjets_tail_cumulative-fractions.png")

-- 10% of wjets in the tail

without Mt40 30-40% of wjets in the tail...

root -l sw-dir/test_f_inputs.root
root -l sw-dir/test_f_inputs_Mt40.root


---> reselect dy_mutau with Mt40

yep, 10% of WJets in the tail and more or less ok agreement with data after 4sigma
still 5-10% more data -- like in mumu and elel?
and more than 10^4 events cumulative at 5sigma

---> final check would be the old cumulative fractions



root -l sw-dir/jobsums/v14raw2_mc_wFSRISR_mu.root

dy    = (TH1D*) ctr_mu_dy_tt->Get("dy_tautau/NOMINAL/ctr_mu_dy_tt_dy_tautau_NOMINAL_tau_SV_sign")
wjets = (TH1D*) ctr_mu_dy_tt->Get("wjets/NOMINAL/ctr_mu_dy_tt_wjets_NOMINAL_tau_SV_sign")

TH1D* sum = (TH1D*) (dy->Clone())
sum->SetName("sum")
sum->SetDirectory(0)
sum->Add(wjets)

dy_cum    = dy->GetCumulative(kFALSE)
wjets_cum = wjets->GetCumulative(kFALSE)
sum_cum   = sum->GetCumulative(kFALSE)

dy_cum->Divide(sum_cum)
wjets_cum->Divide(sum_cum)
sum_cum->Divide(sum_cum)

sum_cum->Draw()
dy_cum->Draw("same")
wjets_cum->Draw("same")

c1->SaveAs("studies/dy_mutau_tests/old_results_v14raw2_mc_wFSRISR_mu_ctr_mu_dy_tt_cumulative-fractions.png")

-- yeah, same 10%
but less events overall -- around 3*10^3 of dy->tautau at 5sigma --- probably due to tighter cut on jet and tau pt



Probably, the jets in W production do come from c quarks often enough, which is bad news.
Bad at the same time now we have a large selection of true taus and W fakes to finish the study of dalitz parameters.


## all the mutau plots now

python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/3-half-fixed/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c dy_mutau               -d tau_sv_sign --wjet 0.8 --skip-QCD --ratio-range 0.5 --title "" --title-x "SV Sign" --title-y "[Events]" --draw-overflows 0.5 --legend-shift 0.02
python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/3-half-fixed/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c dy_mutau               -d tau_sv_sign --wjet 0.8 --skip-QCD --ratio-range 0.5 --title "" --title-x "SV Sign" --title-y "[Events]" --draw-overflows 0.5 --legend-shift 0.02 --logy
python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/3-half-fixed/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c dy_mutau               -d tau_sv_sign --wjet 0.8 --skip-QCD --ratio-range 0.5 --title "" --title-x "SV Sign" --title-y "[Events]" --draw-overflows 0.5 --legend-shift 0.02 --cumulative
python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/3-half-fixed/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c dy_mutau               -d tau_sv_sign --wjet 0.8 --skip-QCD --ratio-range 0.5 --title "" --title-x "SV Sign" --title-y "[Events]" --draw-overflows 0.5 --legend-shift 0.02 --cumulative-fractions

python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c dy_mutau               -d tau_pt --wjet 0.8 --skip-QCD --ratio-range 0.3 --bin-norm --title "" --title-x "p_{T} [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c dy_mutau               -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.3 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c dy_mutau               -d dilep_mass --wjet 0.8 --skip-QCD --ratio-range 0.3 --bin-norm --title "" --title-x "M(#mu, #tau) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02


python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/3-half-fixed/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c mu_sel -x mu_selVloose -d tau_sv_sign --wjet 0.8 --skip-QCD --ratio-range 0.5 --title "" --title-x "SV Sign" --title-y "[Events]" --draw-overflows 0.5 --legend-shift 0.02
python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/3-half-fixed/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c mu_sel -x mu_selVloose -d tau_sv_sign --wjet 0.8 --skip-QCD --ratio-range 0.5 --title "" --title-x "SV Sign" --title-y "[Events]" --draw-overflows 0.5 --legend-shift 0.02 --logy
python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/3-half-fixed/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c mu_sel -x mu_selVloose -d tau_sv_sign --wjet 0.8 --skip-QCD --ratio-range 0.5 --title "" --title-x "SV Sign" --title-y "[Events]" --draw-overflows 0.5 --legend-shift 0.02 --cumulative-fractions

-- something wrong here

python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/3-half-fixed/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c mu_sel -x mu_selVloose -d tau_sv_sign --wjet 0.8 --skip-QCD --ratio-range 0.5 --title "" --title-x "SV Sign" --title-y "[Events]" --draw-overflows 0.5 --legend-shift 0.02 --cumulative

-- this does seem ok






# nominal distributions with dileptons

jet and tau pt are > 21GeV

need to check:

1) tau sign --- for clean DY and normal TT
2) tau pt   --- for difference between TT and DY
3) Mt       --- usual fitting parameter for supressing fakes in TT
4) dilep mass --- for DY mainly

let's merge all

make merge_proc dtags=sw-dir/merge-sets/jobs_hadd.dtags.large_aa nt=v27 proc=dilep1 merge_dir=lstore_outdirs/merge-sets/
make merge_proc dtags=sw-dir/merge-sets/jobs_hadd.dtags.large_ab nt=v27 proc=dilep1 merge_dir=lstore_outdirs/merge-sets/
make merge_proc dtags=sw-dir/merge-sets/jobs_hadd.dtags.small    nt=v27 proc=dilep1 merge_dir=lstore_outdirs/merge-sets/
make merge_proc dtags=sw-dir/merge-sets/jobs_hadd.dtags.single-electron nt=v27 proc=dilep1 merge_dir=lstore_outdirs/merge-sets/
make merge_proc dtags=sw-dir/merge-sets/jobs_hadd.dtags.single-muon     nt=v27 proc=dilep1 merge_dir=lstore_outdirs/merge-sets/

hadd lstore_outdirs/merge-sets/v27/dilep1/MC2016_Summer16_TTJets_powheg.root lstore_outdirs/v27/dilep1/MC2016_Summer16_TTJets_powheg/*root &



I should automate this:

  foreach chans (el_sel el_selVloose el_sel_ss el_selVloose_ss mu_sel mu_selVloose mu_sel_ss mu_selVloose_ss tt_elmu dy_mutau dy_eltau dy_mumu dy_elel)
  foreach chans (el_sel el_selVloose el_sel_ss el_selVloose_ss mu_sel mu_selVloose mu_sel_ss mu_selVloose_ss dy_mutau dy_eltau)

foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main  sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main sw-dir/merge-sets/jobs_hadd.dtags.small_main_noqcd sw-dir/merge-sets/jobs_hadd.dtags.data-and-tt`)
  echo ${dtag}
  foreach chans (el_sel el_selVloose el_sel_ss el_selVloose_ss mu_sel mu_selVloose mu_sel_ss mu_selVloose_ss tt_elmu)

  echo \#\!/bin/sh                                          > batch_jobs/jN_${dtag}_${chans}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/jN_${dtag}_${chans}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/jN_${dtag}_${chans}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/jN_${dtag}_${chans}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/jN_${dtag}_${chans}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/jN_${dtag}_${chans}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/jN_${dtag}_${chans}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/jN_${dtag}_${chans}
  echo cmsenv                                              >> batch_jobs/jN_${dtag}_${chans}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/jN_${dtag}_${chans}

  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"std_mt_vars"' --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250  --output quick-test/v27-dilep1/${dtag}_${chans}_mt_lep_met.root  --std-histos --histo-name $chans/std_procs/nom/Mt_lep_met_f --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/jN_${dtag}_${chans}
  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"event_dilep_mass"' --ttree ttree_out --histo-range 200,0,400                      --output quick-test/v27-dilep1/${dtag}_${chans}_dilep_mass.root  --std-histos --histo-name $chans/std_procs/nom/dilep_mass   --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/jN_${dtag}_${chans}
  end
end


for tau-channels

foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main  sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main sw-dir/merge-sets/jobs_hadd.dtags.small_main_noqcd sw-dir/merge-sets/jobs_hadd.dtags.data-and-tt`)
  echo ${dtag}
  foreach chans (el_sel el_selVloose el_sel_ss el_selVloose_ss mu_sel mu_selVloose mu_sel_ss mu_selVloose_ss)

  echo \#\!/bin/sh                                          > batch_jobs/jNt_${dtag}_${chans}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/jNt_${dtag}_${chans}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/jNt_${dtag}_${chans}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/jNt_${dtag}_${chans}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/jNt_${dtag}_${chans}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/jNt_${dtag}_${chans}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/jNt_${dtag}_${chans}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/jNt_${dtag}_${chans}
  echo cmsenv                                              >> batch_jobs/jNt_${dtag}_${chans}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/jNt_${dtag}_${chans}

  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"event_taus[0].pt()"'    --ttree ttree_out --histo-range 50,0,100  --output quick-test/v27-dilep1/${dtag}_${chans}_taupt.root   --std-histos --histo-name $chans/std_procs/nom/tau_pt      --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/jNt_${dtag}_${chans}
  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"event_taus_sv_sign[0]"' --ttree ttree_out --histo-range 66,-2,20  --output quick-test/v27-dilep1/${dtag}_${chans}_tausign.root --std-histos --histo-name $chans/std_procs/nom/tau_sv_sign --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/jNt_${dtag}_${chans}
  end
end



dy channels with Mt

foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main  sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main sw-dir/merge-sets/jobs_hadd.dtags.small_main_noqcd sw-dir/merge-sets/jobs_hadd.dtags.data-and-tt`)
  echo ${dtag}
  foreach chans (dy_mutau dy_eltau dy_mumu dy_elel)

  echo \#\!/bin/sh                                          > batch_jobs/jD_${dtag}_${chans}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/jD_${dtag}_${chans}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/jD_${dtag}_${chans}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/jD_${dtag}_${chans}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/jD_${dtag}_${chans}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/jD_${dtag}_${chans}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/jD_${dtag}_${chans}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/jD_${dtag}_${chans}
  echo cmsenv                                              >> batch_jobs/jD_${dtag}_${chans}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/jD_${dtag}_${chans}

  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"std_mt_vars"' --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com '"std_mt_vars < 40."' --output quick-test/v27-dilep1/${dtag}_${chans}_mt_lep_met.root  --std-histos --histo-name $chans/std_procs/nom/Mt_lep_met_f --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/jD_${dtag}_${chans}
  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"event_dilep_mass"' --ttree ttree_out --histo-range 200,0,400                     --cond-com '"std_mt_vars < 40."' --output quick-test/v27-dilep1/${dtag}_${chans}_dilep_mass.root  --std-histos --histo-name $chans/std_procs/nom/dilep_mass   --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/jD_${dtag}_${chans}
  end
end


foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main  sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main sw-dir/merge-sets/jobs_hadd.dtags.small_main_noqcd sw-dir/merge-sets/jobs_hadd.dtags.data-and-tt`)
  echo ${dtag}
  foreach chans (dy_mutau dy_eltau)

  echo \#\!/bin/sh                                          > batch_jobs/jDt_${dtag}_${chans}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/jDt_${dtag}_${chans}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/jDt_${dtag}_${chans}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/jDt_${dtag}_${chans}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/jDt_${dtag}_${chans}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/jDt_${dtag}_${chans}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/jDt_${dtag}_${chans}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/jDt_${dtag}_${chans}
  echo cmsenv                                              >> batch_jobs/jDt_${dtag}_${chans}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/jDt_${dtag}_${chans}

  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"event_taus[0].pt()"'    --ttree ttree_out --histo-range 50,0,100 --cond-com '"std_mt_vars < 40."' --output quick-test/v27-dilep1/${dtag}_${chans}_taupt.root   --std-histos --histo-name $chans/std_procs/nom/tau_pt      --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/jDt_${dtag}_${chans}
  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"event_taus_sv_sign[0]"' --ttree ttree_out --histo-range 66,-2,20 --cond-com '"std_mt_vars < 40."' --output quick-test/v27-dilep1/${dtag}_${chans}_tausign.root --std-histos --histo-name $chans/std_procs/nom/tau_sv_sign --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v27/dilep1/*${dtag}*.root >> batch_jobs/jDt_${dtag}_${chans}
  end
end


ls batch_jobs/ > batch_jobs/submit

wc -l batch_jobs/submit
529 batch_jobs/submit
wc -l batch_jobs/submit
1058 batch_jobs/submit

qsub -l h_vmem=1G '/lstore/cms/olek/CMSSW_8_0_26_patch1/src/e
UserCodeh

% s,^,qsub -l h_vmem=1G '/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/batch_jobs/,
% s/$/'/



ls quick-test/v27-dilep1/ | wc -l
1058

hadd all in one go?
no, jost in case split


foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.all-tt-systs_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.small_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main`)
foreach dtag (SingleMuon SingleElectron)
hadd quick-test/v27-dilep1_hadds/$dtag.root quick-test/v27-dilep1/$dtag*root &
end

hadd quick-test/v27-dilep1_hadds/MC2016_Summer16_TTJets_powheg.root quick-test/v27-dilep1/MC2016_Summer16_TTJets_powheg*root


hadd quick-test/distrs_redo_v27dilep1_mc.root quick-test/v27-dilep1_hadds/MC*

python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c mu_sel -x mu_selVloose -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.3 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c tt_elmu                -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.3 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c dy_mutau               -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.3 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c dy_mumu                -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.3 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02

python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c mu_sel -x mu_selVloose -d dilep_mass --wjet 0.8 --skip-QCD --ratio-range 0.3 --bin-norm --title "" --title-x "M(#mu, #tau) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c tt_elmu                -d dilep_mass --wjet 0.8 --skip-QCD --ratio-range 0.3 --bin-norm --title "" --title-x "M(#mu, e) [GeV]"    --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c dy_mutau               -d dilep_mass --wjet 0.8 --skip-QCD --ratio-range 0.3 --bin-norm --title "" --title-x "M(#mu, #tau) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c dy_mumu                -d dilep_mass --wjet 0.8 --skip-QCD --ratio-range 0.3 --bin-norm --title "" --title-x "M(#mu, #mu) [GeV]"  --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02

python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c mu_sel -x mu_selVloose -d tau_pt --wjet 0.8 --skip-QCD --ratio-range 0.5  --title "" --title-x "p_{T} [GeV]" --title-y "[Events]" --draw-overflows 5 --legend-shift 0.02 --y-range 0,35000
python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c dy_mutau               -d tau_pt --wjet 0.8 --skip-QCD --ratio-range 0.5  --title "" --title-x "p_{T} [GeV]" --title-y "[Events]" --draw-overflows 5 --legend-shift 0.02 --y-range 0,35000

 --y-range 0,20000
 --y-range 0,20000



python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c mu_sel -x mu_selVloose -d tau_sv_sign --wjet 0.8 --skip-QCD --ratio-range 0.3 --bin-norm --title "" --title-x "SV Sign" --title-y "[Events]" --draw-overflows 0.5 --legend-shift 0.02
python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c dy_mutau               -d tau_sv_sign --wjet 0.8 --skip-QCD --ratio-range 0.3 --bin-norm --title "" --title-x "SV Sign" --title-y "[Events]" --draw-overflows 0.5 --legend-shift 0.02

-- again some problem with SV sign, not clean DY, not enough DY and too much WJets...

-- taus cut was on vloose...? run with medium..
   but shouldn't SV Sign be more effective even among vloose taus??


with Medium ID better, but still worse than before?

python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c mu_sel -x mu_selVloose -d tau_sv_sign --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "SV Sign" --title-y "[Events]" --draw-overflows 0.5 --legend-shift 0.02 --logy
python stack_plot.py distrs/distrs_redo_v27dilep1_mc.root ../quick-test/v27-dilep1_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c dy_mutau               -d tau_sv_sign --wjet 0.8 --skip-QCD --ratio-range 0.5 --bin-norm --title "" --title-x "SV Sign" --title-y "[Events]" --draw-overflows 0.5 --legend-shift 0.02 --logy






# more info for AN

Mt shapes for each channel at Vloose and Medium tau ID

python jobsums/get_shapes.py --x-title "M_{T}(#mu, MET) [GeV]" --y-title "arbitrary units" --norm-binwidth --formula "tt_mujets : tt_mutau" -c mu_selVloose -d Mt_lep_met_f -p tt_lj "signal":tt_mutau:jobsums/distrs/distrs_redo_v25v26_mc_4.root:mu_selVloose,tt_mutau,NOMINAL "background":tt_mujets:jobsums/distrs/distrs_redo_v25v26_mc_4.root:mu_selVloose,tt_lj,NOMINAL --y-range 0,0.3

python jobsums/get_shapes.py --x-title "M_{T}(e, MET) [GeV]"   --y-title "arbitrary units" --norm-binwidth --formula "tt_eljets : tt_eltau" -c el_selVloose -d Mt_lep_met_f -p tt_lj "signal":tt_eltau:jobsums/distrs/distrs_redo_v25v26_mc_4.root:el_selVloose,tt_eltau,NOMINAL "background":tt_eljets:jobsums/distrs/distrs_redo_v25v26_mc_4.root:el_selVloose,tt_lj,NOMINAL --y-range 0,0.3

python jobsums/get_shapes.py --x-title "M_{T}(#mu, MET) [GeV]" --y-title "arbitrary units" --norm-binwidth --formula "tt_mujets : tt_mutau" -c mu_sel -d Mt_lep_met_f -p tt_lj "signal":tt_mutau:jobsums/distrs/distrs_redo_v25v26_mc_4.root:mu_sel,tt_mutau,NOMINAL "background":tt_mujets:jobsums/distrs/distrs_redo_v25v26_mc_4.root:mu_sel,tt_lj,NOMINAL --y-range 0,0.3

python jobsums/get_shapes.py --x-title "M_{T}(e, MET) [GeV]"   --y-title "arbitrary units" --norm-binwidth --formula "tt_eljets : tt_eltau" -c el_sel -d Mt_lep_met_f -p tt_lj "signal":tt_eltau:jobsums/distrs/distrs_redo_v25v26_mc_4.root:el_sel,tt_eltau,NOMINAL "background":tt_eljets:jobsums/distrs/distrs_redo_v25v26_mc_4.root:el_sel,tt_lj,NOMINAL --y-range 0,0.3


Data-MC in Same Sign selection for control

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c mu_sel_ss -x mu_selVloose_ss -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --y-max 250.

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleElectron.root -p -r -o plots/ --lumi 31300 -c el_sel_ss -x el_selVloose_ss -d Mt_lep_met_f --wjet 0.8 --skip-QCD --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --y-max 150.

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c mu_sel -x mu_selVloose -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --y-max 250.

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleElectron.root -p -r -o plots/ --lumi 31300 -c el_sel -x el_selVloose -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02 --y-max 150.



sel with experimental legend

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c mu_sel -x mu_selVloose -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3  --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0. --exp-legend

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleElectron.root -p -r -o plots/ --lumi 31300 -c el_sel -x el_selVloose -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3  --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0. --exp-legend



The new categorized plots
with all processes explisit --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleElectron.root -p -r -o plots/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleElectron.root -p -r -o plots/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02






for yield table with OS sel nominal data-driven QCD:

foreach sys (NOMINAL)
python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel    -x mu_selVloose    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --systematic $sys &
python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel    -x el_selVloose    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --systematic $sys &
end

hadd histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix_with_selOS.root histosels/redo-v25-v26_1/distrs/*root

python numbers_for_datacard.py histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix_with_selOS.root -y -d Mt_lep_met_f -c el_sel,el_sel_lj,el_sel_ljout --latex
python numbers_for_datacard.py histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix_with_selOS.root -y -d Mt_lep_met_f -c mu_sel,mu_sel_lj,mu_sel_ljout --latex




signal acceptance with statistical uncertainty

merge-sets/v34/t1/MC2016_Summer16_TTJets_powheg.root

python print_acceptances.py --sys-weights merge-sets/v34/t1/MC2016_Summer16_TTJets_powheg.root --with-stat
INFO:root:import ROOT
INFO:root:done
               mutau           0.1756 +- 0.0004     0.1759 +- 0.0004     0.1756 +- 0.0004     0.1754 +- 0.0004     0.1761 +- 0.0004     0.1756 +- 0.0004     0.1760 +- 0.0004     0.1758 +- 0.0004     0.1756 +- 0.0004     0.1757 +- 0.0004     0.1758 +- 0.0004     0.1753 +- 0.0004     0.1754 +- 0.0004     0.1760 +- 0.0004     0.1755 +- 0.0004     0.1757 +- 0.0004     0.1755 +- 0.0004     0.1752 +- 0.0004     0.1762 +- 0.0004     0.1759 +- 0.0004     0.1755 +- 0.0004     0.1749 +- 0.0004     0.1762 +- 0.0004     0.1757 +- 0.0004     0.1757 +- 0.0004     0.1756 +- 0.0004     0.1758 +- 0.0004     0.1763 +- 0.0004     0.1751 +- 0.0004     0.1759 +- 0.0004     0.1754 +- 0.0004     0.1754 +- 0.0004     0.1760 +- 0.0004     0.1761 +- 0.0004     0.1753 +- 0.0004     0.1756 +- 0.0004     0.1758 +- 0.0004     0.1756 +- 0.0004     0.1757 +- 0.0004     0.1758 +- 0.0004     0.1756 +- 0.0004     0.1755 +- 0.0004     0.1761 +- 0.0004     0.1756 +- 0.0004     0.1759 +- 0.0004     0.1760 +- 0.0004     0.1753 +- 0.0004     0.1759 +- 0.0004     0.1756 +- 0.0004     0.1754 +- 0.0004     0.1761 +- 0.0004     0.1752 +- 0.0004     0.1763 +- 0.0004     0.1757 +- 0.0004     0.1757 +- 0.0004     0.1755 +- 0.0004     0.1751 +- 0.0004     0.1752 +- 0.0004     0.1752 +- 0.0004     0.1757 +- 0.0004     0.1757 +- 0.0004     0.1760 +- 0.0004     0.1758 +- 0.0004     0.1757 +- 0.0004     0.1758 +- 0.0004     0.0000 +- 0.0000     0.0000 +- 0.0000     0.0000 +- 0.0000     0.0000 +- 0.0000     0.0000 +- 0.0000     0.0000 +- 0.0000     0.0000 +- 0.0000     0.0000 +- 0.0000     0.0000 +- 0.0000
               eltau           0.1687 +- 0.0004     0.1689 +- 0.0004     0.1686 +- 0.0004     0.1684 +- 0.0004     0.1691 +- 0.0004     0.1685 +- 0.0004     0.1690 +- 0.0004     0.1688 +- 0.0004     0.1686 +- 0.0004     0.1687 +- 0.0004     0.1688 +- 0.0004     0.1683 +- 0.0004     0.1684 +- 0.0004     0.1690 +- 0.0004     0.1686 +- 0.0004     0.1686 +- 0.0004     0.1685 +- 0.0004     0.1683 +- 0.0004     0.1691 +- 0.0004     0.1689 +- 0.0004     0.1686 +- 0.0004     0.1681 +- 0.0004     0.1691 +- 0.0004     0.1687 +- 0.0004     0.1687 +- 0.0004     0.1686 +- 0.0004     0.1688 +- 0.0004     0.1692 +- 0.0004     0.1682 +- 0.0004     0.1688 +- 0.0004     0.1684 +- 0.0004     0.1684 +- 0.0004     0.1690 +- 0.0004     0.1691 +- 0.0004     0.1683 +- 0.0004     0.1687 +- 0.0004     0.1688 +- 0.0004     0.1687 +- 0.0004     0.1687 +- 0.0004     0.1688 +- 0.0004     0.1686 +- 0.0004     0.1685 +- 0.0004     0.1691 +- 0.0004     0.1686 +- 0.0004     0.1689 +- 0.0004     0.1689 +- 0.0004     0.1683 +- 0.0004     0.1689 +- 0.0004     0.1686 +- 0.0004     0.1684 +- 0.0004     0.1691 +- 0.0004     0.1682 +- 0.0004     0.1693 +- 0.0004     0.1688 +- 0.0004     0.1687 +- 0.0004     0.1686 +- 0.0004     0.1681 +- 0.0004     0.1682 +- 0.0004     0.1683 +- 0.0004     0.1688 +- 0.0004     0.1687 +- 0.0004     0.1689 +- 0.0004     0.1688 +- 0.0004     0.1687 +- 0.0004     0.1687 +- 0.0004     0.0000 +- 0.0000     0.0000 +- 0.0000     0.0000 +- 0.0000     0.0000 +- 0.0000     0.0000 +- 0.0000     0.0000 +- 0.0000     0.0000 +- 0.0000     0.0000 +- 0.0000     0.0000 +- 0.0000
                 sum           0.1722     0.1724     0.1721     0.1719     0.1726     0.1721     0.1725     0.1723     0.1721     0.1722     0.1723     0.1718     0.1719     0.1725     0.1721     0.1722     0.1720     0.1717     0.1727     0.1724     0.1721     0.1715     0.1726     0.1722     0.1722     0.1721     0.1723     0.1727     0.1717     0.1724     0.1719     0.1719     0.1725     0.1726     0.1718     0.1722     0.1723     0.1721     0.1722     0.1723     0.1721     0.1720     0.1726     0.1721     0.1724     0.1725     0.1718     0.1724     0.1721     0.1719     0.1726     0.1717     0.1728     0.1722     0.1722     0.1720     0.1716     0.1717     0.1717     0.1723     0.1722     0.1725     0.1723     0.1722     0.1722     0.0000     0.0000     0.0000     0.0000     0.0000     0.0000     0.0000     0.0000     0.0000








# fit plots for the paper, NLL etc

python fit-stuff/plot_uncertainty_scans.py


inputs for sig-strength -> xsec

signal strangth:

el_sig  = 1.020
el_sys  = 0.096
el_stat = 0.015

mu_sig  = 0.909
mu_sys  = 0.077
mu_stat = 0.011

bt_sig  = 0.941
bt_sys  = 0.075
bt_stat = 0.009


yields table

old one:

python numbers_for_datacard.py histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights_test4.root -y -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --latex

now:

python numbers_for_datacard.py histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -y -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --latex



comparison of Mt shapes with different legends

python jobsums/get_shapes.py --x-title "M_{T}(#mu, MET) [GeV]" --norm-binwidth --formula "tt_mujets : tt_mutau " -c mu_selVloose -d Mt_lep_met_f -p tt_lj tt_mutau:jobsums/distrs/distrs_redo_v25v26_mc_4.root:mu_selVloose,tt_mutau,NOMINAL tt_mujets:jobsums/distrs/distrs_redo_v25v26_mc_4.root:mu_selVloose,tt_lj,NOMINAL --y-range 0,0.3

python jobsums/get_shapes.py --x-title "M_{T}(e, MET) [GeV]"   --norm-binwidth --formula "tt_eljets : tt_eltau " -c el_selVloose -d Mt_lep_met_f -p tt_lj tt_eltau:jobsums/distrs/distrs_redo_v25v26_mc_4.root:el_selVloose,tt_eltau,NOMINAL tt_eljets:jobsums/distrs/distrs_redo_v25v26_mc_4.root:el_selVloose,tt_lj,NOMINAL --y-range 0,0.3


python jobsums/get_shapes.py --x-title "M_{T}(#mu, MET) [GeV]" --norm-binwidth --formula "tt_mujets : tt_mutau " -c mu_selVloose -d Mt_lep_met_f -p tt_lj "t#bar{t}#rightarrow #mu#tau_{h}":tt_mutau:jobsums/distrs/distrs_redo_v25v26_mc_4.root:mu_selVloose,tt_mutau,NOMINAL "t#bar{t}#rightarrow lj":tt_mujets:jobsums/distrs/distrs_redo_v25v26_mc_4.root:mu_selVloose,tt_lj,NOMINAL --y-range 0,0.3

python jobsums/get_shapes.py --x-title "M_{T}(e, MET) [GeV]"   --norm-binwidth --formula "tt_eljets : tt_eltau " -c el_selVloose -d Mt_lep_met_f -p tt_lj "t#bar{t}#rightarrow e#tau_{h}":tt_eltau:jobsums/distrs/distrs_redo_v25v26_mc_4.root:el_selVloose,tt_eltau,NOMINAL "t#bar{t}#rightarrow lj":tt_eljets:jobsums/distrs/distrs_redo_v25v26_mc_4.root:el_selVloose,tt_lj,NOMINAL --y-range 0,0.3


python jobsums/get_shapes.py --x-title "M_{T}(#mu, MET) [GeV]" --norm-binwidth --formula "tt_mujets : tt_mutau " -c mu_selVloose -d Mt_lep_met_f -p tt_lj "signal":tt_mutau:jobsums/distrs/distrs_redo_v25v26_mc_4.root:mu_selVloose,tt_mutau,NOMINAL "background":tt_mujets:jobsums/distrs/distrs_redo_v25v26_mc_4.root:mu_selVloose,tt_lj,NOMINAL --y-range 0,0.3

python jobsums/get_shapes.py --x-title "M_{T}(e, MET) [GeV]"   --norm-binwidth --formula "tt_eljets : tt_eltau " -c el_selVloose -d Mt_lep_met_f -p tt_lj "signal":tt_eltau:jobsums/distrs/distrs_redo_v25v26_mc_4.root:el_selVloose,tt_eltau,NOMINAL "background":tt_eljets:jobsums/distrs/distrs_redo_v25v26_mc_4.root:el_selVloose,tt_lj,NOMINAL --y-range 0,0.3


python jobsums/get_shapes.py --x-title "M_{T}(#mu, MET) [GeV]" --norm-binwidth --formula "tt_mujets : tt_mutau " -c mu_selVloose -d Mt_lep_met_f -p tt_lj "signal (t#bar{t}#rightarrow l#tau_{h}#nu#nu{}b#bar{b})":tt_mutau:jobsums/distrs/distrs_redo_v25v26_mc_4.root:mu_selVloose,tt_mutau,NOMINAL "background":tt_mujets:jobsums/distrs/distrs_redo_v25v26_mc_4.root:mu_selVloose,tt_lj,NOMINAL --y-range 0,0.3

python jobsums/get_shapes.py --x-title "M_{T}(e, MET) [GeV]"   --norm-binwidth --formula "tt_eljets : tt_eltau " -c el_selVloose -d Mt_lep_met_f -p tt_lj "signal":tt_eltau:jobsums/distrs/distrs_redo_v25v26_mc_4.root:el_selVloose,tt_eltau,NOMINAL "background":tt_eljets:jobsums/distrs/distrs_redo_v25v26_mc_4.root:el_selVloose,tt_lj,NOMINAL --y-range 0,0.3






python jobsums/get_shapes.py --x-title "M_{T}(l, MET) [GeV]" --y-title "arbitrary units" --norm-binwidth --formula "tt_mujets : tt_mutau" -c mu_selVloose -d Mt_lep_met_f -p tt_lj "signal":tt_mutau:jobsums/distrs/distrs_redo_v25v26_mc_4.root:mu_selVloose,tt_mutau,NOMINAL "background":tt_mujets:jobsums/distrs/distrs_redo_v25v26_mc_4.root:mu_selVloose,tt_lj,NOMINAL --y-range 0,0.3










# sels with nominal systematic

foreach chans (el_sel el_selVloose el_sel_ss el_selVloose_ss mu_sel mu_selVloose mu_sel_ss mu_selVloose_ss)
  foreach systs (nom)
  echo \#\!/bin/sh                                          > batch_jobs/tt_${chans}_${systs}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/tt_${chans}_${systs}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/tt_${chans}_${systs}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/tt_${chans}_${systs}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/tt_${chans}_${systs}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/tt_${chans}_${systs}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/tt_${chans}_${systs}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/tt_${chans}_${systs}
  echo cmsenv                                              >> batch_jobs/tt_${chans}_${systs}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/tt_${chans}_${systs}

  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"std_mt_vars"' --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com '""' --output quick-test/redo-v25-v26_cats/MC2016_Summer16_TTJets_powheg_${chans}_$systs.root    --std-histos --histo-name $chans/std_procs/$systs/Mt_lep_met_f  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root >> batch_jobs/tt_${chans}_${systs}
  end
end

foreach chans (el_sel el_selVloose el_sel_ss el_selVloose_ss mu_sel mu_selVloose mu_sel_ss mu_selVloose_ss)
  foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main  sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main sw-dir/merge-sets/jobs_hadd.dtags.small_main`)
  echo \#\!/bin/sh                                          > batch_jobs/mc_${dtag}_${chans}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/mc_${dtag}_${chans}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/mc_${dtag}_${chans}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/mc_${dtag}_${chans}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/mc_${dtag}_${chans}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/mc_${dtag}_${chans}
  echo cmsenv                                              >> batch_jobs/mc_${dtag}_${chans}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/mc_${dtag}_${chans}

  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"std_mt_vars"' --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com '""' --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom/Mt_lep_met_f  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root >> batch_jobs/mc_${dtag}_${chans}
  end
end

foreach chans (el_sel el_selVloose el_sel_ss el_selVloose_ss mu_sel mu_selVloose mu_sel_ss mu_selVloose_ss)
  foreach dtag (SingleMuon SingleElectron)
  echo \#\!/bin/sh                                          > batch_jobs/data_${dtag}_${chans}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/data_${dtag}_${chans}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/data_${dtag}_${chans}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/data_${dtag}_${chans}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/data_${dtag}_${chans}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/data_${dtag}_${chans}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/data_${dtag}_${chans}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/data_${dtag}_${chans}
  echo cmsenv                                              >> batch_jobs/data_${dtag}_${chans}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/data_${dtag}_${chans}

  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"std_mt_vars"' --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com '""' --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root >> batch_jobs/data_${dtag}_${chans}
  end
end



hadd quick-test/distrs_redo_v25v26_mc_4.root quick-test/redo-v25-v26_cats_hadds/MC*

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleMuon.root     -p -r -o plots/ --lumi 35800 -c mu_sel -x mu_selVloose -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --bin-norm --title "" --title-x "M_{T}(#mu, MET) [GeV]" --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02

python stack_plot.py distrs/distrs_redo_v25v26_mc_4.root ../quick-test/redo-v25-v26_cats_hadds/SingleElectron.root -p -r -o plots/ --lumi 31300 -c el_sel -x el_selVloose -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_eltau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --bin-norm --title "" --title-x "M_{T}(e, MET) [GeV]"   --title-y "[Events/GeV]" --draw-overflows 5 --legend-shift 0.02















# table of the fit results

python ttxsec/fit-stuff/new_impact_table.py --merge-pdf latest_el_impacts_lnN_lnN_noQCDPUnTES_withPDF.json latest_mu_impacts_lnN_lnN_noQCDPUnTES_withPDF.json latest_both_impacts_lnN_lnN_noQCDPUnTES_withPDF.json

python ttxsec/fit-stuff/new_impact_table.py --merge-pdf latest_el_impacts_lnN_lnN_noQCDPUnTES_withPDF.json latest_mu_impacts_lnN_lnN_noQCDPUnTES_withPDF.json  latest_both_impacts_lnN_lnN_noQCDPUnTES_withPDF.json


$\tauh$ jet identification  &  5.1 &  4.7 &  4.5 \\
      Pile-Up uncertainty  &  3.3 &  2.7 &  2.8 \\
$\tauh$ misidentification background  &  2.8 &  2.5 &  2.5 \\
        top quark $p_{T}$  &  3.0 &  3.1 &  2.5 \\
        QCD normalization  &  0.1 &  1.3 &  1.6 \\
     b-tagging efficiency  &  1.5 &  1.5 &  1.4 \\
     W+jets normalization  &  0.3 &  1.2 &  1.2 \\
       muon ID efficiency  &  0.7 &  0.7 \\
         DY normalization  &  0.3 &  0.3 &  0.6 \\
electron trigger efficiency  &  2.6 &  0.5 \\
 Single Top normalization  &  0.6 &  0.5 &  0.5 \\
   electron ID efficiency  &  1.9 &  0.4 \\
     $\tauh$ Energy Scale  &  0.3 &  0.4 &  0.3 \\
  muon trigger efficiency  &  0.4 &  0.3 \\
    jet energy resolution  &  0.1 &  0.1 &  0.2 \\
         jet energy scale  &  0.2 &  0.2 &  0.1 \\
   Dibosons normalization  &  0.0 &  0.0 &  0.0 \\
               Luminosity  &  0.0 &  0.0 &  0.0 \\
          b fragmentation  &  2.7 &  2.6 &  2.7 \\
    Final State Radiation  &  2.2 &  1.6 &  1.9 \\
  Initial State Radiation  &  1.9 &  1.3 &  1.3 \\
ME combined scale variation  &  0.6 &  1.2 &  1.0 \\
 ME Renormalization scale  &  0.9 &  1.3 &  0.9 \\
   ME-PS matching (hdamp)  &  0.2 &  0.7 &  0.6 \\
Underlying event (Pythia tune)  &  0.5 &  0.4 &  0.5 \\
b decay tables, Semileptonic BR  &  0.5 &  0.3 &  0.3 \\
   ME Factorization scale  &  0.3 &  0.3 &  0.1 \\
                      PDF  &  1.6 &  1.3 &  1.5 \\
            MC statistics  &  2.4 &  1.7 &  1.8 \\







# systematic variations in qcd

python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c mu_sel_ljout -d Mt_lep_met_f -s JERUp,JERDown
python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c mu_sel_lj    -d Mt_lep_met_f -s JERUp,JERDown

python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c mu_sel_ljout -d Mt_lep_met_f -s JESUp,JESDown
python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c mu_sel_lj    -d Mt_lep_met_f -s JESUp,JESDown

python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c mu_sel_ljout -d Mt_lep_met_f -s TESUp,TESDown
python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c mu_sel_lj    -d Mt_lep_met_f -s TESUp,TESDown

python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c mu_sel_ljout -d Mt_lep_met_f -s PUUp,PUDown
python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c mu_sel_lj    -d Mt_lep_met_f -s PUUp,PUDown

python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c mu_sel_ljout -d Mt_lep_met_f -s bSFUp,bSFDown
python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c mu_sel_lj    -d Mt_lep_met_f -s bSFUp,bSFDown

python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c mu_sel_ljout -d Mt_lep_met_f -s LEPmuIDUp,LEPmuIDDown
python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c mu_sel_lj    -d Mt_lep_met_f -s LEPmuIDUp,LEPmuIDDown

python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c mu_sel_ljout -d Mt_lep_met_f -s LEPmuTRGUp,LEPmuTRGDown
python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c mu_sel_lj    -d Mt_lep_met_f -s LEPmuTRGUp,LEPmuTRGDown



electron channel

python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c el_sel_ljout -d Mt_lep_met_f -s JERUp,JERDown
python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c el_sel_lj    -d Mt_lep_met_f -s JERUp,JERDown

python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c el_sel_ljout -d Mt_lep_met_f -s JESUp,JESDown
python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c el_sel_lj    -d Mt_lep_met_f -s JESUp,JESDown

python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c el_sel_ljout -d Mt_lep_met_f -s TESUp,TESDown
python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c el_sel_lj    -d Mt_lep_met_f -s TESUp,TESDown

python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c el_sel_ljout -d Mt_lep_met_f -s PUUp,PUDown
python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c el_sel_lj    -d Mt_lep_met_f -s PUUp,PUDown

python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c el_sel_ljout -d Mt_lep_met_f -s bSFUp,bSFDown
python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c el_sel_lj    -d Mt_lep_met_f -s bSFUp,bSFDown

python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c el_sel_ljout -d Mt_lep_met_f -s LEPelIDUp,LEPelIDDown
python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c el_sel_lj    -d Mt_lep_met_f -s LEPelIDUp,LEPelIDDown

python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c el_sel_ljout -d Mt_lep_met_f -s LEPelTRGUp,LEPelTRGDown
python mc_per_sys.py --no-data histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root -p qcd -c el_sel_lj    -d Mt_lep_met_f -s LEPelTRGUp,LEPelTRGDown


why the hell this small variation matters so much?


trying qcd without object systematics

combineCards.py mu=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu.txt el=ttxsec/datacard_v25v26redo_el_lnU_noQCDpu.txt > ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.txt
./scripts/text2workspace.py ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.txt

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV -m 125 --robustFit 1 --doInitialFit                --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV -m 125 --robustFit 1 --doFits --parallel 5         --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV -m 125 -o latest_both_impacts_lnN_lnN_noQCDobj_NEWupdowns.json --name BothImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_lnN_lnN_noQCDobj_NEWupdowns.json -o postfit_both_impacts_lnN_lnN_noQCDobj_NEWupdowns

   r :    +1.032   -0.091/+0.093 (68%)

  FSR       :   +0.691  -0.489/+0.511  -0.038/+0.154
  JES       :   -0.011  -0.265/+0.267  -0.000/+0.004
  SemilepBR :   -0.590  -0.909/+1.483  -0.004/-0.002
  tau_fakes :   +0.793  -0.800/+0.790  +0.099/+0.041

-- same crap

try with frozen pdf:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf -m 125 --robustFit 1 --doInitialFit                --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf -m 125 --robustFit 1 --doFits --parallel 5         --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf -m 125 -o latest_both_impacts_lnN_lnN_noQCDobj_NEWupdowns_noPDF.json --name BothImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_lnN_lnN_noQCDobj_NEWupdowns_noPDF.json -o postfit_both_impacts_lnN_lnN_noQCDobj_NEWupdowns_noPDF

-- a bit different, but same problem with fakes


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf -m 125 --robustFit 1 --doInitialFit                --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf -m 125 --robustFit 1 --doFits --parallel 5         --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf -m 125 -o latest_both_impacts_lnN_lnN_noQCDobjPU_NEWupdowns.json --name BothImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_lnN_lnN_noQCDobjPU_NEWupdowns.json -o postfit_both_impacts_lnN_lnN_noQCDobjPU_NEWupdowns

-- kind of ok, tau id impact failed for some reason, but no asymetry, high fakes and FSR impact, but kind of ok

freeze only lep systematic

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf -m 125 --robustFit 1 --doInitialFit                --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf -m 125 --robustFit 1 --doFits --parallel 5         --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf -m 125 -o latest_both_impacts_lnN_lnN_noQCDlep_NEWupdowns.json --name BothImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_lnN_lnN_noQCDlep_NEWupdowns.json -o postfit_both_impacts_lnN_lnN_noQCDlep_NEWupdowns

-- same crap

no PU, TES

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf -m 125 --robustFit 1 --doInitialFit                --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf -m 125 --robustFit 1 --doFits --parallel 5         --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf -m 125 -o latest_both_impacts_lnN_lnN_noQCDPUnTES.json --name BothImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_lnN_lnN_noQCDPUnTES.json -o postfit_both_impacts_lnN_lnN_noQCDPUnTES

-- ok but fakes are 2nd and FSR is third

compare to qcd with no systematics

postfit_both_impacts_lnN_lnN_noQCDPUnTES.pdf
postfit_both_impacts_lnN_lnN_noQCDallSYST_UPelUpdowns.pdf

-- practically the same

table

python ttxsec/fit-stuff/new_impact_table.py --merge-pdf latest_el_impacts_lnN_lnN_updowns.json latest_mu_impacts_lnN_lnN_updowns.json latest_both_impacts_lnN_lnN_noQCDPUnTES.json 

-- FSR is much larger than in separate channels
   tau_fakes are much larger
   wjets normalization
   qcd norm too


try with pdfs in and separate channels

combineCards.py mu=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu.txt el=ttxsec/datacard_v25v26redo_el_lnU_noQCDpu.txt > ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.txt

./scripts/text2workspace.py ttxsec/datacard_v25v26redo_el_lnU_noQCDpu.txt
./scripts/text2workspace.py ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu.txt
./scripts/text2workspace.py ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.txt

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit                --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5         --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV  -m 125 -o latest_both_impacts_lnN_lnN_noQCDPUnTES_withPDF.json --name BothImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_lnN_lnN_noQCDPUnTES_withPDF.json -o postfit_both_impacts_lnN_lnN_noQCDPUnTES_withPDF


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit                          --name ElImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5                   --name ElImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu.root   --freezeParameters lumi_13TeV  -m 125 -o latest_el_impacts_lnN_lnN_noQCDPUnTES_withPDF.json --name ElImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts_lnN_lnN_noQCDPUnTES_withPDF.json -o postfit_el_impacts_lnN_lnN_noQCDPUnTES_withPDF


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit                          --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5                   --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu.root   --freezeParameters lumi_13TeV  -m 125 -o latest_mu_impacts_lnN_lnN_noQCDPUnTES_withPDF.json --name MuImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_lnN_lnN_noQCDPUnTES_withPDF.json -o postfit_mu_impacts_lnN_lnN_noQCDPUnTES_withPDF


   r :    +1.018   -0.091/+0.091 (68%)
   r :    +1.026   -0.103/+0.110 (68%)
   r :    +0.978   -0.085/+0.092 (68%)

fakes and FSR are 1 and 2 in electron
              and 2 and 3 in muon

round off the FSR?

electron:
           FSR lnN 1.07/0.93     1.48/0.52     1.46/0.54     1.08/0.92     1.31/0.69  - - - - - - - - -  1.09/0.91   1.47/0.53   1.48/0.52   1.13/0.87   1.33/0.67  - - - - - - - - -

muon:
           FSR lnN 1.08/0.92  1.49/0.51  1.48/0.52  1.09/0.91  1.34/0.66  - - - - - - - - -  1.09/0.91   1.46/0.54   1.43/0.57   1.07/0.93   1.33/0.67  - - - - - - - - -
           FSR lnN 1.1  1.4  1.4  1.1  1.35  - - - - - - - - -  1.1   1.4   1.4   1.07   1.33  - - - - - - - - -
           FSR lnN 1.1  1.5  1.5  1.1  1.35  - - - - - - - - -  1.1   1.4   1.4   1.07   1.33  - - - - - - - - -

all worse than the original yields?

           FSR lnN 1.02       1.4        1.35       1.09/0.91  1.34/0.66  - - - - - - - - -  1.05        1.4         1.33        1.07/0.93   1.33/0.67  - - - - - - - - -


el mu both

   r :    +1.044   -0.108/+0.121 (68%)
   r :    +0.970   -0.096/+0.109 (68%)
   r :    +1.025   -0.100/+0.108 (68%)

mu worse and el too

rounded down

el mu both

   r :    +1.040   -0.111/+0.124 (68%)
   r :    +0.959   -0.098/+0.111 (68%)
   r :    +1.009   -0.100/+0.111 (68%)

same crap
el is very symetric sudenly

the original yields in muon channel:

   r :    +0.978   -0.085/+0.092 (68%)

original yield variations in electron channel:

fakes and FSR:
2 and 3 in muon
1 and 2 in electron

electron with muon FSR variation

   r :    +1.031   -0.103/+0.105 (68%)

kind of better?

round for asymetry

   r :    +0.989   -0.097/+0.110 (68%)

-- changed just the tt_lj yield by 2 percent rounded to closest 5 (instead of 10)
   FSR is top, ID 2nd, fakes are constrained and 3rd

freeze FSR

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu.root   --freezeParameters lumi_13TeV,FSR  -m 125 --robustFit 1 --doInitialFit                                --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu.root   --freezeParameters lumi_13TeV,FSR  -m 125 --robustFit 1 --doFits --parallel 5                         --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu.root   --freezeParameters lumi_13TeV,FSR  -m 125 -o latest_mu_impacts_lnN_lnN_noQCDPUnTES_withPDF_noFSR.json --name MuImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_lnN_lnN_noQCDPUnTES_withPDF_noFSR.json -o postfit_mu_impacts_lnN_lnN_noQCDPUnTES_withPDF_noFSR

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu.root   --freezeParameters lumi_13TeV,FSR  -m 125 --robustFit 1 --doInitialFit                          --name ElImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu.root   --freezeParameters lumi_13TeV,FSR  -m 125 --robustFit 1 --doFits --parallel 5                   --name ElImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_el_lnU_noQCDpu.root   --freezeParameters lumi_13TeV,FSR  -m 125 -o latest_el_impacts_lnN_lnN_noQCDPUnTES_withPDF_noFSR.json --name ElImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts_lnN_lnN_noQCDPUnTES_withPDF_noFSR.json -o postfit_el_impacts_lnN_lnN_noQCDPUnTES_withPDF_noFSR

   r :    +1.026   -0.088/+0.096 (68%)

fakes are small and constrained significantly
ID 1 PU 2 TOPPT 3






orthogonality of stuff

v_el    = [ 1.07  1.48  1.46  1.08  1.31   1.09   1.47   1.48   1.13   1.33 ]
v_mu    = [ 1.08  1.49  1.48  1.09  1.34   1.09   1.46   1.43   1.07   1.33 ]

v_elmu2 = [ 1.08  1.5   1.48  1.09  1.34   1.09   1.45   1.43   1.07   1.33 ]

fakes   = [ 0     1.5   1.5   0     1.5    0      1.5    1.5    0      1.5  ]

angle(v1, v2) = (v1*v2') / sqrt(v1*v1' * v2*v2')

angle(fakes, v_mu)
angle(fakes, v_el)
angle(fakes, v_elmu2)

0.848624
0.846225
0.848604


angle(fakes, [ 1.1  1.5   1.48  1.09  1.34   1.09   1.45   1.43   1.07   1.33 ])
0.847507

   r :    +1.057   -0.106/+0.120 (68%)

  JER       :   +0.095  -0.433/+0.501  +0.002/-0.003
  wjets_norm :   +0.142  -0.993/+0.961  -0.001/+0.001
  SemilepBR :   -0.266  -1.059/+1.489  -0.006/-0.002
  JES       :   -0.075  -0.516/+0.471  +0.006/-0.003
  tauID_eff :   -0.155  -0.982/+0.980  +0.059/-0.056
  tau_fakes :   +0.138  -0.550/+0.501  -0.059/+0.064
  FSR       :   -0.334  -0.599/+0.619  +0.062/-0.057

same stuff

larger angle between FSR and fakes makes things worse? why?
-- finds the solution closer to the 0 variation?
-- not weighted for yields?

el_y = [ 2964.433  2181.810  115.910  167.882  58.866    4621.035  1435.403  75.104  275.598  98.665 ]

angle(fakes .* el_y, el_y .* v_el)
angle(fakes .* el_y, el_y .* v_mu)
angle(fakes .* el_y, el_y .* v_elmu2)
angle(fakes .* el_y, el_y .* [ 1.1  1.5   1.48  1.09  1.34   1.09   1.45   1.43   1.07   1.33 ])

0.543939
0.543993
0.544998
0.542956

  tau_fakes :   +0.139  -0.551/+0.501  -0.033/+0.038


id 1, fakes 2, FSR 5th

1.05 in muons makes FSR contrained to 0 error bar and fakes are strongly constrained too

el mu both

   r :    +1.019   -0.089/+0.097 (68%)
   r :    +0.915   -0.071/+0.078 (68%)
   r :    +0.944   -0.070/+0.076 (68%)

WHAT IS THIS WITH MUONS????

but meanwhile

  FSR       :   +0.526  -0.813/+0.794  +0.011/-0.016

but suddenly the impacts are kind of ok








# separate channels are ok, but simultaneous fit fails

The problem:

[olek@fermi02 CombinedLimit]$ python ttxsec/fit-stuff/new_impact_table.py --merge-pdf latest_el_impacts_lnN_lnN_updowns.json latest_mu_impacts_lnN_lnN_updowns.json latest_both_impacts_lnN_lnN_updowns.json
$\tauh$ misidentification background  &  2.0 &  1.4 &  8.1 \\
$\tauh$ jet identification  &  5.2 &  4.9 &  4.3 \\
      Pile-Up uncertainty  &  3.1 &  2.7 &  3.5 \\
        top quark $p_{T}$  &  3.0 &  2.4 &  2.5 \\
     W+jets normalization  &  0.4 &  1.2 &  2.1 \\
        QCD normalization  &  0.6 &  0.9 &  1.9 \\
         DY normalization  &  0.4 &  0.4 &  1.6 \\
     b-tagging efficiency  &  1.9 &  2.0 &  1.5 \\
       muon ID efficiency  &  0.8 &  0.8 \\
     $\tauh$ Energy Scale  &  0.7 &  0.5 &  0.7 \\
electron trigger efficiency  &  2.8 &  0.6 \\
 Single Top normalization  &  0.7 &  0.7 &  0.6 \\
         jet energy scale  &  0.3 &  0.0 &  0.3 \\
  muon trigger efficiency  &  0.4 &  0.3 \\
    jet energy resolution  &  0.3 &  0.0 &  0.2 \\
   electron ID efficiency  &  2.1 &  0.2 \\
   Dibosons normalization  &  0.0 &  0.0 &  0.0 \\
               Luminosity  &  0.0 &  0.0 &  0.0 \\
          b fragmentation  &  3.0 &  2.6 &  3.9 \\
Underlying event (Pythia tune)  &  0.6 &  0.7 &  1.8 \\
  Initial State Radiation  &  1.5 &  1.4 &  1.4 \\
b decay tables, Semileptonic BR  &  0.6 &  0.4 &  1.3 \\
ME combined scale variation  &  0.5 &  1.0 \\
    Final State Radiation  &  1.6 &  0.4 &  0.6 \\
 ME Renormalization scale  &  0.8 &  1.2 &  0.5 \\
   ME-PS matching (hdamp)  &  0.5 &  0.3 &  0.3 \\
   ME Factorization scale  &  0.3 &  0.3 \\
                      PDF  &  1.7 &  1.4 &  3.8 \\
            MC statistics  &  2.5 &  1.7 &  5.5 \\


frozen updowns:

[olek@fermi02 CombinedLimit]$ python ttxsec/fit-stuff/new_impact_table.py --merge-pdf latest_el_impacts_lnN_lnN_updowns.json latest_mu_impacts_lnN_lnN_updowns.json latest_both_impacts_lnN_lnN_updowns_frozenUpdowns.json 
$\tauh$ jet identification  &  5.2 &  4.9 &  4.8 \\
      Pile-Up uncertainty  &  3.1 &  2.7 &  3.6 \\
        top quark $p_{T}$  &  3.0 &  2.4 &  2.9 \\
        QCD normalization  &  0.6 &  0.9 &  2.2 \\
     W+jets normalization  &  0.4 &  1.2 &  2.0 \\
$\tauh$ misidentification background  &  2.0 &  1.4 &  2.0 \\
     b-tagging efficiency  &  1.9 &  2.0 &  1.9 \\
     $\tauh$ Energy Scale  &  0.7 &  0.5 &  1.6 \\
electron trigger efficiency  &  2.8 &  1.2 \\
       muon ID efficiency  &  0.8 &  0.8 \\
   electron ID efficiency  &  2.1 &  0.7 \\
         DY normalization  &  0.4 &  0.4 &  0.6 \\
 Single Top normalization  &  0.7 &  0.7 &  0.6 \\
         jet energy scale  &  0.3 &  0.0 &  0.6 \\
    jet energy resolution  &  0.3 &  0.0 &  0.4 \\
  muon trigger efficiency  &  0.4 &  0.3 \\
   Dibosons normalization  &  0.0 &  0.0 &  0.0 \\
               Luminosity  &  0.0 &  0.0 &  0.0 \\
          b fragmentation  &  3.0 &  2.6 &  2.7 \\
 ME Renormalization scale  &  0.8 &  1.2 &  1.0 \\
ME combined scale variation  &  0.5 &  1.0 &  0.9 \\
b decay tables, Semileptonic BR  &  0.6 &  0.4 &  0.3 \\
   ME Factorization scale  &  0.3 &  0.3 &  0.3 \\
Underlying event (Pythia tune)  &  0.6 &  0.7 &  0.0 \\
   ME-PS matching (hdamp)  &  0.5 &  0.3 &  0.0 \\
  Initial State Radiation  &  1.5 &  1.4 &  0.0 \\
    Final State Radiation  &  1.6 &  0.4 &  0.0 \\
                      PDF  &  1.7 &  1.4 &  1.6 \\
            MC statistics  &  2.5 &  1.7 &  2.4 \\


update yield variations:

python yield_variations.py distrs/distrs_redo_v25v26_mc.root -d Mt_lep_met_f -c mu_sel_lj    -p tt_taultauh,tt_lj,tt_other,tt_mutau,tt_taulj -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py distrs/distrs_redo_v25v26_mc.root -d Mt_lep_met_f -c mu_sel_ljout -p tt_taultauh,tt_lj,tt_other,tt_mutau,tt_taulj -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py distrs/distrs_redo_v25v26_mc.root -d Mt_lep_met_f -c el_sel_lj    -p tt_taultauh,tt_lj,tt_other,tt_eltau,tt_taulj -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py distrs/distrs_redo_v25v26_mc.root -d Mt_lep_met_f -c el_sel_ljout -p tt_taultauh,tt_lj,tt_other,tt_eltau,tt_taulj -s FSR,ISR,HDAMP,TuneCUETP8M2T4

                                 mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj
                               tt_taultauh                 tt_lj              tt_other              tt_mutau              tt_taulj
                 FSR           1.076/0.904           1.488/0.510           3.168/1.548           1.055/0.895           1.466/0.512
                 ISR           1.003/1.026           0.999/0.950           2.310/1.623           0.998/0.988           1.006/0.968
               HDAMP           1.025/1.080           0.966/1.010           1.530/1.524           0.967/0.995           0.958/0.961
      TuneCUETP8M2T4           0.996/1.055           1.001/0.981           1.523/1.488           0.991/0.974           1.037/0.943

                              mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout
                               tt_taultauh                 tt_lj              tt_other              tt_mutau              tt_taulj
                 FSR           1.063/0.924           1.477/0.547           3.143/1.571           1.073/0.904           1.400/0.564
                 ISR           1.003/0.985           1.023/0.972           2.357/1.658           1.017/0.980           0.982/0.863
               HDAMP           0.993/1.013           0.990/1.000           1.522/1.789           0.981/0.985           0.976/0.985
      TuneCUETP8M2T4           1.002/0.958           1.040/0.984           1.647/1.501           1.004/0.996           0.987/0.972

                                 el_sel_lj             el_sel_lj             el_sel_lj             el_sel_lj             el_sel_lj
                               tt_taultauh                 tt_lj              tt_other              tt_eltau              tt_taulj
                 FSR           1.073/0.912           1.511/0.528           2.926/1.550           1.063/0.927           1.508/0.562
                 ISR           1.000/1.020           1.021/0.971           2.288/1.531           1.011/0.995           0.956/0.998
               HDAMP           0.935/1.071           1.002/0.998           1.149/1.551           1.003/1.019           1.007/0.980
      TuneCUETP8M2T4           0.943/0.973           1.039/0.977           1.420/1.354           1.029/1.002           1.024/1.135

                              el_sel_ljout          el_sel_ljout          el_sel_ljout          el_sel_ljout          el_sel_ljout
                               tt_taultauh                 tt_lj              tt_other              tt_eltau              tt_taulj
                 FSR           1.110/0.854           1.523/0.556           3.347/1.682           1.096/0.917           1.514/0.538
                 ISR           0.989/0.949           1.023/0.984           2.643/1.743           1.024/0.998           1.122/0.951
               HDAMP           1.025/0.995           1.017/1.035           1.628/1.693           1.002/1.023           1.020/1.180
      TuneCUETP8M2T4           0.956/0.948           1.025/1.009           1.867/1.745           1.015/1.003           0.967/1.001

what's with tt_other?

python yield_variations.py distrs/distrs_redo_v25v26_mc.root --to-average  -d Mt_lep_met_f -c mu_sel_lj    -p tt_taultauh,tt_lj,tt_other,tt_mutau,tt_taulj -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py distrs/distrs_redo_v25v26_mc.root --to-average  -d Mt_lep_met_f -c mu_sel_ljout -p tt_taultauh,tt_lj,tt_other,tt_mutau,tt_taulj -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py distrs/distrs_redo_v25v26_mc.root --to-average  -d Mt_lep_met_f -c el_sel_lj    -p tt_taultauh,tt_lj,tt_other,tt_eltau,tt_taulj -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py distrs/distrs_redo_v25v26_mc.root --to-average  -d Mt_lep_met_f -c el_sel_ljout -p tt_taultauh,tt_lj,tt_other,tt_eltau,tt_taulj -s FSR,ISR,HDAMP,TuneCUETP8M2T4

                                 mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj
                               tt_taultauh                 tt_lj              tt_other              tt_mutau              tt_taulj
                 FSR           1.087/0.913           1.489/0.511           1.344/0.656           1.082/0.918           1.483/0.517
                 ISR           0.988/1.012           1.025/0.975           1.175/0.825           1.005/0.995           1.019/0.981
               HDAMP           0.974/1.026           0.978/1.022           1.002/0.998           0.986/1.014           0.998/1.002
      TuneCUETP8M2T4           0.971/1.029           1.010/0.990           1.012/0.988           1.009/0.991           1.047/0.953

                              mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout
                               tt_taultauh                 tt_lj              tt_other              tt_mutau              tt_taulj
                 FSR           1.070/0.930           1.459/0.541           1.334/0.666           1.085/0.915           1.426/0.574
                 ISR           1.009/0.991           1.026/0.974           1.174/0.826           1.018/0.982           1.064/0.936
               HDAMP           0.990/1.010           0.995/1.005           0.920/1.080           0.998/1.002           0.995/1.005
      TuneCUETP8M2T4           1.022/0.978           1.028/0.972           1.046/0.954           1.004/0.996           1.007/0.993

                                 el_sel_lj             el_sel_lj             el_sel_lj             el_sel_lj             el_sel_lj
                               tt_taultauh                 tt_lj              tt_other              tt_eltau              tt_taulj
                 FSR           1.081/0.919           1.482/0.518           1.307/0.693           1.069/0.931           1.457/0.543
                 ISR           0.990/1.010           1.025/0.975           1.198/0.802           1.008/0.992           0.979/1.021
               HDAMP           0.932/1.068           1.002/0.998           0.851/1.149           0.992/1.008           1.013/0.987
      TuneCUETP8M2T4           0.984/1.016           1.031/0.969           1.024/0.976           1.014/0.986           0.949/1.051

                              el_sel_ljout          el_sel_ljout          el_sel_ljout          el_sel_ljout          el_sel_ljout
                               tt_taultauh                 tt_lj              tt_other              tt_eltau              tt_taulj
                 FSR           1.130/0.870           1.465/0.535           1.331/0.669           1.089/0.911           1.476/0.524
                 ISR           1.021/0.979           1.020/0.980           1.205/0.795           1.013/0.987           1.083/0.917
               HDAMP           1.015/0.985           0.991/1.009           0.980/1.020           0.990/1.010           0.927/1.073
      TuneCUETP8M2T4           1.004/0.996           1.008/0.992           1.034/0.966           1.006/0.994           0.983/1.017


python yield_variations.py distrs/distrs_redo_v25v26_mc.root --to-average --precision '%.2f' -d Mt_lep_met_f -c mu_sel_lj    -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py distrs/distrs_redo_v25v26_mc.root --to-average --precision '%.2f' -d Mt_lep_met_f -c el_sel_lj    -p tt_eltau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py distrs/distrs_redo_v25v26_mc.root --to-average --precision '%.2f' -d Mt_lep_met_f -c mu_sel_ljout -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py distrs/distrs_redo_v25v26_mc.root --to-average --precision '%.2f' -d Mt_lep_met_f -c el_sel_ljout -p tt_eltau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4


[olek@fermi04 jobsums]$ python yield_variations.py distrs/distrs_redo_v25v26_mc.root --to-average --precision '%.2f' -d Mt_lep_met_f -c mu_sel_lj    -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4
INFO:root:import ROOT
                                 mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj
                                  tt_mutau                 tt_lj              tt_taulj           tt_taultauh              tt_other
                 FSR             1.08/0.92             1.49/0.51             1.48/0.52             1.09/0.91             1.34/0.66
                 ISR             1.01/0.99             1.03/0.97             1.02/0.98             0.99/1.01             1.17/0.83
               HDAMP             0.99/1.01             0.98/1.02             1.00/1.00             0.97/1.03             1.00/1.00
      TuneCUETP8M2T4             1.01/0.99             1.01/0.99             1.05/0.95             0.97/1.03             1.01/0.99
[olek@fermi04 jobsums]$ python yield_variations.py distrs/distrs_redo_v25v26_mc.root --to-average --precision '%.2f' -d Mt_lep_met_f -c el_sel_lj    -p tt_eltau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4
INFO:root:import ROOT
                                 el_sel_lj             el_sel_lj             el_sel_lj             el_sel_lj             el_sel_lj
                                  tt_eltau                 tt_lj              tt_taulj           tt_taultauh              tt_other
                 FSR             1.07/0.93             1.48/0.52             1.46/0.54             1.08/0.92             1.31/0.69
                 ISR             1.01/0.99             1.03/0.97             0.98/1.02             0.99/1.01             1.20/0.80
               HDAMP             0.99/1.01             1.00/1.00             1.01/0.99             0.93/1.07             0.85/1.15
      TuneCUETP8M2T4             1.01/0.99             1.03/0.97             0.95/1.05             0.98/1.02             1.02/0.98


[olek@fermi04 jobsums]$ python yield_variations.py distrs/distrs_redo_v25v26_mc.root --to-average --precision '%.2f' -d Mt_lep_met_f -c mu_sel_ljout -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4
INFO:root:import ROOT
                              mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout
                                  tt_mutau                 tt_lj              tt_taulj           tt_taultauh              tt_other
                 FSR             1.09/0.91             1.46/0.54             1.43/0.57             1.07/0.93             1.33/0.67
                 ISR             1.02/0.98             1.03/0.97             1.06/0.94             1.01/0.99             1.17/0.83
               HDAMP             1.00/1.00             0.99/1.01             1.00/1.00             0.99/1.01             0.92/1.08
      TuneCUETP8M2T4             1.00/1.00             1.03/0.97             1.01/0.99             1.02/0.98             1.05/0.95
[olek@fermi04 jobsums]$ python yield_variations.py distrs/distrs_redo_v25v26_mc.root --to-average --precision '%.2f' -d Mt_lep_met_f -c el_sel_ljout -p tt_eltau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4
INFO:root:import ROOT
                              el_sel_ljout          el_sel_ljout          el_sel_ljout          el_sel_ljout          el_sel_ljout
                                  tt_eltau                 tt_lj              tt_taulj           tt_taultauh              tt_other
                 FSR             1.09/0.91             1.47/0.53             1.48/0.52             1.13/0.87             1.33/0.67
                 ISR             1.01/0.99             1.02/0.98             1.08/0.92             1.02/0.98             1.21/0.79
               HDAMP             0.99/1.01             0.99/1.01             0.93/1.07             1.01/0.99             0.98/1.02
      TuneCUETP8M2T4             1.01/0.99             1.01/0.99             0.98/1.02             1.00/1.00             1.03/0.97




ok let's take muon variation for now
or choose the largest of the two?
or use the particular for each channel


FSR            lnN 1.03/0.97   1.4/0.6     1.35/0.75   1.02/0.98   1.26/0.74    - - - - - - - - -           1.04/0.96   1.35/0.75   1.4/0.6     1.07/0.93   1.3/0.7      - - - - - - - - -
ISR            lnN 1.013/0.987 1.029/0.971 0.986/1.014 0.990/1.010 0.994/1.006  - - - - - - - - -           1.016/0.984 1.024/0.976 1.083/0.917 1.027/0.973 1.014/0.986  - - - - - - - - -
HDAMP          lnN 0.999/1.001 1.008/0.992 1.017/0.983 0.942/1.058 0.886/1.114  - - - - - - - - -           0.996/1.004 0.998/1.002 0.937/1.063 1.018/0.982 0.994/1.006  - - - - - - - - -
TuneCUETP8M2T4 lnN 1.014/0.986 1.032/0.968 0.950/1.050 0.988/1.012 0.996/1.004  - - - - - - - - -           1.007/0.993 1.008/0.992 0.981/1.019 1.003/0.997 1.021/0.979  - - - - - - - - -


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit                --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5         --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV  -m 125 -o latest_both_impacts_lnN_lnN_updownsUP.json --name BothImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_lnN_lnN_updownsUP.json -o postfit_both_impacts_lnN_lnN_updownsUP

   r :    +1.012   -0.087/+0.306 (68%)

  qcd_norm  :   +0.100  -0.956/+0.989  -0.011/+0.027
  wjets_norm :   +0.893  -1.013/+0.888  +0.024/-0.027
  TOPPT     :   +0.701  -1.451/+0.678  -0.022/+0.023
  PU        :   -0.363  -0.968/+0.976  +0.034/-0.032
  bSF       :   +0.995  -1.048/+0.962  +0.030/-0.023


-- like frozen updowns?
nope, fakes are way off, FSR is +0.5sigma, TES is crazy

NLL of it:

breaks off at r=1.5 and goes linearly down

combine -M MultiDimFit ttxsec/latest_datacard_both.root --algo grid --points 60 --rMin 0.7 --rMax 1.3 --name BothShapes --freezeParameters lumi_13TeV
combine -M MultiDimFit ttxsec/latest_datacard_both.root --algo grid --points 60 --rMin 0.7 --rMax 1.3 --name BothShapesNOupdowns --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_updowns
combine -M MultiDimFit ttxsec/latest_datacard_both.root --algo grid --points 60 --rMin 0.7 --rMax 1.3 --name BothShapesNOlepIDs  --freezeParameters lumi_13TeV,LEPelID,LEPmuID
combine -M MultiDimFit ttxsec/latest_datacard_both.root --algo grid --points 60 --rMin 0.7 --rMax 1.3 --name BothShapesNOlep     --freezeParameters lumi_13TeV,LEPelID,LEPmuID,LEPelTRG,LEPmuTRG
combine -M MultiDimFit ttxsec/latest_datacard_both.root --algo grid --points 60 --rMin 0.7 --rMax 1.3 --name BothShapesNOlepNOupdowns  --freezeParameters lumi_13TeV,LEPelID,LEPmuID,LEPelTRG,LEPmuTRG --freezeNuisanceGroup tt_updowns
combine -M MultiDimFit ttxsec/latest_datacard_both.root --algo grid --points 60 --rMin 0.7 --rMax 1.3 --name BothShapesNOlepNOupdownsNOpdfs  --freezeParameters lumi_13TeV,LEPelID,LEPmuID,LEPelTRG,LEPmuTRG --freezeNuisanceGroup tt_updowns,tt_th_pdf
combine -M MultiDimFit ttxsec/latest_datacard_both.root --algo grid --points 60 --rMin 0.7 --rMax 1.3 --name BothShapesNOlepNOttTH  --freezeParameters lumi_13TeV,LEPelID,LEPmuID,LEPelTRG,LEPmuTRG --freezeNuisanceGroup tt_updowns,tt_th_pdf,tt_th_frag

combine -M MultiDimFit ttxsec/latest_datacard_both.root --algo grid --points 60 --rMin 0.7 --rMax 1.3 --name BothShapesNOfakes --freezeParameters lumi_13TeV,tau_fakes
combine -M MultiDimFit ttxsec/latest_datacard_both.root --algo grid --points 60 --rMin 0.7 --rMax 1.3 --name BothShapesNOpu    --freezeParameters lumi_13TeV,PU


frozen PU fixes NLL shape
impacts w.o. PU

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV,PU  -m 125 --robustFit 1 --doInitialFit                --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV,PU  -m 125 --robustFit 1 --doFits --parallel 5         --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV,PU  -m 125 -o latest_both_impacts_lnN_lnN_frozenPU.json --name BothImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_lnN_lnN_frozenPU.json -o postfit_both_impacts_lnN_lnN_frozenPU


looking for the pair of PU

combine -M MultiDimFit ttxsec/latest_datacard_both.root --algo grid --points 60 --rMin 0.7 --rMax 1.3 --name BothShapesNOqcd     --freezeParameters lumi_13TeV,qcd_norm
combine -M MultiDimFit ttxsec/latest_datacard_both.root --algo grid --points 60 --rMin 0.7 --rMax 1.3 --name BothShapesNOwjets   --freezeParameters lumi_13TeV,wjets_norm
combine -M MultiDimFit ttxsec/latest_datacard_both.root --algo grid --points 60 --rMin 0.7 --rMax 1.3 --name BothShapesNOtes     --freezeParameters lumi_13TeV,TES

combine -M MultiDimFit ttxsec/latest_datacard_both.root --algo grid --points 60 --rMin 0.7 --rMax 1.3 --name BothShapesNOpuNOqcd --freezeParameters lumi_13TeV,PU,qcd_norm


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV,PU,qcd_norm  -m 125 --robustFit 1 --doInitialFit                --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV,PU,qcd_norm  -m 125 --robustFit 1 --doFits --parallel 5         --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV,PU,qcd_norm  -m 125 -o latest_both_impacts_lnN_lnN_frozenPUnQCD.json --name BothImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_lnN_lnN_frozenPUnQCD.json -o postfit_both_impacts_lnN_lnN_frozenPUnQCD

  Peterson  :   +0.916  -0.974/+0.928  -0.019/+0.019
  tau_fakes :   +0.725  -0.844/+0.812  -0.042/+0.043
  wjets_norm :   +0.952  -0.998/+0.867  +0.019/-0.021
  TES       :   +0.042  -0.391/+0.381  +0.006/-0.002
  tauID_eff :   +0.253  -0.947/+0.944  +0.049/-0.047
  bSF       :   +1.047  -0.939/+0.920  +0.019/-0.018

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV,PU,qcd_norm --freezeNuisanceGroup tt_updowns -m 125 --robustFit 1 --doInitialFit                --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV,PU,qcd_norm --freezeNuisanceGroup tt_updowns -m 125 --robustFit 1 --doFits --parallel 5         --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV,PU,qcd_norm --freezeNuisanceGroup tt_updowns -m 125 -o latest_both_impacts_lnN_lnN_frozenPUnQCDnUPDOWNS.json --name BothImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_lnN_lnN_frozenPUnQCDnUPDOWNS.json -o postfit_both_impacts_lnN_lnN_frozenPUnQCDnUPDOWNS

   r :    +0.961   -0.069/+0.067 (68%)
  JER       :   +0.067  -0.287/+0.300  +0.000/+0.001


NLL for datacard with no PU in QCD:

combineCards.py mu=ttxsec/datacard_v25v26redo_mu_lnU_noQCDpu.txt el=ttxsec/datacard_v25v26redo_el_lnU_noQCDpu.txt > ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.txt
./scripts/text2workspace.py ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.txt

combine -M MultiDimFit ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root --algo grid --points 60 --rMin 0.7 --rMax 1.3 --name BothShapesNOqcdPU  --freezeParameters lumi_13TeV

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV -m 125 --robustFit 1 --doInitialFit                --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV -m 125 --robustFit 1 --doFits --parallel 5         --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV -m 125 -o latest_both_impacts_lnN_lnN_noQCDpu.json --name BothImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_lnN_lnN_noQCDpu.json -o postfit_both_impacts_lnN_lnN_noQCDpu

   r :    +1.001   -0.087/+0.089 (68%)
  Peterson   :   +0.915  -0.983/+0.929  -0.018/+0.017
  TES        :   +0.042  -0.396/+0.383  +0.007/-0.002
  wjets_norm :   +0.947  -1.016/+0.888  +0.024/-0.037
  tau_fakes  :   +0.722  -0.855/+0.827  +0.078/+0.041

----- asymmetric

  SemilepBR :   -0.548  -0.916/+1.453  -0.003/-0.002


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV,FSR --freezeNuisanceGroup tt_th_pdf -m 125 --robustFit 1 --doInitialFit                --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV,FSR --freezeNuisanceGroup tt_th_pdf -m 125 --robustFit 1 --doFits --parallel 5         --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV,FSR --freezeNuisanceGroup tt_th_pdf -m 125 -o latest_both_impacts_lnN_lnN_noQCDpu_freezePDFnFSR.json --name BothImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_lnN_lnN_noQCDpu_freezePDFnFSR.json -o postfit_both_impacts_lnN_lnN_noQCDpu_freezePDFnFSR

   r :    +0.948   -0.071/+0.073 (68%)

???

  wjets_norm :   +1.343  -0.926/+0.778  +0.013/-0.015
  PU        :   +0.025  -0.938/+0.955  +0.026/-0.026
  tau_fakes :   -0.248  -0.232/+0.225  -0.021/+0.024
  TES       :   +0.042  -0.390/+0.373  +0.007/-0.003
  SemilepBR :   -0.557  -0.912/+1.434  -0.003/-0.002
  bSF       :   +1.203  -1.027/+0.952  +0.016/-0.012

fakes are constrained, otherwise ok

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV,FSR  -m 125 --robustFit 1 --doInitialFit                          --name BothImpactsJustFSR
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV,FSR  -m 125 --robustFit 1 --doFits --parallel 5                   --name BothImpactsJustFSR
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV,FSR  -m 125 -o latest_both_impacts_lnN_lnN_noQCDpu_freezeFSR.json --name BothImpactsJustFSR
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_lnN_lnN_noQCDpu_freezeFSR.json -o postfit_both_impacts_lnN_lnN_noQCDpu_freezeFSR

   r :    +0.957   -0.074/+0.076 (68%)
  JER       :   +0.073  -0.296/+0.312  +0.000/+0.002
  JES       :   -0.009  -0.282/+0.280  +0.001/+0.001

   r :    +0.957   -0.074/+0.076 (68%)




remove all propagation to QCD?

combineCards.py mu=ttxsec/datacard_v25v26redo_mu_lnU_noQCDsysts.txt el=ttxsec/datacard_v25v26redo_el_lnU_noQCDsysts.txt > ttxsec/datacard_v25v26redo_both_lnU_noQCDsysts.txt
./scripts/text2workspace.py ttxsec/datacard_v25v26redo_both_lnU_noQCDsysts.txt

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDsysts.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit                   --name BothImpactsNoQCDsysts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDsysts.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5            --name BothImpactsNoQCDsysts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDsysts.root   --freezeParameters lumi_13TeV  -m 125 -o latest_both_impacts_lnN_lnN_noQCDsysts.json --name BothImpactsNoQCDsysts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_lnN_lnN_noQCDsysts.json -o postfit_both_impacts_lnN_lnN_noQCDsysts

   r :    +0.997   -0.082/+0.088 (68%)

  FSR       :   +0.540  -0.524/+0.521  -0.038/+0.037
  Peterson  :   +0.892  -1.057/+0.926  -0.017/+0.017


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDsysts.root   --freezeParameters lumi_13TeV,FSR  -m 125 --robustFit 1 --doInitialFit                   --name BothImpactsNoQCDsystsFSR
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDsysts.root   --freezeParameters lumi_13TeV,FSR  -m 125 --robustFit 1 --doFits --parallel 5            --name BothImpactsNoQCDsystsFSR
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDsysts.root   --freezeParameters lumi_13TeV,FSR  -m 125 -o latest_both_impacts_lnN_lnN_noQCDsystsFSR.json --name BothImpactsNoQCDsystsFSR
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_lnN_lnN_noQCDsystsFSR.json -o postfit_both_impacts_lnN_lnN_noQCDsystsFSR



no QCD PU and updated updowns for electron channel:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV -m 125 --robustFit 1 --doInitialFit                --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV -m 125 --robustFit 1 --doFits --parallel 5         --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV -m 125 -o latest_both_impacts_lnN_lnN_noQCDpu_UPelUpdowns.json --name BothImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_lnN_lnN_noQCDpu_UPelUpdowns.json -o postfit_both_impacts_lnN_lnN_noQCDpu_UPelUpdowns

   r :    +1.018   -0.091/+0.091 (68%)

  Frag      :   -0.440  -0.951/+0.802  -0.018/+0.017
  FSR       :   +0.685  -0.490/+0.512  -0.038/+0.038
  JES       :   -0.006  -0.290/+0.289  +0.000/+0.004
  ISR       :   -0.649  -0.956/+0.945  -0.017/+0.016
  TES       :   +0.028  -0.414/+0.391  +0.008/-0.002
  qcd_norm  :   +0.310  -0.932/+0.868  -0.009/+0.014

  PU        :   -0.192  -0.930/+0.982  +0.029/-0.031
  bSF       :   +1.126  -1.031/+0.952  +0.022/-0.019
  stop_norm :   +0.148  -0.999/+0.999  +0.004/-0.005
  TOPPT     :   +0.655  -1.520/+0.661  -0.020/+0.022
  wjets_norm :   +0.955  -1.004/+0.876  +0.025/-0.039
  qcd_norm  :   +0.310  -0.932/+0.868  -0.009/+0.014

again, remove all propagation to QCD:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV -m 125 --robustFit 1 --doInitialFit                --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV -m 125 --robustFit 1 --doFits --parallel 5         --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/datacard_v25v26redo_both_lnU_noQCDpu.root   --freezeParameters lumi_13TeV -m 125 -o latest_both_impacts_lnN_lnN_noQCDallSYST_UPelUpdowns.json --name BothImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_lnN_lnN_noQCDallSYST_UPelUpdowns.json -o postfit_both_impacts_lnN_lnN_noQCDallSYST_UPelUpdowns

   r :    +1.014   -0.087/+0.089 (68%)
  FSR       :   +0.642  -0.484/+0.507  -0.037/+0.038
  tau_fakes :   +0.708  -0.796/+0.789  -0.042/+0.042
  tauID_eff :   +0.186  -0.956/+0.953  +0.047/-0.045
  bSF       :   +1.270  -0.867/+0.860  +0.017/-0.017


-- best behavior is with frozen systematics

mu el

   r :    +0.914   -0.067/+0.075 (68%)
   r :    +1.027   -0.097/+0.107 (68%)

  FSR       :   +0.098  -0.027/+0.026  +0.006/-0.004


















# again fakes correlate with fsr

FSR            lnN 1.03/0.97   1.4/0.6     1.35/0.75   1.02/0.98   1.26/0.74    - - - - - - - - -           1.04/0.96   1.35/0.75   1.4/0.6     1.07/0.93   1.3/0.7      - - - - - - - - -
ISR            lnN 1.013/0.987 1.029/0.971 0.986/1.014 0.990/1.010 0.994/1.006  - - - - - - - - -           1.016/0.984 1.024/0.976 1.083/0.917 1.027/0.973 1.014/0.986  - - - - - - - - -     
HDAMP          lnN 0.999/1.001 1.008/0.992 1.017/0.983 0.942/1.058 0.886/1.114  - - - - - - - - -           0.996/1.004 0.998/1.002 0.937/1.063 1.018/0.982 0.994/1.006  - - - - - - - - -
TuneCUETP8M2T4 lnN 1.014/0.986 1.032/0.968 0.950/1.050 0.988/1.012 0.996/1.004  - - - - - - - - -           1.007/0.993 1.008/0.992 0.981/1.019 1.003/0.997 1.021/0.979  - - - - - - - - -     

FSR            lnN 1.03/0.97   1.4/0.6     1.35/0.75   1.02/0.98   1.26/0.74    - - - - - - - - -           1.04/0.96   1.35/0.75   1.4/0.6     1.07/0.93   1.3/0.7      - - - - - - - - -
ISR            lnN 1.013/0.987 1.029/0.971 0.986/1.014 0.990/1.010 0.994/1.006  - - - - - - - - -           1.016/0.984 1.024/0.976 1.083/0.917 1.027/0.973 1.014/0.986  - - - - - - - - -
HDAMP          lnN 0.999/1.001 1.008/0.992 1.017/0.983 0.942/1.058 0.886/1.114  - - - - - - - - -           0.996/1.004 0.998/1.002 0.937/1.063 1.018/0.982 0.994/1.006  - - - - - - - - -
TuneCUETP8M2T4 lnN 1.014/0.986 1.032/0.968 0.950/1.050 0.988/1.012 0.996/1.004  - - - - - - - - -           1.007/0.993 1.008/0.992 0.981/1.019 1.003/0.997 1.021/0.979  - - - - - - - - -


tau_fakes               lnN    -      1.2   1.2   -     1.2        1.2      1.2   -     -        -     -        -     -        -                  -      1.2   1.2   -     1.2        1.2      1.2   -     -        -     -        -     -



weirdness now:

el -> 0.9
mu -> 1.03

what? the plots of Mt are the same as usual, el must -> 1.03 and mu -> 0.93, what is this?
delirious results

combine -M MultiDimFit ttxsec/latest_datacard_el.root   --algo grid --points 10 --rMin 0.7 --rMax 1.3 --name ElShapes   --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_updowns
combine -M MultiDimFit ttxsec/latest_datacard_mu.root   --algo grid --points 10 --rMin 0.7 --rMax 1.3 --name MuShapes   --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_updowns

el 1.06897
mu 1.02145

???

old rateParams and rate updowns

1.0689
1.02071

combine -M MultiDimFit ttxsec/latest_datacard_el.root   --algo grid --points 10 --rMin 0.7 --rMax 1.3 --name ElShapes   --freezeParameters lumi_13TeV
combine -M MultiDimFit ttxsec/latest_datacard_mu.root   --algo grid --points 10 --rMin 0.7 --rMax 1.3 --name MuShapes   --freezeParameters lumi_13TeV

1.08401 -> [0.7,1.3]
0.950753 -> [0.7,1.3]


try rate updowns and lnN fakerates?

save shape rows:

FSR             shape          1.0    1.0   1.0   1.0   1.0  - - - - - - - - -         1.0 1.0 1.0 1.0 1.0  - - - - - - - - -
ISR             shape          1.0    1.0   1.0   1.0   1.0  - - - - - - - - -         1.0 1.0 1.0 1.0 1.0  - - - - - - - - -
HDAMP           shape          1.0    1.0   1.0   1.0   1.0  - - - - - - - - -         1.0 1.0 1.0 1.0 1.0  - - - - - - - - -
TuneCUETP8M2T4  shape          1.0    1.0   1.0   1.0   1.0  - - - - - - - - -         1.0 1.0 1.0 1.0 1.0  - - - - - - - - -


try rate updowns and lnU fakerates

1.08098
0.9525

and el is too wide?

combine -M MultiDimFit ttxsec/latest_datacard_el.root   --algo grid --points 60 --rMin 0.7 --rMax 1.3 --name ElShapes   --freezeParameters lumi_13TeV
combine -M MultiDimFit ttxsec/latest_datacard_mu.root   --algo grid --points 60 --rMin 0.7 --rMax 1.3 --name MuShapes   --freezeParameters lumi_13TeV

el

  [WARNING] Found [wjets_norm] at boundary. 
  [WARNING] Found [qcd_norm] at boundary. 

mu

  [WARNING] Found [tau_fakes] at boundary. 
  [WARNING] Found [wjets_norm] at boundary. 
  [WARNING] Found [qcd_norm] at boundary. 

and mu has deviation in NLL

impacts

mu

  FSR       :   +0.985  -0.377/+0.179  +0.012/+0.018
  bSF       :   +0.640  -1.016/+0.962  +0.032/-0.021

tau_fakes = 1. +0 -0.47


try rate updowns and lnN fakerates

1.05535
0.95561

crack in mu at 1.1
complete nonesense in el

freeze updowns -- still nonesense???

no frag, semilep etc to qcd

combine -M MultiDimFit ttxsec/latest_datacard_el.root   --algo grid --points 20 --rMin 0.7 --rMax 1.3 --name ElShapes   --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_updowns
combine -M MultiDimFit ttxsec/latest_datacard_mu.root   --algo grid --points 20 --rMin 0.7 --rMax 1.3 --name MuShapes   --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_updowns

1.03627  -- shape ok
0.930665 -- shape ok

combine -M MultiDimFit ttxsec/latest_datacard_el.root   --algo grid --points 20 --rMin 0.7 --rMax 1.3 --name ElShapes   --freezeParameters lumi_13TeV
combine -M MultiDimFit ttxsec/latest_datacard_mu.root   --algo grid --points 20 --rMin 0.7 --rMax 1.3 --name MuShapes   --freezeParameters lumi_13TeV

1.03863  -- shape ok
0.958358 -- shape ok

impacts:

el fine
mu ok, but fakes and FSR are up to 1sigma




try lnU for fakes

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_mu.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit         --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_mu.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5  --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_mu.root   --freezeParameters lumi_13TeV  -m 125 -o latest_mu_impacts_lnU.json        --name MuImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_lnU.json -o postfit_mu_impacts_lnU

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_el.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit         --name ElImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_el.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5  --name ElImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_el.root   --freezeParameters lumi_13TeV  -m 125 -o latest_el_impacts_lnU.json        --name ElImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts_lnU.json -o postfit_el_impacts_lnU


lnU is weirder

mu - wjets impact more than tau_fakes
     tau_fakes are pulled to 1, same as FSR

el - FSR is 2nd impact, tau_fakes are 0.06 +-0



then return to lnN and try shape for updowns

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_mu.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit         --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_mu.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5  --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_mu.root   --freezeParameters lumi_13TeV  -m 125 -o latest_mu_impacts_lnN_shape_updowns.json        --name MuImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_lnN_shape_updowns.json -o postfit_mu_impacts_lnN_shape_updowns

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_el.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit         --name ElImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_el.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5  --name ElImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_el.root   --freezeParameters lumi_13TeV  -m 125 -o latest_el_impacts_lnN_shape_updowns.json        --name ElImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts_lnN_shape_updowns.json -o postfit_el_impacts_lnN_shape_updowns

el 0.918 +- 0.095
   tau fakes and FSR are one-sided
   otherwise all ok

mu 0.94  +- 0.078
   bunch of systematics are weirdly constrained
   ISR, HDAMP, FSR but also TES
   FSR and tau_fakes are overall ok


NO modeling systematics to QCD!

rateParams for tau fakes

lnN for updowns

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_mu.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit         --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_mu.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5  --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_mu.root   --freezeParameters lumi_13TeV  -m 125 -o latest_mu_impacts_rateParam_lnN_updowns.json        --name MuImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_rateParam_lnN_updowns.json -o postfit_mu_impacts_rateParam_lnN_updowns

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_el.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit         --name ElImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_el.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5  --name ElImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_el.root   --freezeParameters lumi_13TeV  -m 125 -o latest_el_impacts_rateParam_lnN_updowns.json        --name ElImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts_rateParam_lnN_updowns.json -o postfit_el_impacts_rateParam_lnN_updowns

el 1.04 +- 0.102
   FSR is second largest and it is one-sided (??)
   couple MC bins are pulled by 1 sigma

mu 0.95 +- 0.0758
   FSR is down the list, pulled to 1 and constrained
   ISR and HDAMP are not constrained


shape updowns

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_mu.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit         --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_mu.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5  --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_mu.root   --freezeParameters lumi_13TeV  -m 125 -o latest_mu_impacts_rateParam_shape_updowns.json        --name MuImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_rateParam_shape_updowns.json -o postfit_mu_impacts_rateParam_shape_updowns

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_el.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit         --name ElImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_el.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5  --name ElImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_el.root   --freezeParameters lumi_13TeV  -m 125 -o latest_el_impacts_rateParam_shape_updowns.json        --name ElImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts_rateParam_shape_updowns.json -o postfit_el_impacts_rateParam_shape_updowns

el 0.902 +- 0.093
   TOPPT second, Tune, FSR are pulled and constrained

mu 0.96  +- 0.078
   bSF pulled +1sigma
   Tune, FSR, ISR, HDAMP are constrained



the most reasonable is the very first one
try it again

lnN fakes and shape updowns

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_mu.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit         --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_mu.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5  --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_mu.root   --freezeParameters lumi_13TeV  -m 125 -o latest_mu_impacts_lnN_shape_updowns2.json        --name MuImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_lnN_shape_updowns2.json -o postfit_mu_impacts_lnN_shape_updowns2

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_el.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit         --name ElImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_el.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5  --name ElImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_el.root   --freezeParameters lumi_13TeV  -m 125 -o latest_el_impacts_lnN_shape_updowns2.json        --name ElImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts_lnN_shape_updowns2.json -o postfit_el_impacts_lnN_shape_updowns2


then lnN fakes and lnN updowns

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_mu.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit         --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_mu.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5  --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_mu.root   --freezeParameters lumi_13TeV  -m 125 -o latest_mu_impacts_lnN_lnN_updowns.json        --name MuImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_lnN_lnN_updowns.json -o postfit_mu_impacts_lnN_lnN_updowns

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_el.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit         --name ElImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_el.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5  --name ElImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_el.root   --freezeParameters lumi_13TeV  -m 125 -o latest_el_impacts_lnN_lnN_updowns.json        --name ElImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts_lnN_lnN_updowns.json -o postfit_el_impacts_lnN_lnN_updowns

-- and check the systematics table

python ttxsec/fit-stuff/new_impact_table.py --merge-pdf latest_el_impacts_lnN_lnN_updowns.json latest_mu_impacts_lnN_lnN_updowns.json latest_both_impacts_lnN_lnN_updowns.json

                   el &   mu
MC statistics  &  2.5 &  1.7 \\

but nonesense in both

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit                --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5         --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV  -m 125 -o latest_both_impacts_lnN_lnN_updowns.json --name BothImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_lnN_lnN_updowns.json -o postfit_both_impacts_lnN_lnN_updowns

in fit of both there are bunch of:

 ---------------------------

 WARNING: MultiDimFit failed

 ---------------------------

result is

File higgsCombine_paramFit_BothImpacts_Mf.MultiDimFit.mH125.root did not contain a sufficient number of entries, skipping
File higgsCombine_paramFit_BothImpacts_Mfr.MultiDimFit.mH125.root did not contain a sufficient number of entries, skipping
File higgsCombine_paramFit_BothImpacts_PDFCT14n15.MultiDimFit.mH125.root did not contain a sufficient number of entries, skipping
File higgsCombine_paramFit_BothImpacts_PDFCT14n22.MultiDimFit.mH125.root did not contain a sufficient number of entries, skipping
File higgsCombine_paramFit_BothImpacts_PDFCT14n27.MultiDimFit.mH125.root did not contain a sufficient number of entries, skipping
File higgsCombine_paramFit_BothImpacts_PDFCT14n4.MultiDimFit.mH125.root did not contain a sufficient number of entries, skipping
File higgsCombine_paramFit_BothImpacts_prop_binmu_mu_sel_lj_bin1.MultiDimFit.mH125.root did not contain a sufficient number of entries, skipping
File higgsCombine_paramFit_BothImpacts_prop_binmu_mu_sel_lj_bin4.MultiDimFit.mH125.root did not contain a sufficient number of entries, skipping
File higgsCombine_paramFit_BothImpacts_prop_binmu_mu_sel_lj_bin6.MultiDimFit.mH125.root did not contain a sufficient number of entries, skipping
File higgsCombine_paramFit_BothImpacts_prop_binmu_mu_sel_lj_bin7.MultiDimFit.mH125.root did not contain a sufficient number of entries, skipping
File higgsCombine_paramFit_BothImpacts_prop_binmu_mu_sel_lj_bin8.MultiDimFit.mH125.root did not contain a sufficient number of entries, skipping
File higgsCombine_paramFit_BothImpacts_prop_binmu_mu_sel_ljout_bin2.MultiDimFit.mH125.root did not contain a sufficient number of entries, skipping
File higgsCombine_paramFit_BothImpacts_prop_binel_el_sel_lj_bin4.MultiDimFit.mH125.root did not contain a sufficient number of entries, skipping
File higgsCombine_paramFit_BothImpacts_prop_binel_el_sel_lj_bin8.MultiDimFit.mH125.root did not contain a sufficient number of entries, skipping
File higgsCombine_paramFit_BothImpacts_prop_binel_el_sel_ljout_bin2.MultiDimFit.mH125.root did not contain a sufficient number of entries, skipping

   r :    +0.990   -0.078/+0.079 (68%)

impacts table:

$\tauh$ misidentification background  &  2.0 &  1.4 &  8.1 \\
$\tauh$ jet identification  &  5.2 &  4.9 &  4.3 \\
...
                      PDF  &  1.7 &  1.4 &  3.8 \\
            MC statistics  &  2.5 &  1.7 &  5.5 \\

how does this work then?
some weird weirdness, tau_fakes is pulled to +1sigma
but it is also very stretched over position 0
and it is one-sided

el tau_fakes is slightly shifted to 0.1-0.2
mu tau_fakes are at 1sigma and constrained by about half

both with FSR frozen:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV,FSR  -m 125 --robustFit 1 --doInitialFit                --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV,FSR  -m 125 --robustFit 1 --doFits --parallel 5         --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV,FSR  -m 125 -o latest_both_impacts_lnN_lnN_updowns_frozenFSR.json --name BothImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_lnN_lnN_updowns_frozenFSR.json -o postfit_both_impacts_lnN_lnN_updowns_frozenFSR

   r :    +0.986   -0.073/+0.258 (68%)

  tauID_eff :        +0.255  -0.949/+0.946  +0.047/-0.045
  TuneCUETP8M2T4 :   +1.232  -0.941/+0.935  -0.009/+0.009
  bSF       :        +1.148  -1.053/+0.955  +0.026/-0.018

no failed parameters

result is weirdly 0.986 +- 0.166 !!!!!!!!!!!

which 0.16? where is 0.07?

tau fakes are 5th and strongly constrained
qcd norm is third?

python ttxsec/fit-stuff/new_impact_table.py --merge-pdf latest_el_impacts_lnN_lnN_updowns.json latest_mu_impacts_lnN_lnN_updowns.json latest_both_impacts_lnN_lnN_updowns_frozenFSR.json

the table is more reasonable:

$\tauh$ jet identification  &  5.2 &  4.9 &  4.7 \\
      Pile-Up uncertainty  &  3.1 &  2.7 &  3.2 \\
        top quark $p_{T}$  &  3.0 &  2.4 &  2.9 \\
        QCD normalization  &  0.6 &  0.9 &  2.7 \\
     b-tagging efficiency  &  1.9 &  2.0 &  2.6 \\
$\tauh$ misidentification background  &  2.0 &  1.4 &  2.4 \\
     W+jets normalization  &  0.4 &  1.2 &  1.9 \\
     $\tauh$ Energy Scale  &  0.7 &  0.5 &  1.2 \\
       muon ID efficiency  &  0.8 &  0.8 \\
electron trigger efficiency  &  2.8 &  0.7 \\
         DY normalization  &  0.4 &  0.4 &  0.6 \\
 Single Top normalization  &  0.7 &  0.7 &  0.6 \\
   electron ID efficiency  &  2.1 &  0.4 \\
    jet energy resolution  &  0.3 &  0.0 &  0.4 \\
         jet energy scale  &  0.3 &  0.0 &  0.3 \\
  muon trigger efficiency  &  0.4 &  0.3 \\
   Dibosons normalization  &  0.0 &  0.0 &  0.0 \\
               Luminosity  &  0.0 &  0.0 &  0.0 \\
          b fragmentation  &  3.0 &  2.6 &  2.7 \\
  Initial State Radiation  &  1.5 &  1.4 &  1.2 \\
Underlying event (Pythia tune)  &  0.6 &  0.7 &  0.9 \\
 ME Renormalization scale  &  0.8 &  1.2 &  0.9 \\
ME combined scale variation  &  0.5 &  1.0 &  0.8 \\
b decay tables, Semileptonic BR  &  0.6 &  0.4 &  0.4 \\
   ME Factorization scale  &  0.3 &  0.3 &  0.2 \\
   ME-PS matching (hdamp)  &  0.5 &  0.3 &  0.2 \\
    Final State Radiation  &  1.6 &  0.4 &  0.0 \\
                      PDF  &  1.7 &  1.4 &  1.7 \\
            MC statistics  &  2.5 &  1.7 &  2.2 \\

QCD and WJets norm is weird
JER, JES are 0 in muon??
TES is larger in both than in any of separate channels? and same for tau_fakes
(FSR is frozen in both)


let's freeze all updowns and go for dinner

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV  --freezeNuisanceGroup tt_updowns -m 125 --robustFit 1 --doInitialFit                --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV  --freezeNuisanceGroup tt_updowns -m 125 --robustFit 1 --doFits --parallel 5         --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/latest_datacard_both.root   --freezeParameters lumi_13TeV  --freezeNuisanceGroup tt_updowns -m 125 -o latest_both_impacts_lnN_lnN_updowns_frozenUpdowns.json --name BothImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts_lnN_lnN_updowns_frozenUpdowns.json -o postfit_both_impacts_lnN_lnN_updowns_frozenUpdowns







# fixing qcd recalculation for systematics

it seems it is always done only for nominal

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root -o plots/ --lumi 35800 -c mu_sel_lj -x mu_selVloose_lj -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root -o plots/ --lumi 35800 -c mu_sel_lj -x mu_selVloose_lj -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 -s PUUp

hadd plots/distrs/foobar.root plots//distrs/distrs_redo_v25v26_mc_HISTOSEL_Mt_lep_met_f_mu_sel_lj_*



ls histosels/redo-v25-v26_1/distrs/*root | wc -l
584
ls histosels/redo-v25-v26_1/distrs/2/*root | wc -l
620

hadd histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root histosels/redo-v25-v26_1/distrs/*root






# correcting the plots

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root -p -r -o plots/ --lumi 35800 -c mu_sel_lj -x mu_selVloose_lj -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3


python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root -p -r -o plots/ --lumi 35800 -c mu_sel_lj -x mu_selVloose_lj -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other.dy_other,dy_tautau

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root -p -r -o plots/ --lumi 35800 -c mu_sel_lj -x mu_selVloose_lj -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other


python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root -p -r -o plots/ --lumi 35800 -c mu_sel_lj -x mu_selVloose_lj -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --systematic-uncertainty bSF,PU,LEPmuID,LEPmuTRG,TOPPT

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root -p -r -o plots/ --lumi 35800 -c mu_sel_lj -x mu_selVloose_lj -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --systematic-uncertainty bSF,PU,LEPmuID,LEPmuTRG,JES,JER,TES

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root -p -r -o plots/ --lumi 35800 -c mu_sel_lj -x mu_selVloose_lj -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --systematic-uncertainty bSF,PU,LEPmuID,LEPmuTRG,TOPPT,JES,JER,TES

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root -p -r -o plots/ --lumi 35800 -c mu_sel_lj -x mu_selVloose_lj -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --systematic-uncertainty bSF,PU,LEPmuID,LEPmuTRG,TOPPT,JES,JER,TES,Frag,SemilepBR,Peterson





# compare precomputed mt-s to recomputed

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_NOMINAL.root    --std-histos --histo-name mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &


python -W ignore sumup_ttree_draw.py "event_met_lep_mt" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_NOMINAL_precomp.root    --std-histos --histo-name mu_sel/std_procs/NOMINAL/Mt_lep_met_f_precomp  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &

mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 40821, Total sum= 36603.5

mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f_precomp")->Print()
TH1.Print Name  = mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f_precomp, Entries= 40821, Total sum= 36603.5

hadd quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_NOMINAL_compare.root quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_NOMINAL_precomp.root quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_NOMINAL.root

h         = (TH1D*) mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")
h_precomp = (TH1D*) mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f_precomp")

h_precomp->SetLineColor(kRed)

h        ->Draw()
h_precomp->Draw("same")

OK perfect match

to implement the mt obj variations


test

time python -W ignore sumup_ttree_draw.py "std_mt_vars" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_obj_mt.root    --std-histos --histo-name mu_sel/std_procs/NOMINAL,obj/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root


mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Draw()
mu_sel->Get("tt_mutau/JESUp/mu_sel_tt_mutau_JESUp_Mt_lep_met_f")->Draw("same")
mu_sel->Get("tt_mutau/JESDown/mu_sel_tt_mutau_JESDown_Mt_lep_met_f")->Draw("same")
mu_sel->Get("tt_mutau/JERUp/mu_sel_tt_mutau_JERUp_Mt_lep_met_f")->Draw("same")
mu_sel->Get("tt_mutau/JERDown/mu_sel_tt_mutau_JERDown_Mt_lep_met_f")->Draw("same")
mu_sel->Get("tt_mutau/TESUp/mu_sel_tt_mutau_TESUp_Mt_lep_met_f")->Draw("same")
mu_sel->Get("tt_mutau/TESDown/mu_sel_tt_mutau_TESDown_Mt_lep_met_f")->Draw("same")

perfect

hadd jobsums/distrs/distrs_redo_v25v26_mc_3w0jets.root quick-test/redo-v25-v26_cats_hadds/MC*

mu_sel_lj->Get("tt_mutau/NOMINAL/mu_sel_lj_tt_mutau_NOMINAL_Mt_lep_met_f")->Draw()
mu_sel_lj->Get("tt_mutau/JESUp/mu_sel_lj_tt_mutau_JESUp_Mt_lep_met_f")->Draw("same")
mu_sel_lj->Get("tt_mutau/JESDown/mu_sel_lj_tt_mutau_JESDown_Mt_lep_met_f")->Draw("same")
mu_sel_lj->Get("tt_mutau/JERUp/mu_sel_lj_tt_mutau_JERUp_Mt_lep_met_f")->Draw("same")
mu_sel_lj->Get("tt_mutau/JERDown/mu_sel_lj_tt_mutau_JERDown_Mt_lep_met_f")->Draw("same")
mu_sel_lj->Get("tt_mutau/TESUp/mu_sel_lj_tt_mutau_TESUp_Mt_lep_met_f")->Draw("same")
mu_sel_lj->Get("tt_mutau/TESDown/mu_sel_lj_tt_mutau_TESDown_Mt_lep_met_f")->Draw("same")

mu_selVloose_lj->Get("tt_mutau/NOMINAL/mu_selVloose_lj_tt_mutau_NOMINAL_Mt_lep_met_f")->Draw()
mu_selVloose_lj->Get("tt_mutau/TESUp/mu_selVloose_lj_tt_mutau_TESUp_Mt_lep_met_f")->Draw("same")
mu_selVloose_lj->Get("tt_mutau/TESDown/mu_selVloose_lj_tt_mutau_TESDown_Mt_lep_met_f")->Draw("same")

mu_sel_lj->Get("qcd/NOMINAL/mu_sel_lj_qcd_NOMINAL_Mt_lep_met_f")->Draw()
mu_sel_lj->Get("qcd/TESUp/mu_sel_lj_qcd_TESUp_Mt_lep_met_f")->Draw("same")
mu_sel_lj->Get("qcd/TESDown/mu_sel_lj_qcd_TESDown_Mt_lep_met_f")->Draw("same")

rerun histosels and substitute HISTOSEL file for the fit

foreach sys (JESDown JESUp)
foreach sys (TESDown TESUp)
foreach sys (JERDown JERUp)
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --sys $sys &
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --sys $sys &
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --sys $sys &
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --sys $sys &
end

hadd histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_2.root histosels/redo-v25-v26_1/*root







# datacards

python numbers_for_datacard.py histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights_test4.root -y -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --latex


new lep systematics

 KEY: TDirectoryFile	LEPelIDDown;1	LEPelIDDown
 KEY: TDirectoryFile	LEPelIDUp;1	LEPelIDUp
 KEY: TDirectoryFile	LEPelTRGDown;1	LEPelTRGDown
 KEY: TDirectoryFile	LEPelTRGUp;1	LEPelTRGUp
 KEY: TDirectoryFile	LEPmuIDDown;1	LEPmuIDDown
 KEY: TDirectoryFile	LEPmuIDUp;1	LEPmuIDUp
 KEY: TDirectoryFile	LEPmuTRGDown;1	LEPmuTRGDown
 KEY: TDirectoryFile	LEPmuTRGUp;1	LEPmuTRGUp

ttxsec/fit-stuff/new_impact_table.py
python ttxsec/fit-stuff/new_impact_table.py --merge-pdf latest_el_impacts.json latest_mu_impacts.json latest_both_impacts.json





# histosels

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o plots/redo-v25-v26_1/ -p -r --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o plots/redo-v25-v26_1/ -p -r --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o plots/redo-v25-v26_1/ -p -r --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o plots/redo-v25-v26_1/ -p -r --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8

qcd

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o plots/redo-v25-v26_1/ -p -r --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o plots/redo-v25-v26_1/ -p -r --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o plots/redo-v25-v26_1/ -p -r --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o plots/redo-v25-v26_1/ -p -r --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05



systematics with recalculated qcd

foreach sys (`cat syst-test.syst-list.1`)
foreach sys (`cat syst-test.syst-list.1_aa`)
foreach sys (`cat syst-test.syst-list.1_ab`)
foreach sys (`cat syst-test.syst-list.1_ac`)
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --systematic $sys &
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --systematic $sys &
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --systematic $sys &
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --systematic $sys &
end

and without (hard tt modeling)

syst-test.syst-list.2_aa  syst-test.syst-list.2_ac  syst-test.syst-list.2_ae  syst-test.syst-list.2_ag
syst-test.syst-list.2_ab  syst-test.syst-list.2_ad  syst-test.syst-list.2_af  syst-test.syst-list.2_ah

foreach sys (`cat syst-test.syst-list.2_aa`)
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
end

foreach sys (`cat syst-test.syst-list.2_ab`)
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
end

foreach sys (`cat syst-test.syst-list.2_ac`)
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
end

foreach sys (`cat syst-test.syst-list.2_ad`)
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
end

foreach sys (`cat syst-test.syst-list.2_ae`)
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
end

foreach sys (`cat syst-test.syst-list.2_af`)
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
end

foreach sys (`cat syst-test.syst-list.2_ag`)
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
end

foreach sys (`cat syst-test.syst-list.2_ah`)
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
end





old example:

foreach sys (`cat syst-test.syst-list.1`)
python stack_plot.py distrs_v25pStage2Run3_3_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_mu_ljs/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8    -s $sys || true
end

python stack_plot.py distrs_v25pStage2Run3_3_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_mu_ljs/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8    -s NOMINAL || true


foreach sys (`cat syst-test.syst-list.1`)
python stack_plot.py distrs_v25pStage2Run3_3_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_mu_ljs/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --qcd 1.05 --wjet 0.8    -s $sys || true
end

python stack_plot.py distrs_v25pStage2Run3_3_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_mu_ljs/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --qcd 1.05 --wjet 0.8    -s NOMINAL || true


now datacard with qcd systematics and free parameters
and run NLL and impacts













# run with systematics, tt in separate bunches

let's hadd after all?

tt, data, small and tt systs are hadded already

all nominals:

merge-sets/jobs_hadd.dtags.single-muon      
merge-sets/jobs_hadd.dtags.single-electron 

merge-sets/jobs_hadd.dtags.all-tt-systs_main

merge-sets/jobs_hadd.dtags.small_main
merge-sets/jobs_hadd.dtags.large_aa_main
merge-sets/jobs_hadd.dtags.large_ab_main

MC2016_Summer16_TTJets_powheg


time python -W ignore sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_sels/MC2016_Summer16_TTJets_powheg.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &


foreach dtag (`cat merge-sets/jobs_hadd.dtags.all-tt-systs_main`)
echo $dtag
time python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_sels/$dtag.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root &
end

foreach dtag (`cat merge-sets/jobs_hadd.dtags.small_main`)
python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_sels/$dtag.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root &
end

foreach dtag (`cat merge-sets/jobs_hadd.dtags.large_aa_main`)
python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_sels/$dtag.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root &
end

foreach dtag (`cat merge-sets/jobs_hadd.dtags.large_ab_main`)
python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_sels/$dtag.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root &
end

foreach dtag (SingleMuon SingleElectron)
python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_sels/$dtag.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root &
end






with systematics:

named_systs_weights_all = {'nom': systs_weights_nominal,
'common': systs_weights_common,
'obj'   : systs_objects,
'tt_weights': systs_weights_tt,
'tt_hard': systs_weights_tt_hard,
'tt_pdf':  systs_weights_tt_alpha_pdf,
}

foreach chans ( el_sel_lj,el_selVloose_lj,el_sel_ljout,el_selVloose_ljout,el_sel_lj_ss,el_selVloose_lj_ss,el_sel_ljout_ss,el_selVloose_ljout_ss mu_sel_lj,mu_selVloose_lj,mu_sel_ljout,mu_selVloose_ljout,mu_sel_lj_ss,mu_selVloose_lj_ss,mu_sel_ljout_ss,mu_selVloose_ljout_ss)
  foreach systs (nom,common obj tt_weights tt_hard tt_pdf)
  time python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_cats/MC2016_Summer16_TTJets_powheg_${chans}_$systs.root    --std-histos --histo-name $chans/std_procs/$systs/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &
  end
end


foreach chans ( el_sel_lj,el_selVloose_lj,el_sel_ljout,el_selVloose_ljout,el_sel_lj_ss,el_selVloose_lj_ss,el_sel_ljout_ss,el_selVloose_ljout_ss mu_sel_lj,mu_selVloose_lj,mu_sel_ljout,mu_selVloose_ljout,mu_sel_lj_ss,mu_selVloose_lj_ss,mu_sel_ljout_ss,mu_selVloose_ljout_ss)
  foreach dtag (`cat merge-sets/jobs_hadd.dtags.all-tt-systs_main`)
  echo $dtag
  time python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root &
  end
end

foreach chans ( el_sel_lj,el_selVloose_lj,el_sel_ljout,el_selVloose_ljout,el_sel_lj_ss,el_selVloose_lj_ss,el_sel_ljout_ss,el_selVloose_ljout_ss mu_sel_lj,mu_selVloose_lj,mu_sel_ljout,mu_selVloose_ljout,mu_sel_lj_ss,mu_selVloose_lj_ss,mu_sel_ljout_ss,mu_selVloose_ljout_ss)
  foreach dtag (`cat merge-sets/jobs_hadd.dtags.small_main`)
  python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom,common,obj/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root &
  end
end

foreach chans ( el_sel_lj,el_selVloose_lj,el_sel_ljout,el_selVloose_ljout,el_sel_lj_ss,el_selVloose_lj_ss,el_sel_ljout_ss,el_selVloose_ljout_ss mu_sel_lj,mu_selVloose_lj,mu_sel_ljout,mu_selVloose_ljout,mu_sel_lj_ss,mu_selVloose_lj_ss,mu_sel_ljout_ss,mu_selVloose_ljout_ss)
  foreach dtag (`cat merge-sets/jobs_hadd.dtags.large_aa_main`)
  python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom,common,obj/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root &
  end
end

foreach chans ( el_sel_lj,el_selVloose_lj,el_sel_ljout,el_selVloose_ljout,el_sel_lj_ss,el_selVloose_lj_ss,el_sel_ljout_ss,el_selVloose_ljout_ss mu_sel_lj,mu_selVloose_lj,mu_sel_ljout,mu_selVloose_ljout,mu_sel_lj_ss,mu_selVloose_lj_ss,mu_sel_ljout_ss,mu_selVloose_ljout_ss)
  foreach dtag (`cat merge-sets/jobs_hadd.dtags.large_ab_main`)
  python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom,common,obj/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root &
  end
end


foreach chans ( el_sel_lj,el_selVloose_lj,el_sel_ljout,el_selVloose_ljout,el_sel_lj_ss,el_selVloose_lj_ss,el_sel_ljout_ss,el_selVloose_ljout_ss mu_sel_lj,mu_selVloose_lj,mu_sel_ljout,mu_selVloose_ljout,mu_sel_lj_ss,mu_selVloose_lj_ss,mu_sel_ljout_ss,mu_selVloose_ljout_ss)
  foreach dtag (SingleMuon SingleElectron)
  python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root &
  end
end



-- gen batch jobs out of this?





## batch jobs

foreach chans (el_sel_lj el_selVloose_lj el_sel_ljout el_selVloose_ljout el_sel_lj_ss el_selVloose_lj_ss el_sel_ljout_ss el_selVloose_ljout_ss mu_sel_lj mu_selVloose_lj mu_sel_ljout mu_selVloose_ljout mu_sel_lj_ss mu_selVloose_lj_ss mu_sel_ljout_ss mu_selVloose_ljout_ss)
  foreach systs (nom common obj tt_weights tt_hard tt_alpha tt_pdf1 tt_pdf10 tt_pdf20 tt_pdf30 tt_pdf40 tt_pdf50)
  echo \#\!/bin/sh                                          > batch_jobs/tt_${chans}_${systs}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/tt_${chans}_${systs}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/tt_${chans}_${systs}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/tt_${chans}_${systs}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/tt_${chans}_${systs}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/tt_${chans}_${systs}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/tt_${chans}_${systs}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/tt_${chans}_${systs}
  echo cmsenv                                              >> batch_jobs/tt_${chans}_${systs}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/tt_${chans}_${systs}

  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"std_mt_vars"' --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com '""' --output quick-test/redo-v25-v26_cats/MC2016_Summer16_TTJets_powheg_${chans}_$systs.root    --std-histos --histo-name $chans/std_procs/$systs/Mt_lep_met_f  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root >> batch_jobs/tt_${chans}_${systs}
  end
end

foreach chans (el_sel_lj el_selVloose_lj el_sel_ljout el_selVloose_ljout el_sel_lj_ss el_selVloose_lj_ss el_sel_ljout_ss el_selVloose_ljout_ss mu_sel_lj mu_selVloose_lj mu_sel_ljout mu_selVloose_ljout mu_sel_lj_ss mu_selVloose_lj_ss mu_sel_ljout_ss mu_selVloose_ljout_ss)
  foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main  sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main sw-dir/merge-sets/jobs_hadd.dtags.small_main`)
  echo \#\!/bin/sh                                          > batch_jobs/mc_${dtag}_${chans}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/mc_${dtag}_${chans}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/mc_${dtag}_${chans}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/mc_${dtag}_${chans}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/mc_${dtag}_${chans}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/mc_${dtag}_${chans}
  echo cmsenv                                              >> batch_jobs/mc_${dtag}_${chans}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/mc_${dtag}_${chans}

  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"std_mt_vars"' --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com '""' --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom,common,obj/Mt_lep_met_f  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root >> batch_jobs/mc_${dtag}_${chans}
  end
end

foreach chans (el_sel_lj el_selVloose_lj el_sel_ljout el_selVloose_ljout el_sel_lj_ss el_selVloose_lj_ss el_sel_ljout_ss el_selVloose_ljout_ss mu_sel_lj mu_selVloose_lj mu_sel_ljout mu_selVloose_ljout mu_sel_lj_ss mu_selVloose_lj_ss mu_sel_ljout_ss mu_selVloose_ljout_ss)
  foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.all-tt-systs_main`)
  echo \#\!/bin/sh                                          > batch_jobs/mc_${dtag}_${chans}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/mc_${dtag}_${chans}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/mc_${dtag}_${chans}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/mc_${dtag}_${chans}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/mc_${dtag}_${chans}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/mc_${dtag}_${chans}
  echo cmsenv                                              >> batch_jobs/mc_${dtag}_${chans}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/mc_${dtag}_${chans}

  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"std_mt_vars"' --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com '""' --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom/Mt_lep_met_f  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root >> batch_jobs/mc_${dtag}_${chans}
  end
end

foreach chans (el_sel_lj el_selVloose_lj el_sel_ljout el_selVloose_ljout el_sel_lj_ss el_selVloose_lj_ss el_sel_ljout_ss el_selVloose_ljout_ss mu_sel_lj mu_selVloose_lj mu_sel_ljout mu_selVloose_ljout mu_sel_lj_ss mu_selVloose_lj_ss mu_sel_ljout_ss mu_selVloose_ljout_ss)
  foreach dtag (SingleMuon SingleElectron)
  echo \#\!/bin/sh                                          > batch_jobs/data_${dtag}_${chans}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/data_${dtag}_${chans}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/data_${dtag}_${chans}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/data_${dtag}_${chans}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/data_${dtag}_${chans}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/data_${dtag}_${chans}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/data_${dtag}_${chans}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/data_${dtag}_${chans}
  echo cmsenv                                              >> batch_jobs/data_${dtag}_${chans}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/data_${dtag}_${chans}

  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"std_mt_vars"' --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com '""' --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root >> batch_jobs/data_${dtag}_${chans}
  end
end



ls batch_jobs/ > batch_jobs/submit

qsub -l h_vmem=1G '/lstore/cms/olek/CMSSW_8_0_26_patch1/src/e
UserCodeh

% s,^,qsub -l h_vmem=1G '/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/batch_jobs/,
% s/$/'/

remove the line with submit

$ wc -l batch_jobs/submit
800 batch_jobs/submit


sed -i 's/--cond-com/--cond-com ""/'                 batch_jobs/data_*
sed -i -e 's/sqrt/"sqrt/' -e 's/ --ttree/" --ttree/' batch_jobs/tt_*


PUDown failed (= PUUp now)



hadds


hadd quick-test/redo-v25-v26_cats_hadds/MC2016_Summer16_TTJets_powheg.root quick-test/redo-v25-v26_cats/MC2016_Summer16_TTJets_powheg_el_*.root quick-test/redo-v25-v26_cats/MC2016_Summer16_TTJets_powheg_mu_*.root &

foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.all-tt-systs_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.small_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main`)
foreach dtag (SingleMuon SingleElectron)
hadd quick-test/redo-v25-v26_cats_hadds/$dtag.root quick-test/redo-v25-v26_cats/$dtag*root &
end

hadd quick-test/distrs_redo_v25v26_mc_3.root quick-test/redo-v25-v26_cats_hadds/MC*


merge-sets/jobs_hadd.dtags.small_main
merge-sets/jobs_hadd.dtags.large_aa_main
merge-sets/jobs_hadd.dtags.large_ab_main

MC2016_Summer16_TTJets_powheg

small did not match
MC2016_Summer16_WJets_madgraph did not match
and only el_sel_lj in SingleT


foreach chans (el_sel_lj el_selVloose_lj el_sel_ljout el_selVloose_ljout el_sel_lj_ss el_selVloose_lj_ss el_sel_ljout_ss el_selVloose_ljout_ss mu_sel_lj mu_selVloose_lj mu_sel_ljout mu_selVloose_ljout mu_sel_lj_ss mu_selVloose_lj_ss mu_sel_ljout_ss mu_selVloose_ljout_ss)
  foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main sw-dir/merge-sets/jobs_hadd.dtags.small_main`)
  echo $chans $dtag
  echo \#\!/bin/sh                                          > batch_jobs/mc_${dtag}_${chans}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/mc_${dtag}_${chans}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/mc_${dtag}_${chans}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/mc_${dtag}_${chans}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/mc_${dtag}_${chans}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/mc_${dtag}_${chans}
  echo cmsenv                                              >> batch_jobs/mc_${dtag}_${chans}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/mc_${dtag}_${chans}
  echo python -W ignore sumup_ttree_draw.py '"sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))"' --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com '""' --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom,common,obj/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root >> batch_jobs/mc_${dtag}_${chans}
  end
end

foreach chans (el_sel_lj el_selVloose_lj el_sel_ljout el_selVloose_ljout el_sel_lj_ss el_selVloose_lj_ss el_sel_ljout_ss el_selVloose_ljout_ss mu_sel_lj mu_selVloose_lj mu_sel_ljout mu_selVloose_ljout mu_sel_lj_ss mu_selVloose_lj_ss mu_sel_ljout_ss mu_selVloose_ljout_ss)
  foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main sw-dir/merge-sets/jobs_hadd.dtags.small_main`)
  echo $chans
  echo $dtag
  end
end


foreach chans (el_sel_lj el_selVloose_lj el_sel_ljout el_selVloose_ljout el_sel_lj_ss el_selVloose_lj_ss el_sel_ljout_ss el_selVloose_ljout_ss mu_sel_lj mu_selVloose_lj mu_sel_ljout mu_selVloose_ljout mu_sel_lj_ss mu_selVloose_lj_ss mu_sel_ljout_ss mu_selVloose_ljout_ss)
  foreach dtag (MC2016_Summer16_WJets_madgraph)
  echo \#\!/bin/sh                                          > batch_jobs/mc_${dtag}_${chans}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/mc_${dtag}_${chans}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/mc_${dtag}_${chans}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/mc_${dtag}_${chans}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/mc_${dtag}_${chans}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/mc_${dtag}_${chans}
  echo cmsenv                                              >> batch_jobs/mc_${dtag}_${chans}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/mc_${dtag}_${chans}

  echo python -W ignore sumup_ttree_draw.py '"sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))"' --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com '""' --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom,common,obj/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root >> batch_jobs/mc_${dtag}_${chans}
  end
end


ls batch_jobs/mc_* batch_jobs/tt_* batch_jobs/data_* > batch_jobs/submit



broken weights and number of entries

foreach chans (el_sel_lj el_selVloose_lj el_sel_ljout el_selVloose_ljout el_sel_lj_ss el_selVloose_lj_ss el_sel_ljout_ss el_selVloose_ljout_ss mu_sel_lj mu_selVloose_lj mu_sel_ljout mu_selVloose_ljout mu_sel_lj_ss mu_selVloose_lj_ss mu_sel_ljout_ss mu_selVloose_ljout_ss)
  foreach systs (nom,common obj tt_weights tt_hard tt_pdf)
  echo \#\!/bin/sh                                          > batch_jobs/tt_${chans}_${systs}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/tt_${chans}_${systs}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/tt_${chans}_${systs}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/tt_${chans}_${systs}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/tt_${chans}_${systs}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/tt_${chans}_${systs}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/tt_${chans}_${systs}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/tt_${chans}_${systs}
  echo cmsenv                                              >> batch_jobs/tt_${chans}_${systs}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/tt_${chans}_${systs}

  end
end




python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_NOMINAL.root    --std-histos --histo-name mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_lj_NOMINAL.root --std-histos --histo-name mu_sel_lj/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_NOMINAL,TESUp.root    --std-histos --histo-name mu_sel/std_procs/NOMINAL,TESUp/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_TESUp.root    --std-histos --histo-name mu_sel/std_procs/TESUp/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &


root [6] mu_sel_lj->Get("tt_lj/NOMINAL/mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f, Entries= 11001, Total sum= 10001.2


root [1] mu_sel->Get("tt_lj/NOMINAL/mu_sel_tt_lj_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_tt_lj_NOMINAL_Mt_lep_met_f, Entries= 18405, Total sum= 16741.9

root [3] mu_sel->Get("tt_lj/NOMINAL/mu_sel_tt_lj_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_tt_lj_NOMINAL_Mt_lep_met_f, Entries= 18405, Total sum= 16741.9
root [4] mu_sel->Get("tt_lj/TESUp/mu_sel_tt_lj_TESUp_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_tt_lj_TESUp_Mt_lep_met_f, Entries= 19110, Total sum= 133735

root [2] mu_sel->Get("tt_lj/TESUp/mu_sel_tt_lj_TESUp_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_tt_lj_TESUp_Mt_lep_met_f, Entries= 19110, Total sum= 133735


python -W ignore sumup_ttree_draw.py --debug --test "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_lj_NOMINAL.root --std-histos --histo-name mu_sel_lj/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root

python -W ignore sumup_ttree_draw.py --debug --test "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_TESUp.root    --std-histos --histo-name mu_sel/std_procs/TESUp/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root




## distrs

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o plots/redo-v25-v26_1/ -p -r --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o plots/redo-v25-v26_1/ -p -r --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o plots/redo-v25-v26_1/ -p -r --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o plots/redo-v25-v26_1/ -p -r --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8


-- w0jets are not cut off well

foreach chans (el_sel_lj el_selVloose_lj el_sel_ljout el_selVloose_ljout el_sel_lj_ss el_selVloose_lj_ss el_sel_ljout_ss el_selVloose_ljout_ss mu_sel_lj mu_selVloose_lj mu_sel_ljout mu_selVloose_ljout mu_sel_lj_ss mu_selVloose_lj_ss mu_sel_ljout_ss mu_selVloose_ljout_ss)
  foreach dtag (MC2016_Summer16_WJets_madgraph)
  echo \#\!/bin/sh                                          > batch_jobs/mc_${dtag}_${chans}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/mc_${dtag}_${chans}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/mc_${dtag}_${chans}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/mc_${dtag}_${chans}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/mc_${dtag}_${chans}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/mc_${dtag}_${chans}
  echo cmsenv                                              >> batch_jobs/mc_${dtag}_${chans}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/mc_${dtag}_${chans}

  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))"' --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com '""' --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom,common,obj/Mt_lep_met_f  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root >> batch_jobs/mc_${dtag}_${chans}
  end
end

hadd jobsums/distrs/distrs_redo_v25v26_mc_2w0jets.root quick-test/redo-v25-v26_cats_hadds/MC*










## some error with NOMINAL TT

python -W ignore sumup_ttree_draw.py --debug --test "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_lj_NOMINAL.root --std-histos --histo-name mu_sel_lj/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root

python -W ignore sumup_ttree_draw.py --debug --test "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_lj_NOMINAL.root --std-histos --histo-name mu_sel_lj/std_procs/NOMINAL,common/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root

python -W ignore sumup_ttree_draw.py --debug --test "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_lj_NOMINAL.root --std-histos --histo-name mu_sel_lj/std_procs/NOMINAL,common,obj/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root



check updowns

python -W ignore sumup_ttree_draw.py --debug --test "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_fsrup_mu_sel_lj_NOMINAL.root --std-histos --histo-name mu_sel_lj/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/MC2016_Summer16_TTJets_powheg_fsrup*root

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_fsrup_mu_sel_lj_NOMINAL.root --std-histos --histo-name mu_sel_lj/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/MC2016_Summer16_TTJets_powheg_fsrup*root

time python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_fsrdown_mu_sel_lj_NOMINAL.root --std-histos --histo-name mu_sel_lj/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/MC2016_Summer16_TTJets_powheg_fsrdown*root



fixed sys names of updowns



also the hadd failed?

ls quick-test/redo-v25-v26_cats/MC2016_Summer16_TTJets_powheg_el_*.root quick-test/redo-v25-v26_cats/MC2016_Summer16_TTJets_powheg_mu_*.root | wc -l

hadd quick-test/redo-v25-v26_cats_hadds/MC2016_Summer16_TTJets_powheg.root quick-test/redo-v25-v26_cats/MC2016_Summer16_TTJets_powheg_el_*.root quick-test/redo-v25-v26_cats/MC2016_Summer16_TTJets_powheg_mu_*.root










# skipping the merge step

compate these:

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26/MC2016_Summer16_TTJets_powheg_sels.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26/SingleElectron_sels.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/SingleElectron.root &

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26/SingleMuon_sels.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/SingleMuon.root &

to:

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26/MC2016_Summer16_TTJets_powheg_sels_files.root --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/v26/resub1/MC2016_Summer16_TTJets_powheg/*root &
python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26/SingleElectron_sels_files.root                --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/v25/resub1/Data13TeV_SingleElectron2016*/*root &
python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26/SingleMuon_sels_files.root                    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/v25/resub1/Data13TeV_SingleMuon2016*/*root &

OK  SingleMuon
OK  SingleElectron (14383)
OK  MC TT

hadded file
root [2] el_sel->Get("tt_eltau/NOMINAL/el_sel_tt_eltau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = el_sel_tt_eltau_NOMINAL_Mt_lep_met_f, Entries= 27022, Total sum= 25102.6
root [3] mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 40821, Total sum= 36603.5

separate files (takes much longer, 30 minutes)
TH1.Print Name  = el_sel_tt_eltau_NOMINAL_Mt_lep_met_f, Entries= 27022, Total sum= 25102.6
TH1.Print Name  = mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 40821, Total sum= 36603.5

Perfect



debugging input with multiple files

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26/SingleMuon_sels_files.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/v25/resub1/Data13TeV_SingleMuon2016B_03Feb2017_ver2/Data13TeV_SingleMuon2016B_03Feb2017_ver2_1.root lstore_outdirs/v25/resub1/Data13TeV_SingleMuon2016B_03Feb2017_ver2/Data13TeV_SingleMuon2016B_03Feb2017_ver2_10.root







## time them too?








# run selection on v25-v26

first finish the full script on all dtags
systematics per each dtag

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super_w0cut.root  --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight --cut-w0jets lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_WJets_madgraph.root



python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super_w0cut_tt.root  --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight --cut-w0jets lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_TTJets_powheg.root

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super_w0cut_tt_without.root  --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_TTJets_powheg.root

-- test with and without OK



python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super_per_dtag_sys_wjet.root    --std-histos --histo-name el_sel,mu_sel/std_procs/per_dtag/Mt_lep_met_f  --save-weight --cut-w0jets lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_WJets_madgraph.root &

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super_per_dtag_sys_ttjet.root   --std-histos --histo-name el_sel,mu_sel/std_procs/per_dtag/Mt_lep_met_f  --save-weight --cut-w0jets lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_TTJets_powheg.root &

-- nothing in wjets


python -W ignore sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super_per_dtag_sys_wjet.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight --cut-w0jets lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_WJets_madgraph.root

python -W ignore sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super_per_dtag_sys_wjet.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_WJets_madgraph.root

-- only 16 events pass?


but it seems to work

run on all MCs etc:

the fit was with
HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root

from log below it was made with

grep v25pStage2Run3_3_Run4_mu_ljs jobsums/histosel*
grep: jobsums/histosel-roots: Is a directory
jobsums/histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs:python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8    -s $sys || true
jobsums/histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs:python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8    -s NOMINAL || true
jobsums/histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs:python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8    -s $sys || true
jobsums/histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs:python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --qcd 1.05 --wjet 0.8    -s NOMINAL || true
jobsums/histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs_pdfs:python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8    -s $sys || true
jobsums/histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs_pdfs:python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8    -s $sys || true
jobsums/histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs_rest:python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8    -s $sys || true
jobsums/histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs_rest:python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8    -s $sys || true


last in histosel-roots
HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights_test4.root
v25pStage2Run3_3_Run4_el_ljs
v25pStage2Run3_3_Run4_mu_ljs

HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root


in mc_norm
distrs_v25pStage2Run3_3_Run4_updowns_weights_4.root

from below:

hadd distrs_v25pStage2Run3_3_Run4_updowns_weights_4.root v25pStage2Run4Rest/MC* v25pStage2Run4Rest/wjets/MC* v25r4/MC* v26pStage2Run4/MC2016_Summer16_TTJets_powheg.root

cp  distrs_v25pStage2Run3_3_Run4_updowns_weights_4.root  ../distrs_v25pStage2Run3_3_Run4_updowns_weights.root

merge-sets/v25/pStage2Run4Rest  -- small processes MC    (28 files)
merge-sets/v25/r4               -- TT systematics        ( 8 files)
merge-sets/v26/pStage2Run4      -- main TT               ( 1 file)

all MC
ls merge-sets/v25/pStage2Run4Rest/*.root merge-sets/v25/r4/*root merge-sets/v26/pStage2Run4/*root

-- 37 files

and Data in ../distrs/v25pStage2Run3_hadds/SingleMuon.root

ls merge-sets/v25/pStage2Run3/Data*


python -W ignore sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-at-v40/MC2016_Summer16_WJets_madgraph.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight merge-sets/v25/pStage2Run4Rest/MC2016_Summer16_WJets_madgraph.root




## confirm the old selection is processed ok with the super sumup script in mu_sel, el_sel and NOMINAL

foreach file (`ls merge-sets/v25/pStage2Run4Rest/*root`)
setenv dtag `echo $file | sed 's/^.*\(MC[^.]*\).root.*/\1/'`
python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-at-v40/$dtag.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight merge-sets/v25/pStage2Run4Rest/$dtag.root
end


foreach file (`ls merge-sets/v25/r4/MC*root`)
setenv dtag `echo $file | sed 's/^.*\(MC[^.]*\).root.*/\1/'`
python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-at-v40/$dtag.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight merge-sets/v25/r4/$dtag.root &
end

foreach file (`ls merge-sets/v26/pStage2Run4/MC*TT*root`)
setenv dtag `echo $file | sed 's/^.*\(MC[^.]*\).root.*/\1/'`
python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-at-v40/$dtag.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight merge-sets/v26/pStage2Run4/$dtag.root &
end

foreach file (`ls merge-sets/v25/pStage2Run3/Data*root`)
setenv dtag `echo $file | sed 's/^.*\(Data[^.]*\).root.*/\1/'`
python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-at-v40/$dtag.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight merge-sets/v25/pStage2Run3/$dtag.root &
end



debugging

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-at-v40/MC2016_Summer16_WJets_madgraph.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight merge-sets/v25/pStage2Run4Rest/MC2016_Summer16_WJets_madgraph.root


python -W ignore sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-at-v40/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight merge-sets/v25/pStage2Run3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root



-- works, but now the selection ids are different





## re-stage2 the old NTuples

with separate presel and sel!    -- CORRECT NUMBERS IN DRAW
and with Vloose cut at tau!      -- CHECK? OK

merge-sets/jobs_hadd.dtags.all-tt-systs

merge-sets/jobs_hadd.dtags.small
merge-sets/jobs_hadd.dtags.large_aa
merge-sets/jobs_hadd.dtags.large_ab

make merge_proc dtags=merge-sets/jobs_hadd.dtags.all-tt-systs nt=v25 proc=resub1 merge_dir=lstore_outdirs/merge-sets/
make merge_proc dtags=merge-sets/jobs_hadd.dtags.single-muon      nt=v25 proc=resub1 merge_dir=lstore_outdirs/merge-sets/
make merge_proc dtags=merge-sets/jobs_hadd.dtags.single-electron  nt=v25 proc=resub1 merge_dir=lstore_outdirs/merge-sets/

make merge_proc dtags=merge-sets/jobs_hadd.dtags.small    nt=v25 proc=resub1 merge_dir=lstore_outdirs/merge-sets/
make merge_proc dtags=merge-sets/jobs_hadd.dtags.large_aa nt=v25 proc=resub1 merge_dir=lstore_outdirs/merge-sets/
make merge_proc dtags=merge-sets/jobs_hadd.dtags.large_ab nt=v25 proc=resub1 merge_dir=lstore_outdirs/merge-sets/

hadd lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root lstore_outdirs/v26/resub1/MC2016_Summer16_TTJets_powheg/*root &




test data and tt yields

SingleMuon
64252 ev
24147 in OS mu_sel

SingleElectron
38121 ev
14383 in OS el_sel

TT
249914 ev
64461  OS mu
42162  OS el

OK



TT and Data nominals:

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26/MC2016_Summer16_TTJets_powheg_sels.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26/SingleElectron_sels.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/SingleElectron.root &

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26/SingleMuon_sels.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/SingleMuon.root &















# el yield investigation PROBLEM

quick test


scheme Dilep_tauId

python sumup_ttree_draw.py "lep_p4[0].pt()" --histo-range 21,0.,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 1 && lep_id[0]*tau_id[0] < 0"   --per-weight    --save-weight --histo-name "musel/tt/NOMINAL/musel_tt_NOMINAL_lep_pt" --output quick-test/v40/MC2016_Summer16_TTJets_powheg_mutau_lep_pt.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_TTJets_powheg*/*/0000/*_22.root &

python sumup_ttree_draw.py "lep_p4[0].pt()" --histo-range 21,0.,200 --cond-com "abs(leps_ID) == 11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 1 && lep_id[0]*tau_id[0] < 0"   --per-weight    --save-weight --histo-name "elsel/tt/NOMINAL/elsel_tt_NOMINAL_lep_pt" --output quick-test/v40/MC2016_Summer16_TTJets_powheg_eltau_lep_pt.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_TTJets_powheg*/*/0000/*_22.root &

8302 and 1856



scheme signal

python sumup_ttree_draw.py "lep_p4[0].pt()" --histo-range 21,0.,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 1 && lep_id[0]*tau_id[0] < 0"   --per-weight    --save-weight --histo-name "musel/tt/NOMINAL/musel_tt_NOMINAL_lep_pt" --output quick-test/v34/MC2016_Summer16_TTJets_powheg_mutau_lep_pt.root gstore_outdirs/v34/*/Ntupler_v34_MC2016_Summer16_TTJets_powheg*/*/0000/*_22.root &

python sumup_ttree_draw.py "lep_p4[0].pt()" --histo-range 21,0.,200 --cond-com "abs(leps_ID) == 11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 1 && lep_id[0]*tau_id[0] < 0"   --per-weight    --save-weight --histo-name "elsel/tt/NOMINAL/elsel_tt_NOMINAL_lep_pt" --output quick-test/v34/MC2016_Summer16_TTJets_powheg_eltau_lep_pt.root gstore_outdirs/v34/*/Ntupler_v34_MC2016_Summer16_TTJets_powheg*/*/0000/*_22.root &


6400 and 4313


scheme Dilep_tauId

python sumup_ttree_draw.py "lep_p4[0].pt()" --histo-range 21,0.,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 1 && lep_id[0]*tau_id[0] < 0"   --per-weight    --save-weight --histo-name "musel/tt/NOMINAL/musel_tt_NOMINAL_lep_pt" --output quick-test/v31v27/MC2016_Summer16_TTJets_powheg_mutau_lep_pt.root gstore_outdirs/v31v27/*/Ntupler_v31v27_MC2016_Summer16_TTJets_powheg*/*/0000/*_22.root &

python sumup_ttree_draw.py "lep_p4[0].pt()" --histo-range 21,0.,200 --cond-com "abs(leps_ID) == 11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 1 && lep_id[0]*tau_id[0] < 0"   --per-weight    --save-weight --histo-name "elsel/tt/NOMINAL/elsel_tt_NOMINAL_lep_pt" --output quick-test/v31v27/MC2016_Summer16_TTJets_powheg_eltau_lep_pt.root gstore_outdirs/v31v27/*/Ntupler_v31v27_MC2016_Summer16_TTJets_powheg*/*/0000/*_22.root &

mu el
613 and 415

????



NTupler on 1 TT file 10k events

tauID

abs(leps_ID) == 11 or 13
184
681

Dilepton

11 or 13
0
0

11*11, 11*13 or 13*13
4
21
63

-- hm?


v33tauCands

tauID

11 13

184
681


Dilepton

11 11   11 13   13 13

4
21
63


v26

tauID

184
681


Dilepton

4
21
63

?



------------------------ ok, ntupler outputs the same
test whether the gstore files are the same?




root -l gstore_outdirs/v26/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v26_MC2016_Summer16_TTJets_powheg/180412_180008/0000/MC2016_Summer16_TTJets_powheg_1.root

((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(leps_ID)==11")
39156

((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(leps_ID)==13")
55855

-- but the ratio is totally not 184-681!!!!!!!!!!!!!!!!!!!!!!!1111

root -l gstore_outdirs/v40/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v40_MC2016_Summer16_TTJets_powheg/*/0000/MC2016_Summer16_TTJets_powheg_1.root

11
13645
13
57593

???



------------------------ test ntupler on tauID_Dileptons together
must be no interference -- dilep scheme did not contribute any events to leps_ID 11, 13

v40

11 13
184
681

11*11 11*13 13*13

4
21
63

-- no interference!

v26 (RECOMPILE!)

518
663

29
65
63


--- there +20 muons now? more precise barrel-endcap relIso?
or just movement from el-mu to mu?


fixed electrons
507? (missing what?)
663

25
63
63


some electrons are missing..

dut to higher veto pt?
-    el_veto_kino_cuts_pt  = cms.double( 10.),
+    el_veto_kino_cuts_pt  = cms.double( 15.),

-- an old veto elecron is not considered at all

and lower muon veto pt:
-    mu_veto_kino_cuts_pt  = cms.double( 15.),
+    mu_veto_kino_cuts_pt  = cms.double( 10.),

-- it scratches elmu probably

test with old vetos

507
663

25
63
63

same????????


filters_noBadMuons
filters_duplicateMuons

maybe the filters work? -- they actually must tag events and not skip them

nothing works. hopefully it's ok, running as is





# new sumup draw

lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_TTJets_powheg.root

python sumup_ttree_draw.py "{draw_com}" --ttree ttree_out """ + "--histo-range {}".format(args.histo_range) + """ --cond-com "{selection}" --output {outdir}/test1_lep_pt_{dtag}_{chan}_{proc}_{sys}_{distr}.root  --histo-name {chan}/{proc}/{sys}/{chan}_{proc}_{sys}_{distr}  --save-weight {options} {dtag_file}

python sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super.root  --std-histos --histo-name mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight  lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_TTJets_powheg.root

python sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super.root  --std-histos --histo-name mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight  lstore_outdirs/v40/p1/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_1.root



python sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super.root  --std-histos --histo-name mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --per-weight --try-xsec --save-weight  lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_TTJets_powheg.root

-- per weight and xsecs (only lumi is left)
if do this then also THE TAU ID 0.95 and THE SYSTEMATIC NORM TO WEIGHT!



systematics

python sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super.root  --std-histos --histo-name mu_sel/std_procs/NOMINAL,obj,common/Mt_lep_met_f  --save-weight  lstore_outdirs/v40/p1/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_1.root



multiple channels

python sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super.root  --std-histos --histo-name mu_sel/std_procs/NOMINAL,obj,common/Mt_lep_met_f  --save-weight  lstore_outdirs/v40/p1/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_1.root


python sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super.root  --std-histos --histo-name all_std/std_procs/NOMINAL,obj,common/Mt_lep_met_f  --save-weight  lstore_outdirs/v40/p1/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_1.root



automatic el processes?

python sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super.root  --std-histos --histo-name mu_sel,el_sel/std_procs/NOMINAL,obj,common/Mt_lep_met_f  --save-weight  lstore_outdirs/v40/p1/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_1.root

-- ok
but too few el events?



test event yield in tt

python sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super.root  --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --per-weight --try-xsec --save-weight  lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_TTJets_powheg.root

-- in TT 64.7k mu sel (107)
  and 14.1k of el sel (117)

same difference in presel

and no vloose? -- yes, the cut is at Medium


w0jets

python sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super_nocut.root  --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --per-weight --try-xsec --save-weight              lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_WJets_madgraph.root &

python sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super_w0cut.root  --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --per-weight --try-xsec --save-weight --cut-w0jets lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_WJets_madgraph.root &










# number of jobs for control

ls gstore_outdirs/v40/SingleMuon/Ntupler_v40_Data13TeV_SingleMuon2016*/*/*/*root         | wc -l
471
ls gstore_outdirs/v40/SingleElectron/Ntupler_v40_Data13TeV_SingleElectron2016*/*/*/*root | wc -l
430

python genjobs.py v40 p1 --do-W-stitching channels_nom_sys_muon_sel_main --dtags data_mu,data_el,MC2016_Summer16_TTJets_powheg,MC2016_Summer16_WZTo3LNu_powheg --submit queue

make merge_proc dtags=merge-sets/jobs_hadd.dtags.small nt=v40 proc=p1 merge_dir=lstore_outdirs/merge-sets/









# final distrs run in v40

put it in the Makefile!

make distrs_data_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v40 p=p1  cond="selection_stage==107"  chan="mu_sel"    &
make distrs_data_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v40 p=p1  cond="selection_stage==106"  chan="mu_sel_ss" &
make distrs_data_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v40 p=p1  cond="(selection_stage==107 || selection_stage==105)"  chan="mu_selVloose"    &
make distrs_data_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v40 p=p1  cond="(selection_stage==106 || selection_stage==104)"  chan="mu_selVloose_ss" &

make distrs_data_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v40 p=p1 options="--el-procs" cond="selection_stage==117"  chan="el_sel"    dtag=SingleEle &
make distrs_data_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v40 p=p1 options="--el-procs" cond="selection_stage==116"  chan="el_sel_ss" dtag=SingleEle &
make distrs_data_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v40 p=p1 options="--el-procs" cond="(selection_stage==117 || selection_stage==115)"  chan="el_selVloose"    dtag=SingleEle &
make distrs_data_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v40 p=p1 options="--el-procs" cond="(selection_stage==116 || selection_stage==114)"  chan="el_selVloose_ss" dtag=SingleEle &


just in case just sel in nominal:

make distrs_usual_data_sel
make distrs_usual_nominal_sel


and these are lj and ljout:

make distrs_usual_data_sel    more=" && event_jets_lj_var >  60." suff="_ljout"
make distrs_usual_nominal_sel more=" && event_jets_lj_var >  60." suff="_ljout"

make distrs_usual_nominal_sel proc=distrs_mc_common_weights more=" && event_jets_lj_var >  60." suff="_ljout"
make distrs_usual_nominal_sel proc=distrs_mc_objects        more=" && event_jets_lj_var >  60." suff="_ljout"
make distrs_usual_nominal_sel proc=distrs_mc_tt_weights     more=" && event_jets_lj_var >  60." suff="_ljout"

make distrs_usual_nominal_sel proc=distrs_mc_tt_weights_scale  more=" && event_jets_lj_var >  60." suff="_ljout"
make distrs_usual_nominal_sel proc=distrs_mc_tt_weights_alphas more=" && event_jets_lj_var >  60." suff="_ljout"
make distrs_usual_nominal_sel proc=distrs_mc_tt_weights_pdf    more=" && event_jets_lj_var >  60." suff="_ljout"


make distrs_usual_data_sel    more=" && event_jets_lj_var >  60." suff="_lj"
make distrs_usual_nominal_sel more=" && event_jets_lj_var >  60." suff="_lj"

make distrs_usual_nominal_sel proc=distrs_mc_common_weights more=" && event_jets_lj_var >  60." suff="_lj"
make distrs_usual_nominal_sel proc=distrs_mc_objects        more=" && event_jets_lj_var >  60." suff="_lj"
make distrs_usual_nominal_sel proc=distrs_mc_tt_weights     more=" && event_jets_lj_var >  60." suff="_lj"

make distrs_usual_nominal_sel proc=distrs_mc_tt_weights_scale  more=" && event_jets_lj_var >  60." suff="_lj"
make distrs_usual_nominal_sel proc=distrs_mc_tt_weights_alphas more=" && event_jets_lj_var >  60." suff="_lj"
make distrs_usual_nominal_sel proc=distrs_mc_tt_weights_pdf    more=" && event_jets_lj_var >  60." suff="_lj"



leptons have this el/mu difference...

make distrs_mc_lep_weights   sysname=LEPmu p=p1 nt=v40                      cond="selection_stage==107 && event_jets_lj_var >  60." chan="mu_sel_ljout" &
make distrs_mc_lep_weights   sysname=LEPmu p=p1 nt=v40                      cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj"    &
make distrs_mc_lep_weights   sysname=LEPel p=p1 nt=v40 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
make distrs_mc_lep_weights   sysname=LEPel p=p1 nt=v40 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj"    &

make distrs_mc_lep_weights   sysname=LEPmu p=p1 nt=v40                      cond="selection_stage==106 && event_jets_lj_var >  60." chan="mu_sel_ljout_ss" &
make distrs_mc_lep_weights   sysname=LEPmu p=p1 nt=v40                      cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss"    &
make distrs_mc_lep_weights   sysname=LEPel p=p1 nt=v40 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
make distrs_mc_lep_weights   sysname=LEPel p=p1 nt=v40 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss"    &


make distrs_mc_lep_weights   sysname=LEPmu p=p1 nt=v40                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var >  60." chan="mu_selVloose_ljout" &
make distrs_mc_lep_weights   sysname=LEPmu p=p1 nt=v40                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj"    &
make distrs_mc_lep_weights   sysname=LEPel p=p1 nt=v40 options="--el-procs" cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
make distrs_mc_lep_weights   sysname=LEPel p=p1 nt=v40 options="--el-procs" cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj"    &

make distrs_mc_lep_weights   sysname=LEPmu p=p1 nt=v40                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var >  60." chan="mu_selVloose_ljout_ss" &
make distrs_mc_lep_weights   sysname=LEPmu p=p1 nt=v40                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss"    &
make distrs_mc_lep_weights   sysname=LEPel p=p1 nt=v40 options="--el-procs" cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
make distrs_mc_lep_weights   sysname=LEPel p=p1 nt=v40 options="--el-procs" cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss"    &








# test the free parameters in higgsCombine

lrwxrwxrwx 1 olek t3cms 53 Sep 10 10:56 ttxsec/fit-stuff/latest_datacard_mu.txt -> stage2_run3_test_mu_sel_ljs_updowns_rates_weights.txt

fit NLL and impacts

old datacard:

 POI: r= 0.942117 -> [0.5,1.5]


rm latest_datacard_mu.txt
ln -s stage2_run3_test_mu_sel_ljs_updowns_rates_weights_rateParam.txt latest_datacard_mu.txt


new with rateparams
 POI: r= 0.983215 -> [0.5,1.5]

very similar toy impacts, overall uncertainty a bit large, FSR a bit less asymetric


*fit to data shifted FSR to 2 sigmas up*......................!!!




fit to data in electron-tau

lrwxrwxrwx 1 olek t3cms 53 Sep 10 10:56 latest_datacard_el.txt -> stage2_run3_test_el_sel_ljs_updowns_rates_weights.txt

ln -s stage2_run3_test_el_sel_ljs_updowns_rates_weights_rateParam.txt latest_datacard_el.txt


 POI: r= 0.5048 -> [0.5,1.5]
????

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_el.root --algo grid --points 50 --rMin 0.7 --rMax 1.3 --name ElShapes2 --freezeParameters lumi_13TeV

 POI: r= 0.700004 -> [0.7,1.3]

remove the rateParams

tau_fakerate_tt rateParam el_sel_lj    tt_lj       1.0
tau_fakerate_tt rateParam el_sel_lj    tt_taulj    1.0
tau_fakerate_tt rateParam el_sel_lj    tt_other    1.0
tau_fakerate_tt rateParam el_sel_lj    dibosons    1.0
tau_fakerate_tt rateParam el_sel_lj    s_top_lj    1.0
tau_fakerate_tt rateParam el_sel_lj    s_top_other 1.0
tau_fakerate_tt rateParam el_sel_ljout tt_lj       1.0
tau_fakerate_tt rateParam el_sel_ljout tt_taulj    1.0
tau_fakerate_tt rateParam el_sel_ljout tt_other    1.0
tau_fakerate_tt rateParam el_sel_ljout dibosons    1.0
tau_fakerate_tt rateParam el_sel_ljout s_top_lj    1.0
tau_fakerate_tt rateParam el_sel_ljout s_top_other 1.0

tau_fakerate_wjets rateParam el_sel_lj    wjets_taul  1.0
tau_fakerate_wjets rateParam el_sel_lj    wjets_other 1.0
tau_fakerate_wjets rateParam el_sel_ljout wjets_taul  1.0
tau_fakerate_wjets rateParam el_sel_ljout wjets_other 1.0

tau_fakerate_qcd rateParam el_sel_lj    qcd  1.0
tau_fakerate_qcd rateParam el_sel_ljout qcd  1.0

tau group = tauID_eff tau_fakerate_tt tau_fakerate_wjets tau_fakerate_qcd

 POI: r= 1.01968 -> [0.7,1.3]


ok............. fakerates interfere with FSR?

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_el.root --algo grid --points 50 --rMin 0.7 --rMax 1.3 --name ElShapes2 --freezeParameters lumi_13TeV,FSR

 POI: r= 0.7001 -> [0.7,1.3]

then what???

add range 0.5-1.5

 POI: r= 1.01856 -> [0.7,1.3]

-- ok, like removing the rates

and with FSR:

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_el.root --algo grid --points 50 --rMin 0.7 --rMax 1.3 --name ElShapes2 --freezeParameters lumi_13TeV

 POI: r= 1.01914 -> [0.7,1.3]

toy impacts 1+-0.096


to data:
1.02 +- 0.102
and FSR is ok



mu fit with 0.5 range for free params (does it fix the FSR?)

0.95 +- 0.0688
and FSR is constrained and close to +1sigma







# QCD shape in OS and SS

time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=pQCDtest nt=v35                      cond="(selection_stage==107 || selection_stage==105 || selection_stage==103 || selection_stage== 7 || selection_stage== 5 || selection_stage== 3)"  chan="mu_presel" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=pQCDtest nt=v35                      cond="(selection_stage==106 || selection_stage==104 || selection_stage==102 || selection_stage== 6 || selection_stage== 4 || selection_stage== 2)"  chan="mu_presel_ss" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=pQCDtest nt=v35 options="--el-procs" cond="(selection_stage==117 || selection_stage==115 || selection_stage==113 || selection_stage==17 || selection_stage==15 || selection_stage==13)"  chan="el_presel" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=pQCDtest nt=v35 options="--el-procs" cond="(selection_stage==116 || selection_stage==114 || selection_stage==112 || selection_stage==16 || selection_stage==14 || selection_stage==12)"  chan="el_presel_ss" &


time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=pQCDtest nt=v35                      cond="(selection_stage_wjets== 7 )"  chan="mu_wjets" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=pQCDtest nt=v35                      cond="(selection_stage_wjets== 6 )"  chan="mu_wjets_ss" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=pQCDtest nt=v35 options="--el-procs" cond="(selection_stage_wjets==17 )"  chan="el_wjets" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=pQCDtest nt=v35 options="--el-procs" cond="(selection_stage_wjets==16 )"  chan="el_wjets_ss" &


foreach dtag ( MC2016_Summer16_QCD_EMEnriched_Pt-120to170 MC2016_Summer16_QCD_EMEnriched_Pt-170to300 MC2016_Summer16_QCD_EMEnriched_Pt-20to30 MC2016_Summer16_QCD_EMEnriched_Pt-300toInf MC2016_Summer16_QCD_EMEnriched_Pt-30to40 MC2016_Summer16_QCD_EMEnriched_Pt-30to50 MC2016_Summer16_QCD_EMEnriched_Pt-30toInf MC2016_Summer16_QCD_EMEnriched_Pt-40toInf MC2016_Summer16_QCD_EMEnriched_Pt-50to80 MC2016_Summer16_QCD_EMEnriched_Pt-80to120 MC2016_Summer16_QCD_HT-100-200 MC2016_Summer16_QCD_HT-1000-1500 MC2016_Summer16_QCD_HT-1500-2000 MC2016_Summer16_QCD_HT-200-300 MC2016_Summer16_QCD_HT-2000-Inf MC2016_Summer16_QCD_HT-300-500 MC2016_Summer16_QCD_HT-50-100 MC2016_Summer16_QCD_HT-500-700 MC2016_Summer16_QCD_HT-700-1000 MC2016_Summer16_QCD_MuEnriched_Pt15_20toInf MC2016_Summer16_QCD_MuEnriched_Pt5_1000toInf MC2016_Summer16_QCD_MuEnriched_Pt5_120to170 MC2016_Summer16_QCD_MuEnriched_Pt5_15to20 MC2016_Summer16_QCD_MuEnriched_Pt5_170to300 MC2016_Summer16_QCD_MuEnriched_Pt5_20to30 MC2016_Summer16_QCD_MuEnriched_Pt5_300to470 MC2016_Summer16_QCD_MuEnriched_Pt5_30to50 MC2016_Summer16_QCD_MuEnriched_Pt5_470to600 MC2016_Summer16_QCD_MuEnriched_Pt5_50to80 MC2016_Summer16_QCD_MuEnriched_Pt5_600to800 MC2016_Summer16_QCD_MuEnriched_Pt5_800to1000 MC2016_Summer16_QCD_MuEnriched_Pt5_80to120 )
hadd distrs/v35pQCDtest_hadds/$dtag.root distrs/v35pQCDtest/*$dtag*
end


hadd distrs_v35pQCDtest_QCD_HT.root v35pQCDtest/MC2016_Summer16_QCD_HT-*
hadd distrs_v35pQCDtest_QCD_EM.root v35pQCDtest/MC2016_Summer16_QCD_EMEnriched_Pt-*
hadd distrs_v35pQCDtest_QCD_Mu.root v35pQCDtest/MC2016_Summer16_QCD_MuEnriched_Pt*

TH1D* h_mu_presel    = (TH1D*) (mu_presel->Get("qcd/NOMINAL/mu_presel_qcd_NOMINAL_Mt_lep_met_f"))
TH1D* h_mu_presel_ss = (TH1D*) (mu_presel_ss->Get("qcd/NOMINAL/mu_presel_ss_qcd_NOMINAL_Mt_lep_met_f"))
TH1D* h_el_presel    = (TH1D*) (el_presel->Get("qcd/NOMINAL/el_presel_qcd_NOMINAL_Mt_lep_met_f"))
TH1D* h_el_presel_ss = (TH1D*) (el_presel_ss->Get("qcd/NOMINAL/el_presel_ss_qcd_NOMINAL_Mt_lep_met_f"))


TH1D* h_mu_wjets     = (TH1D*) (mu_wjets->Get("qcd/NOMINAL/mu_wjets_qcd_NOMINAL_Mt_lep_met_f"))
TH1D* h_mu_wjets_ss  = (TH1D*) (mu_wjets_ss->Get("qcd/NOMINAL/mu_wjets_ss_qcd_NOMINAL_Mt_lep_met_f"))
TH1D* h_el_wjets     = (TH1D*) (el_wjets->Get("qcd/NOMINAL/el_wjets_qcd_NOMINAL_Mt_lep_met_f"))
TH1D* h_el_wjets_ss  = (TH1D*) (el_wjets_ss->Get("qcd/NOMINAL/el_wjets_ss_qcd_NOMINAL_Mt_lep_met_f"))


h_mu_presel_ss ->SetLineColor(kRed)
h_el_presel_ss ->SetLineColor(kRed)
h_mu_wjets_ss  ->SetLineColor(kRed)
h_el_wjets_ss  ->SetLineColor(kRed)


h_mu_presel   ->SetXTitle("M_{T} (#mu, E^{miss}_{T}) [GeV]")
h_el_presel   ->SetXTitle("M_{T} (e,   E^{miss}_{T}) [GeV]")
h_mu_wjets    ->SetXTitle("M_{T} (#mu, E^{miss}_{T}) [GeV]")
h_el_wjets    ->SetXTitle("M_{T} (e,   E^{miss}_{T}) [GeV]")

h_mu_presel    ->Draw()
h_mu_presel_ss ->Draw("same")

h_el_presel    ->Draw()
h_el_presel_ss ->Draw("same")

h_mu_wjets     ->Draw()
h_mu_wjets_ss  ->Draw("same")

h_el_wjets     ->Draw()
h_el_wjets_ss  ->Draw("same")


leg = new TLegend(0.6,0.7, 0.9,0.9)
leg->AddEntry(h_mu_presel,    "Opposite Sign", "l")
leg->AddEntry(h_mu_presel_ss, "Same Sign",     "l")

gStyle->SetOptStat(0)

leg->Draw("same")

c1->SaveAs("mt_shapes_os_ss_mu_presel.png")
c1->SaveAs("mt_shapes_os_ss_el_presel.png")

c1->SaveAs("mt_shapes_os_ss_mu_wjets.png")
c1->SaveAs("mt_shapes_os_ss_el_wjets.png")







# hadds per output dir

foreach dtag (`ls lstore_outdirs/v40/u4test/`)
hadd lstore_outdirs/merge-sets/v40/u4test/$dtag.root lstore_outdirs/v40/u4test/$dtag/*.root &
end






# qcd shape cross check in MC

hadd:

foreach dtag (`ls lstore_outdirs/v35/pQCDtest/`)
hadd lstore_outdirs/merge-sets/v35/pQCDtest/$dtag.root lstore_outdirs/v35/pQCDtest/$dtag/*.root
end

time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v35 p=pQCDtest                      cond="selection_stage_wjets==7"  chan="wjets_mu"    &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v35 p=pQCDtest                      cond="selection_stage_wjets==6"  chan="wjets_mu_ss" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v35 p=pQCDtest options="--el-procs" cond="selection_stage_wjets==17" chan="wjets_el"    &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v35 p=pQCDtest options="--el-procs" cond="selection_stage_wjets==16" chan="wjets_el_ss" &


and presel (2-3 and 12-13 sel without 100):

time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v35 p=pQCDtest                      cond="(selection_stage==3  || selection_stage==5  || selection_stage==7  || selection_stage==107 || selection_stage==105 || selection_stage==103)"  chan="mu_sel"    &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v35 p=pQCDtest                      cond="(selection_stage==2  || selection_stage==4  || selection_stage==6  || selection_stage==106 || selection_stage==104 || selection_stage==102)"  chan="mu_sel_ss" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v35 p=pQCDtest options="--el-procs" cond="(selection_stage==13 || selection_stage==15 || selection_stage==17 || selection_stage==117 || selection_stage==115 || selection_stage==113)"  chan="el_sel"    &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v35 p=pQCDtest options="--el-procs" cond="(selection_stage==12 || selection_stage==14 || selection_stage==16 || selection_stage==116 || selection_stage==114 || selection_stage==112)"  chan="el_sel_ss" &







# NOMINAL dy tautau, selection problem and adding data and systematics

in distrs:
root [3] dy_tautau_sel->Get("tt_mutau/NOMINAL/dy_tautau_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_tautau_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 9818, Total sum= 0.102819
root [6] dy_tautau_sel->Get("tt_lj/NOMINAL/dy_tautau_sel_tt_lj_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_tautau_sel_tt_lj_NOMINAL_Mt_lep_met_f, Entries= 10977, Total sum= 0.114189

in merge:
root [3] ttree_out->Draw("event_leptons[0].pt()", "selection_stage_dy==102 || selection_stage_dy==103")
Info in <TCanvas::MakeDefCanvas>:  created default TCanvas with name c1
(Long64_t) 12610

-- and good distribution of gen_proc_id


--- forgot parenths in distr selection?
--> after the fix everything is better, but still too much WJets and also tt

--- I reran the selection without 3pi & SV Sign cut?
    check in ttrees the geom SV

ttree_out->Draw("event_taus_sv_sign[0]>>h(42, -1, 20)", "selection_stage_dy==102 || selection_stage_dy==103")

-- clear cut at 2.5

ttree_out->Draw("event_taus_sv_sign[0]>>h(40,-20,20)", "selection_stage_dy==102 || selection_stage_dy==103")
-- some taus at -11, i.e. don't have the SV refitted
   it was a run without .hasSecondaryVertex() ? and it somehow interfered

try quick test

-- made sumup_ttree_draw per-xsec-capable and nickname-capable

python sumup_ttree_draw.py "event_taus_sv_sign[0]" --ttree ttree_out --histo-range 42,-1,20 --cond-com "(selection_stage_dy==102 || selection_stage_dy==103)"   --per-weight --try-xsec --std-histo-name geom_tau_sv_sign  --save-weight --histo-name "dy_tautau_sel/dy_all/NOMINAL/dy_tautau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/u2/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_all.root lstore_outdirs/merge-sets/v40/u2/MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root



with only madgraph wjets

foreach dtag ( MC2016_Summer16_WWTo2L2Nu_powheg MC2016_Summer16_WWToLNuQQ_powheg MC2016_Summer16_WZTo1L1Nu2Q_amcatnlo_madspin MC2016_Summer16_WZTo1L3Nu_amcatnlo_madspin MC2016_Summer16_WZTo2L2Q_amcatnlo_madspin MC2016_Summer16_WZTo3LNu_powheg MC2016_Summer16_ZZTo2L2Nu_powheg MC2016_Summer16_ZZTo2L2Q_amcatnlo_madspin MC2016_Summer16_schannel_4FS_leptonicDecays_amcatnlo MC2016_Summer16_tchannel_antitop_4f_leptonicDecays_powheg MC2016_Summer16_tchannel_top_4f_leptonicDecays_powheg MC2016_Summer16_DYJetsToLL_10to50_amcatnlo MC2016_Summer16_DYJetsToLL_50toInf_madgraph MC2016_Summer16_SingleT_tW_5FS_powheg MC2016_Summer16_SingleTbar_tW_5FS_powheg MC2016_Summer16_WJets_madgraph MC2016_Summer16_TTJets_powheg )
python sumup_ttree_draw.py "event_taus_sv_sign[0]" --ttree ttree_out --histo-range 42,-1,20 --cond-com "(selection_stage_dy==102 || selection_stage_dy==103)"   --per-weight --try-xsec --std-histo-name geom_tau_sv_sign  --save-weight --histo-name "dy_tautau_sel/dy_all/NOMINAL/dy_tautau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/u2/$dtag.root lstore_outdirs/merge-sets/v40/u2/$dtag.root
end

hadd quick-test/foobar_v40u2.root quick-test/v40/u2/MC*root

python stack_quick.py quick-test/foobar_v40u2.root --chan dy_tautau_sel --sys NOMINAL --distr geom_tau_sv_sign --stack ttbar,wjets,dibosons,single_top,dy --debug test_f.root --scale-stack 35800

-- wjets have significant tail.............................................................



## quick test on inputs

old quick test:

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40."   --per-weight --scale 5765.4   --save-weight --histo-name "dy_mutau_sel/dy_all/NOMINAL/dy_mutau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_all.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &

foreach dtag ( MC2016_Summer16_WWTo2L2Nu_powheg MC2016_Summer16_WWToLNuQQ_powheg MC2016_Summer16_WZTo1L1Nu2Q_amcatnlo_madspin MC2016_Summer16_WZTo1L3Nu_amcatnlo_madspin MC2016_Summer16_WZTo2L2Q_amcatnlo_madspin MC2016_Summer16_WZTo3LNu_powheg MC2016_Summer16_ZZTo2L2Nu_powheg MC2016_Summer16_ZZTo2L2Q_amcatnlo_madspin MC2016_Summer16_schannel_4FS_leptonicDecays_amcatnlo MC2016_Summer16_tchannel_antitop_4f_leptonicDecays_powheg MC2016_Summer16_tchannel_top_4f_leptonicDecays_powheg MC2016_Summer16_DYJetsToLL_10to50_amcatnlo MC2016_Summer16_DYJetsToLL_50toInf_madgraph MC2016_Summer16_SingleT_tW_5FS_powheg MC2016_Summer16_SingleTbar_tW_5FS_powheg MC2016_Summer16_WJets_madgraph MC2016_Summer16_TTJets_powheg )
python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 42,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 21 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"   --per-weight --try-xsec --std-histo-name geom_tau_sv_sign  --save-weight --histo-name "dy_tautau_sel/dy_all/NOMINAL/dy_tautau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/u2_inputs/$dtag.root gstore_outdirs/v40/*/Ntupler_v40_$dtag/*/*/MC*root
end

hadd quick-test/foobar_v40u2_inputs.root quick-test/v40/u2_inputs/MC*root

python stack_quick.py quick-test/foobar_v40u2_inputs.root --chan dy_tautau_sel --sys NOMINAL --distr geom_tau_sv_sign --stack ttbar,wjets,dibosons,single_top,dy --debug test_f_inputs.root --scale-stack 35800

INFO:root:import ROOT
DEBUG:root:dy_tautau_sel/ttbar/NOMINAL/dy_tautau_sel_ttbar_NOMINAL_geom_tau_sv_sign
DEBUG:root:ttbar 4801.91458273
DEBUG:root:dy_tautau_sel/wjets/NOMINAL/dy_tautau_sel_wjets_NOMINAL_geom_tau_sv_sign
DEBUG:root:wjets 79165.7116547
DEBUG:root:dy_tautau_sel/dibosons/NOMINAL/dy_tautau_sel_dibosons_NOMINAL_geom_tau_sv_sign
DEBUG:root:dibosons 2399.22657406
DEBUG:root:dy_tautau_sel/single_top/NOMINAL/dy_tautau_sel_single_top_NOMINAL_geom_tau_sv_sign
DEBUG:root:single_top 1381.56985289
DEBUG:root:dy_tautau_sel/dy/NOMINAL/dy_tautau_sel_dy_NOMINAL_geom_tau_sv_sign
DEBUG:root:dy 52192.7615089

-- noticeable tail in wjets
-- is it the same as in v40u2 stage2 output?

try with Mt40

foreach dtag ( MC2016_Summer16_WWTo2L2Nu_powheg MC2016_Summer16_WWToLNuQQ_powheg MC2016_Summer16_WZTo1L1Nu2Q_amcatnlo_madspin MC2016_Summer16_WZTo1L3Nu_amcatnlo_madspin MC2016_Summer16_WZTo2L2Q_amcatnlo_madspin MC2016_Summer16_WZTo3LNu_powheg MC2016_Summer16_ZZTo2L2Nu_powheg MC2016_Summer16_ZZTo2L2Q_amcatnlo_madspin MC2016_Summer16_schannel_4FS_leptonicDecays_amcatnlo MC2016_Summer16_tchannel_antitop_4f_leptonicDecays_powheg MC2016_Summer16_tchannel_top_4f_leptonicDecays_powheg MC2016_Summer16_DYJetsToLL_10to50_amcatnlo MC2016_Summer16_DYJetsToLL_50toInf_madgraph MC2016_Summer16_SingleT_tW_5FS_powheg MC2016_Summer16_SingleTbar_tW_5FS_powheg MC2016_Summer16_WJets_madgraph MC2016_Summer16_TTJets_powheg )
python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 42,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 21 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40."   --per-weight --try-xsec --std-histo-name geom_tau_sv_sign  --save-weight --histo-name "dy_tautau_sel/dy_all/NOMINAL/dy_tautau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/u2_inputs_Mt40/$dtag.root gstore_outdirs/v40/*/Ntupler_v40_$dtag/*/*/MC*root &
end

hadd quick-test/foobar_v40u2_inputs_Mt40.root quick-test/v40/u2_inputs_Mt40/MC*root

python stack_quick.py quick-test/foobar_v40u2_inputs_Mt40.root --chan dy_tautau_sel --sys NOMINAL --distr geom_tau_sv_sign --stack ttbar,wjets,dibosons,single_top,dy --debug test_f_inputs_Mt40.root --scale-stack 35800

DEBUG:root:dy_tautau_sel/ttbar/NOMINAL/dy_tautau_sel_ttbar_NOMINAL_geom_tau_sv_sign
DEBUG:root:ttbar 1007.68226349
DEBUG:root:dy_tautau_sel/wjets/NOMINAL/dy_tautau_sel_wjets_NOMINAL_geom_tau_sv_sign
DEBUG:root:wjets 15209.1757812
DEBUG:root:dy_tautau_sel/dibosons/NOMINAL/dy_tautau_sel_dibosons_NOMINAL_geom_tau_sv_sign
DEBUG:root:dibosons 547.442466587
DEBUG:root:dy_tautau_sel/single_top/NOMINAL/dy_tautau_sel_single_top_NOMINAL_geom_tau_sv_sign
DEBUG:root:single_top 277.260660708
DEBUG:root:dy_tautau_sel/dy/NOMINAL/dy_tautau_sel_dy_NOMINAL_geom_tau_sv_sign
DEBUG:root:dy 34797.0296421

-- negligible after 2.5-3 SV Sign

comparing to stage2 output they look completely different: the tail in the stage2 is unreasonable
(a kind of problem which could propagate unnoticed to tt too)

are yields similar?

root [6] dy_tautau_sel->Get("dy/NOMINAL/dy_tautau_sel_dy_NOMINAL_geom_tau_sv_sign")->Print()
TH1.Print Name  = dy_tautau_sel_dy_NOMINAL_geom_tau_sv_sign, Entries= 8197, Total sum= 0.971984
root [7] dy_tautau_sel->Get("ttbar/NOMINAL/dy_tautau_sel_ttbar_NOMINAL_geom_tau_sv_sign")->Print()
TH1.Print Name  = dy_tautau_sel_ttbar_NOMINAL_geom_tau_sv_sign, Entries= 2724, Total sum= 0.0281475
root [8] dy_tautau_sel->Get("wjets/NOMINAL/dy_tautau_sel_wjets_NOMINAL_geom_tau_sv_sign")->Print()
TH1.Print Name  = dy_tautau_sel_wjets_NOMINAL_geom_tau_sv_sign, Entries= 237, Total sum= 0.424837

in stage2 processing:

root [4] dy_tautau_sel->Get("dy/NOMINAL/dy_tautau_sel_dy_NOMINAL_geom_tau_sv_sign")->Print()
TH1.Print Name  = dy_tautau_sel_dy_NOMINAL_geom_tau_sv_sign, Entries= 22311, Total sum= 0.487645
root [5] dy_tautau_sel->Get("ttbar/NOMINAL/dy_tautau_sel_ttbar_NOMINAL_geom_tau_sv_sign")->Print()
TH1.Print Name  = dy_tautau_sel_ttbar_NOMINAL_geom_tau_sv_sign, Entries= 12610, Total sum= 0.115728
root [3] dy_tautau_sel->Get("wjets/NOMINAL/dy_tautau_sel_wjets_NOMINAL_geom_tau_sv_sign")->Print()
TH1.Print Name  = dy_tautau_sel_wjets_NOMINAL_geom_tau_sv_sign, Entries= 1017, Total sum= 0.529739

-- what's with total sums?

tau ID cut was vloose


statement of the problem:
* test_f.root is made of stage2 output
  and it has the problem
* test_f_inputs.root and test_f_inputs_Mt40.root
  is from inputs (gstore ntuples)
  and it's fine






## repeate quick test in dy only

(then in tt)

without Mt cut now

don't cut on SV Sign, but save it in ttree

info on differences with quick test:

* 0 bjets, not matched to tau
* stage2 checks dR match quality of tau SV refit
* correct (geom) SV Sign is saved
* tau pt cut 21GeV

quick test was done on all DY, including ext
ls gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/*/MC*root




## re-stage2 in v40 u4test, re-quick-test

make merge_proc dtags=merge-sets/jobs_hadd.dtags.large_aa nt=v40 proc=u4test merge_dir=lstore_outdirs/merge-sets/
make merge_proc dtags=merge-sets/jobs_hadd.dtags.large_ab nt=v40 proc=u4test merge_dir=lstore_outdirs/merge-sets/
hadd lstore_outdirs/merge-sets/v40/u4test/MC2016_Summer16_TTJets_powheg.root lstore_outdirs/v40/u4test/MC2016_Summer16_TTJets_powheg/*.root
hadd lstore_outdirs/merge-sets/v40/u4test/MC2016_Summer16_WJets_madgraph.root lstore_outdirs/v40/u4test/MC2016_Summer16_WJets_madgraph/*.root


foreach dtag ( MC2016_Summer16_WWTo2L2Nu_powheg MC2016_Summer16_WWToLNuQQ_powheg MC2016_Summer16_WZTo1L1Nu2Q_amcatnlo_madspin MC2016_Summer16_WZTo1L3Nu_amcatnlo_madspin MC2016_Summer16_WZTo2L2Q_amcatnlo_madspin MC2016_Summer16_WZTo3LNu_powheg MC2016_Summer16_ZZTo2L2Nu_powheg MC2016_Summer16_ZZTo2L2Q_amcatnlo_madspin MC2016_Summer16_schannel_4FS_leptonicDecays_amcatnlo MC2016_Summer16_tchannel_antitop_4f_leptonicDecays_powheg MC2016_Summer16_tchannel_top_4f_leptonicDecays_powheg MC2016_Summer16_DYJetsToLL_10to50_amcatnlo MC2016_Summer16_DYJetsToLL_50toInf_madgraph MC2016_Summer16_SingleT_tW_5FS_powheg MC2016_Summer16_SingleTbar_tW_5FS_powheg MC2016_Summer16_WJets_madgraph MC2016_Summer16_TTJets_powheg )

foreach dtag ( MC2016_Summer16_DYJetsToLL_50toInf_madgraph MC2016_Summer16_WJets_madgraph MC2016_Summer16_TTJets_powheg )
python sumup_ttree_draw.py "event_taus_sv_sign[0]" --ttree ttree_out --histo-range 42,-1,20 --cond-com "(selection_stage_dy==102 || selection_stage_dy==103)"   --per-weight --try-xsec --std-histo-name geom_tau_sv_sign  --save-weight --histo-name "dy_tautau_sel/dy_all/NOMINAL/dy_tautau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/u4test/$dtag.root lstore_outdirs/merge-sets/v40/u4test/$dtag.root
end

hadd quick-test/foobar_v40u4test.root quick-test/v40/u4test/MC*root

python stack_quick.py quick-test/foobar_v40u4test.root --chan dy_tautau_sel --sys NOMINAL --distr geom_tau_sv_sign --stack ttbar,wjets,dibosons,single_top,dy --debug quick-test/test_f_v40u4test.root --scale-stack 35800

kind of ok
a little too much wjets in the tail
very similar to the quick on all inputs (without Mt cut)


foreach dtag ( MC2016_Summer16_DYJetsToLL_50toInf_madgraph MC2016_Summer16_WJets_madgraph MC2016_Summer16_TTJets_powheg )
python sumup_ttree_draw.py "event_taus_sv_sign[0]" --ttree ttree_out --histo-range 42,-1,20 --cond-com "((selection_stage_dy==102 || selection_stage_dy==103) && event_met_lep_mt < 40.)"   --per-weight --try-xsec --std-histo-name geom_tau_sv_sign  --save-weight --histo-name "dy_tautau_sel/dy_all/NOMINAL/dy_tautau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/u4test_Mt40/$dtag.root lstore_outdirs/merge-sets/v40/u4test/$dtag.root
end

hadd quick-test/foobar_v40u4test_Mt40.root quick-test/v40/u4test_Mt40/MC*root

python stack_quick.py quick-test/foobar_v40u4test_Mt40.root --chan dy_tautau_sel --sys NOMINAL --distr geom_tau_sv_sign --stack ttbar,wjets,dibosons,single_top,dy --debug quick-test/test_f_v40u4test_Mt40.root --scale-stack 35800

kind of too much wjets?
-- the same amount of wjets in the tail!
   Mt did not work?

in DY  Mt = 0 or rarely -87.
WJets  Mt = 0
TTJets Mt = 0


--- after the mt fix it's perfect!






# NOMINAL distrs for double ratio test 2

hadd lstore_outdirs/merge-sets/v40/u2/MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root lstore_outdirs/v40/u2/*/*root

root [2] ttree_out->Draw("event_taus_sv_sign[0]>>h(21,-1,20)", "selection_stage_dy>100")
(Long64_t) 15737

hadd lstore_outdirs/merge-sets/v40/u2/MC2016_Summer16_TTJets_powheg.root lstore_outdirs/v40/u2/MC2016_Summer16_TTJets_powheg/*root


ttree_out->Draw("selection_stage_dy", "selection_stage_dy>100")
ttree_out->Draw("event_taus_sv_sign[0]>>h(21,-1,20)", "selection_stage_dy>100")

ttree_out->Draw("selection_stage",    "selection_stage==107")
ttree_out->Draw("selection_stage_em", "selection_stage_em==205")
ttree_out->Draw("selection_stage_dy", "selection_stage_dy==102 || selection_stage_dy==103")
ttree_out->Draw("selection_stage_dy_mumu", "selection_stage_dy_mumu==102 || selection_stage_dy_mumu==103")

dy
root [1] ttree_out->Draw("selection_stage",    "selection_stage==107")
Info in <TCanvas::MakeDefCanvas>:  created default TCanvas with name c1
(Long64_t) 67
root [2] ttree_out->Draw("selection_stage_em", "selection_stage_em==205")
(Long64_t) 26
root [3] ttree_out->Draw("selection_stage_dy", "selection_stage_dy==102 || selection_stage_dy==103")
(Long64_t) 13417
root [4] ttree_out->Draw("selection_stage_dy_mumu", "selection_stage_dy_mumu==102 || selection_stage_dy_mumu==103")
(Long64_t) 12138782


ttbar
root [3] ttree_out->Draw("selection_stage",    "selection_stage==107")
Info in <TCanvas::MakeDefCanvas>:  created default TCanvas with name c1
(Long64_t) 9244
root [4] ttree_out->Draw("selection_stage_em", "selection_stage_em==205")
(Long64_t) 86794
root [5] ttree_out->Draw("selection_stage_dy", "selection_stage_dy==102 || selection_stage_dy==103")
(Long64_t) 12610
root [6] ttree_out->Draw("selection_stage_dy_mumu", "selection_stage_dy_mumu==102 || selection_stage_dy_mumu==103")
(Long64_t) 87954

-- weird (maybe just the 2.5 SV Sign taus)

also forgot Mt < 40 !!!!!!!!!!!!!!!!!!!
-- will see if backgrounds are dead in SV Sign




time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="selection_stage==107"  chan="mu_sel" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="selection_stage==106"  chan="mu_sel_ss" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40 options="--el-procs" cond="selection_stage==117"  chan="el_sel" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40 options="--el-procs" cond="selection_stage==116"  chan="el_sel_ss" &


time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="(selection_stage==107 || selection_stage==105)"  chan="mu_selVloose" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="(selection_stage==106 || selection_stage==104)"  chan="mu_selVloose_ss" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40 options="--el-procs" cond="(selection_stage==117 || selection_stage==115)"  chan="el_selVloose" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40 options="--el-procs" cond="(selection_stage==116 || selection_stage==114)"  chan="el_selVloose_ss" &


time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="selection_stage_em==205"  chan="elmu_sel" &

time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="(selection_stage_dy==102 || selection_stage_dy==103)"  chan="dy_tautau_sel" &

time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="(selection_stage_dy_mumu==102 || selection_stage_dy_mumu==103)"  chan="dy_mumu_sel" &


foreach d ( `cat all-dtags` )
hadd distrs/v40u2_hadds/$d.root distrs/v40u2/*$d*root &
end



python stack_plot.py mc_norm/distrs_v40u2_mc_1.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root -p -r -o plots/v40u2/ --lumi 35800 -c mu_sel -d Mt_lep_met_f --skip-QCD --no-data --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events/1GeV" --title ""

-- 50-70-90(max) events in bins, 478 events in MC overall
   too few events per bin???
   also: same ratio with fakes, a bin with WJets


python stack_plot.py mc_norm/distrs_v40u2_mc_1.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root -p -r -o plots/v40u2/ --lumi 35800 -c dy_tautau_sel -d Mt_lep_met_f --skip-QCD --no-data --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events/1GeV" --title ""
python stack_plot.py mc_norm/distrs_v40u2_mc_1.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root -p -r -o plots/v40u2/ --lumi 35800 -c dy_mumu_sel   -d Mt_lep_met_f --skip-QCD --no-data --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events/1GeV" --title ""



time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="selection_stage==107"  chan="mu_sel" dtag=TTJet &

hadd foobar1.root v40u1/1/*TT*heg_mu_sel_tt* &
hadd foobar2.root v40u2/1/*TT*heg_mu_sel_tt* &


---- typo with u1 instead of u2!!!

missing W1Jets
hadd lstore_outdirs/merge-sets//v40/u2/MC2016_Summer16_W1Jets_madgraph.root lstore_outdirs/v40/u2/MC2016_Summer16_W1Jets_madgraph/*root

time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="selection_stage==107"  chan="mu_sel"    dtag=W1Jet &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="selection_stage==106"  chan="mu_sel_ss" dtag=W1Jet &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40 options="--el-procs" cond="selection_stage==117"  chan="el_sel"    dtag=W1Jet &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40 options="--el-procs" cond="selection_stage==116"  chan="el_sel_ss" dtag=W1Jet &


time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="(selection_stage==107 || selection_stage==105)"  chan="mu_selVloose"    dtag=W1Jet &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="(selection_stage==106 || selection_stage==104)"  chan="mu_selVloose_ss" dtag=W1Jet &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40 options="--el-procs" cond="(selection_stage==117 || selection_stage==115)"  chan="el_selVloose"    dtag=W1Jet &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40 options="--el-procs" cond="(selection_stage==116 || selection_stage==114)"  chan="el_selVloose_ss" dtag=W1Jet &


time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="selection_stage_em==205"  chan="elmu_sel"  dtag=W1Jet &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="selection_stage_dy==102 || selection_stage_dy==103"  chan="dy_tautau_sel" dtag=W1Jet &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="selection_stage_dy_mumu==102 || selection_stage_dy_mumu==103"  chan="dy_mumu_sel" dtag=W1Jet &


python stack_plot.py mc_norm/distrs_v40u2_mc_2.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root -p -r -o plots/v40u2/2/ --lumi 35800 -c mu_sel -d Mt_lep_met_f --skip-QCD --no-data --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events" --title ""

3300 events overall

python stack_plot.py mc_norm/distrs_v40u2_mc_2.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root -p -r -o plots/v40u2/2/ --lumi 35800 -c mu_sel_ss     -d Mt_lep_met_f --skip-QCD --no-data --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events" --title ""

788.719281
practically pure tt and st, some wjets
need data to check for qcd


python stack_plot.py mc_norm/distrs_v40u2_mc_2.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root -p -r -o plots/v40u2/2/ --lumi 35800 -c elmu_sel      -d Mt_lep_met_f --skip-QCD --no-data --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events" --title ""

30711.964286
pure tt->other and s-top->other

python stack_plot.py mc_norm/distrs_v40u2_mc_2.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root -p -r -o plots/v40u2/2/ --lumi 35800 -c dy_mumu_sel   -d Mt_lep_met_f --skip-QCD --no-data --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events" --title ""

16358095.808810
pure DY,
tautau is probably mumu
--> after DY fix:
15497337.752776
and pure DY->mumu

python stack_plot.py mc_norm/distrs_v40u2_mc_2.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root -p -r -o plots/v40u2/2/ --lumi 35800 -c dy_tautau_sel -d Mt_lep_met_f --skip-QCD --no-data --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events" --title ""

116706.923147
-- PROBLEM, it's a rainbow with WJets, tt and DY->other
--> after DY fix:
51568.708471
negligible DY->mumu, but noticeable tt and wjets (with correct contributions from different processes)
including below Mt<40 about third of events is wjets -- where it's not expected, another PROBLEM



1. why DY->other?
2. why wjets? just need Mt<40? how much does it cut?
   --- it won't cut all wjets, like a third of all events will be wjets,
       which is not expected from SV Sign 2.5
3. why each tt process contributes the same amount? and they have the same Mt shape??
   --- checked for mutau and lj, indeed the same shape
       and yields 9800 mutau, 11000 lj

useful distrs:
tau pt
SV Sign




## old results

bin 2-3 -- 350-380 events
    3-4 -- 250
    4-5 -- 150-180




## quick test

dy:

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40."   --per-weight --scale 5765.4   --save-weight --histo-name "dy_mutau_sel/dy_all/NOMINAL/dy_mutau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_all.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &

tt:

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 0 && lep_id[0]*tau_id[0] < 0"   --per-weight --scale 831.4   --save-weight --histo-name "mu_sel/tt/NOMINAL/mu_sel_tt_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_TTJets_powheg.root gstore_outdirs/v40/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v40_MC2016_Summer16_TTJets_powheg/181009_141741/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 1 && lep_id[0]*tau_id[0] < 0"   --per-weight --scale 831.4   --save-weight --histo-name "mu_sel_2b/tt/NOMINAL/mu_sel_2b_tt_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_TTJets_powheg_nbjets2.root gstore_outdirs/v40/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v40_MC2016_Summer16_TTJets_powheg/181009_141741/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 2.5 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 0 && lep_id[0]*tau_id[0] < 0"   --per-weight --scale 831.4   --save-weight --histo-name "mu_sel_2sv5/tt/NOMINAL/mu_sel_2sv5_tt_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_TTJets_powheg_2sv5.root gstore_outdirs/v40/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v40_MC2016_Summer16_TTJets_powheg/181009_141741/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 2.5 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 1 && lep_id[0]*tau_id[0] < 0"   --per-weight --scale 831.4   --save-weight --histo-name "mu_sel_2sv5_2b/tt/NOMINAL/mu_sel_2sv5_2b_tt_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_TTJets_powheg_2sv5_2b.root gstore_outdirs/v40/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v40_MC2016_Summer16_TTJets_powheg/181009_141741/0000/*root &


h = (TH1D*) mu_sel->Get("tt/NOMINAL/mu_sel_tt_NOMINAL_geom_tau_sv_sign")
h->Scale(35800)
h->Print()
TH1.Print Name  = mu_sel_tt_NOMINAL_geom_tau_sv_sign, Entries= 44147, Total sum= 16165


h = (TH1D*) mu_sel_2b->Get("tt/NOMINAL/mu_sel_2b_tt_NOMINAL_geom_tau_sv_sign")
TH1.Print Name  = mu_sel_2b_tt_NOMINAL_geom_tau_sv_sign, Entries= 32778, Total sum= 11945.7

h = (TH1D*) mu_sel_2sv5->Get("tt/NOMINAL/mu_sel_2sv5_tt_NOMINAL_geom_tau_sv_sign")
TH1.Print Name  = mu_sel_2sv5_tt_NOMINAL_geom_tau_sv_sign, Entries= 13670, Total sum= 4582.09

h = (TH1D*) mu_sel_2sv5_2b->Get("tt/NOMINAL/mu_sel_2sv5_2b_tt_NOMINAL_geom_tau_sv_sign")
TH1.Print Name  = mu_sel_2sv5_2b_tt_NOMINAL_geom_tau_sv_sign, Entries= 11366, Total sum= 3808.2



quick test on taus without 3pi

python sumup_ttree_draw.py "tau_p4[0].pt()" --histo-range 21,0,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 0 && lep_id[0]*tau_id[0] < 0"   --per-weight --scale 831.4   --save-weight --histo-name "mu_sel/tt/NOMINAL/mu_sel_tt_NOMINAL_tau_pt" --output quick-test/v40/MC2016_Summer16_TTJets_powheg_tau_pt.root gstore_outdirs/v40/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v40_MC2016_Summer16_TTJets_powheg/181009_141741/0000/*root &


time python channel_distrs_full_loop.py --do-W-stitching -l logss temp/ channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v40/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v40_MC2016_Summer16_TTJets_powheg/181009_141741/0000/MC2016_Summer16_TTJets_powheg_33.root







# NOMINAL distrs for TT/DY double ratio

make merge_proc dtags=merge-sets/jobs_hadd.dtags.small    nt=v40 proc=u1
make merge_proc dtags=merge-sets/jobs_hadd.dtags.large_aa nt=v40 proc=u1
make merge_proc dtags=merge-sets/jobs_hadd.dtags.large_ab nt=v40 proc=u1

tt lep-tau (with VLoose too)

time make distrs_mc_nominal p=u1 nt=v40                      cond="selection_stage==107"  chan="mu_sel" &
time make distrs_mc_nominal p=u1 nt=v40                      cond="selection_stage==106"  chan="mu_sel_ss" &
time make distrs_mc_nominal p=u1 nt=v40 options="--el-procs" cond="selection_stage==117"  chan="el_sel" &
time make distrs_mc_nominal p=u1 nt=v40 options="--el-procs" cond="selection_stage==116"  chan="el_sel_ss" &


time make distrs_mc_nominal p=u1 nt=v40                      cond="(selection_stage==107 || selection_stage==105)"  chan="mu_selVloose" &
time make distrs_mc_nominal p=u1 nt=v40                      cond="(selection_stage==106 || selection_stage==104)"  chan="mu_selVloose_ss" &
time make distrs_mc_nominal p=u1 nt=v40 options="--el-procs" cond="(selection_stage==117 || selection_stage==115)"  chan="el_selVloose" &
time make distrs_mc_nominal p=u1 nt=v40 options="--el-procs" cond="(selection_stage==116 || selection_stage==114)"  chan="el_selVloose_ss" &


tt elmu
time make distrs_mc_nominal p=u1 nt=v40                      cond="selection_stage_em==205"  chan="elmu_sel" &

dy tautau
time make distrs_mc_nominal p=u1 nt=v40                      cond="selection_stage_dy==102 || selection_stage_dy==103"  chan="dy_tautau_sel" &

dy mumu (mu hlt, no mass requirement)
time make distrs_mc_nominal p=u1 nt=v40                      cond="selection_stage_dy_mumu==102 || selection_stage_dy_mumu==103"  chan="dy_mumu_sel" &



tests:

python selections.py  --out-dir distrs/  "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage_dy==102" --distr Mt_lep_met_f --chan dy_tautau_sel --custom-range 0,20,40,60,80,100,130,160,200,250 --weight event_weight merge-sets/v40/u1/*MC*.root

python sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "event_weight * (selection_stage_dy==102 && !(gen_proc_id == 1))" --output distrs//test1_lep_pt_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_dy_tautau_sel_dy_other_NOMINAL_Mt_lep_met_f.root  --histo-name dy_tautau_sel/dy_other/NOMINAL/dy_tautau_sel_dy_other_NOMINAL_Mt_lep_met_f  --save-weight --per-weight merge-sets/v40/u1/MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root


-- turned off the recoils


foreach d ( `cat all-dtags` )
hadd distrs/v40u1_hadd/$d.root distrs/v40u1/*$d*root &
end

test TT and DY yields in channels, relative to each other

mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
elmu_sel->Get("tt_mutau/NOMINAL/elmu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
dy_mumu_sel->Get("tt_mutau/NOMINAL/dy_mumu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
dy_tautau_sel->Get("tt_mutau/NOMINAL/dy_tautau_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()

root [4] mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 5929, Total sum= 7.05533e-05
root [5] elmu_sel->Get("tt_mutau/NOMINAL/elmu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = elmu_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 61, Total sum= 5.98596e-07
root [6] dy_mumu_sel->Get("tt_mutau/NOMINAL/dy_mumu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_mumu_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 0, Total sum= 0
root [7] dy_tautau_sel->Get("tt_mutau/NOMINAL/dy_tautau_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_tautau_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 2934, Total sum= 3.73507e-05

-- wrong processes in elmu and mumu

mu_sel->Get("dy_other/NOMINAL/mu_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
elmu_sel->Get("dy_other/NOMINAL/elmu_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
dy_mumu_sel->Get("dy_other/NOMINAL/dy_mumu_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
dy_tautau_sel->Get("dy_other/NOMINAL/dy_tautau_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()

root [2] mu_sel->Get("dy_other/NOMINAL/mu_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_dy_other_NOMINAL_Mt_lep_met_f, Entries= 1, Total sum= 6.70175e-09
root [3] elmu_sel->Get("dy_other/NOMINAL/elmu_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = elmu_sel_dy_other_NOMINAL_Mt_lep_met_f, Entries= 1, Total sum= 7.12112e-09
root [4] dy_mumu_sel->Get("dy_other/NOMINAL/dy_mumu_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_mumu_sel_dy_other_NOMINAL_Mt_lep_met_f, Entries= 0, Total sum= 0
root [5] dy_tautau_sel->Get("dy_other/NOMINAL/dy_tautau_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_tautau_sel_dy_other_NOMINAL_Mt_lep_met_f, Entries= 428, Total sum= 2.78714e-06


mu_sel->Get("dy_tautau/NOMINAL/mu_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
elmu_sel->Get("dy_tautau/NOMINAL/elmu_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
dy_mumu_sel->Get("dy_tautau/NOMINAL/dy_mumu_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
dy_tautau_sel->Get("dy_tautau/NOMINAL/dy_tautau_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()

root [6] mu_sel->Get("dy_tautau/NOMINAL/mu_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_dy_tautau_NOMINAL_Mt_lep_met_f, Entries= 64, Total sum= 4.35527e-07
root [7] elmu_sel->Get("dy_tautau/NOMINAL/elmu_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = elmu_sel_dy_tautau_NOMINAL_Mt_lep_met_f, Entries= 23, Total sum= 1.56526e-07
root [8] dy_mumu_sel->Get("dy_tautau/NOMINAL/dy_mumu_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_mumu_sel_dy_tautau_NOMINAL_Mt_lep_met_f, Entries= 0, Total sum= 0
root [9] dy_tautau_sel->Get("dy_tautau/NOMINAL/dy_tautau_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_tautau_sel_dy_tautau_NOMINAL_Mt_lep_met_f, Entries= 10374, Total sum= 6.87678e-05

-- all 0 in dy_mumu
all 0 in ttree_out




-- fixed mumu and redone

root [1] mu_sel->Get("dy_other/NOMINAL/mu_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_dy_other_NOMINAL_Mt_lep_met_f, Entries= 0, Total sum= 0
root [2] elmu_sel->Get("dy_other/NOMINAL/elmu_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = elmu_sel_dy_other_NOMINAL_Mt_lep_met_f, Entries= 0, Total sum= 0
root [3] dy_mumu_sel->Get("dy_other/NOMINAL/dy_mumu_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_mumu_sel_dy_other_NOMINAL_Mt_lep_met_f, Entries= 43170, Total sum= 0.000278779
root [4] dy_tautau_sel->Get("dy_other/NOMINAL/dy_tautau_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_tautau_sel_dy_other_NOMINAL_Mt_lep_met_f, Entries= 34, Total sum= 2.22026e-07

root [5] mu_sel->Get("dy_tautau/NOMINAL/mu_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_dy_tautau_NOMINAL_Mt_lep_met_f, Entries= 4, Total sum= 2.90441e-08
root [6] elmu_sel->Get("dy_tautau/NOMINAL/elmu_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = elmu_sel_dy_tautau_NOMINAL_Mt_lep_met_f, Entries= 2, Total sum= 1.64038e-08
root [7] dy_mumu_sel->Get("dy_tautau/NOMINAL/dy_mumu_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_mumu_sel_dy_tautau_NOMINAL_Mt_lep_met_f, Entries= 337, Total sum= 2.21724e-06
root [8] dy_tautau_sel->Get("dy_tautau/NOMINAL/dy_tautau_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_tautau_sel_dy_tautau_NOMINAL_Mt_lep_met_f, Entries= 751, Total sum= 5.00932e-06


root [1] mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 793, Total sum= 9.5598e-06
root [2] elmu_sel->Get("tt_mutau/NOMINAL/elmu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = elmu_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 8, Total sum= 7.71649e-08
root [3] dy_mumu_sel->Get("tt_mutau/NOMINAL/dy_mumu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_mumu_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 15, Total sum= 1.70171e-07
root [4] dy_tautau_sel->Get("tt_mutau/NOMINAL/dy_tautau_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_tautau_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 372, Total sum= 4.63528e-06


-- 700 TT in tt mutau
   700 DY in dy taumutau

too few events?
in DY from the test it was 1k per bin in 3-5sigma bins
in TT it was 100 events per bin


comparing DY to quick tests

root -l quick-test/foobar.root
dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign")->Print()
TH1.Print Name  = dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign, Entries= 22476, Total sum= 0.845538

((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->Scale(22476./0.845538)

root [10] ((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->GetBinContent(1)
(Double_t) 2531.66
root [11] ((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->GetBinContent(2)
(Double_t) 9040.16
root [12] ((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->GetBinContent(3)
(Double_t) 3314.38
root [13] ((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->GetBinContent(4)
(Double_t) 2015.38
root [14] ((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->GetBinContent(5)
(Double_t) 1317.67
root [15] ((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->GetBinContent(6)
(Double_t) 913.347
root [16] ((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->GetBinContent(7)
(Double_t) 695.636
root [17] ((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->GetBinContent(0)
(Double_t) 20.7343
root [18] 
root [18] ((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->GetBinContent(8)
(Double_t) 493.477
root [19] ((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->GetBinContent(9)
(Double_t) 375.291

-- more than 700



root [3] ttree_out->Draw("selection_stage_dy", "selection_stage_dy>100")
(Long64_t) 1167
root [1] ttree_out->Draw("selection_stage_dy", "selection_stage_dy>100")
(Long64_t) 15737

and it was 10k in first run!?
did it have tau SV cut? NO and SV sign distr is like TT, 100 events per bin in 3-4-5sigma

quick test selection?

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40."   --per-weight --scale 5765.4   --save-weight --histo-name "dy_mutau_sel/dy_all/NOMINAL/dy_mutau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_all.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &

-- forgot Mt
also pass_mu has no_iso_veto_leps and lep_relIso[0] < 0.15
dy_tautau definition = any tau + any tau

and n bjets < 2? -- not tau bjets?

ttree_out->Draw("selection_stage_dy", "selection_stage_dy>100")
ttree_out->Draw("event_taus_sv_sign[0]>>h(21,-1,20)", "selection_stage_dy>100")

retest the SV Sign

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40."   --per-weight --scale 5765.4   --save-weight --histo-name "dy_mutau_sel/dy_all/NOMINAL/dy_mutau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_all_retest.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 21 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40."   --per-weight --scale 5765.4   --save-weight --histo-name "dy_mutau_sel/dy_all/NOMINAL/dy_mutau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_all_retest_tau21pt.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &


dy_mutau_sel->Get("dy_all/NOMINAL/dy_mutau_sel_dy_all_NOMINAL_geom_tau_sv_sign")->Print()
retest
TH1.Print Name  = dy_mutau_sel_dy_all_NOMINAL_geom_tau_sv_sign, Entries= 25229, Total sum= 0.950801

retest_tau21pt
TH1.Print Name  = dy_mutau_sel_dy_all_NOMINAL_geom_tau_sv_sign, Entries= 24364, Total sum= 0.917807

-- forgot 10k limit!!!!!!










# issue with recoil corrections

how did I get them to link in last time?












# More info plots for AN

Mt shape of signal and background
Same Sign selection

file with nominal sel for paper Mt:
jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root

python jobsums/get_shapes.py --formula "tt_mujets : tt_mutau " -c mu_selVloose -d Mt_lep_met_f -p tt_lj tt_mutau:jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root:mu_selVloose,tt_mutau,NOMINAL tt_mujets:jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root:mu_selVloose,tt_lj,NOMINAL

python jobsums/get_shapes.py --x-title "M_{T} [GeV]" --norm-binwidth --formula "tt_mujets : tt_mutau " -c mu_selVloose -d Mt_lep_met_f -p tt_lj tt_mutau:jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root:mu_selVloose,tt_mutau,NOMINAL tt_mujets:jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root:mu_selVloose,tt_lj,NOMINAL

python jobsums/get_shapes.py --x-title "M_{T} [GeV]" --norm-binwidth --formula "tt_mujets : tt_mutau " -c mu_sel -d Mt_lep_met_f -p tt_lj tt_mutau:jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root:mu_sel,tt_mutau,NOMINAL tt_mujets:jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root:mu_sel,tt_lj,NOMINAL

python jobsums/get_shapes.py --x-title "M_{T} [GeV]" --norm-binwidth --formula "tt_eljets : tt_eltau " -c el_sel -d Mt_lep_met_f -p tt_lj tt_eltau:jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root:el_sel,tt_eltau,NOMINAL tt_eljets:jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root:el_sel,tt_lj,NOMINAL

python jobsums/get_shapes.py --x-title "M_{T} [GeV]" --norm-binwidth --formula "tt_eljets : tt_eltau " -c el_selVloose -d Mt_lep_met_f -p tt_lj tt_eltau:jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root:el_selVloose,tt_eltau,NOMINAL tt_eljets:jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root:el_selVloose,tt_lj,NOMINAL



file from last histosel
distrs_v25pStage2Run3_3_Run4_updowns_weights.root

python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root  --bin-norm  -p -r -o plots/v25pStage2Run3_3_Run4/ --lumi 31300 -c el_sel_ljout_ss -x el_selVloose_ljout_ss -d Mt_lep_met_f --skip-QCD --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events/1GeV" --title ""

python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root  --bin-norm  -p -r -o plots/v25pStage2Run3_3_Run4/ --lumi 31300 -c el_sel_lj_ss    -x el_selVloose_lj_ss    -d Mt_lep_met_f --skip-QCD --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events/1GeV" --title ""


python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root      --bin-norm  -p -r -o plots/v25pStage2Run3_3_Run4/ --lumi 35800 -c mu_sel_ljout_ss -x mu_selVloose_ljout_ss -d Mt_lep_met_f --skip-QCD --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events/1GeV" --title ""

python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root      --bin-norm  -p -r -o plots/v25pStage2Run3_3_Run4/ --lumi 35800 -c mu_sel_lj_ss    -x mu_selVloose_lj_ss    -d Mt_lep_met_f --skip-QCD --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events/1GeV" --title ""








# DY -> taue-tauh

compare number of events to mu-tau

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 29. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40. && (((abs(gen_zdecays_IDs[0]) == 15*11 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*11 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0)"   --per-weight  --scale 5765.4  --save-weight --histo-name "dy_mutau_sel/dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_tautau.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 29. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40. && \!(((abs(gen_zdecays_IDs[0]) == 15*11 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*11 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0)"   --per-weight  --scale 5765.4  --save-weight --histo-name "dy_mutau_sel/dy_other/NOMINAL/dy_mutau_sel_dy_other_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_other.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &

-- very few events, to confirm check the dy->taumu-tauh with el cut

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 29. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40. && (((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0)"   --per-weight  --scale 5765.4  --save-weight --histo-name "dy_mutau_sel/dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_tautau_mutau-w-el-cut.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root








# quick test over full MC

example with Mt and OS:

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40. && lep_id[0]*tau_id[0] < 0"              --save-weight --histo-name "mutau_sel_MT40OS/data/NOMINAL/mutau_sel_MT40OS_data_NOMINAL_geom_tau_sv_sign" --output foobarNOHLT_Mt40OS_SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

with HLT, OS id, without Mt 40

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"              --save-weight --histo-name "mutau_sel/data/NOMINAL/mutau_sel_data_NOMINAL_geom_tau_sv_sign" --output foobarNOHLT_Mt40OS_SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &


python selections.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0" --chan dy_mutau_sel --sys NOMINAL --distr geom_tau_sv_sign --out-dir quick-test/test/ gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/*/*root


foreach dtag (`cat merge-sets/jobs_hadd.dtags.small`)
python selections.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0" --chan dy_mutau_sel --sys NOMINAL --distr geom_tau_sv_sign --out-dir quick-test/v40/ gstore_outdirs/v40/*/Ntupler_v40_$dtag*/*/*/*root &
end

-- troubles


quick script:
python per_dtag_script.py

dy_mutau_sel->Get("dy/NOMINAL/dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign")->Print()

dy = (TH1D*) dy_mutau_sel->Get("dy/NOMINAL/dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign")
dy->Scale(5765.4 * 35800)
dy->Print()

TH1.Print Name  = dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign, Entries= 14927, Total sum= 20195.1

-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!1

data = (TH1D*) mutau_sel->Get("data/NOMINAL/mutau_sel_data_NOMINAL_geom_tau_sv_sign")
dy->SetLineColor(kRed)
data->Draw()
dy->Draw("same")

dy->Scale(5765.4)

full run:

foreach dtag ( MC2016_Summer16_WWTo2L2Nu_powheg MC2016_Summer16_WWToLNuQQ_powheg MC2016_Summer16_WZTo1L1Nu2Q_amcatnlo_madspin MC2016_Summer16_WZTo1L3Nu_amcatnlo_madspin MC2016_Summer16_WZTo2L2Q_amcatnlo_madspin MC2016_Summer16_WZTo3LNu_powheg MC2016_Summer16_ZZTo2L2Nu_powheg MC2016_Summer16_ZZTo2L2Q_amcatnlo_madspin MC2016_Summer16_schannel_4FS_leptonicDecays_amcatnlo MC2016_Summer16_tchannel_antitop_4f_leptonicDecays_powheg MC2016_Summer16_tchannel_top_4f_leptonicDecays_powheg MC2016_Summer16_DYJetsToLL_10to50_amcatnlo MC2016_Summer16_DYJetsToLL_50toInf_madgraph MC2016_Summer16_SingleT_tW_5FS_powheg MC2016_Summer16_SingleTbar_tW_5FS_powheg MC2016_Summer16_W1Jets_madgraph MC2016_Summer16_W2Jets_madgraph MC2016_Summer16_W3Jets_madgraph MC2016_Summer16_W4Jets_madgraph MC2016_Summer16_WJets_amcatnlo MC2016_Summer16_WJets_madgraph MC2016_Summer16_TTJets_powheg )
python per_dtag_script.py $dtag &
end

only wjets:

foreach dtag (  MC2016_Summer16_W1Jets_madgraph MC2016_Summer16_W2Jets_madgraph MC2016_Summer16_W3Jets_madgraph MC2016_Summer16_W4Jets_madgraph MC2016_Summer16_WJets_amcatnlo MC2016_Summer16_WJets_madgraph )
python per_dtag_script.py $dtag &
end

only TTbar:

foreach dtag ( MC2016_Summer16_TTJets_powheg )
python per_dtag_script.py $dtag &
end



run on data:

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"             --save-weight --histo-name "dy_mutau_sel/data/NOMINAL/dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root

hadd foobar.root v40/*.root

dy         = (TH1D*) dy_mutau_sel->Get("dy/NOMINAL/dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign")
single_top = (TH1D*) dy_mutau_sel->Get("single_top/NOMINAL/dy_mutau_sel_single_top_NOMINAL_geom_tau_sv_sign")
wjets      = (TH1D*) dy_mutau_sel->Get("wjets/NOMINAL/dy_mutau_sel_wjets_NOMINAL_geom_tau_sv_sign")
dibosons   = (TH1D*) dy_mutau_sel->Get("dibosons/NOMINAL/dy_mutau_sel_dibosons_NOMINAL_geom_tau_sv_sign")
ttbar      = (TH1D*) dy_mutau_sel->Get("ttbar/NOMINAL/dy_mutau_sel_ttbar_NOMINAL_geom_tau_sv_sign")

dy         ->Scale(35800)
single_top ->Scale(35800)
wjets      ->Scale(35800)
dibosons   ->Scale(35800)
ttbar      ->Scale(35800)

dy         ->Print()
single_top ->Print()
wjets      ->Print()
dibosons   ->Print()
ttbar      ->Print()

TH1.Print Name  = dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign, Entries= 14988, Total sum= 22045.3
root [11] single_top ->Print()
TH1.Print Name  = dy_mutau_sel_single_top_NOMINAL_geom_tau_sv_sign, Entries= 9154, Total sum= 1210.31
root [12] wjets      ->Print()
TH1.Print Name  = dy_mutau_sel_wjets_NOMINAL_geom_tau_sv_sign, Entries= 9136, Total sum= 114618
root [13] dibosons   ->Print()
TH1.Print Name  = dy_mutau_sel_dibosons_NOMINAL_geom_tau_sv_sign, Entries= 27178, Total sum= 1756.32
root [3] ttbar      ->Print()
TH1.Print Name  = dy_mutau_sel_ttbar_NOMINAL_geom_tau_sv_sign, Entries= 15578, Total sum= 5786.75


data = (TH1D*) dy_mutau_sel->Get("data/NOMINAL/dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign")
data->Print()

TH1.Print Name  = dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign, Entries= 80894, Total sum= 79490

-- delirious results
amcatnlo wjets need aMCatNLO weight!

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "(aMCatNLO_weight>0.) * (abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0)"    --per-weight   --scale 61526.7         --save-weight --histo-name "dy_mutau_sel/wjets/NOMINAL/dy_mutau_sel_wjets_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_WJets_amcatnlo.root gstore_outdirs/v40/*/*MC2016_Summer16_WJets_amcatnlo*/*/0000/*root

TH1.Print Name  = dy_mutau_sel_wjets_NOMINAL_geom_tau_sv_sign, Entries= 6503, Total sum= 81559.5

still too many events, but closer to data

dibosons seem too big





# test refit index

python selections.py "tau_refited_index[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0" --chan dy_mutau_sel --sys NOMINAL --distr geom_tau_sv_sign --out-dir quick-test/test/ gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/*/*root

python sumup_ttree_draw.py "tau_refited_index[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"             --save-weight --histo-name "dy_mutau_sel/data/NOMINAL/dy_mutau_sel_data_NOMINAL_tau_refited_index" --output quick-test/test/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root


python sumup_ttree_draw.py "tau_refited_index[0]" --histo-range 100,-5,5 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"             --save-weight --histo-name "dy_mutau_sel/data/NOMINAL/dy_mutau_sel_data_NOMINAL_tau_refited_index" --output quick-test/test/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_2.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root

= -1 and 0 indexes only






# yield with lower cuts

python sumup_ttree_draw.py "tau_refited_index[0]" --histo-range 20,-10,10 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"             --save-weight --histo-name "dy_mutau_sel/dy/NOMINAL/dy_mutau_sel_dy_NOMINAL_tau_refited_index" --output quick-test/test/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_lowcuts.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root

149047 events (37136.0 refit index = 0, others = -1) VS 49273



## geom SV sign distrs in DY and data

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"   --per-weight   --save-weight --histo-name "dy_mutau_sel/dy/NOMINAL/dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign" --output quick-test/test/lowcuts_Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_geom_svsign.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"                  --save-weight --histo-name "dy_mutau_sel/data/NOMINAL/dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign" --output quick-test/test/lowcuts_SingleMuon_geom_svsign.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"                  --save-weight --histo-name "dy_mutau_sel/data/NOMINAL/dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign" --output quick-test/test/lowcuts_SingleMuon_geom_svsign.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

hadd h_lowcuts.root lowcuts*root

dy   = (TH1D*) dy_mutau_sel->Get("dy/NOMINAL/dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign")
data = (TH1D*) dy_mutau_sel->Get("data/NOMINAL/dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign")
dy->SetLineColor(kRed)
dy->Scale(5765.4 * 35800)
data->Print()
dy->Print()

-- dy lowcuts have 1k at 3-4-5 signmas



## try Mt < 40 and full run on MC

foreach dtag ( MC2016_Summer16_WWTo2L2Nu_powheg MC2016_Summer16_WWToLNuQQ_powheg MC2016_Summer16_WZTo1L1Nu2Q_amcatnlo_madspin MC2016_Summer16_WZTo1L3Nu_amcatnlo_madspin MC2016_Summer16_WZTo2L2Q_amcatnlo_madspin MC2016_Summer16_WZTo3LNu_powheg MC2016_Summer16_ZZTo2L2Nu_powheg MC2016_Summer16_ZZTo2L2Q_amcatnlo_madspin MC2016_Summer16_schannel_4FS_leptonicDecays_amcatnlo MC2016_Summer16_tchannel_antitop_4f_leptonicDecays_powheg MC2016_Summer16_tchannel_top_4f_leptonicDecays_powheg MC2016_Summer16_DYJetsToLL_10to50_amcatnlo MC2016_Summer16_DYJetsToLL_50toInf_madgraph MC2016_Summer16_SingleT_tW_5FS_powheg MC2016_Summer16_SingleTbar_tW_5FS_powheg MC2016_Summer16_WJets_madgraph MC2016_Summer16_TTJets_powheg )
python per_dtag_script.py $dtag &
end

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"             --save-weight --histo-name "dy_mutau_sel/data/NOMINAL/dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root

hadd foobar.root v40/MC*root v40/SingleMuon.root


dy         = (TH1D*) dy_mutau_sel->Get("dy/NOMINAL/dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign")
single_top = (TH1D*) dy_mutau_sel->Get("single_top/NOMINAL/dy_mutau_sel_single_top_NOMINAL_geom_tau_sv_sign")
wjets      = (TH1D*) dy_mutau_sel->Get("wjets/NOMINAL/dy_mutau_sel_wjets_NOMINAL_geom_tau_sv_sign")
dibosons   = (TH1D*) dy_mutau_sel->Get("dibosons/NOMINAL/dy_mutau_sel_dibosons_NOMINAL_geom_tau_sv_sign")
ttbar      = (TH1D*) dy_mutau_sel->Get("ttbar/NOMINAL/dy_mutau_sel_ttbar_NOMINAL_geom_tau_sv_sign")

dy         ->Scale(35800)
single_top ->Scale(35800)
wjets      ->Scale(35800)
dibosons   ->Scale(35800)
ttbar      ->Scale(35800)

dy         ->Print()
single_top ->Print()
wjets      ->Print()
dibosons   ->Print()
ttbar      ->Print()

data = (TH1D*) dy_mutau_sel->Get("data/NOMINAL/dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign")
data->Print()

root [11] dy         ->Print()
TH1.Print Name  = dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign, Entries= 37306, Total sum= 55273.7
root [12] single_top ->Print()
TH1.Print Name  = dy_mutau_sel_single_top_NOMINAL_geom_tau_sv_sign, Entries= 12396, Total sum= 1443.25
root [13] wjets      ->Print()
TH1.Print Name  = dy_mutau_sel_wjets_NOMINAL_geom_tau_sv_sign, Entries= 4482, Total sum= 93913.1
root [14] dibosons   ->Print()
TH1.Print Name  = dy_mutau_sel_dibosons_NOMINAL_geom_tau_sv_sign, Entries= 34159, Total sum= 2489.03
root [15] ttbar      ->Print()
TH1.Print Name  = dy_mutau_sel_ttbar_NOMINAL_geom_tau_sv_sign, Entries= 13295, Total sum= 4948.53

root [18] data->Print()
TH1.Print Name  = dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign, Entries= 212683, Total sum= 209320



and with Mt

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40."             --save-weight --histo-name "dy_mutau_sel/data/NOMINAL/dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

root [11] dy         ->Print()
TH1.Print Name  = dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign, Entries= 25322, Total sum= 36829.1
root [12] single_top ->Print()
TH1.Print Name  = dy_mutau_sel_single_top_NOMINAL_geom_tau_sv_sign, Entries= 2519, Total sum= 288.954
root [13] wjets      ->Print()
TH1.Print Name  = dy_mutau_sel_wjets_NOMINAL_geom_tau_sv_sign, Entries= 811, Total sum= 17017.4
root [14] dibosons   ->Print()
TH1.Print Name  = dy_mutau_sel_dibosons_NOMINAL_geom_tau_sv_sign, Entries= 12990, Total sum= 565.068
root [15] ttbar      ->Print()
TH1.Print Name  = dy_mutau_sel_ttbar_NOMINAL_geom_tau_sv_sign, Entries= 2802, Total sum= 1036.63

root [18] data->Print()
TH1.Print Name  = dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign, Entries= 77254, Total sum= 75717


-- by dy-data distrs seems like this is it


now:
* to stack
* splitting DY in tautau and other


### split DY

only with z_decays the second option does not count now
and only in DY50

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40. && (((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0)"   --per-weight  --scale 5765.4  --save-weight --histo-name "dy_mutau_sel/dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_tautau.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40. && \!(((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0)"   --per-weight  --scale 5765.4  --save-weight --histo-name "dy_mutau_sel/dy_other/NOMINAL/dy_mutau_sel_dy_other_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_other.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &

dy         = (TH1D*) dy_mutau_sel->Get("dy/NOMINAL/dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign")
dy_tautau  = (TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign")
dy_other   = (TH1D*) dy_mutau_sel->Get("dy_other/NOMINAL/dy_mutau_sel_dy_other_NOMINAL_geom_tau_sv_sign")

dy         ->Print()
dy_tautau  ->Print()
dy_other   ->Print()

add up?

root [5] dy         ->Print()
TH1.Print Name  = dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign, Entries= 25322, Total sum= 1.02875
root [6] dy_tautau  ->Print()
TH1.Print Name  = dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign, Entries= 22476, Total sum= 0.000146657
root [7] dy_other   ->Print()
TH1.Print Name  = dy_mutau_sel_dy_other_NOMINAL_geom_tau_sv_sign, Entries= 1455, Total sum= 9.74784e-06

22476 + 1455
23931

-- undefined N_zdecays?

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40."   --per-weight --scale 5765.4   --save-weight --histo-name "dy_mutau_sel/dy_all/NOMINAL/dy_mutau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_all.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &

dy_all    = (TH1D*) dy_mutau_sel->Get("dy_all/NOMINAL/dy_mutau_sel_dy_all_NOMINAL_geom_tau_sv_sign")



### stack them

python stack_quick.py quick-test/foobar.root --chan dy_mutau_sel --sys NOMINAL --distr geom_tau_sv_sign --stack ttbar,wjets,dibosons,single_top,dy --also data test_f.root --scale-stack 35800

python stack_quick.py quick-test/foobar.root --chan dy_mutau_sel --sys NOMINAL --distr geom_tau_sv_sign --stack ttbar,wjets,dibosons,single_top,dy_tautau,dy_other --debug --also data test_f.root --scale-stack 35800











# check the yield in SS DY

python sumup_ttree_draw.py "tau_refited_index[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] > 0"             --save-weight --histo-name "dy_mutau_sel/dy/NOMINAL/dy_mutau_sel_dy_NOMINAL_tau_refited_index" --output quick-test/test/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_SS.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root

5461 events VS 49273 in OS













# testing DY MC in tau-tau

in the summer project it had very small number of events
-- redo and compare with old SV Sign plot

python sumup_ttree_distrs.py "tau_SV_geom_flightLenSign[0]" --histo-range 20,0,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4" --per-weight --save-weight --histo-name mc_dy_tau_svsign_geom --output mc_dy_tau_svsign_geom.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph/181009_141955/0000/*root

example:

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --custom-range 1,20,40,60,80,100,130,160,200,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) > 15*15) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) > 15*15)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0" --histo-name  tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt   --output tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root



and full runs with propper histo names:

python sumup_ttree_distrs.py "tau_SV_geom_flightLenSign[0]" --histo-range 20,0,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0" --per-weight --save-weight --histo-name "mutau_sel/dy/NOMINAL/mutau_sel_dy_NOMINAL_geom_tau_sv_sign"     --output MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &

and data:

python sumup_ttree_distrs.py "tau_SV_geom_flightLenSign[0]" --histo-range 20,0,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0"              --save-weight --histo-name "mutau_sel/data/NOMINAL/mutau_sel_data_NOMINAL_geom_tau_sv_sign" --output SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &


dy = (TH1D*) mutau_sel->Get("dy/NOMINAL/mutau_sel_dy_NOMINAL_geom_tau_sv_sign")
data = (TH1D*) mutau_sel->Get("data/NOMINAL/mutau_sel_data_NOMINAL_geom_tau_sv_sign")
dy->Scale(5765.4 * 35800)
dy->SetLineColor(kRed)
data->Draw()
dy->Draw("same")







and without HLT requirement:

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 20,0,20 --cond-com "abs(leps_ID) == 13 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0" --per-weight --save-weight --histo-name "mutau_sel/dy/NOMINAL/mutau_sel_dy_NOMINAL_geom_tau_sv_sign"     --output foobarNOHLT_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 20,0,20 --cond-com "abs(leps_ID) == 13 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0"              --save-weight --histo-name "mutau_sel/data/NOMINAL/mutau_sel_data_NOMINAL_geom_tau_sv_sign" --output foobarNOHLT_SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

-- same factor of 3 crap!

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 20,0,20 --cond-com "abs(leps_ID) == 11 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0" --per-weight --save-weight --histo-name "eltau_sel/dy/NOMINAL/eltau_sel_dy_NOMINAL_geom_tau_sv_sign"     --output foobarNOHLT_el_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 20,0,20 --cond-com "abs(leps_ID) == 11 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0"              --save-weight --histo-name "eltau_sel/data/NOMINAL/eltau_sel_data_NOMINAL_geom_tau_sv_sign" --output foobarNOHLT_el_SingleElectron.root gstore_outdirs/v40/SingleElectron/*/*/0000/*root &












dimuon test of normalization:

python sumup_ttree_distrs.py "lep_p4[0].pt()" --histo-range 20,0,200 --cond-com "leps_ID == -13*13 && HLT_mu && (lep_matched_HLT[0] || lep_matched_HLT[1]) && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && lep_p4[1].pt() > 30 && abs(lep_p4[0].eta()) < 2.4 && nbjets == 0" --per-weight --save-weight --histo-name "mumu_sel/dy/NOMINAL/mumu_sel_dy_NOMINAL_geom_tau_sv_sign"     --output MC2016_Summer16_DYJetsToLL_50toInf_madgraph_mumu.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &

python sumup_ttree_distrs.py "lep_p4[0].pt()" --histo-range 20,0,200 --cond-com "leps_ID == -13*13 && HLT_mu && (lep_matched_HLT[0] || lep_matched_HLT[1]) && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && lep_p4[1].pt() > 30 && abs(lep_p4[0].eta()) < 2.4 && nbjets == 0"              --save-weight --histo-name "mumu_sel/data/NOMINAL/mumu_sel_data_NOMINAL_geom_tau_sv_sign" --output SingleMuon_mumu.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

mumu_dy = (TH1D*) mumu_sel->Get("dy/NOMINAL/mumu_sel_dy_NOMINAL_geom_tau_sv_sign")
mumu_data = (TH1D*) mumu_sel->Get("data/NOMINAL/mumu_sel_data_NOMINAL_geom_tau_sv_sign")
mumu_dy->Scale(5765.4 * 35800)
mumu_dy->SetLineColor(kRed)
mumu_data->Draw()
mumu_dy->Draw("same")





hadd test_foobar.root SingleMuon.root SingleMuon_mumu.root MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root MC2016_Summer16_DYJetsToLL_50toInf_madgraph_mumu.root SingleMuon_pt.root MC2016_Summer16_DYJetsToLL_50toInf_madgraph_pt.root



mumu ok (MC has more events with smaller pt -- SFs)
mutau -- difference data > MC by factor of 3 over all SV Sign range, why?






python sumup_ttree_distrs.py "tau_p4[0].pt()" --histo-range 20,0,100 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0" --per-weight --save-weight --histo-name "mutau_sel/dy/NOMINAL/mutau_sel_dy_NOMINAL_tau_pt"     --output MC2016_Summer16_DYJetsToLL_50toInf_madgraph_pt.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &

python sumup_ttree_distrs.py "tau_p4[0].pt()" --histo-range 20,0,100 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0"              --save-weight --histo-name "mutau_sel/data/NOMINAL/mutau_sel_data_NOMINAL_tau_pt" --output SingleMuon_pt.root                                  gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

dy = (TH1D*) mutau_sel->Get("dy/NOMINAL/mutau_sel_dy_NOMINAL_tau_pt")
data = (TH1D*) mutau_sel->Get("data/NOMINAL/mutau_sel_data_NOMINAL_tau_pt")
dy->Scale(5765.4 * 35800)
dy->SetLineColor(kRed)
data->Draw()
dy->Draw("same")


-- same factor of 3









## investigation of factor 3

tau-lep dR match?

python sumup_ttree_distrs.py "tau_p4[0].pt()" --histo-range 20,0,100 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && \!tau_matching_lep[0] && nbjets == 0"              --save-weight --histo-name "mutau_sel/data/NOMINAL/mutau_sel_data_NOMINAL_tau_pt" --output SingleMuon_pt_lepmatch.root                                  gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

from
210961
down to
184479

! renamed sumup_ttree_distrs to sumup_ttree_draw !

OS tau?

python sumup_ttree_draw.py "tau_p4[0].pt()" --histo-range 20,0,100 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && \!tau_matching_lep[0] && nbjets == 0 && tau_id[0] * lep_id[0] < 0"              --save-weight --histo-name "mutau_sel/data/NOMINAL/mutau_sel_data_NOMINAL_tau_pt" --output SingleMuon_pt_lepmatch_os.root                                  gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

-- down to
146400

still not 1 third


not the 0 tau?

python sumup_ttree_events.py --output foobar_test_SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &
python sumup_ttree_events.py --output foobar_test_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &


-- in DY mostly all events have only 1 tau

waiting SingleMuon


what if nbjets == 0 is wrong? (the true tau matches to a bjet, in case of mumu it does not happen)

python sumup_ttree_draw.py "tau_p4[0].pt()" --histo-range 20,0,100 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && \!tau_matching_lep[0] && nbjets < 2 && tau_id[0] * lep_id[0] < 0"              --save-weight --histo-name "mutau_sel/data/NOMINAL/mutau_sel_data_NOMINAL_tau_pt" --output SingleMuon_pt_lepmatch_os_nbjets1.root                                  gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

python sumup_ttree_draw.py "tau_p4[0].pt()" --histo-range 20,0,100 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && \!tau_matching_lep[0] && nbjets < 2 && tau_id[0] * lep_id[0] < 0" --per-weight --save-weight --histo-name "mutau_sel/dy/NOMINAL/mutau_sel_dy_NOMINAL_tau_pt"     --output MC2016_Summer16_DYJetsToLL_50toInf_madgraph_pt_lepmatch_os_nbjets1.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &


TH1.Print Name  = mutau_sel_dy_NOMINAL_tau_pt, Entries= 48841, Total sum= 0.000328438
root [3] mutau_sel->Get("dy/NOMINAL/mutau_sel_dy_NOMINAL_tau_pt")->Integral()
root [4]
root [4] 0.000328438 * 5765.4 * 35800
(double) 67790.0

root [2] mutau_sel->Get("data/NOMINAL/mutau_sel_data_NOMINAL_tau_pt")->Print()
TH1.Print Name  = mutau_sel_data_NOMINAL_tau_pt, Entries= 214744, Total sum= 210495



ok, test of tau IDs

python sumup_ttree_draw.py "tau_IDlev[0] + 10*tau_IDlev[1] + 100*tau_IDlev[2]" --histo-range 1000,0,1000 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && \!tau_matching_lep[0] && nbjets < 2 && tau_id[0] * lep_id[0] < 0"              --save-weight --histo-name "mutau_sel/data/NOMINAL/mutau_sel_data_NOMINAL_tau_IDlevs" --output foobars3_SingleMuon_tau_IDlevs.root                                  gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

python sumup_ttree_draw.py "tau_IDlev[0] + 10*tau_IDlev[1] + 100*tau_IDlev[2]" --histo-range 1000,0,1000 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && \!tau_matching_lep[0] && nbjets < 2 && tau_id[0] * lep_id[0] < 0" --per-weight --save-weight --histo-name "mutau_sel/dy/NOMINAL/mutau_sel_dy_NOMINAL_tau_IDlevs"     --output foobars3_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_tau_IDlevs.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &



another wain atempt with bjets == 0

python sumup_ttree_draw.py "tau_p4[0].pt()" --histo-range 20,0,100 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && \!tau_matching_lep[0] && nbjets < 1 && tau_id[0] * lep_id[0] < 0"              --save-weight --histo-name "mutau_sel/data/NOMINAL/mutau_sel_b0_data_NOMINAL_tau_pt" --output SingleMuon_pt_lepmatch_os_nbjets0.root                                  gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

python sumup_ttree_draw.py "tau_p4[0].pt()" --histo-range 20,0,100 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && \!tau_matching_lep[0] && nbjets < 1 && tau_id[0] * lep_id[0] < 0" --per-weight --save-weight --histo-name "mutau_sel/dy/NOMINAL/mutau_sel_b0_dy_NOMINAL_tau_pt"     --output MC2016_Summer16_DYJetsToLL_50toInf_madgraph_pt_lepmatch_os_nbjets0.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &

-- about 1.4 less events than with nbjets < 2
in both data and dy


hadd foobar3_test.root   foobars3_*.root MC2016_Summer16_DYJetsToLL_50toInf_madgraph_pt_lepmatch_os_nbjets1.root SingleMuon_pt_lepmatch_os_nbjets1.root MC2016_Summer16_DYJetsToLL_50toInf_madgraph_pt_lepmatch_os_nbjets0.root SingleMuon_pt_lepmatch_os_nbjets0.root

hadd foobar3_test.root SingleMuon_pt_lepmatch_os_nbjets0.root MC2016_Summer16_DYJetsToLL_50toInf_madgraph_pt_lepmatch_os_nbjets0.root SingleMuon_tau_IDlevs.root MC2016_Summer16_DYJetsToLL_50toInf_madgraph_tau_IDlevs.root SingleMuon_pt_lepmatch_os_nbjets1.root MC2016_Summer16_DYJetsToLL_50toInf_madgraph_pt_lepmatch_os_nbjets1.root


dy = (TH1D*) mutau_sel->Get("dy/NOMINAL/mutau_sel_dy_NOMINAL_tau_IDlevs")
data = (TH1D*) mutau_sel->Get("data/NOMINAL/mutau_sel_data_NOMINAL_tau_IDlevs")
dy->Scale(5765.4 * 35800)
dy->SetLineColor(kRed)
data->Draw()
dy->Draw("same")




## even more properly done full event scan

with corrected index into SV
and b-jet dR matching

python sumup_ttree_events.py --save-weight              --output foobar_test2_SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &
python sumup_ttree_events.py --save-weight --per-weight --output foobar_test2_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &


-- but could be even more precise!
now all jets are matched to tau and skipped if they are dR < 0.4,
in principle it's better to have only 1 the best matched to tau and skipped
it's an edge case

by tau pt
220659   data and
 72000.8 dy

by sv sign
73016   data
18946.8 dy



## All DY events

all events are recorded
the BR on gen level are ok

no gen_N_zdecays > 0 events (?????)

((TTree*) ntupler->Get("reduced_ttree"))->GetEntries()

HLTs

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "abs(gen_pythia8_prompt_leptons_IDs[0]) == 13 && abs(gen_pythia8_prompt_leptons_IDs[1]) == 13")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "(abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[1]) >15*15) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[0]) >15*15)")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "(abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*11) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*11)")

-- % passing HLT:

1.87% in mumu
0.1 % in taumu+tauh
0.05% in taumu+tauel

HLT el

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_el", "abs(gen_pythia8_prompt_leptons_IDs[0]) == 11 && abs(gen_pythia8_prompt_leptons_IDs[1]) == 11")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_el", "(abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*11 && abs(gen_pythia8_prompt_leptons_IDs[1]) >15*15) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*11 && abs(gen_pythia8_prompt_leptons_IDs[0]) >15*15)")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_el", "(abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*11) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*11)")

h = (TH1D*) (((TTree*) ntupler->Get("reduced_ttree"))->GetHistogram())

h->GetBinContent(1)
h->GetBinContent(2)

0.9%  elel eff
0.04% in tauel+tauh
0.05% in taumu+tauel (differen events trigger el and mu trig)



events with some reco taus:

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "((abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[1]) >15*15) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[0]) >15*15)) && tau_IDlev[0] > 1")


((TTree*) ntupler->Get("reduced_ttree"))->Scan("tau_IDlev[0]:tau_IDlev[1]:tau_IDlev[2]:tau_IDlev[3]", "tau_IDlev[0] > 2 && tau_p4[0].pt() > 30. && abs(tau_p4[0].eta()) < 2.4 && !tau_matching_lep[0] && abs(leps_ID) == 13")

((TTree*) ntupler->Get("reduced_ttree"))->Scan("tau_p4[0].pt():tau_p4[0].eta():tau_IDlev[0]:tau_IDlev[1]:tau_IDlev[2]:tau_IDlev[3]:gen_pythia8_prompt_leptons_IDs[0]:gen_pythia8_prompt_leptons_IDs[1]", "((abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[1]) >15*15) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[0]) >15*15)) && tau_IDlev[0] > 0")


how many gen tauh get ID?

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "((abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[1]) >15*15) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[0]) >15*15))")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "((abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[1]) >15*15) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[0]) >15*15)) && tau_IDlev[0] > 0")

from
7563
id at 0
61

0.00806558

among mumu?

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "abs(gen_pythia8_prompt_leptons_IDs[0]) == 13 && abs(gen_pythia8_prompt_leptons_IDs[1]) == 13")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "abs(gen_pythia8_prompt_leptons_IDs[0]) == 13 && abs(gen_pythia8_prompt_leptons_IDs[1]) == 13 && tau_IDlev[0] > 0")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "abs(gen_pythia8_prompt_leptons_IDs[0]) == 13 && abs(gen_pythia8_prompt_leptons_IDs[1]) == 13 && tau_IDlev[0] > 0 && !tau_matching_lep[0]")

from
34428
id
124
and
124

0.00360172

incredible numbers
fake rate in DY is 0.5 of true taus


too few tau ID in true taus
scan tau IDs

((TTree*) ntupler->Get("reduced_ttree"))->Scan("tau_IDlev[0]:tau_IDlev[1]:tau_IDlev[2]", "((abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[1]) >15*15) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[0]) >15*15))")

-- no "high tau ID on last indices"
mostly empty, and
*    53120 *         1 *           *           *
sometimes
*    53586 *         3 *         1 *         0 *
*    55726 *         4 *           *           *
*    55754 *           *           *           *
*    55760 *         0 *           *           *

*    58588 *         5 *           *           *

((TTree*) ntupler->Get("reduced_ttree"))->Scan("tau_IDlev[0]:tau_IDlev[1]:tau_IDlev[2]", "((abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[1]) >15*15) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[0]) >15*15)) && tau_p4[0].pt() > 25")

mostly ID = 0




### issue with merged genparticle producer?

%MSG
%MSG-w MergedGenParticleProducer:  MergedGenParticleProducer:mergedGenParticles  12-Oct-2018 12:33:54 CEST Run: 1 Event: 4251447
Found multiple packed matches for: 13	22	4.97106e-09	-2.89792

-- check on first 1000 events: are all 1000 events recorded? does it cause some missing events?

-- tested on 10k events, all 10k are recorded
(empty ones? will see in full file record)




### OldDMs?

recompile ntupler with OldDMs for tau decay mode finding

and scan this:

((TTree*) ntupler->Get("reduced_ttree"))->Scan("tau_IDlev[0]:tau_IDlev[1]:tau_IDlev[2]", "((abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[1]) >15*15) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[0]) >15*15))")

pat::Tau: the ID decayModeFindingOldDMs can't be found in this pat::Tau.
The available IDs are:
'againstElectronLooseMVA6'
'againstElectronMVA6Raw'
'againstElectronMVA6category'
'againstElectronMediumMVA6'
'againstElectronTightMVA6'
'againstElectronVLooseMVA6'
'againstElectronVTightMVA6'
'againstMuonLoose3'
'againstMuonTight3'
'byCombinedIsolationDeltaBetaCorrRaw3Hits'
'byIsolationMVArun2v1DBdR03oldDMwLTraw'
'byIsolationMVArun2v1DBnewDMwLTraw'
'byIsolationMVArun2v1DBoldDMwLTraw'
'byIsolationMVArun2v1PWdR03oldDMwLTraw'
'byIsolationMVArun2v1PWnewDMwLTraw'
'byIsolationMVArun2v1PWoldDMwLTraw'
'byLooseCombinedIsolationDeltaBetaCorr3Hits'
'byLooseIsolationMVArun2v1DBdR03oldDMwLT'
'byLooseIsolationMVArun2v1DBnewDMwLT'
'byLooseIsolationMVArun2v1DBoldDMwLT'
'byLooseIsolationMVArun2v1PWdR03oldDMwLT'
'byLooseIsolationMVArun2v1PWnewDMwLT'
'byLooseIsolationMVArun2v1PWoldDMwLT'
'byMediumCombinedIsolationDeltaBetaCorr3Hits'
'byMediumIsolationMVArun2v1DBdR03oldDMwLT'
'byMediumIsolationMVArun2v1DBnewDMwLT'
'byMediumIsolationMVArun2v1DBoldDMwLT'
'byMediumIsolationMVArun2v1PWdR03oldDMwLT'
'byMediumIsolationMVArun2v1PWnewDMwLT'
'byMediumIsolationMVArun2v1PWoldDMwLT'
'byPhotonPtSumOutsideSignalCone'
'byTightCombinedIsolationDeltaBetaCorr3Hits'
'byTightIsolationMVArun2v1DBdR03oldDMwLT'
'byTightIsolationMVArun2v1DBnewDMwLT'
'byTightIsolationMVArun2v1DBoldDMwLT'
'byTightIsolationMVArun2v1PWdR03oldDMwLT'
'byTightIsolationMVArun2v1PWnewDMwLT'
'byTightIsolationMVArun2v1PWoldDMwLT'
'byVLooseIsolationMVArun2v1DBdR03oldDMwLT'
'byVLooseIsolationMVArun2v1DBnewDMwLT'
'byVLooseIsolationMVArun2v1DBoldDMwLT'
'byVLooseIsolationMVArun2v1PWdR03oldDMwLT'
'byVLooseIsolationMVArun2v1PWnewDMwLT'
'byVLooseIsolationMVArun2v1PWoldDMwLT'
'byVTightIsolationMVArun2v1DBdR03oldDMwLT'
'byVTightIsolationMVArun2v1DBnewDMwLT'
'byVTightIsolationMVArun2v1DBoldDMwLT'
'byVTightIsolationMVArun2v1PWdR03oldDMwLT'
'byVTightIsolationMVArun2v1PWnewDMwLT'
'byVTightIsolationMVArun2v1PWoldDMwLT'
'byVVTightIsolationMVArun2v1DBdR03oldDMwLT'
'byVVTightIsolationMVArun2v1DBnewDMwLT'
'byVVTightIsolationMVArun2v1DBoldDMwLT'
'byVVTightIsolationMVArun2v1PWdR03oldDMwLT'
'byVVTightIsolationMVArun2v1PWnewDMwLT'
'byVVTightIsolationMVArun2v1PWoldDMwLT'
'chargedIsoPtSum'
'chargedIsoPtSumdR03'
'decayModeFinding'
'decayModeFindingNewDMs'
'footprintCorrection'
'footprintCorrectiondR03'
'neutralIsoPtSum'
'neutralIsoPtSumWeight'
'neutralIsoPtSumWeightdR03'
'neutralIsoPtSumdR03'
'photonPtSumOutsideSignalCone'
'photonPtSumOutsideSignalConedR03'
'puCorrPtSum'











### full new file

trigger efficiencies

((TTree*) ntupler->Get("reduced_ttree"))->GetEntries()

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "gen_N_zdecays > 0")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "gen_N_zdecays == 0")

125498
7991

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "abs(gen_zdecays_IDs[0]) == 11 && abs(gen_zdecays_IDs[1]) == 11 && gen_N_zdecays > 0")

41760
41810

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "abs(gen_zdecays_IDs[0]) > 15 && abs(gen_zdecays_IDs[1]) > 15 && gen_N_zdecays > 0")

41928

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0")

(Long64_t) 9337
root [12] 9337. / 41928
(double) 0.222691

h = (TH1D*) (((TTree*) ntupler->Get("reduced_ttree"))->GetHistogram())

h->GetBinContent(1)
h->GetBinContent(2)

mumu
15814.0
25946.0

taumu tauh

8526.00
 811.000


electron

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_el", "abs(gen_zdecays_IDs[0]) == 11 && abs(gen_zdecays_IDs[1]) == 11 && gen_N_zdecays > 0")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_el", "((abs(gen_zdecays_IDs[0]) == 15*11 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*11 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0")


muon HLT efficiency
mumu       0.62
taumu tauh 0.086 -> 1 - (1-0.086)^2 = 0.166

electron HLT
elel       0.47
tauel tauh 0.044 -> 1 - (1-0.044)^2 = 0.086


-- the efficiency equations don't hold!
the taumu kinematics is different from just mu but not this much!



### trigger efficiencies in TT

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_el", "abs(gen_t_w_decay_id) == 11 && abs(gen_tb_w_decay_id) == 13")

983

root [5] h->GetBinContent(1)
(Double_t) 512.000
root [6] h->GetBinContent(2)
(Double_t) 471.000

root [11] 471.000 / 983
(double) 0.479145

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_el", "abs(gen_t_w_decay_id) == 11 && abs(gen_tb_w_decay_id) == 11")

1008

root [9] h->GetBinContent(1)
(Double_t) 297.000
root [10] h->GetBinContent(2)
(Double_t) 711.000

root [12] 711.000 / 1008
(double) 0.705357

root [13] 1 - (1 - 0.479145)*(1 - 0.479145)
(double) 0.728710



### reco efficiencies and kinematics of the lepton

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "abs(gen_zdecays_IDs[0]) == 11 && abs(gen_zdecays_IDs[1]) == 11 && gen_N_zdecays > 0")

in mumu:

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].pt()", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("abs(leps_ID)", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0 && abs(leps_ID) == 13")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0 && leps_ID == -13*13")

-- compare lep pt

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].pt()", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0 && abs(leps_ID) == 13")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].pt()", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0 && leps_ID == -13*13")

h = (TH1D *) (((TTree*) ntupler->Get("reduced_ttree"))->GetHistogram())



lep IDs in tautau:

((TTree*) ntupler->Get("reduced_ttree"))->Draw("abs(leps_ID)",   "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("abs(leps_ID)",   "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0 && abs(leps_ID) == 1")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("abs(leps_ID)",   "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0 && abs(leps_ID) == 13")



((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].pt()>>h(20,0,200)", "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0 && abs(leps_ID) == 13")

h_tautau_pt = (TH1D *) (((TTree*) ntupler->Get("reduced_ttree"))->GetHistogram())

etas:

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].eta()>>h(20,-2.5,2.5)", "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0 && abs(leps_ID) == 13")

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].eta()>>h(50,-2.5,2.5)", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0 && abs(leps_ID) == 13")





### test with Mt < 40.


python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 20,0,20 --cond-com "abs(leps_ID) == 13 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40."              --save-weight --histo-name "mutau_sel_MT40/data/NOMINAL/mutau_sel_MT40_data_NOMINAL_geom_tau_sv_sign" --output foobarNOHLT_Mt40_SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

mutau_sel_MT40->Get("data/NOMINAL/mutau_sel_MT40_data_NOMINAL_geom_tau_sv_sign")->Print()
15.2k now

w.o. MT40:
mutau_sel->Get("data/NOMINAL/mutau_sel_data_NOMINAL_geom_tau_sv_sign")->Print()
44.2k

examples:

data = (TH1D*) mutau_sel_MT40->Get("data/NOMINAL/mutau_sel_MT40_data_NOMINAL_geom_tau_sv_sign")

dy = (TH1D*) mutau_sel->Get("dy/NOMINAL/mutau_sel_dy_NOMINAL_geom_tau_sv_sign")
dy->Scale(5765.4 * 35800)
dy->SetLineColor(kRed)
data->Draw()
dy->Draw("same")


test on DY:

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 20,0,20 --cond-com "abs(leps_ID) == 13 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40." --per-weight --save-weight --histo-name "mutau_sel_MT40/dy/NOMINAL/mutau_sel_MT40_dy_NOMINAL_geom_tau_sv_sign"     --output foobarNOHLT_Mt40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root

mutau_sel_MT40->Get("dy/NOMINAL/mutau_sel_MT40_dy_NOMINAL_geom_tau_sv_sign")->Print()
Entries= 5338, Total sum= 2.66933e-05

mutau_sel->Get("dy/NOMINAL/mutau_sel_dy_NOMINAL_geom_tau_sv_sign")->Print()
TH1.Print Name  = mutau_sel_dy_NOMINAL_geom_tau_sv_sign, Entries= 8621, Total sum= 4.23872e-05

dy = (TH1D*) mutau_sel_MT40->Get("dy/NOMINAL/mutau_sel_MT40_dy_NOMINAL_geom_tau_sv_sign")
dy->Scale(5765.4 * 35800)
dy->Print()
TH1.Print Name  = mutau_sel_MT40_dy_NOMINAL_geom_tau_sv_sign, Entries= 5338, Total sum= 5509.52

-- again 1/3 of 14k of data

hadd foobarNOHLT_Mt40.root foobarNOHLT_Mt40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root foobarNOHLT_Mt40_SingleMuon.root

data = (TH1D*) mutau_sel_MT40->Get("data/NOMINAL/mutau_sel_MT40_data_NOMINAL_geom_tau_sv_sign")
dy = (TH1D*) mutau_sel_MT40->Get("dy/NOMINAL/mutau_sel_MT40_dy_NOMINAL_geom_tau_sv_sign")
dy->Scale(5765.4 * 35800)
dy->Print()
dy->SetLineColor(kRed)
data->Draw()
dy->Draw("same")

-- maybe closer in tail
much less events than in Strasbourg result:
1) there 1k events was at 3-4sigma
2) here 1k is at 1sigma, 3-4 have 100 events -- in both data and DY




include OS

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40. && lep_id[0]*tau_id[0] < 0"              --save-weight --histo-name "mutau_sel_MT40OS/data/NOMINAL/mutau_sel_MT40OS_data_NOMINAL_geom_tau_sv_sign" --output foobarNOHLT_Mt40OS_SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40. && lep_id[0]*tau_id[0] < 0" --per-weight --save-weight --histo-name "mutau_sel_MT40OS/dy/NOMINAL/mutau_sel_MT40OS_dy_NOMINAL_geom_tau_sv_sign"     --output foobarNOHLT_Mt40OS_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &


include OS and HLT

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40. && lep_id[0]*tau_id[0] < 0 && HLT_mu && lep_matched_HLT[0]"              --save-weight --histo-name "mutau_sel_MT40OSHLT/data/NOMINAL/mutau_sel_MT40OSHLT_data_NOMINAL_geom_tau_sv_sign" --output foobarNOHLT_Mt40OSHLT_SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40. && lep_id[0]*tau_id[0] < 0 && HLT_mu && lep_matched_HLT[0]" --per-weight --save-weight --histo-name "mutau_sel_MT40OSHLT/dy/NOMINAL/mutau_sel_MT40OSHLT_dy_NOMINAL_geom_tau_sv_sign"     --output foobarNOHLT_Mt40OSHLT_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &

hadd foobarNOHLT_Mt40_OS_HLT.root foobarNOHLT_Mt40OS_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root foobarNOHLT_Mt40OS_SingleMuon.root foobarNOHLT_Mt40OSHLT_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root foobarNOHLT_Mt40OSHLT_SingleMuon.root

data_os = (TH1D*) mutau_sel_MT40OS->Get("data/NOMINAL/mutau_sel_MT40OS_data_NOMINAL_geom_tau_sv_sign")
dy_os   = (TH1D*) mutau_sel_MT40OS->Get("dy/NOMINAL/mutau_sel_MT40OS_dy_NOMINAL_geom_tau_sv_sign")
dy_os->Scale(5765.4 * 35800)
dy_os->Print()
data_os->Print()
dy_os->SetLineColor(kRed)
data_os->Draw()
dy_os->Draw("same")

TH1.Print Name  = mutau_sel_MT40OS_dy_NOMINAL_geom_tau_sv_sign, Entries= 4817, Total sum= 6664.21
TH1.Print Name  = mutau_sel_MT40OS_data_NOMINAL_geom_tau_sv_sign, Entries= 16560, Total sum= 16440

data_os_hlt = (TH1D*) mutau_sel_MT40OSHLT->Get("data/NOMINAL/mutau_sel_MT40OSHLT_data_NOMINAL_geom_tau_sv_sign")
dy_os_hlt   = (TH1D*) mutau_sel_MT40OSHLT->Get("dy/NOMINAL/mutau_sel_MT40OSHLT_dy_NOMINAL_geom_tau_sv_sign")
dy_os_hlt->Scale(5765.4 * 35800)
dy_os_hlt->Print()
data_os_hlt->Print()
dy_os_hlt->SetLineColor(kRed)
data_os_hlt->Draw()
dy_os_hlt->Draw("same")

TH1.Print Name  = mutau_sel_MT40OSHLT_dy_NOMINAL_geom_tau_sv_sign, Entries= 4806, Total sum= 6648.85
TH1.Print Name  = mutau_sel_MT40OSHLT_data_NOMINAL_geom_tau_sv_sign, Entries= 16546, Total sum= 16426




### checking gen lepton pt

with gen2_leptons_p4

((TTree*) ntupler->Get("reduced_ttree"))->Scan("gen2_leptons_p4[0].pt():gen2_leptons_p4[1].pt():gen2_leptons_p4[2].pt()", "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0")

-- most of events don't have the lepton
others have only 1 as should be

((TTree*) ntupler->Get("reduced_ttree"))->Scan("gen2_leptons_p4[0].pt():gen2_leptons_p4[1].pt():gen2_leptons_p4[2].pt()", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0")

-- mostly 2 or 1 lepton, sometimes none

?????????????????????????????????????????????????

gen_final_p4 gen_final_pdgId gen_final_chainId gen_final_ndaughters

gen_final_pdgId[0]:gen_final_pdgId[1]:gen_final_pdgId[2]:gen_final_pdgId[3]:gen_final_pdgId[4]
gen_final_chainId[0]:gen_final_chainId[1]:gen_final_chainId[2]:gen_final_chainId[3]:gen_final_chainId[4]
gen_final_ndaughters[0]:gen_final_ndaughters[1]:gen_final_ndaughters[2]:gen_final_ndaughters[3]:gen_final_ndaughters[4]

((TTree*) ntupler->Get("reduced_ttree"))->Scan("gen_final_ndaughters[0]:gen_final_ndaughters[1]:gen_final_ndaughters[2]:gen_final_ndaughters[3]:gen_final_ndaughters[4]", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0")

-- all 0 daughters, muons and photos are from chainID 23 (Z), pdgID = muons, photons and protons

((TTree*) ntupler->Get("reduced_ttree"))->Scan("gen_final_ndaughters[0]:gen_final_ndaughters[1]:gen_final_ndaughters[2]:gen_final_ndaughters[3]:gen_final_ndaughters[4]", "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0")

-- all 0

((TTree*) ntupler->Get("reduced_ttree"))->Scan("gen_final_pdgId[0]:gen_final_pdgId[1]:gen_final_pdgId[2]:gen_final_pdgId[3]:gen_final_pdgId[4]:gen_final_pdgId[5]:gen_final_pdgId[6]:gen_final_pdgId[7]:gen_final_pdgId[8]", "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0")
((TTree*) ntupler->Get("reduced_ttree"))->Scan("gen_final_chainId[0]:gen_final_chainId[1]:gen_final_chainId[2]:gen_final_chainId[3]:gen_final_chainId[4]:gen_final_chainId[5]:gen_final_chainId[6]:gen_final_chainId[7]:gen_final_chainId[8]", "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0")

-- protons and tau products in final state, tau products are from 23 (Z)

((TTree*) ntupler->Get("reduced_ttree"))->Scan("gen_final_p4[0].pt():gen_final_p4[1].pt():gen_final_p4[2].pt():gen_final_p4[3].pt():gen_final_p4[4].pt():gen_final_p4[5].pt():gen_final_p4[6].pt():gen_final_p4[7].pt():gen_final_p4[8].pt()", "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0")

-- out of first 11 tau-muons only 2 pass 22GeV cut and only 1 passes 24 GeV (one is barely above 22, another one is 25)

in mumu

((TTree*) ntupler->Get("reduced_ttree"))->Scan("gen_final_p4[0].pt():gen_final_p4[1].pt():gen_final_p4[2].pt():gen_final_p4[3].pt():gen_final_p4[4].pt():gen_final_p4[5].pt():gen_final_p4[6].pt():gen_final_p4[7].pt():gen_final_p4[8].pt()", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0")
((TTree*) ntupler->Get("reduced_ttree"))->Scan("gen_final_pdgId[0]:gen_final_pdgId[1]:gen_final_pdgId[2]:gen_final_pdgId[3]:gen_final_pdgId[4]:gen_final_pdgId[5]:gen_final_pdgId[6]:gen_final_pdgId[7]:gen_final_pdgId[8]", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0")

-- easily above 30GeV










# testing the tau momenta in MC at gen level: orig -> vis + invis

((TTree*) ntupler->Get("reduced_ttree"))->Draw("(gen_tt_tau_vis_p4[lep_matching_gen_collection[0]] + gen_tt_tau_invis_p4[lep_matching_gen_collection[0]]).pt()", "lep_matching_gen_collection[0]>-1")

-- the sum does not work in the root interpreter
try separate components:

((TTree*) ntupler->Get("reduced_ttree"))->Draw("gen_tt_tau_orig_p4[lep_matching_gen_collection[0]].X() / (gen_tt_tau_vis_p4[lep_matching_gen_collection[0]].X() + gen_tt_tau_invis_p4[lep_matching_gen_collection[0]].X())", "lep_matching_gen_collection[0]>-1")

= 1



((TTree*) ntupler->Get("reduced_ttree"))->Draw("gen_tt_tau_orig_p4[lep_matching_gen_collection[0]].Y() / (gen_tt_tau_vis_p4[lep_matching_gen_collection[0]].Y() + gen_tt_tau_invis_p4[lep_matching_gen_collection[0]].Y())", "lep_matching_gen_collection[0]>-1")

= 1 mostly, three entries at 0.625, 0.96 and 0.99
(neutrino-neutrino chains in gen level?)

((TTree*) ntupler->Get("reduced_ttree"))->Draw("gen_tt_tau_orig_p4[lep_matching_gen_collection[0]].Z() / (gen_tt_tau_vis_p4[lep_matching_gen_collection[0]].Z() + gen_tt_tau_invis_p4[lep_matching_gen_collection[0]].Z())", "lep_matching_gen_collection[0]>-1")

((TTree*) ntupler->Get("reduced_ttree"))->Draw("gen_tt_tau_orig_p4[lep_matching_gen_collection[0]].T() / (gen_tt_tau_vis_p4[lep_matching_gen_collection[0]].T() + gen_tt_tau_invis_p4[lep_matching_gen_collection[0]].T())", "lep_matching_gen_collection[0]>-1")


hadronic taus:

((TTree*) ntupler->Get("reduced_ttree"))->Draw("gen_tt_tau_orig_p4[tau_matching_gen_collection[0]].X() / (gen_tt_tau_vis_p4[tau_matching_gen_collection[0]].X() + gen_tt_tau_invis_p4[tau_matching_gen_collection[0]].X())", "tau_matching_gen_collection[0]>-1")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("gen_tt_tau_orig_p4[tau_matching_gen_collection[0]].Y() / (gen_tt_tau_vis_p4[tau_matching_gen_collection[0]].Y() + gen_tt_tau_invis_p4[tau_matching_gen_collection[0]].Y())", "tau_matching_gen_collection[0]>-1")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("gen_tt_tau_orig_p4[tau_matching_gen_collection[0]].Z() / (gen_tt_tau_vis_p4[tau_matching_gen_collection[0]].Z() + gen_tt_tau_invis_p4[tau_matching_gen_collection[0]].Z())", "tau_matching_gen_collection[0]>-1")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("gen_tt_tau_orig_p4[tau_matching_gen_collection[0]].T() / (gen_tt_tau_vis_p4[tau_matching_gen_collection[0]].T() + gen_tt_tau_invis_p4[tau_matching_gen_collection[0]].T())", "tau_matching_gen_collection[0]>-1")

= 1 +- 0.004


ok, run on grid and check later




submit on tt and dy:

/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/RunIISummer16MiniAODv2-PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/MINIAODSIM
/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/RunIISummer16MiniAODv2-PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6_ext1-v2/MINIAODSIM
/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/RunIISummer16MiniAODv2-PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6_ext2-v1/MINIAODSIM












# enriched

## mu enriched qcd

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4."   nt=v35 p=pStage2MuEnriched  cond="selection_stage_tt_alliso==503" chan="alliso_mu_sel" dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5"  nt=v35 p=pStage2MuEnriched  cond="selection_stage_tt_alliso==513" chan="alliso_el_sel" dtag="QCD" &

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4."   nt=v35 p=pStage2MuEnriched  cond="selection_stage_tt_alliso==502" chan="alliso_mu_sel_ss" dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5"  nt=v35 p=pStage2MuEnriched  cond="selection_stage_tt_alliso==512" chan="alliso_el_sel_ss" dtag="QCD" &


foreach d ( `cat merge-sets/jobs_hadd.dtags.qcd-mu-enriched` )
hadd distrs/$d.root distrs/v35pStage2MuEnriched/*$d*root &
end


TH1D* h_mu    = (TH1D*) alliso_mu_sel   ->Get("qcd/NOMINAL/alliso_mu_sel_qcd_NOMINAL_relIso")
TH1D* h_mu_ss = (TH1D*) alliso_mu_sel_ss->Get("qcd/NOMINAL/alliso_mu_sel_ss_qcd_NOMINAL_relIso")
h_mu->Divide(h_mu_ss)
h_mu->Draw()

TH1D* h_el    = (TH1D*) alliso_el_sel   ->Get("qcd/NOMINAL/alliso_el_sel_qcd_NOMINAL_relIso")
TH1D* h_el_ss = (TH1D*) alliso_el_sel_ss->Get("qcd/NOMINAL/alliso_el_sel_ss_qcd_NOMINAL_relIso")
h_el->Divide(h_el_ss)
h_el->Draw()






## EM Enriched QCD test

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4."   nt=v35 p=pStage2EMEnriched  cond="selection_stage_tt_alliso==503" chan="alliso_mu_sel"    dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4."   nt=v35 p=pStage2EMEnriched  cond="selection_stage_tt_alliso==502" chan="alliso_mu_sel_ss" dtag="QCD" &


time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5"  nt=v35 p=pStage2EMEnriched  cond="selection_stage_tt_alliso==513" chan="alliso_el_sel"    dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5"  nt=v35 p=pStage2EMEnriched  cond="selection_stage_tt_alliso==512" chan="alliso_el_sel_ss" dtag="QCD" &


foreach d ( `cat merge-sets/jobs_hadd.dtags.qcd-em-enriched` )
hadd distrs/$d.root distrs/v35pStage2EMEnriched/*$d*root &
end


TH1D* h_el    = (TH1D*) alliso_el_sel   ->Get("qcd/NOMINAL/alliso_el_sel_qcd_NOMINAL_relIso")
TH1D* h_el_ss = (TH1D*) alliso_el_sel_ss->Get("qcd/NOMINAL/alliso_el_sel_ss_qcd_NOMINAL_relIso")
h_el->Divide(h_el_ss)
h_el->Draw()


-- file by file is kind of flat indeed

hadd antiiso_emenriched_v35pStage2EMEnriched.root v35pStage2EMEnriched/MC*
hadd antiiso_emenriched_v35pStage2EMEnriched.root MC2016_Summer16_QCD_EMEnriched_Pt-20to30.root MC2016_Summer16_QCD_EMEnriched_Pt-30to50.root MC2016_Summer16_QCD_EMEnriched_Pt-50to80.root MC2016_Summer16_QCD_EMEnriched_Pt-80to120.root MC2016_Summer16_QCD_EMEnriched_Pt-120to170.root MC2016_Summer16_QCD_EMEnriched_Pt-170to300.root MC2016_Summer16_QCD_EMEnriched_Pt-300toInf.root

hadd antiiso_double_emenriched_v35pStage2EMEnriched.root MC2016_Summer16_QCD_EMEnriched_Pt-30toInf.root MC2016_Summer16_QCD_EMEnriched_Pt-40toInf.root MC2016_Summer16_QCD_EMEnriched_Pt-30to40.root

hadd antiiso_emenriched_v35pStage2EMEnriched.root MC2016_Summer16_QCD_EMEnriched_Pt-20to30.root MC2016_Summer16_QCD_EMEnriched_Pt-30to50.root MC2016_Summer16_QCD_EMEnriched_Pt-50to80.root MC2016_Summer16_QCD_EMEnriched_Pt-80to120.root MC2016_Summer16_QCD_EMEnriched_Pt-120to170.root MC2016_Summer16_QCD_EMEnriched_Pt-170to300.root MC2016_Summer16_QCD_EMEnriched_Pt-300toInf.root

w.o. 80to120

hadd antiiso_emenriched_v35pStage2EMEnriched.root MC2016_Summer16_QCD_EMEnriched_Pt-20to30.root MC2016_Summer16_QCD_EMEnriched_Pt-30to50.root MC2016_Summer16_QCD_EMEnriched_Pt-50to80.root  MC2016_Summer16_QCD_EMEnriched_Pt-120to170.root MC2016_Summer16_QCD_EMEnriched_Pt-170to300.root MC2016_Summer16_QCD_EMEnriched_Pt-300toInf.root

hadd antiiso_emenriched_v35pStage2EMEnriched.root MC2016_Summer16_QCD_EMEnriched_Pt-120to170.root MC2016_Summer16_QCD_EMEnriched_Pt-170to300.root MC2016_Summer16_QCD_EMEnriched_Pt-300toInf.root
hadd antiiso_emenriched_v35pStage2EMEnriched.root MC2016_Summer16_QCD_EMEnriched_Pt-120to170.root MC2016_Summer16_QCD_EMEnriched_Pt-170to300.root



 xsec: 557600000, eff: 0.0096, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-20to30        
 xsec: 136000000, eff: 0.073, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-30to50         
 xsec: 136000000, eff: 0.073, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-30to50_ext1   
 xsec: 19800000,  eff: 0.146, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-50to80        
 xsec: 19800000,  eff: 0.146, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-50to80_ext1   
 xsec: 2800000,   eff: 0.151, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-80to120        
 xsec: 2800000,   eff: 0.151, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-80to120_ext1  
 xsec: 477000,    eff: 0.162, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-120to170      
 xsec: 477000,    eff: 0.162, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-120to170_ext1 
 xsec: 114000,    eff: 0.165, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-170to300      
 xsec: 9000,      eff: 0.15, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-300toInf      
 xsec: 162060000, eff: 0.0016, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-30toInf       
 xsec: 108000000, eff: 0.000225, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-30to40        
 xsec: 54120000,  eff: 0.002, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-40toInf       










# NOMINAL Mt for paper

mc rest:

time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="selection_stage==107"  chan="mu_sel" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="selection_stage==106"  chan="mu_sel_ss" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="selection_stage==117"  chan="el_sel" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="selection_stage==116"  chan="el_sel_ss" &


time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="(selection_stage==107 || selection_stage==105)"  chan="mu_selVloose" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="(selection_stage==106 || selection_stage==104)"  chan="mu_selVloose_ss" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="(selection_stage==117 || selection_stage==115)"  chan="el_selVloose" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="(selection_stage==116 || selection_stage==114)"  chan="el_selVloose_ss" &



mc tt:

time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="selection_stage==107"  chan="mu_sel" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="selection_stage==106"  chan="mu_sel_ss" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==117"  chan="el_sel" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==116"  chan="el_sel_ss" &


time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="(selection_stage==107 || selection_stage==105)"  chan="mu_selVloose" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="(selection_stage==106 || selection_stage==104)"  chan="mu_selVloose_ss" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="(selection_stage==117 || selection_stage==115)"  chan="el_selVloose" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="(selection_stage==116 || selection_stage==114)"  chan="el_selVloose_ss" &


data (old selection stages):

time make distrs_data_nominal      p=pStage2Run3  cond="selection_stage==105"  chan="mu_sel"    &
time make distrs_data_nominal      p=pStage2Run3  cond="selection_stage==104"  chan="mu_sel_ss" &
time make distrs_data_nominal      p=pStage2Run3  cond="(selection_stage==105 || selection_stage==103)"  chan="mu_selVloose"    &
time make distrs_data_nominal      p=pStage2Run3  cond="(selection_stage==104 || selection_stage==102)"  chan="mu_selVloose_ss" &

time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="selection_stage==115"  chan="el_sel"    dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="selection_stage==114"  chan="el_sel_ss" dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="(selection_stage==115 || selection_stage==113)"  chan="el_selVloose"    dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="(selection_stage==114 || selection_stage==112)"  chan="el_selVloose_ss" dtag=SingleEle &


foreach d ( `cat all-dtags` )
hadd distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/$d.root distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj/*$d*root &
end


hadd v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root     v25v26_pStage2Run3_Run4_Run4Rest_nolj/*SingleMuon* &
hadd v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleElectron.root v25v26_pStage2Run3_Run4_Run4Rest_nolj/*SingleElectron* &


python stack_plot.py v25v26_pStage2Run3_Run4_Run4Rest_nolj.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleElectron.root -p -r -o plots/run4/nolj/ --lumi 31300 -c el_sel -x el_selVloose -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm

python stack_plot.py v25v26_pStage2Run3_Run4_Run4Rest_nolj.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root     -p -r -o plots/run4/nolj/ --lumi 35800 -c mu_sel -x mu_selVloose -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm


python stack_plot.py v25v26_pStage2Run3_Run4_Run4Rest_nolj.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root     -p -r -o plots/run4/ --lumi 35800 -c mu_sel    -x mu_selVloose    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm --title "" --title-x "M_{T}(#mu, MET), GeV" --title-y "Events/1GeV" --draw-overflows 5 --legend-shift 0.02

python stack_plot.py v25v26_pStage2Run3_Run4_Run4Rest_nolj.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleElectron.root -p -r -o plots/run4/ --lumi 31300 -c el_sel    -x el_selVloose    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm --title "" --title-x "M_{T}(e, MET), GeV"   --title-y "Events/1GeV" --draw-overflows 5 --legend-shift 0.02








#

$\tauh$ jet identification &  5.3 &  5.3 &  5.3 \\
         jet energy scale  &  3.8 &  2.9 &  3.6 \\
pileup                     &  3.1 &  2.5 &  2.2 \\
     b-tagging efficiency  &  2.1 &  2.3 &  2.2 \\
$\tauh$ misidentification background  &  3.2 &  2.9 &  1.5 \\
    jet energy resolution  &  2.1 &  0.6 &  1.2 \\
   electron ID efficiency  &  3.8 & -     &  1.1 \\
 single top normalization  &  0.7 &  0.9 &  0.7 \\
$\tauh$ energy scale       &  0.8 &  0.6 &  0.5 \\
       muon ID efficiency  &   -   &  0.7 &  0.5 \\
        QCD normalization  &  1.9 &  1.0 &  0.5 \\
         DY normalization  &  0.3 &  0.0 &  0.4 \\
   dibosons normalization  &  0.0 &  0.1 &  0.0 \\
     W+jets normalization  &  0.0 &  0.4 &  0.0 \\
luminosity                     &       2.5         &       2.5     &   2.5\\
%
\hline
%
\multicolumn{1}{l}\textit{Theoretical uncertainties:} & \\
top quark \pt modeling     &  3.1 &  4.3 &  3.4 \\
          b fragmentation  &  3.2 &  2.0 &  2.5 \\
    Final State Radiation  &  2.6 &  2.0 &  1.5 \\
  Initial State Radiation  &  1.7 &  1.7 &  1.3 \\
   ME-PS matching (hdamp)  &  0.6 &  0.2 &  0.7 \\
 ME Renormalization scale  &  0.7 &  1.4 &  0.8 \\
ME combined scale variation  &  0.3 &  0.7 &  0.5 \\
   ME Factorization scale  &  0.5 &  0.7 &  0.4 \\
Underlying event (Pythia tune)  &  0.5 &  0.7 &  0.3 \\
b decay tables, Semileptonic BR  &  0.6 &  0.3 &  0.3 \\
PDF                             &  1.9 &  1.6 &  1.5 \\
MC statistics                   &  3.7 &  2.5 &  2.2 \\
\hline
\hline

python numbers_for_datacard.py histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights_test4.root -y -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --latex

                                 process &  el_sel_lj & el_sel_ljout &  mu_sel_lj & mu_sel_ljout \\
$\ttbar\rightarrow{\ell\tau}\nu\nu b\bar{b}$ ($\ell=e,\mu$) & $      5090 \pm        115 $ & $      7867 \pm        142 $ \\
$\ttbar\rightarrow{\ell\tau}\nu\nu b\bar{b}$ ($\ell=e,\mu$) & $      2962 \pm         87 $ & $      4624 \pm        110 $ \\
$\ttbar\rightarrow{\tau_{\ell}\tau_{h} \nu\nu b\bar{b} }$ & $       168 \pm         19 $ & $       276 \pm         25 $ & $       325 \pm         26 $ & $       514 \pm         34 $ \\
$\ttbar\rightarrow{\ell\nu jj b\bar{b}}$ & $      2184 \pm         42 $ & $      1433 \pm         34 $ & $      3730 \pm         56 $ & $      2509 \pm         45 $ \\
$\ttbar\rightarrow{\tau_{\ell}\nu jj b\bar{b}}$ & $       116 \pm          8 $ & $        75 \pm          7 $ & $       238 \pm         12 $ & $       160 \pm         10 $ \\
          $\ttbar\rightarrow{\rm other}$ & $        59 \pm          9 $ & $        98 \pm         11 $ & $       103 \pm         12 $ & $       179 \pm         15 $ \\
$\text{single top}\rightarrow{{\rm \ell} \tau}+X$ & $       150 \pm         14 $ & $       270 \pm         19 $ \\
$\text{single top}\rightarrow{{\rm \ell} \tau}+X$ & $       230 \pm         17 $ & $       446 \pm         25 $ \\
$\text{single top}\rightarrow{\rm other}$ & $        20 \pm          3 $ & $        31 \pm          5 $ & $        40 \pm          5 $ & $        61 \pm          7 $ \\
$\text{single top}\rightarrow{\ell j}+X$ & $       148 \pm          8 $ & $       166 \pm          8 $ & $       233 \pm         10 $ & $       294 \pm         11 $ \\
$\text{DY}\rightarrow{\tau_{\ell}\tau_{h}}+ {\rm jets}$ & $       100 \pm         27 $ & $       189 \pm         28 $ & $       202 \pm         32 $ & $       418 \pm         52 $ \\
       $\text{DY}\rightarrow{\rm other}$ & $        20 \pm         10 $ & $        59 \pm         19 $ & $        10 \pm         10 $ & $        33 \pm         14 $ \\
$\text{W+jets} \rightarrow\ell\nu+ {\rm jets}$ & $       111 \pm         33 $ & $       180 \pm         37 $ & $       256 \pm         49 $ & $       398 \pm         68 $ \\
$\text{W+jets} \rightarrow\tau_{\ell}\nu + {\rm jets}$ & $         7 \pm          3 $ & $         7 \pm          4 $ & $        22 \pm         14 $ & $        16 \pm          4 $ \\
                       $\text{dibosons}$ & $        23 \pm          4 $ & $        45 \pm          6 $ & $        42 \pm          6 $ & $        84 \pm         10 $ \\
                            $\text{QCD}$ & $       170 \pm         55 $ & $       411 \pm         74 $ & $       225 \pm         48 $ & $       314 \pm         59 $ \\
                                  mc_sum & $      6238 \pm        129 $ & $      7866 \pm        158 $ & $     10746 \pm        164 $ & $     13293 \pm        199 $ \\
                                    data & $      6200 \pm        236 $ & $      7896 \pm        273 $ & $     10243 \pm        298 $ & $     13558 \pm        352 $ \\









# problem with merging two datacards

JER               lnN           0.999/1.001           1.001/1.001           1.003/1.008           1.002/1.000           0.996/1.000           0.970/0.983           1.004/1.001           1.005/0.991           0.995/1.002           1.000/1.000           0.993/0.999           0.819/0.976           0.979/0.988            -       0.999/1.000           0.999/0.999           0.998/1.000           0.999/0.998           0.987/0.991           1.003/1.006           1.001/1.000           1.003/0.997           0.998/1.005           1.080/1.107           1.021/1.031           1.014/1.071           0.998/1.009               -

JER             shape          1.0    1.0   1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -                  1.0    1.0   1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -


python new_impact_table.py --merge-pdf latest_el_impacts.json latest_mu_impacts.json latest_both_impacts.json








# symmetric NLL asymmetric impacts


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -t -1 --expectSignal 1.0 -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit         --name MuImpactsToys
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -t -1 --expectSignal 1.0 -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5  --name MuImpactsToys
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -t -1 --expectSignal 1.0 -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 -o latest_mu_impacts_toys_3.json            --name MuImpactsToys
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_toys_3.json -o prefit_mu_impacts_toys

  JES       :   +0.000  -0.769/+0.831  +0.008/-0.000
  JER       :   -0.000  -0.750/+0.840  +0.007/+0.005
  TES       :   -0.000  -0.810/+0.796  +0.013/-0.003


example:

combine -M MultiDimFit ttxsec/fit-stuff/fresh_mu.txt --algo grid --points 2000 --rMax 2 --name MuShapes --forceRecreateNLL --saveSpecifiedNuis TOPPT,dy_norm --parameters TOPPT




combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid -t -1 --expectSignal 1.0 --points 100 --rMin 0.5 --rMax 1.5 --name MuShapesTest4 --freezeParameters lumi_13TeV         --saveSpecifiedNuis JES,JER,TES

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid -t -1 --expectSignal 1.0 --points 100 --rMin 0.5 --rMax 1.5 --name MuShapesTest4 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --saveSpecifiedNuis JES,JER,TES


combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid -t -1 --expectSignal 1.0 --points 200 --rMin 0.8 --rMax 1.2 --name MuShapesTest4 --freezeParameters lumi_13TeV         --saveSpecifiedNuis JES,JER,TES

limit->Draw("2*deltaNLL:r", "deltaNLL>0 && 2*deltaNLL<10", "L")
limit->Draw("2*deltaNLL:r", "deltaNLL>0 && 2*deltaNLL<1", "L")
limit->Draw("JES:r", "deltaNLL>0 && 2*deltaNLL<1", "L")
limit->Draw("JER:r", "deltaNLL>0 && 2*deltaNLL<1", "L")
limit->Draw("TES:r", "deltaNLL>0 && 2*deltaNLL<1", "L")


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -t -1 --expectSignal 1.0 -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -m 125 --robustFit 1 --doInitialFit         --name MuImpactsToys
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -t -1 --expectSignal 1.0 -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -m 125 --robustFit 1 --doFits --parallel 5  --name MuImpactsToys
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -t -1 --expectSignal 1.0 -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -m 125 -o latest_mu_impacts_toys_3.json            --name MuImpactsToys
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_toys_3.json -o prefit_mu_impacts_toys


only JES impact

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,JER,TES,stop_norm,dibos_norm,LEPmu --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,JER,TES,stop_norm,dibos_norm,LEPmu --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,JER,TES,stop_norm,dibos_norm,LEPmu --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.648/+0.689  +0.013/-0.014

without MC stats:

  JES       :   +0.000  -0.604/+0.646  +0.013/-0.013










# blown up electron systematics

many systematics (PDF, PU)
have both variations much larger than nominal: about x2 of nominal

time make distrs_mc_common_weights  p=pStage2Run4 nt=v26 option="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_nominal         p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &





re-hadd all

ls v26pStage2Run4 > group-hadds
split -l 500 group-hadds group-hadds_

cd v26pStage2Run4

foreach group ( `ls ../group-hadds_*` )
hadd $group.MC2016_Summer16_TTJets_powheg.root `cat $group` &
end

hadd v26pStage2Run4_hadds2/MC2016_Summer16_TTJets_powheg.root group-hadds_??.MC2016_Summer16_TTJets_powheg.root



hadd distrs_v25pStage2Run3_3_Run4_updowns_weights_4.root v25pStage2Run4Rest/MC* v25pStage2Run4Rest/wjets/MC* v25r4/MC* v26pStage2Run4/MC2016_Summer16_TTJets_powheg.root

cp  distrs_v25pStage2Run3_3_Run4_updowns_weights_4.root  ../distrs_v25pStage2Run3_3_Run4_updowns_weights.root

python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -p -r -o plots/run4/test4/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -p -r -o plots/run4/test4/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s PUUp
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -p -r -o plots/run4/test4/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s PUDown

hadd HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights_test4.root v25pStage2Run3_3_Run4_mu_ljs/*root v25pStage2Run3_3_Run4_el_ljs/*root

cp HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights_test4.root ../../../fit-stuff/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root









# rest of MC with new nominal TES etc

hopefully it will correct the issue with PU and wjets

time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="selection_stage==107 && event_jets_lj_var > 60."  chan="mu_sel_ljout" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="selection_stage==106 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &

time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60."  chan="el_sel_ljout" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &


time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &

time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var > 60."  chan="el_selVloose_ljout" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var > 60."  chan="el_selVloose_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &





time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25                      cond="selection_stage==107 && event_jets_lj_var >  60." chan="mu_sel_ljout" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25                      cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &

time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25                      cond="selection_stage==106 && event_jets_lj_var >  60." chan="mu_sel_ljout_ss" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25                      cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &



time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var >  60." chan="mu_selVloose_ljout" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &

time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var >  60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &





distrs_mc_lep_weights

time make distrs_mc_lep_weights   sysname=LEPmu p=pStage2Run4Rest nt=v25                      cond="selection_stage==107 && event_jets_lj_var >  60." chan="mu_sel_ljout" &
time make distrs_mc_lep_weights   sysname=LEPmu p=pStage2Run4Rest nt=v25                      cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_lep_weights   sysname=LEPel p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_lep_weights   sysname=LEPel p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &

time make distrs_mc_lep_weights   sysname=LEPmu p=pStage2Run4Rest nt=v25                      cond="selection_stage==106 && event_jets_lj_var >  60." chan="mu_sel_ljout_ss" &
time make distrs_mc_lep_weights   sysname=LEPmu p=pStage2Run4Rest nt=v25                      cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_lep_weights   sysname=LEPel p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_lep_weights   sysname=LEPel p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &



time make distrs_mc_lep_weights   sysname=LEPmu p=pStage2Run4Rest nt=v25                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var >  60." chan="mu_selVloose_ljout" &
time make distrs_mc_lep_weights   sysname=LEPmu p=pStage2Run4Rest nt=v25                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_lep_weights   sysname=LEPel p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_lep_weights   sysname=LEPel p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &

time make distrs_mc_lep_weights   sysname=LEPmu p=pStage2Run4Rest nt=v25                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var >  60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_lep_weights   sysname=LEPmu p=pStage2Run4Rest nt=v25                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_lep_weights   sysname=LEPel p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_lep_weights   sysname=LEPel p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &






and tt for electron channels


time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &




time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &






time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &





time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &





lepton SFs 
distrs_mc_lep_weights

time make distrs_mc_lep_weights  sysname=LEPmu  p=pStage2Run4 nt=v26                       cond="selection_stage==107 && event_jets_lj_var >  60." chan="mu_sel_ljout" &
time make distrs_mc_lep_weights  sysname=LEPmu  p=pStage2Run4 nt=v26                       cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_lep_weights  sysname=LEPmu  p=pStage2Run4 nt=v26                       cond="selection_stage==106 && event_jets_lj_var >  60." chan="mu_sel_ljout_ss" &
time make distrs_mc_lep_weights  sysname=LEPmu  p=pStage2Run4 nt=v26                       cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_lep_weights  sysname=LEPel  p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_lep_weights  sysname=LEPel  p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_lep_weights  sysname=LEPel  p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_lep_weights  sysname=LEPel  p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &


time make distrs_mc_lep_weights  sysname=LEPmu  p=pStage2Run4 nt=v26                       cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var >  60." chan="mu_selVloose_ljout" &
time make distrs_mc_lep_weights  sysname=LEPmu  p=pStage2Run4 nt=v26                       cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_lep_weights  sysname=LEPmu  p=pStage2Run4 nt=v26                       cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var >  60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_lep_weights  sysname=LEPmu  p=pStage2Run4 nt=v26                       cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_lep_weights  sysname=LEPel  p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_lep_weights  sysname=LEPel  p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_lep_weights  sysname=LEPel  p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_lep_weights  sysname=LEPel  p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &








foreach d ( `cat all-dtags` )
hadd distrs/v25pStage2Run4Rest_nominal_hadds/$d.root distrs/v25pStage2Run4Rest_nominal/*$d*root &
end

foreach d ( `cat all-dtags` )
hadd distrs/v25pStage2Run4Rest_sys_hadds/$d.root distrs/v25pStage2Run4Rest_sys/*$d*root &
end


foreach d ( `cat all-dtags` )
hadd distrs/v25pStage2Run4Rest_hadds/$d.root distrs/v25pStage2Run4Rest_sys_hadds/*$d*root distrs/v25pStage2Run4Rest_nominal_hadds/*$d*root &
end



hadd all

all mc
core wjets
updowns
tt

hadd distrs_v25pStage2Run3_3_Run4_updowns_weights_3.root v25pStage2Run4Rest/MC* v25pStage2Run4Rest/wjets/MC* v25r4/MC* v26pStage2Run4/2/MC2016_Summer16_TTJets_powheg.root

cp  distrs_v25pStage2Run3_3_Run4_updowns_weights_3.root  ../distrs_v25pStage2Run3_3_Run4_updowns_weights.root

hadd HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root v25pStage2Run3_3_Run4_mu_ljs/*root v25pStage2Run3_3_Run4_el_ljs/*root

cp HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root ../../../fit-stuff



-- apparently no change in the MC yields

use W0Jets?


checking for now:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  TES       :   +0.000  -0.607/+0.565  +0.013/-0.004
  JER       :   +0.000  -0.992/+0.990  +0.000/-0.000
  JES       :   +0.000  -0.599/+0.674  +0.008/-0.005

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.656/+0.739  +0.008/-0.005
  JER       :   +0.000  -0.992/+0.992  +0.000/-0.000
  TES       :   +0.000  -0.713/+0.618  +0.019/-0.007

with wjets:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.703/+0.779  +0.018/-0.002
  JER       :   +0.000  -0.993/+0.992  +0.001/-0.001
  TES       :   +0.000  -0.731/+0.690  +0.025/-0.004

kind of ok


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV -o latest_mu_toys_asimov_impacts_full_Run4Test3.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test3.json -o latest_mu_toys_asimov_impacts_full_Run4Test3

  JES       :   +0.000  -0.723/+0.799  +0.009/+0.001
  JER       :   +0.000  -0.993/+0.993  +0.000/-0.001
  TES       :   +0.000  -0.776/+0.758  +0.016/-0.002





../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV -o latest_mu_toys_asimov_impacts_full_Run4Test3.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test3.json -o latest_mu_toys_asimov_impacts_full_Run4Test3











# full redo tt with nominal tes

all rest MC without tt
updowns
and tt v26 with weights

hadd distrs_v25pStage2Run3_3_Run4_updowns_weights.root   v25pStage2Run3/MC* v25r4/MC* v26r4/MC2016_Summer16_TTJets_powheg.root

now:

hadd distrs_v25pStage2Run3_3_Run4_updowns_weights_2.root v25pStage2Run3/MC* v25r4/MC* v26pStage2Run4/2/MC2016_Summer16_TTJets_powheg.root




ls v26pStage2Run4 > group-hadds
split -l 500 group-hadds group-hadds_

cd v26pStage2Run4

foreach group ( `ls ../group-hadds_*` )
hadd $group.MC2016_Summer16_TTJets_powheg.root `cat $group` &
end

hadd v26pStage2Run4_hadds2/MC2016_Summer16_TTJets_powheg.root group-hadds_??.MC2016_Summer16_TTJets_powheg.root

hadd distrs_v25pStage2Run3_3_Run4_updowns_weights_2.root v25pStage2Run3/MC* v25r4/MC* v26pStage2Run4/2/MC2016_Summer16_TTJets_powheg.root

cp distrs_v25pStage2Run3_3_Run4_updowns_weights_2.root ../distrs_v25pStage2Run3_3_Run4_updowns_weights.root

rm histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/*
rm histosel-roots/v25pStage2Run3_3_Run4_el_ljs/*

source histosel_stage2_run3_3_Run4_VlooseShapes_el_sel_ljs &
source histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs &

source histosel_stage2_run3_3_Run4_VlooseShapes_el_sel_ljs_rest &
source histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs_rest &

source histosel_stage2_run3_3_Run4_VlooseShapes_el_sel_ljs_pdfs &
source histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs_pdfs &


redo lepton systematics:

python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root  -o histosel-roots/v25pStage2Run3_3_Run4_el_ljs/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8    -s LEPelUp &
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root  -o histosel-roots/v25pStage2Run3_3_Run4_el_ljs/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8    -s LEPelUp &

python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root  -o histosel-roots/v25pStage2Run3_3_Run4_el_ljs/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8    -s LEPelDown &
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root  -o histosel-roots/v25pStage2Run3_3_Run4_el_ljs/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8    -s LEPelDown &


python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8    -s LEPmuUp &
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8    -s LEPmuUp &

python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8    -s LEPmuDown &
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8    -s LEPmuDown &






hadd HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root v25pStage2Run3_3_Run4_mu_ljs/*root v25pStage2Run3_3_Run4_el_ljs/*root



../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit               --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5        --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 -o latest_mu_impacts_Run4Test2.json  --name MuImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_Run4Test2.json -o postfit_mu_impacts_Run4Test2


-- JES and JER are assymetric again, in the same way as usual
JES +9 -1  * 10^-3
JER +7 +5  * 10^-3
-- but they are smaller then in the first test

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2




again all three asymmetric

JER       :   -0.000  -0.699/+0.673  +0.016/+0.016
JES       :   +0.000  -0.696/+0.678  +0.018/+0.008
TES       :   -0.000  -0.665/+0.655  +0.023/+0.011

dmn
why??????


try leaving them in TT only, no old MCs






## JES JER TES only in TT

full:

JES             shape       1.0 1.0 1.0 1.0 1.0        1.0      1.0 1.0 1.0      1.0 1.0      1.0 1.0      -               1.0 1.0 1.0 1.0 1.0        1.0      1.0 1.0 1.0      1.0 1.0      1.0 1.0      -
JER             shape       1.0 1.0 1.0 1.0 1.0        1.0      1.0 1.0 1.0      1.0 1.0      1.0 1.0      -               1.0 1.0 1.0 1.0 1.0        1.0      1.0 1.0 1.0      1.0 1.0      1.0 1.0      -
TES             shape       1.0 1.0 1.0 1.0 1.0        1.0      1.0 1.0 1.0      1.0 1.0      1.0 1.0      -               1.0 1.0 1.0 1.0 1.0        1.0      1.0 1.0 1.0      1.0 1.0      1.0 1.0      -


only TT:

JES             shape       1.0 1.0 1.0 1.0 1.0        -        -   -   -        -   -        -   -        -               1.0 1.0 1.0 1.0 1.0        -        -   -   -        -   -        -   -        -
JER             shape       1.0 1.0 1.0 1.0 1.0        -        -   -   -        -   -        -   -        -               1.0 1.0 1.0 1.0 1.0        -        -   -   -        -   -        -   -        -
TES             shape       1.0 1.0 1.0 1.0 1.0        -        -   -   -        -   -        -   -        -               1.0 1.0 1.0 1.0 1.0        -        -   -   -        -   -        -   -        -


still:

  JER       :   +0.000  -0.751/+0.836  +0.009/+0.006
  JES       :   +0.000  -0.773/+0.830  +0.010/+0.001
  TES       :   -0.000  -0.810/+0.793  +0.014/-0.001






## rate based JER

JER             shape       1.0 1.0 1.0 1.0 1.0        1.0      1.0 1.0 1.0      1.0 1.0      1.0 1.0      -               1.0 1.0 1.0 1.0 1.0        1.0      1.0 1.0 1.0      1.0 1.0      1.0 1.0      -

JER             shape       1.0 1.0 1.0 1.0 1.0        -        -   -   -        -   -        -   -        -               1.0 1.0 1.0 1.0 1.0        -        -   -   -        -   -        -   -        -


python yield_variations.py histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other,dibosons,s_top_lj,s_top_other,s_top_mutau,wjets_taul,wjets_other,dy_other,dy_tautau -s JER

                                 mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj    mu_sel_lj      mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout    mu_sel_ljout
                                  tt_mutau                 tt_lj              tt_taulj           tt_taultauh              tt_other              dibosons              s_top_lj           s_top_other           s_top_mutau            wjets_taul           wjets_other              dy_other             dy_tautau          qcd          tt_mutau                 tt_lj              tt_taulj           tt_taultauh              tt_other              dibosons              s_top_lj           s_top_other           s_top_mutau            wjets_taul           wjets_other              dy_other             dy_tautau             qcd
                 JER           0.999/1.001           1.001/1.001           1.003/1.008           1.002/1.000           0.996/1.000           0.970/0.983           1.004/1.001           1.005/0.991           0.995/1.002           1.000/1.000           0.993/0.999           0.819/0.976           0.979/0.988            -       0.999/1.000           0.999/0.999           0.998/1.000           0.999/0.998           0.987/0.991           1.003/1.006           1.001/1.000           1.003/0.997           0.998/1.005           1.080/1.107           1.021/1.031           1.014/1.071           0.998/1.009               -



toy fit with PU on only

  TES       :   +0.000  -0.607/+0.566  +0.013/-0.004
  JER       :   +0.000  -0.992/+0.991  +0.000/-0.000
  JES       :   +0.000  -0.599/+0.674  +0.008/-0.005

-- kind of ok

full toy fit

  TES       :   +0.000  -0.778/+0.754  +0.017/-0.000
  JER       :   +0.000  -0.992/+0.993  +0.000/-0.001
  JES       :   +0.000  -0.730/+0.798  +0.011/+0.002

freeze JER

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,JER --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,JER --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,JER -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,JER,PU --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,JER,PU --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,JER,PU -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2


the usual check:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

-- works!

with groups:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  TES       :   +0.000  -0.736/+0.702  +0.008/-0.004
  JER       :   +0.000  -0.992/+0.991  +0.000/-0.000
  JES       :   +0.000  -0.639/+0.745  +0.006/-0.004

-- fine!

-- suddenly FSR is constrained a lot! -- it's not balanced out by fakes!

only without tau:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,tauID_eff,tau_fakes --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,tauID_eff,tau_fakes --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,tauID_eff,tau_fakes -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  TES       :   +0.000  -0.777/+0.754  +0.019/+0.002
  JER       :   +0.000  -0.993/+0.993  +0.000/-0.001
  JES       :   +0.000  -0.727/+0.791  +0.014/+0.001

-- ha!

only added wjets:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,qcd_norm --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,qcd_norm --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,qcd_norm -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.663/+0.781  +0.008/-0.001
  JER       :   +0.000  -0.994/+0.992  +0.000/-0.000
  TES       :   +0.000  -0.740/+0.746  +0.010/-0.001

full fit without wjets:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.692/+0.763  +0.001/-0.005
  JER       :   +0.000  -0.993/+0.993  +0.000/-0.001
  TES       :   +0.000  -0.761/+0.720  +0.010/-0.009

hmmm

no wjets and no PU too:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm,PU --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm,PU --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm,PU -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.692/+0.763  +0.001/-0.005
  JER       :   +0.000  -0.993/+0.993  +0.000/-0.001
  TES       :   +0.000  -0.761/+0.720  +0.010/-0.009

on real data:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsTest2   --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm,PU --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsTest2   --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm,PU --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsTest2   --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm,PU -o latest_mu_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_Run4Test2.json -o latest_mu_Run4Test2


  TES       :   -0.039  -0.434/+0.362  +0.003/-0.003
  JER       :   -0.022  -1.042/+1.062  +0.000/-0.000
  JES       :   -0.013  -0.322/+0.316  -0.001/-0.000

real data full set:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsTest2   --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsTest2   --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsTest2   --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV -o latest_mu_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_Run4Test2.json -o latest_mu_Run4Test2







## impacts with only objects

testing correlation with all systematics one by one

standard fit with all systematics:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2


no theory:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  TES       :   +0.000  -0.626/+0.565  +0.015/-0.012
  JER       :   +0.000  -0.665/+0.774  +0.000/+0.001
  JES       :   +0.000  -0.623/+0.686  +0.009/-0.008



tau on

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  TES       :   +0.000  -0.626/+0.565  +0.015/-0.012
  JER       :   +0.000  -0.665/+0.774  +0.000/+0.001
  JES       :   +0.000  -0.623/+0.686  +0.009/-0.008



exp on

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JER       :   +0.000  -0.707/+0.803  +0.008/+0.007
  TES       :   +0.000  -0.772/+0.750  +0.016/-0.003
  JES       :   +0.000  -0.729/+0.789  +0.011/-0.000


-- one of exp!

only exp on

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.721/+0.784  +0.015/-0.001
  JER       :   +0.000  -0.706/+0.802  +0.009/+0.007
  TES       :   +0.000  -0.741/+0.704  +0.021/+0.002

exps:
exp group = tauID_eff tau_fakes dy_norm wjets_norm qcd_norm bSF PU TOPPT

norms:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JER       :   +0.000  -0.665/+0.775  +0.002/+0.002
  JES       :   +0.000  -0.645/+0.729  +0.003/+0.003
  TES       :   +0.000  -0.691/+0.649  +0.014/+0.004

the others:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   -0.000  -0.699/+0.780  +0.011/-0.002
  JER       :   +0.000  -0.695/+0.798  +0.006/+0.005
  TES       :   +0.000  -0.686/+0.682  +0.011/-0.002


--- ??? so which

again:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.623/+0.686  +0.009/-0.008
  JER       :   +0.000  -0.665/+0.774  +0.000/+0.001
  TES       :   +0.000  -0.626/+0.565  +0.015/-0.012


-- maybe there are several affecting params?

tau fakes:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.623/+0.686  +0.009/-0.008
  JER       :   +0.000  -0.665/+0.774  +0.000/+0.001
  TES       :   +0.000  -0.626/+0.565  +0.015/-0.012


tau ID:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.623/+0.686  +0.009/-0.008
  JER       :   +0.000  -0.665/+0.774  +0.000/+0.001
  TES       :   +0.000  -0.626/+0.565  +0.015/-0.012



PU:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  TES       :   +0.000  -0.653/+0.646  +0.009/+0.006
  JER       :   +0.000  -0.665/+0.775  +0.000/+0.002
  JES       :   +0.000  -0.640/+0.726  +0.003/+0.003

--- PU !!!!!!!!!!

all PU:

PU              shape          1.0    1.0   1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -                  1.0    1.0   1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -

only-TT PU:

PU              shape          1.0    1.0   1.0   1.0   1.0        -        -     -     -        -     -        -     -        -                  1.0    1.0   1.0   1.0   1.0        -        -     -     -        -     -        -     -        -

-- run

  JER       :   +0.000  -0.666/+0.775  +0.002/+0.003
  JES       :   +0.000  -0.634/+0.716  +0.005/+0.002
  TES       :   +0.000  -0.646/+0.644  +0.010/+0.005

--- same stuff...

NLL scan with these parameters

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid -t -1 --expectSignal 1.0 --points 80 --rMin 0.6 --rMax 1.4 --name MuShapes3 --freezeParameters  lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau  --saveSpecifiedNuis JES,JER,TES,PU

--freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau
--freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau

no JER:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm,JER --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm,JER --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm,JER --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JER       :   +0.000  +0.000/+0.000  +0.000/+0.000
  JES       :   +0.000  -0.599/+0.674  +0.008/-0.005
  TES       :   +0.000  -0.607/+0.565  +0.013/-0.004

-- ha



TOPPT:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  TES       :   +0.000  -0.672/+0.573  +0.021/-0.013
  JER       :   +0.000  -0.665/+0.774  +0.000/+0.000
  JES       :   +0.000  -0.627/+0.689  +0.011/-0.009



bSF:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.623/+0.686  +0.009/-0.008
  JER       :   +0.000  -0.665/+0.774  +0.000/+0.001
  TES       :   +0.000  -0.626/+0.565  +0.015/-0.012


the rest of norms: dy wjets qcd

dy

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.628/+0.686  +0.009/-0.008
  JER       :   +0.000  -0.666/+0.775  +0.000/+0.000
  TES       :   +0.000  -0.628/+0.565  +0.015/-0.012


wjets

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.623/+0.767  +0.009/-0.001
  JER       :   +0.000  -0.682/+0.787  +0.004/+0.004
  TES       :   +0.000  -0.651/+0.675  +0.009/-0.003

-- WJETS to some extend!!!!!!!!!!!!!!!!!!!!


qcd

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  TES       :   -0.000  -0.686/+0.620  +0.011/-0.008
  JER       :   +0.000  -0.665/+0.774  +0.000/+0.001
  JES       :   +0.000  -0.673/+0.747  +0.006/-0.006

again all norms:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   -0.000  -0.699/+0.780  +0.011/-0.002
  JER       :   +0.000  -0.695/+0.798  +0.006/+0.005
  TES       :   +0.000  -0.686/+0.682  +0.011/-0.002


--- this is it!

PU & WJETS













without MC stats:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.623/+0.686  +0.009/-0.008
  JER       :   +0.000  -0.665/+0.774  +0.000/+0.001
  TES       :   +0.000  -0.626/+0.565  +0.015/-0.012


with MC stats:

  JES       :   -0.000  -0.666/+0.723  +0.010/-0.009
  JER       :   +0.000  -0.706/+0.808  +0.000/+0.000
  TES       :   -0.000  -0.664/+0.605  +0.016/-0.013









## effect of JER

in stack plot JER  up and down shapes deviate from nominal in the same way

python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_ljout -d Mt_lep_met_f -s JERUp,JERDown 
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_ljout -d Mt_lep_met_f -s JERUp,JERDown 

python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_lj    -d Mt_lep_met_f -s JERUp,JERDown 
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_lj    -d Mt_lep_met_f -s JERUp,JERDown 


redo JER?


python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_ljout -d Mt_lep_met_f -s PUUp,PUDown 
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_ljout -d Mt_lep_met_f -s PUUp,PUDown 

python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_lj    -d Mt_lep_met_f -s PUUp,PUDown 
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_lj    -d Mt_lep_met_f -s PUUp,PUDown 










## distributions

python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm 
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s JESUp
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s JESDown
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s JERUp
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s JERDown
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s TESUp
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s TESDown

python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm 
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s JESUp
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s JESDown
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s JERUp
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s JERDown
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s TESUp
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s TESDown


## correlations

combine -M FitDiagnostics ttxsec/fit-stuff/latest_datacard_mu.root                          --plots --saveShapes --saveWithUncertainties --name MuShapes3

combine -M FitDiagnostics ttxsec/fit-stuff/latest_datacard_mu.root -t -1 --expectSignal 1.0 --plots --saveShapes --saveWithUncertainties --name MuShapes3


combine -M FitDiagnostics ttxsec/fit-stuff/latest_datacard_mu.root -t -1 --expectSignal 1.0 --plots --saveShapes --saveWithUncertainties --name MuShapes3 --freezeNuisanceGroup tt_th_pdf

eog covariance_fit_s.png


* autoMCStats 0










# some weird issues in the fit after Run4 patch of jbect systematics

maybe it's due to TES in nominal MC?
-- need to correct all systematics (weight-based too)


combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid --points 80 --rMin 0.6 --rMax 1.4 --freezeNuisanceGroup exp,tau,tt_th_frag,tt_th_pdf,tt_updowns --name MuShapes3 --freezeParameters lumi_13TeV  --saveSpecifiedNuis JES,JER,TES

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid --points 80 --rMin 0.6 --rMax 1.4 --freezeNuisanceGroup exp,tau,tt_th_frag,tt_th_pdf,tt_updowns --name MuShapes3 --freezeParameters lumi_13TeV,TES,JER  --saveSpecifiedNuis JES

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid -t -1 --expectSignal 1.0 --points 80 --rMin 0.6 --rMax 1.4 --freezeNuisanceGroup exp,tau,tt_th_frag,tt_th_pdf,tt_updowns --name MuShapes3 --freezeParameters lumi_13TeV,TES,JER  --saveSpecifiedNuis JES


combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid --points 80 --rMin 0.6 --rMax 1.4 --freezeNuisanceGroup tt_th_frag,tt_th_pdf,tt_updowns --name MuShapes3 --freezeParameters lumi_13TeV,TES,JER,JES

-- on Run4 0.68  with objects 0.7 and a lot of angles all on = 

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid --points 80 --rMin 0.6 --rMax 1.4 --freezeNuisanceGroup tt_th_frag,tt_th_pdf,tt_updowns --name MuShapes3 --freezeParameters lumi_13TeV,TauES,JER,JES

-- on Run3 data with stuff frozen it goes to 0.86 with objects syst on it's 0.96-1, with tt theory 0.96


root -l higgsCombineMuShapes3.MultiDimFit.mH120.root

limit->Draw("2*deltaNLL:r", "deltaNLL>0 && 2*deltaNLL<10", "L")

limit->Draw("deltaNLL:JES", "", "L")

combine -M FitDiagnostics ttxsec/fit-stuff/latest_datacard_mu.root  --saveShapes --saveWithUncertainties --name MuShapes3  --freezeNuisanceGroup exp,tau,tt_th_frag,tt_th_pdf,tt_updowns --freezeParameters lumi_13TeV


combine -M FitDiagnostics ttxsec/fit-stuff/latest_datacard_mu.root  --saveShapes --saveWithUncertainties --name MuShapes3  --freezeNuisanceGroup exp,tau,tt_th_frag,tt_th_pdf,tt_updowns --freezeParameters lumi_13TeV,TES,JER


JES rates:
JES              lnN           0.982/1.018           0.988/1.011           0.995/1.016           0.985/1.020           0.986/1.023           0.931/1.067           0.977/1.034           0.984/1.038           0.969/1.031           1.000/1.042           0.934/1.030           0.819/1.157           0.937/1.064           -               0.988/1.015           0.989/1.011           0.980/1.015           0.987/1.014           0.980/1.025           0.974/1.018           0.974/1.021           0.973/1.032           0.974/1.024           1.000/1.110           0.978/1.084           0.973/0.846           0.960/1.031           -

shape
JES             shape       1.0 1.0 1.0 1.0 1.0           1.0           1.0 1.0 1.0           1.0 1.0           1.0 1.0           -               1.0 1.0 1.0 1.0 1.0           1.0           1.0 1.0 1.0           1.0 1.0           1.0 1.0           -



## reproducing all weight systematics


time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="selection_stage==107 && event_jets_lj_var > 60."  chan="mu_sel_ljout" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="selection_stage==106 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &

time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60."  chan="el_sel_ljout" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &


time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &

time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var > 60."  chan="el_selVloose_ljout" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var > 60."  chan="el_selVloose_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &




time make distrs_mc_common_weights    p=pStage2Run4 nt=v26  cond="selection_stage==107 && event_jets_lj_var >  60." chan="mu_sel_ljout" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26  cond="selection_stage==107 && event_jets_lj_var >  60." chan="mu_sel_ljout" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4  cond="selection_stage==107 && event_jets_lj_var >  60." chan="mu_sel_ljout" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4  cond="selection_stage==107 && event_jets_lj_var >  60." chan="mu_sel_ljout" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4  cond="selection_stage==107 && event_jets_lj_var >  60." chan="mu_sel_ljout" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &


time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &



time make distrs_mc_common_weights    p=pStage2Run4 nt=v26  cond="selection_stage==106 && event_jets_lj_var >  60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26  cond="selection_stage==106 && event_jets_lj_var >  60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4  cond="selection_stage==106 && event_jets_lj_var >  60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4  cond="selection_stage==106 && event_jets_lj_var >  60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4  cond="selection_stage==106 && event_jets_lj_var >  60." chan="mu_sel_ljout_ss" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &


time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &





time make distrs_mc_common_weights    p=pStage2Run4 nt=v26  cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var >  60." chan="mu_selVloose_ljout" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26  cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var >  60." chan="mu_selVloose_ljout" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4  cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var >  60." chan="mu_selVloose_ljout" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4  cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var >  60." chan="mu_selVloose_ljout" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4  cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var >  60." chan="mu_selVloose_ljout" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26  cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26  cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4  cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4  cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4  cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &


time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &


time make distrs_mc_common_weights    p=pStage2Run4 nt=v26  cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var >  60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26  cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var >  60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4  cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var >  60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4  cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var >  60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4  cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var >  60." chan="mu_selVloose_ljout_ss" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26  cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26  cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4  cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4  cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4  cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &


time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &




time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &








# one sided expectations of JES and JER

## JES

tt_lj has the same yields in mu_sel_lj and the same yields of variations in ljout when nominal is less
but the shapes of both variations follow the same "direction" with one being smaller

tt_mutau has different yields


nom     = (TH1D*) mu_sel_ljout->Get("tt_lj/NOMINAL/mu_sel_ljout_tt_lj_NOMINAL_Mt_lep_met_f")
jesup   = (TH1D*) mu_sel_ljout->Get("tt_lj/JESUp/mu_sel_ljout_tt_lj_JESUp_Mt_lep_met_f")
jesdown = (TH1D*) mu_sel_ljout->Get("tt_lj/JESDown/mu_sel_ljout_tt_lj_JESDown_Mt_lep_met_f")
jerup   = (TH1D*) mu_sel_ljout->Get("tt_lj/JERUp/mu_sel_ljout_tt_lj_JERUp_Mt_lep_met_f")
jerdown = (TH1D*) mu_sel_ljout->Get("tt_lj/JERDown/mu_sel_ljout_tt_lj_JERDown_Mt_lep_met_f")

nom     = (TH1D*) mu_sel_lj->Get("tt_lj/NOMINAL/mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f")
jesup   = (TH1D*) mu_sel_lj->Get("tt_lj/JESUp/mu_sel_lj_tt_lj_JESUp_Mt_lep_met_f")
jesdown = (TH1D*) mu_sel_lj->Get("tt_lj/JESDown/mu_sel_lj_tt_lj_JESDown_Mt_lep_met_f")
jerup   = (TH1D*) mu_sel_lj->Get("tt_lj/JERUp/mu_sel_lj_tt_lj_JERUp_Mt_lep_met_f")
jerdown = (TH1D*) mu_sel_lj->Get("tt_lj/JERDown/mu_sel_lj_tt_lj_JERDown_Mt_lep_met_f")


nom     = (TH1D*) mu_sel_ljout->Get("tt_mutau/NOMINAL/mu_sel_ljout_tt_mutau_NOMINAL_Mt_lep_met_f")
jesup   = (TH1D*) mu_sel_ljout->Get("tt_mutau/JESUp/mu_sel_ljout_tt_mutau_JESUp_Mt_lep_met_f")
jesdown = (TH1D*) mu_sel_ljout->Get("tt_mutau/JESDown/mu_sel_ljout_tt_mutau_JESDown_Mt_lep_met_f")
jerup   = (TH1D*) mu_sel_ljout->Get("tt_mutau/JERUp/mu_sel_ljout_tt_mutau_JERUp_Mt_lep_met_f")
jerdown = (TH1D*) mu_sel_ljout->Get("tt_mutau/JERDown/mu_sel_ljout_tt_mutau_JERDown_Mt_lep_met_f")

nom     = (TH1D*) mu_sel_lj->Get("tt_mutau/NOMINAL/mu_sel_lj_tt_mutau_NOMINAL_Mt_lep_met_f")
jesup   = (TH1D*) mu_sel_lj->Get("tt_mutau/JESUp/mu_sel_lj_tt_mutau_JESUp_Mt_lep_met_f")
jesdown = (TH1D*) mu_sel_lj->Get("tt_mutau/JESDown/mu_sel_lj_tt_mutau_JESDown_Mt_lep_met_f")
jerup   = (TH1D*) mu_sel_lj->Get("tt_mutau/JERUp/mu_sel_lj_tt_mutau_JERUp_Mt_lep_met_f")
jerdown = (TH1D*) mu_sel_lj->Get("tt_mutau/JERDown/mu_sel_lj_tt_mutau_JERDown_Mt_lep_met_f")


jesup   ->SetLineColor(kRed)
jesdown ->SetLineColor(kGreen)

nom     ->Draw()
jesup   ->Draw("same")
jesdown ->Draw("same")

jerup   ->SetLineColor(kRed)
jerdown ->SetLineColor(kGreen)

nom     ->Draw()
jerup   ->Draw("same")
jerdown ->Draw("same")


nom     ->Print()
jesup   ->Print()
jesdown ->Print()

jerup   ->Print()
jerdown ->Print()



## fitting info after correction

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid -t -1 --expectSignal 1.0 --points 80 --rMin 0.6 --rMax 1.4 --name MuShapes3 --freezeParameters lumi_13TeV  --saveSpecifiedNuis JES,JER

root -l higgsCombineMuShapes3.MultiDimFit.mH120.root

limit->Draw("2*deltaNLL:r", "deltaNLL>0 && 2*deltaNLL<10", "L")

limit->Draw("deltaNLL:JES", "", "L")


combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid -t -1 --expectSignal 1.0 --points 80 --rMin 0.6 --rMax 1.4 --freezeNuisanceGroup exp,tau,tt_th_frag,tt_th_pdf --name MuShapes3 --freezeParameters lumi_13TeV  --saveSpecifiedNuis JES,JER

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid -t -1 --expectSignal 1.0 --points 80 --rMin 0.6 --rMax 1.4 --freezeNuisanceGroup exp,tau,tt_th_frag,tt_th_pdf --name MuShapes3 --freezeParameters lumi_13TeV  --saveSpecifiedNuis JES,JER,TES

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid --points 80 --rMin 0.6 --rMax 1.4 --freezeNuisanceGroup exp,tau,tt_th_frag,tt_th_pdf --name MuShapes3 --freezeParameters lumi_13TeV  --saveSpecifiedNuis JES,JER,TES




plot of syst variations of JES

python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_lj -d Mt_lep_met_f -s JESUp,JESDown 
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_lj -d Mt_lep_met_f -s JESUp,JESDown 

python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_ljout -d Mt_lep_met_f -s JESUp,JESDown 
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_ljout -d Mt_lep_met_f -s JESUp,JESDown 


python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_lj    -d Mt_lep_met_f -s JESUp 
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_ljout -d Mt_lep_met_f -s JESUp 

python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_lj    -d Mt_lep_met_f -s JESUp 
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_ljout -d Mt_lep_met_f -s JESUp 

python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_lj    -d Mt_lep_met_f -s JESDown
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_ljout -d Mt_lep_met_f -s JESDown

JES             shape          0.2    0.2   0.2   0.2   0.2        0.2      0.2   0.2   0.2      0.2   0.2      0.2   0.2      -                  0.2    0.2   0.2   0.2   0.2        0.

JES             shape          1.0    1.0   1.0   1.0   1.0        -        -     -     -        -     -        -     -        -                  1.0    1.0   1.0   1.0   1.0        -        -     -     -        -     -        -     -        -        

JES             shape          1.0    1.0   -     -     -          -        -     -     -        -     -        -     -        -                  1.0    1.0   -     -     -          -        -     -     -        -     -        -     -        -        

JES             shape          1.0    -     -     -     -          -        -     -     -        -     -        -     -        -                  1.0    -     -     -     -          -        -     -     -        -     -        -     -        -


JES             shape          -      1.0   -     -     -          -        -     -     -        -     -        -     -        -                  -      1.0   -     -     -          -        -     -     -        -     -        -     -        -

-- sharp step here


JES             shape          -      -     -     -     -          -        -     -     -        -     -        -     -        -                  -      1.0   -     -     -          -        -     -     -        -     -        -     -        -

JES             shape          -      1.0   -     -     -          -        -     -     -        -     -        -     -        -                  -      -     -     -     -          -        -     -     -        -     -        -     -        -


JES             shape          1.0    -     1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -                  1.0    -     1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -                  



rate 

python yield_variations.py histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other -s JES

python yield_variations.py histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other,dibosons,s_top_lj,s_top_other,s_top_mutau,wjets_taul,wjets_other,dy_other,dy_tautau -s JES



JES             lnN          1.0    -     -     -     -          1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -                  1.0    -     -     -     -          1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -








## the selection stages

time make distrs_mc_objects        p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_objects        p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &

test

python selections.py  --out-dir distrs/ --distr Mt_lep_met_f --chan mu_sel_ljout "sqrt(2*(sqrt((event_met_JERDown.Px()*event_met_JERDown.Px() + event_met_JERDown.Py()*event_met_JERDown.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met_JERDown.Px()*event_leptons[0].Px() + event_met_JERDown.Py()*event_leptons[0].Py())))"    --cond-com "selection_stage_JERDown==  7 && event_jets_lj_var > 60." --custom-range 0,20,40,60,80,100,130,160,200,250 --sys JERDown   --weight event_weight  merge-sets/v25/pStage2Run3/*MC*TT*.root



time make distrs_mc_nominal dtag=TT nt=v26 p=r4                      cond="(selection_stage==105 || selection_stage==107)"  chan="mu_selVloose"    &
time make distrs_mc_nominal dtag=TT nt=v26 p=r4 options="--el-procs" cond="(selection_stage==115 || selection_stage==117)"  chan="el_selVloose" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERDown met=event_met_JERDown cond="(selection_stage_JERDown==  7 || selection_stage_JERDown==105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &


time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="selection_stage==107 && event_jets_lj_var > 60."  chan="mu_sel_ljout" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="selection_stage==106 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &

time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60."  chan="el_sel_ljout" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &


time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &

time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var > 60."  chan="el_selVloose_ljout" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var > 60."  chan="el_selVloose_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &





time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERDown met=event_met_JERDown cond="selection_stage_JERDown==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERUp   met=event_met_JERUp   cond="selection_stage_JERUp  ==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESDown met=event_met_JESDown cond="selection_stage_JESDown==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESUp   met=event_met_JESUp   cond="selection_stage_JESUp  ==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESDown met=event_met_TESDown cond="selection_stage_TESDown==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESUp   met=event_met_TESUp   cond="selection_stage_TESUp  ==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERDown met=event_met_JERDown cond="selection_stage_JERDown==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERUp   met=event_met_JERUp   cond="selection_stage_JERUp  ==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESDown met=event_met_JESDown cond="selection_stage_JESDown==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESUp   met=event_met_JESUp   cond="selection_stage_JESUp  ==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESDown met=event_met_TESDown cond="selection_stage_TESDown==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESUp   met=event_met_TESUp   cond="selection_stage_TESUp  ==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERDown met=event_met_JERDown cond="selection_stage_JERDown==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERUp   met=event_met_JERUp   cond="selection_stage_JERUp  ==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESDown met=event_met_JESDown cond="selection_stage_JESDown==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESUp   met=event_met_JESUp   cond="selection_stage_JESUp  ==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESDown met=event_met_TESDown cond="selection_stage_TESDown==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESUp   met=event_met_TESUp   cond="selection_stage_TESUp  ==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERDown met=event_met_JERDown cond="selection_stage_JERDown==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERUp   met=event_met_JERUp   cond="selection_stage_JERUp  ==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESDown met=event_met_JESDown cond="selection_stage_JESDown==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESUp   met=event_met_JESUp   cond="selection_stage_JESUp  ==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESDown met=event_met_TESDown cond="selection_stage_TESDown==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESUp   met=event_met_TESUp   cond="selection_stage_TESUp  ==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &





time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERDown met=event_met_JERDown cond="selection_stage_JERDown==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERUp   met=event_met_JERUp   cond="selection_stage_JERUp  ==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESDown met=event_met_JESDown cond="selection_stage_JESDown==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESUp   met=event_met_JESUp   cond="selection_stage_JESUp  ==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESDown met=event_met_TESDown cond="selection_stage_TESDown==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESUp   met=event_met_TESUp   cond="selection_stage_TESUp  ==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERDown met=event_met_JERDown cond="selection_stage_JERDown==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERUp   met=event_met_JERUp   cond="selection_stage_JERUp  ==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESDown met=event_met_JESDown cond="selection_stage_JESDown==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESUp   met=event_met_JESUp   cond="selection_stage_JESUp  ==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESDown met=event_met_TESDown cond="selection_stage_TESDown==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESUp   met=event_met_TESUp   cond="selection_stage_TESUp  ==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERDown met=event_met_JERDown cond="selection_stage_JERDown==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERUp   met=event_met_JERUp   cond="selection_stage_JERUp  ==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESDown met=event_met_JESDown cond="selection_stage_JESDown==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESUp   met=event_met_JESUp   cond="selection_stage_JESUp  ==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESDown met=event_met_TESDown cond="selection_stage_TESDown==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESUp   met=event_met_TESUp   cond="selection_stage_TESUp  ==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERDown met=event_met_JERDown cond="selection_stage_JERDown==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERUp   met=event_met_JERUp   cond="selection_stage_JERUp  ==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESDown met=event_met_JESDown cond="selection_stage_JESDown==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESUp   met=event_met_JESUp   cond="selection_stage_JESUp  ==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESDown met=event_met_TESDown cond="selection_stage_TESDown==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESUp   met=event_met_TESUp   cond="selection_stage_TESUp  ==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &







time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERDown met=event_met_JERDown cond="(selection_stage_JERDown==107 || selection_stage_JERDown==105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERUp   met=event_met_JERUp   cond="(selection_stage_JERUp  ==107 || selection_stage_JERUp  ==105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESDown met=event_met_JESDown cond="(selection_stage_JESDown==107 || selection_stage_JESDown==105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESUp   met=event_met_JESUp   cond="(selection_stage_JESUp  ==107 || selection_stage_JESUp  ==105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESDown met=event_met_TESDown cond="(selection_stage_TESDown==107 || selection_stage_TESDown==105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESUp   met=event_met_TESUp   cond="(selection_stage_TESUp  ==107 || selection_stage_TESUp  ==105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERDown met=event_met_JERDown cond="(selection_stage_JERDown==106 || selection_stage_JERDown==104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERUp   met=event_met_JERUp   cond="(selection_stage_JERUp  ==106 || selection_stage_JERUp  ==104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESDown met=event_met_JESDown cond="(selection_stage_JESDown==106 || selection_stage_JESDown==104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESUp   met=event_met_JESUp   cond="(selection_stage_JESUp  ==106 || selection_stage_JESUp  ==104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESDown met=event_met_TESDown cond="(selection_stage_TESDown==106 || selection_stage_TESDown==104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESUp   met=event_met_TESUp   cond="(selection_stage_TESUp  ==106 || selection_stage_TESUp  ==104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERDown met=event_met_JERDown cond="(selection_stage_JERDown==107 || selection_stage_JERDown==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERUp   met=event_met_JERUp   cond="(selection_stage_JERUp  ==107 || selection_stage_JERUp  ==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESDown met=event_met_JESDown cond="(selection_stage_JESDown==107 || selection_stage_JESDown==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESUp   met=event_met_JESUp   cond="(selection_stage_JESUp  ==107 || selection_stage_JESUp  ==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESDown met=event_met_TESDown cond="(selection_stage_TESDown==107 || selection_stage_TESDown==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESUp   met=event_met_TESUp   cond="(selection_stage_TESUp  ==107 || selection_stage_TESUp  ==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERDown met=event_met_JERDown cond="(selection_stage_JERDown==106 || selection_stage_JERDown==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERUp   met=event_met_JERUp   cond="(selection_stage_JERUp  ==106 || selection_stage_JERUp  ==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESDown met=event_met_JESDown cond="(selection_stage_JESDown==106 || selection_stage_JESDown==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESUp   met=event_met_JESUp   cond="(selection_stage_JESUp  ==106 || selection_stage_JESUp  ==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESDown met=event_met_TESDown cond="(selection_stage_TESDown==106 || selection_stage_TESDown==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESUp   met=event_met_TESUp   cond="(selection_stage_TESUp  ==106 || selection_stage_TESUp  ==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &




time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERDown met=event_met_JERDown cond="(selection_stage_JERDown==117 || selection_stage_JERDown==115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERUp   met=event_met_JERUp   cond="(selection_stage_JERUp  ==117 || selection_stage_JERUp  ==115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESDown met=event_met_JESDown cond="(selection_stage_JESDown==117 || selection_stage_JESDown==115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESUp   met=event_met_JESUp   cond="(selection_stage_JESUp  ==117 || selection_stage_JESUp  ==115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESDown met=event_met_TESDown cond="(selection_stage_TESDown==117 || selection_stage_TESDown==115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESUp   met=event_met_TESUp   cond="(selection_stage_TESUp  ==117 || selection_stage_TESUp  ==115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERDown met=event_met_JERDown cond="(selection_stage_JERDown==116 || selection_stage_JERDown==114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERUp   met=event_met_JERUp   cond="(selection_stage_JERUp  ==116 || selection_stage_JERUp  ==114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESDown met=event_met_JESDown cond="(selection_stage_JESDown==116 || selection_stage_JESDown==114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESUp   met=event_met_JESUp   cond="(selection_stage_JESUp  ==116 || selection_stage_JESUp  ==114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESDown met=event_met_TESDown cond="(selection_stage_TESDown==116 || selection_stage_TESDown==114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESUp   met=event_met_TESUp   cond="(selection_stage_TESUp  ==116 || selection_stage_TESUp  ==114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERDown met=event_met_JERDown cond="(selection_stage_JERDown==117 || selection_stage_JERDown==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERUp   met=event_met_JERUp   cond="(selection_stage_JERUp  ==117 || selection_stage_JERUp  ==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESDown met=event_met_JESDown cond="(selection_stage_JESDown==117 || selection_stage_JESDown==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESUp   met=event_met_JESUp   cond="(selection_stage_JESUp  ==117 || selection_stage_JESUp  ==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESDown met=event_met_TESDown cond="(selection_stage_TESDown==117 || selection_stage_TESDown==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESUp   met=event_met_TESUp   cond="(selection_stage_TESUp  ==117 || selection_stage_TESUp  ==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERDown met=event_met_JERDown cond="(selection_stage_JERDown==116 || selection_stage_JERDown==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERUp   met=event_met_JERUp   cond="(selection_stage_JERUp  ==116 || selection_stage_JERUp  ==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESDown met=event_met_JESDown cond="(selection_stage_JESDown==116 || selection_stage_JESDown==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESUp   met=event_met_JESUp   cond="(selection_stage_JESUp  ==116 || selection_stage_JESUp  ==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESDown met=event_met_TESDown cond="(selection_stage_TESDown==116 || selection_stage_TESDown==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESUp   met=event_met_TESUp   cond="(selection_stage_TESUp  ==116 || selection_stage_TESUp  ==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &


foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v25pStage2Run3_mc_objects_rerun/*$d*root &
end


foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v25pStage2Run3_noJesJerTes/*$d*root &
end

hadd distrs_v25pStage2Run3_3_updowns_weights.root v25pStage2Run3/MC* v25r4/MC* v26r4/MC2016_Summer16_TTJets_powheg.root

cat histosel_stage2_run3_3_VlooseShapes_mu_sel_ljs histosel_stage2_run3_3_VlooseShapes_el_sel_ljs

source histosel_stage2_run3_3_VlooseShapes_mu_sel_ljs &
source histosel_stage2_run3_3_VlooseShapes_el_sel_ljs &


hadd histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root histosel-roots/v25pStage2Run3_3_el_ljs/*root histosel-roots/v25pStage2Run3_3_mu_ljs/*root  histosel-roots/v25pStage2Run3_el_ljs_updowns/*root histosel-roots/v25pStage2Run3_mu_ljs_updowns/*root histosel-roots/v25pStage2Run3_el_ljs_updowns_weights/distr*root histosel-roots/v25pStage2Run3_mu_ljs_updowns_weights/distr*root



with new jes jer tes patch

hadd v26pStage2Run4_hadds/MC2016_Summer16_TTJets_powheg.root v25pStage2Run3_no_objects_in_tt/test*TT*root v26pStage2Run4/test*TT*root

hadd distrs_v25pStage2Run3_3_Run4_updowns_weights.root v25pStage2Run3/MC* v25r4/MC* v26r4/MC2016_Summer16_TTJets_powheg.root v26pStage2Run4/MC2016_Summer16_TTJets_powheg.root

diverted from nominal TES factor:
pdfs and scale
updowns


source histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs &
source histosel_stage2_run3_3_Run4_VlooseShapes_el_sel_ljs &


hadd histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root histosel-roots/v25pStage2Run3_3_Run4_el_ljs/*root histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/*root  histosel-roots/v25pStage2Run3_el_ljs_updowns/*root histosel-roots/v25pStage2Run3_mu_ljs_updowns/*root histosel-roots/v25pStage2Run3_el_ljs_updowns_weights/distr*root histosel-roots/v25pStage2Run3_mu_ljs_updowns_weights/distr*root


python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_lj    -d Mt_lep_met_f -s JESUp 
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_ljout -d Mt_lep_met_f -s JESUp 

python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_lj    -d Mt_lep_met_f -s JESDown
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_ljout -d Mt_lep_met_f -s JESDown


python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_lj    -d Mt_lep_met_f -s JESUp 
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_ljout -d Mt_lep_met_f -s JESUp 

python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_lj    -d Mt_lep_met_f -s JESDown
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_ljout -d Mt_lep_met_f -s JESDown










# plots tables etc

Mt distrs for the fit (the onloy figures in the paper)
bins are normalized per gev

python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm --title "" --title-x "M_{T}(#mu, MET), GeV" --title-y "Events/1GeV" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm --title "" --title-x "M_{T}(#mu, MET), GeV" --title-y "Events/1GeV" --draw-overflows 5 --legend-shift 0.02

python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -p -r -o plots/run4/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm --title "" --title-x "M_{T}(e, MET), GeV"   --title-y "Events/1GeV" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -p -r -o plots/run4/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm --title "" --title-x "M_{T}(e, MET), GeV"   --title-y "Events/1GeV" --draw-overflows 5 --legend-shift 0.02

copy and rename

cp distrs_v25pStage2Run3_2_updowns_..,distrs,v25pStage2Run3_hadds,SingleElectron_Mt_lep_met_f_el_sel_lj_NOMINAL_stack_ratio_x_el_selVloose_lj_dataqcd.png        el_sel_lj_Mt.png
cp distrs_v25pStage2Run3_2_updowns_..,distrs,v25pStage2Run3_hadds,SingleElectron_Mt_lep_met_f_el_sel_ljout_NOMINAL_stack_ratio_x_el_selVloose_ljout_dataqcd.png  el_sel_ljout_Mt.png
cp distrs_v25pStage2Run3_2_updowns_..,distrs,v25pStage2Run3_hadds,SingleMuon_Mt_lep_met_f_mu_sel_lj_NOMINAL_stack_ratio_x_mu_selVloose_lj_dataqcd.png            mu_sel_lj_Mt.png
cp distrs_v25pStage2Run3_2_updowns_..,distrs,v25pStage2Run3_hadds,SingleMuon_Mt_lep_met_f_mu_sel_ljout_NOMINAL_stack_ratio_x_mu_selVloose_ljout_dataqcd.png      mu_sel_ljout_Mt.png






NLL plot for paper
and stat-sus split of uncertainties


combine -M MultiDimFit --algo none --rMin 0.5 --rMax 1.5 ttxsec/fit-stuff/latest_datacard_mu.root --saveWorkspace -n MuBestfit
combine -M MultiDimFit --algo grid --points 100 --rMin 0.5 --rMax 1.5 higgsCombineMuBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters all --fastScan -n MuNoSysWLumi
combine -M MultiDimFit --algo grid --points 100 --rMin 0.5 --rMax 1.5 higgsCombineMuBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters "lumi_13TeV" -n MuFullUncertaintyNoLumi

plot1DScan.py higgsCombineMuFullUncertaintyNoLumi.MultiDimFit.mH120.root --others  'higgsCombineMuNoSysWLumi.MultiDimFit.mH120.root:stat:2' --breakdown syst,stat

mv scan.pdf run4_scan_mu_obs.pdf
mv scan.png run4_scan_mu_obs.png


remember for el:
combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_el.root   --algo grid --points 32 --rMin 0.6 --rMax 1.4 --name ElShapes --freezeParameters lumi_13TeV




combine -M MultiDimFit --algo none             --rMin 0.6 --rMax 1.4 ttxsec/fit-stuff/latest_datacard_el.root --saveWorkspace -n ElBestfit
combine -M MultiDimFit --algo grid --points 32 --rMin 0.6 --rMax 1.4 higgsCombineElBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters all --fastScan -n ElNoSysWLumi
combine -M MultiDimFit --algo grid --points 32 --rMin 0.6 --rMax 1.4 higgsCombineElBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters "lumi_13TeV" -n ElFullUncertaintyNoLumi

plot1DScan.py higgsCombineElFullUncertaintyNoLumi.MultiDimFit.mH120.root --others  'higgsCombineElNoSysWLumi.MultiDimFit.mH120.root:stat:2' --breakdown syst,stat

mv scan.pdf run4_scan_el_obs.pdf
mv scan.png run4_scan_el_obs.png


combine -M MultiDimFit --algo none -t -1 --expectSignal 1 --rMin 0.5 --rMax 1.5 ttxsec/fit-stuff/latest_datacard_both.root --saveWorkspace -n ExpectedBothBestfit
combine -M MultiDimFit --algo grid -t -1 --expectSignal 1 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedBothBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters all --fastScan -n ExpectedBothNoSysWLumi
combine -M MultiDimFit --algo grid -t -1 --expectSignal 1 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedBothBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters "tauID_eff,tau_fakes" -n ExpectedBothNoTauWLumi
combine -M MultiDimFit --algo grid -t -1 --expectSignal 1 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedBothBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit  -n ExpectedBothFullUncertaintyWLumi
combine -M MultiDimFit --algo grid -t -1 --expectSignal 1 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedBothBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters lumi_13TeV -n ExpectedBothFullUncertaintyNoLumi

plot1DScan.py higgsCombineExpectedBothFullUncertaintyWLumi.MultiDimFit.mH120.root --others 'higgsCombineExpectedBothFullUncertaintyNoLumi.MultiDimFit.mH120.root:lumi:4' 'higgsCombineExpectedBothNoSysWLumi.MultiDimFit.mH120.root:stat:2' --breakdown lumi,syst,stat

mv scan.pdf run4_scan_both_exp.pdf
mv scan.png run4_scan_both_exp.png



combine -M MultiDimFit --algo none --rMin 0.5 --rMax 1.5 ttxsec/fit-stuff/latest_datacard_both.root --saveWorkspace -n BothBestfit
combine -M MultiDimFit --algo grid --points 100 --rMin 0.5 --rMax 1.5 higgsCombineBothBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters all --fastScan -n BothNoSysWLumi
combine -M MultiDimFit --algo grid --points 100 --rMin 0.5 --rMax 1.5 higgsCombineBothBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters "tauID_eff,tau_fakes" -n BothNoTauWLumi
combine -M MultiDimFit --algo grid --points 100 --rMin 0.5 --rMax 1.5 higgsCombineBothBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit  -n BothFullUncertaintyWLumi
combine -M MultiDimFit --algo grid --points 100 --rMin 0.5 --rMax 1.5 higgsCombineBothBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters "lumi_13TeV" -n BothFullUncertaintyNoLumi


plot1DScan.py higgsCombineBothFullUncertaintyWLumi.MultiDimFit.mH120.root --others 'higgsCombineBothFullUncertaintyNoLumi.MultiDimFit.mH120.root:lumi:4' 'higgsCombineBothNoSysWLumi.MultiDimFit.mH120.root:stat:2' --breakdown lumi,syst,stat

mv scan.pdf run4_scan_both_obs.pdf
mv scan.png run4_scan_both_obs.png



python plot_uncertainty_scans.py

eog uncertainty_scans_both_exp.png uncertainty_scans_el_exp.png uncertainty_scans_mu_exp.png
eog uncertainty_scans_both_exp_obs.png uncertainty_scans_el_exp_obs.png uncertainty_scans_mu_exp_obs.png


impact table


python new_impact_table.py --merge-pdf 
python new_impact_table.py --merge-pdf 
python new_impact_table.py --merge-pdf latest_el_impacts.json latest_mu_impacts.json latest_both_impacts.json



yields

python numbers_for_datacard.py histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns_weights.root -y -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --latex

python numbers_for_datacard.py histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights_test4.root -y -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --latex



xsec numbers with extrapolation

the W BRs in ttbar powheg:

t_w_el = 9261
tb_w_el = 9368
tb_w_mu = 9220
tb_w_mu = 9306
tb_w_tau = 9275
t_w_tau = 9575

(t_w_el  + tb_w_el) / 2N
(t_w_mu  + tb_w_mu) / 2N
(t_w_tau + tb_w_tau) / 2N

0.10767212280945115
0.10707680214546632
0.10894946132149627


acceptances -- the same

acc_el = 0.1687
acc_mu = 0.1756
acc_bt = 0.1722
accept = [ acc_el acc_mu acc_bt ]

root -l merge-sets/v34/t1/MC2016_Summer16_TTJets_powheg.root

cut_ev_eltau->Divide( all_ev_eltau )
cut_ev_mutau->Divide( all_ev_mutau )

python proc/print_acceptances.py --sys-weights merge-sets/v34/t1/MC2016_Summer16_TTJets_powheg.root

acc_mu_err = sum(([0.1759     0.1756     0.1754     0.1761     0.1756     0.1760     0.1758     0.1756     0.1757     0.1758     0.1753     0.1754     0.1760     0.1755     0.1757     0.1755     0.1752     0.1762     0.1759     0.1755     0.1749     0.1762     0.1757     0.1757     0.1756     0.1758     0.1763     0.1751     0.1759     0.1754     0.1754     0.1760     0.1761     0.1753     0.1756     0.1758     0.1756     0.1757     0.1758     0.1756     0.1755     0.1761     0.1756     0.1759     0.1760     0.1753     0.1759     0.1756     0.1754     0.1761     0.1752     0.1763     0.1757     0.1757     0.1755     0.1751     0.1752     0.1752     0.1757     0.1757     0.1760     0.1758     0.1757     0.1758] - 0.1756) .^ 2) ^ 0.5
0.0025455844122715655

acc_el_err = sum(([0.1689     0.1686     0.1684     0.1691     0.1685     0.1690     0.1688     0.1686     0.1687     0.1688     0.1683     0.1684     0.1690     0.1686     0.1686     0.1685     0.1683     0.1691     0.1689     0.1686     0.1681     0.1691     0.1687     0.1687     0.1686     0.1688     0.1692     0.1682     0.1688     0.1684     0.1684     0.1690     0.1691     0.1683     0.1687     0.1688     0.1687     0.1687     0.1688     0.1686     0.1685     0.1691     0.1686     0.1689     0.1689     0.1683     0.1689     0.1686     0.1684     0.1691     0.1682     0.1693     0.1688     0.1687     0.1686     0.1681     0.1682     0.1683     0.1688     0.1687     0.1689     0.1688     0.1687     0.1687] - 0.1687) .^ 2) ^ 0.5
0.0022605309110914646

acc_bt_err = sum(([0.1724     0.1721     0.1719     0.1726     0.1721     0.1725     0.1723     0.1721     0.1722     0.1723     0.1718     0.1719     0.1725     0.1721     0.1722     0.1720     0.1717     0.1727     0.1724     0.1721     0.1715     0.1726     0.1722     0.1722     0.1721     0.1723     0.1727     0.1717     0.1724     0.1719     0.1719     0.1725     0.1726     0.1718     0.1722     0.1723     0.1721     0.1722     0.1723     0.1721     0.1720     0.1726     0.1721     0.1724     0.1725     0.1718     0.1724     0.1721     0.1719     0.1726     0.1717     0.1728     0.1722     0.1722     0.1720     0.1716     0.1717     0.1717     0.1723     0.1722     0.1725     0.1723     0.1722     0.1722] - 0.1722) .^ 2) ^ 0.5
0.002372762103540929

0.0025455844122715655 / 0.1759
0.0022605309110914646 / 0.1689
0.002372762103540929  / 0.1724

acc_el_err / acc_el
acc_mu_err / acc_mu
acc_bt_err / acc_bt




signal strangth:

el_sys = 0.112
mu_sys = 0.085
bt_sys = 0.079

el_sig = 1.022
mu_sig = 0.959
bt_sig = 1.027

el_stat = 0.016
mu_stat = 0.011
bt_stat = 0.009


el_sig  = 1.023
el_sys  = 0.10
el_stat = 0.016

mu_sig  = 0.938
mu_sys  = 0.066
mu_stat = 0.011

bt_sig  = 0.989
bt_stat = 0.009
bt_sys  = 0.07



xsec_el_vis = [el_sig el_stat el_sys 0.025 ]
xsec_mu_vis = [mu_sig mu_stat mu_sys 0.025 ]
xsec_bt_vis = [bt_sig bt_stat bt_sys 0.025 ]

xsec_vis = 831.76 * accept

xsec_el_vis * xsec_vis[1]
xsec_mu_vis * xsec_vis[2]
xsec_bt_vis * xsec_vis[3]


el_sys_extr = sum([el_sys acc_el_err / acc_el].^2) ^ 0.5
mu_sys_extr = sum([mu_sys acc_mu_err / acc_mu].^2) ^ 0.5
bt_sys_extr = sum([bt_sys acc_bt_err / acc_bt].^2) ^ 0.5

xsec_el_extr = [el_sig el_stat el_sys_extr 0.025 ]
xsec_mu_extr = [mu_sig mu_stat mu_sys_extr 0.025 ]
xsec_bt_extr = [bt_sig bt_stat bt_sys_extr 0.025 ]

xsec_el_extr = el_sig * 831.76
xsec_mu_extr = mu_sig * 831.76
xsec_bt_extr = bt_sig * 831.76

xsec_el_extr .* [el_stat el_sys_extr 0.025 ]
xsec_mu_extr .* [mu_stat mu_sys_extr 0.025 ]
xsec_bt_extr .* [bt_stat bt_sys_extr 0.025 ]



post-fit distrs:

combine -M FitDiagnostics ttxsec/fit-stuff/latest_datacard_mu.root  --saveShapes --saveWithUncertainties --name MuShapes --freezeParameters lumi_13TeV
combine -M FitDiagnostics ttxsec/fit-stuff/latest_datacard_el.root  --saveShapes --saveWithUncertainties --name ElShapes --freezeParameters lumi_13TeV


python stack_postfit.py fitDiagnosticsMuShapes.root mu_sel_lj    --custom-bins --mu --ratio  --y-max 2500
python stack_postfit.py fitDiagnosticsMuShapes.root mu_sel_ljout --custom-bins --mu --ratio  --y-max 2500

python stack_postfit.py fitDiagnosticsElShapes.root el_sel_lj    --custom-bins --lumi 31.3 --ratio  --y-max 1500
python stack_postfit.py fitDiagnosticsElShapes.root el_sel_ljout --custom-bins --lumi 31.3 --ratio  --y-max 1500




# weight syst normalized to acceptance

## error while hadding a lot of files with all the weight systematics

hadd MC2016_Summer16_TTJets_powheg_Alpha_all.root v26r4/te*Alpha*

hadd MC2016_Summer16_TTJets_powheg_Mr_all.root v26r4/te*Mr*
hadd MC2016_Summer16_TTJets_powheg_Mf_all.root v26r4/te*Mf*

hadd MC2016_Summer16_TTJets_powheg_PDF_1.root v26r4/te*PDFCT14n1*
hadd MC2016_Summer16_TTJets_powheg_PDF_2.root v26r4/te*PDFCT14n2*
hadd MC2016_Summer16_TTJets_powheg_PDF_3.root v26r4/te*PDFCT14n3*
hadd MC2016_Summer16_TTJets_powheg_PDF_4.root v26r4/te*PDFCT14n4*
hadd MC2016_Summer16_TTJets_powheg_PDF_5.root v26r4/te*PDFCT14n5*
hadd MC2016_Summer16_TTJets_powheg_PDF_6.root v26r4/te*PDFCT14n[6789]*

hadd MC2016_Summer16_TTJets_powheg.root MC2016_Summer16_TTJets_powheg_Alpha_all.root MC2016_Summer16_TTJets_powheg_Mf_all.root MC2016_Summer16_TTJets_powheg_Mr_all.root MC2016_Summer16_TTJets_powheg_PDF_[123456].root


event_weight_me_f_rUp
event_weight_me_fUp_r
event_weight_me_frUp
event_weight_pdf

hadd distrs_v25pStage2Run3_2_updowns.root v25pStage2Run3/MC* v25r4/MC*

hadd distrs_v25pStage2Run3_2_updowns_weights.root v25pStage2Run3/MC* v25r4/MC* v26r4/MC2016_Summer16_TTJets_powheg.root

for sys_i, sys_w in enumerate([the_mc_weight] + w_scale + w_alphas + w_pdf):
[weights_gen_weight_f_rUp, weights_gen_weight_f_rDn, weights_gen_weight_fUp_r, weights_gen_weight_fDn_r, weights_gen_weight_frUp, weights_gen_weight_frDn]
[weights_gen_weight_alphas_up, weights_gen_weight_alphas_dn]
[round_pdf_weight(event.gen_weights_pdf_hessians[i] / weights_gen_weight_norm) for i in range(1,57)]

6
2
56




## acceptance norm

per-process aceptance changes in 2nd digit only by 1
in all channels but the signal, where the change is larger

python proc/print_acceptances.py temp/nominal.root --sys-weights
INFO:root:import ROOT
INFO:root:done
               mutau            0.322      0.323      0.324      0.323      0.323      0.322      0.325      0.323      0.323      0.323      0.323      0.322      0.323      0.324      0.323      0.323      0.323      0.322      0.324      0.323      0.323      0.322      0.324      0.323      0.323      0.323      0.323      0.324      0.322      0.323      0.323      0.323      0.324      0.324      0.323      0.323      0.323      0.323      0.323      0.323      0.323      0.323      0.324      0.323      0.323      0.324      0.322      0.324      0.323      0.323      0.324      0.323      0.324      0.323      0.323      0.323      0.322      0.322      0.323      0.323      0.323      0.323      0.323      0.323      0.323      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000
               eltau            0.294      0.297      0.301      0.300      0.300      0.297      0.302      0.300      0.300      0.300      0.300      0.299      0.299      0.300      0.299      0.300      0.300      0.299      0.301      0.300      0.300      0.299      0.301      0.300      0.300      0.300      0.300      0.301      0.299      0.300      0.299      0.299      0.300      0.300      0.299      0.300      0.300      0.300      0.300      0.300      0.300      0.300      0.300      0.300      0.300      0.300      0.299      0.300      0.299      0.299      0.301      0.299      0.301      0.300      0.300      0.300      0.299      0.299      0.299      0.300      0.300      0.300      0.300      0.300      0.300      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000

all procs:

$ python proc/print_acceptances.py temp/nominal.root --sys-weights --all-procs                                           
INFO:root:import ROOT
INFO:root:done
               mutau            0.322      0.323      0.324      0.323      0.323      0.322      0.325      0.323      0.323      0.323      0.323      0.322      0.323      0.324      0.323      0.323      0.323      0.322      0.324      0.323      0.323      0.322      0.324      0.323      0.323      0.323      0.323      0.324      0.322      0.323      0.323      0.323      0.324      0.324      0.323      0.323      0.323      0.323      0.323      0.323      0.323      0.323      0.324      0.323      0.323      0.324      0.322      0.324      0.323      0.323      0.324      0.323      0.324      0.323      0.323      0.323      0.322      0.322      0.323      0.323      0.323      0.323      0.323      0.323      0.323      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000
               eltau            0.294      0.297      0.301      0.300      0.300      0.297      0.302      0.300      0.300      0.300      0.300      0.299      0.299      0.300      0.299      0.300      0.300      0.299      0.301      0.300      0.300      0.299      0.301      0.300      0.300      0.300      0.300      0.301      0.299      0.300      0.299      0.299      0.300      0.300      0.299      0.300      0.300      0.300      0.300      0.300      0.300      0.300      0.300      0.300      0.300      0.300      0.299      0.300      0.299      0.299      0.301      0.299      0.301      0.300      0.300      0.300      0.299      0.299      0.299      0.300      0.300      0.300      0.300      0.300      0.300      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000
                 muj            0.505      0.506      0.505      0.505      0.506      0.506      0.505      0.506      0.505      0.505      0.506      0.505      0.504      0.506      0.505      0.506      0.505      0.503      0.507      0.506      0.505      0.502      0.507      0.505      0.506      0.505      0.506      0.507      0.503      0.506      0.504      0.504      0.506      0.506      0.505      0.505      0.506      0.505      0.506      0.506      0.505      0.505      0.507      0.506      0.505      0.506      0.504      0.506      0.505      0.505      0.506      0.504      0.507      0.505      0.505      0.505      0.504      0.504      0.503      0.505      0.505      0.506      0.506      0.505      0.505      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000
                 elj            0.486      0.486      0.487      0.486      0.486      0.486      0.486      0.486      0.486      0.486      0.486      0.485      0.485      0.487      0.485      0.486      0.485      0.484      0.488      0.487      0.486      0.483      0.488      0.486      0.486      0.486      0.486      0.488      0.484      0.486      0.485      0.485      0.487      0.487      0.485      0.486      0.486      0.486      0.486      0.486      0.486      0.486      0.487      0.486      0.486      0.487      0.485      0.486      0.486      0.485      0.487      0.485      0.487      0.486      0.486      0.485      0.485      0.485      0.484      0.486      0.486      0.487      0.486      0.486      0.486      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000
           taumutauh            0.144      0.143      0.148      0.145      0.145      0.143      0.148      0.145      0.145      0.145      0.145      0.144      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.144      0.146      0.145      0.145      0.145      0.144      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000
           taueltauh            0.098      0.097      0.098      0.096      0.098      0.096      0.099      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.098      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.098      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.098      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000
              taumuj            0.191      0.192      0.190      0.192      0.191      0.193      0.189      0.192      0.191      0.191      0.192      0.191      0.191      0.192      0.191      0.191      0.191      0.191      0.192      0.192      0.191      0.191      0.192      0.191      0.191      0.191      0.191      0.192      0.191      0.192      0.191      0.191      0.192      0.192      0.191      0.191      0.192      0.191      0.191      0.192      0.191      0.191      0.192      0.191      0.191      0.192      0.191      0.192      0.191      0.191      0.192      0.191      0.192      0.191      0.191      0.191      0.191      0.191      0.191      0.191      0.191      0.192      0.192      0.191      0.192      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000
              tauelj            0.160      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.162      0.164      0.163      0.163      0.163      0.162      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000
               other            0.028      0.028      0.029      0.028      0.029      0.028      0.029      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000

-- maybe some error in the signal?






check old full-signal study:

[olek@fermi05 proc]$ grep accept last_procs
# run for inlcuding updowns and scales in the fit, normalized to the acceptance
# first acceptance run
python genjobs.py v34 t1 --acceptance-study channels_nom_sys_both_sel_main --dtags MC2016_Summer16_TTJets_powheg,updowns,updowns_extra --scheme 5,5,2,12,12


python proc/print_acceptances.py --sys-weights merge-sets/v34/t1/MC2016_Summer16_TTJets_powheg.root

python print_acceptances.py --sys-weights merge-sets/v34/t1/MC2016_Summer16_TTJets_powheg.root
INFO:root:import ROOT
INFO:root:done
               mutau            0.176      0.176      0.176      0.175      0.176      0.176      0.176      0.176      0.176      0.176      0.176      0.175      0.175      0.176      0.176      0.176      0.175      0.175      0.176      0.176      0.176      0.175      0.176      0.176      0.176      0.176      0.176      0.176      0.175      0.176      0.175      0.175      0.176      0.176      0.175      0.176      0.176      0.176      0.176      0.176      0.176      0.176      0.176      0.176      0.176      0.176      0.175      0.176      0.176
               eltau            0.169      0.169      0.169      0.168      0.169      0.169      0.169      0.169      0.169      0.169      0.169      0.168      0.168      0.169      0.169      0.169      0.169      0.168      0.169      0.169      0.169      0.168      0.169      0.169      0.169      0.169      0.169      0.169      0.168      0.169      0.168      0.168      0.169      0.169      0.168      0.169      0.169      0.169      0.169      0.169      0.169      0.169      0.169      0.169      0.169      0.169      0.168      0.169      0.169


-- very similar to all-proc result






## histosels

histosel_stage2_run3_VlooseShapes_el_sel_ljs_updowns2
histosel_stage2_run3_VlooseShapes_mu_sel_ljs_updowns2

vim syst-test.syst-list.3
vim syst-test.syst-list.pdfs

histosel-roots/v25pStage2Run3_el_ljs_updowns_weights/
histosel-roots/v25pStage2Run3_mu_ljs_updowns_weights/

source histosel_stage2_run3_VlooseShapes_el_sel_ljs_updowns2_weights_1 &
source histosel_stage2_run3_VlooseShapes_el_sel_ljs_updowns2_weights_2 &
source histosel_stage2_run3_VlooseShapes_mu_sel_ljs_updowns2_weights_1 &
source histosel_stage2_run3_VlooseShapes_mu_sel_ljs_updowns2_weights_2 &

hadd histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns.root histosel-roots/v25pStage2Run3_el_ljs/distr*root histosel-roots/v25pStage2Run3_mu_ljs/distr*root histosel-roots/v25pStage2Run3_el_ljs_updowns/distr*root histosel-roots/v25pStage2Run3_mu_ljs_updowns/distr*root

hadd histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns_weights.root histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns.root histosel-roots/v25pStage2Run3_el_ljs_updowns_weights/distr*root histosel-roots/v25pStage2Run3_mu_ljs_updowns_weights/distr*root


el alphas error

foreach sys (AlphaSUp AlphaSDown)
python stack_plot.py distrs_v25pStage2Run3_2_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root  -o histosel-roots/v25pStage2Run3_el_ljs_updowns_weights/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8    -s $sys || true
end

foreach sys (AlphaSUp AlphaSDown)
python stack_plot.py distrs_v25pStage2Run3_2_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root  -o histosel-roots/v25pStage2Run3_el_ljs_updowns_weights/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8    -s $sys || true
end

-- there was data-qcd and mc



combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid --points 60 --rMin 0.6 --rMax 1.4 --name MuShapes --freezeParameters lumi_13TeV
combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_el.root   --algo grid --points 32 --rMin 0.6 --rMax 1.4 --name ElShapes --freezeParameters lumi_13TeV
combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_both.root --algo grid --points 60 --rMin 0.6 --rMax 1.4 --name BothShapes --freezeParameters lumi_13TeV


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit               --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5        --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 -o latest_mu_impacts.json                  --name MuImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts.json -o postfit_mu_impacts


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit          --name ElImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5   --name ElImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeParameters lumi_13TeV  -m 125 -o latest_el_impacts.json             --name ElImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts.json -o postfit_el_impacts


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_both.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit         --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_both.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5  --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_both.root --freezeParameters lumi_13TeV  -m 125 -o latest_both_impacts.json          --name BothImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts.json -o postfit_both_impacts


python new_impact_table.py --merge-pdf latest_el_impacts.json
python new_impact_table.py --merge-pdf latest_mu_impacts.json
python new_impact_table.py --merge-pdf latest_both_impacts.json























# acceptances in all processes in all systematics

for dset in `cat dsets_tt_systs`
do
das_client --limit=2 --query="file dataset=$dset"
done | tee dsets_tt_systs_2file

das_client --limit=2 --query="file dataset=/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/RunIISummer16MiniAODv2-PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/MINIAODSIM" >> dsets_tt_systs_2file


export INFILE=/eos/user/o/otoldaie/TTJets_TuneCUETP8M2T4_13TeV-amcatnloFXFX-pythia8_366459FB-DFC5-E611-BE5E-D8D385AF8AE2.root
export DTAG=TTJets_amcatnlo
cmsRun python/ConfFile_cfg.py

export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4_GluonMoveCRTune_13TeV-powheg-pythia8_B6EEA189-C940-E711-B6FB-E0071B6CAD00.root
export DTAG=TTJets_GluonMoveCRTune
export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4_QCDbasedCRTune_erdON_13TeV-powheg-pythia8_BE256AF2-B926-E711-A36C-A0369FD20608.root
export DTAG=TTJets_QCDbasedCRTune

export INFILE=/eos/user/o/otoldaie/TT_TuneEE5C_13TeV-powheg-herwigpp_6820BBE0-01B5-E611-85C8-002590E7E01A.root
export DTAG=TTJets_herwigpp'



export INFILE=/eos/user/o/otoldaie/TT_165F54A0-A3BE-E611-B3F7-0025905A606A.root
export DTAG=TTJets_NOMINAL
cmsRun python/ConfFile_cfg.py



export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8_3071D964-03B7-E611-98C4-B083FED18596.root
export DTAG=TTJets_FSRDown
cmsRun python/ConfFile_cfg.py

export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8_BE2542A8-C2D6-E611-BCB2-0CC47A6C0682.root
export DTAG=TTJets_FSRUp
cmsRun python/ConfFile_cfg.py

export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8_244A6BD6-CFB5-E611-98C3-008CFA16615C.root
export DTAG=TTJets_ISRDown
cmsRun python/ConfFile_cfg.py
export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8_14D0A1F0-A0BE-E611-BF78-FA163E795A09.root
export DTAG=TTJets_ISRUp
cmsRun python/ConfFile_cfg.py

export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4down_13TeV-powheg-pythia8_B87402B7-52C0-E611-95D4-B8CA3A70A410.root
export DTAG=TTJets_TuneDown
cmsRun python/ConfFile_cfg.py
export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4up_13TeV-powheg-pythia8_BAD9F05B-C6B6-E611-9C69-0023AEEEB226.root
export DTAG=TTJets_TuneUp
cmsRun python/ConfFile_cfg.py

export INFILE=/eos/user/o/otoldaie/TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8_F8364FC9-A5F2-E611-90F2-FA163E73666D.root
export DTAG=TTJets_HDAMPDown
cmsRun python/ConfFile_cfg.py
export INFILE=/eos/user/o/otoldaie/TT_hdampUP_TuneCUETP8M2T4_13TeV-powheg-pythia8_1EA7E8C9-C0F2-E611-85C3-FA163E65B77A.root
export DTAG=TTJets_HDAMPUp
cmsRun python/ConfFile_cfg.py


second batch

export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/80000/7C8A67E6-9ABE-E611-B3E7-0242AC130004.root
export DTAG=TTJets_NOMINAL_1
cmsRun python/ConfFile_cfg.py

export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/80000/9031330B-9ABE-E611-BAF9-0242AC130002.root
export DTAG=TTJets_NOMINAL_2
cmsRun python/ConfFile_cfg.py


export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/80000/9EAC0046-06B7-E611-AF76-141877411FED.root
export DTAG=TTJets_FSRDown_2
cmsRun python/ConfFile_cfg.py
export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/50000/A2858033-C4D6-E611-BB70-0CC47AA989C4.root
export DTAG=TTJets_FSRUp_2
cmsRun python/ConfFile_cfg.py

export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/110000/005CF57C-CAB5-E611-862F-141877642ECF.root
export DTAG=TTJets_ISRDown_2
cmsRun python/ConfFile_cfg.py
export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6_ext1-v1/70000/E0D51A37-A1BE-E611-A84E-02163E012FCB.root
export DTAG=TTJets_ISRUp_2
cmsRun python/ConfFile_cfg.py

export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4down_13TeV-powheg-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/120000/266CE88B-5FC0-E611-8C1C-0CC47A4C8EB6.root
export DTAG=TTJets_TuneDown_2
cmsRun python/ConfFile_cfg.py
export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4up_13TeV-powheg-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/70000/1604C4FE-C9B6-E611-B524-0023AEEEB226.root
export DTAG=TTJets_TuneUp_2
cmsRun python/ConfFile_cfg.py

export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/120000/4EBECEBC-AAF2-E611-8399-02163E013A79.root
export DTAG=TTJets_2_HDAMPDown_2
cmsRun python/ConfFile_cfg.py
export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_hdampUP_TuneCUETP8M2T4_13TeV-powheg-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/120000/6CB65478-B7F2-E611-837A-FA163ED9F610.root
export DTAG=TTJets_2_HDAMPUp_2
cmsRun python/ConfFile_cfg.py






for f in NtuplerAnalyzer_test_METfiltersOFF_TTJets_HDAMPUp_signal_recordAll.root    NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrup_signal_recordAll.root    NtuplerAnalyzer_test_METfiltersOFF_TTJets2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_HDAMPDown_signal_recordAll.root  NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrdown_signal_recordAll.root  NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneUp_signal_recordAll.root     NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrup_signal_recordAll.root    NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneDown_signal_recordAll.root   NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrdown_signal_recordAll.root
do
python proc/signal_acceptance.py temp/ $f --no-tau-cut
done

without repetition now:

for f in NtuplerAnalyzer_test_METfiltersOFF_TTJets_HDAMPUp_signal_recordAll.root    NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrup_signal_recordAll.root    NtuplerAnalyzer_test_METfiltersOFF_TTJets_HDAMPDown_signal_recordAll.root  NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrdown_signal_recordAll.root  NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneUp_signal_recordAll.root     NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrup_signal_recordAll.root    NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneDown_signal_recordAll.root   NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrdown_signal_recordAll.root
do
python proc/signal_acceptance.py temp/ $f --no-tau-cut
done


all_ev_mutau->GetBinContent(1)
all_ev_muj->GetBinContent(1)
all_ev_taumutauh->GetBinContent(1)
all_ev_taumuj->GetBinContent(1)

all_ev_eltau->GetBinContent(1)
all_ev_elj->GetBinContent(1)
all_ev_taueltauh->GetBinContent(1)
all_ev_tauelj->GetBinContent(1)

all_ev_other->GetBinContent(1)




python proc/print_acceptances.py temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets2_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_HDAMPDown_signal_recordAll.root  temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_HDAMPUp_signal_recordAll.root    temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneDown_signal_recordAll.root   temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneUp_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrdown_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrup_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrdown_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrup_signal_recordAll.root




second batch of files


for f in NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_HDAMPDown_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_HDAMPUp_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneUp_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneDown_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrUp_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrDown_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrUp_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrDown_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_1_signal_recordAll.root
do
python proc/signal_acceptance.py temp/ $f --no-tau-cut
done

python proc/print_acceptances.py  temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets2_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_1_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_signal_recordAll.root

 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_HDAMPDown_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_HDAMPUp_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneUp_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneDown_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrUp_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrDown_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrUp_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrDown_2_signal_recordAll.root


for f in NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrDown_2_signal_recordAll.root  NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrdown_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrUp_2_signal_recordAll.root    NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrup_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_FSRDown_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_1_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets2_signal_recordAll.root
do
python proc/signal_acceptance.py temp/ $f --no-tau-cut
done

python proc/print_acceptances.py  temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets2_signal_recordAll.root           temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_1_signal_recordAll.root          temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_signal_recordAll.root          temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_FSRDown_signal_recordAll.root    temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrdown_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrDown_2_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrup_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrUp_2_signal_recordAll.root



hadd nominal.root  init/NtuplerAnalyzer_test_METfiltersOFF_TTJets2_signal_recordAll.root init/NtuplerAnalyzer_test_METfiltersOFF_TTJets_1_signal_recordAll.root init/NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_signal_recordAll.root

hadd HDAMPDown.root init/*HDAMPDown*.root 
hadd HDAMPUp.root   init/*HDAMPUp*.root 

hadd TuneDown.root  init/*TuneDown*.root 
hadd TuneUp.root    init/*TuneUp*.root 

hadd FSRDown.root  init/*FSRDown*.root 
hadd FSRUp.root    init/*FSRUp*.root 

hadd ISRDown.root  init/*ISRDown*.root 
hadd ISRUp.root    init/*ISRUp*.root 


python proc/print_acceptances.py  temp/nominal.root

python proc/print_acceptances.py  temp/init/*FSR*.root




python proc/print_acceptances.py temp/nominal.root temp/init/*FSRDown* temp/init/*FSRUp*
INFO:root:import ROOT
INFO:root:done
               mutau            0.322      0.337      0.345      0.320      0.309
               eltau            0.294      0.316      0.334      0.298      0.302
                 muj            0.505      0.513      0.508      0.492      0.486
                 elj            0.486      0.494      0.490      0.467      0.479
           taumutauh            0.144      0.116      0.111      0.135      0.072
           taueltauh            0.098      0.122      0.125      0.095      0.100
              taumuj            0.191      0.195      0.205      0.192      0.181
              tauelj            0.160      0.141      0.175      0.141      0.168
               other            0.028      0.030      0.028      0.027      0.027


python proc/print_acceptances.py temp/nominal.root temp/init/*ISRDown* temp/init/*ISRUp*
INFO:root:import ROOT
INFO:root:done
               mutau            0.322      0.336      0.328      0.302      0.309
               eltau            0.294      0.294      0.317      0.317      0.298
                 muj            0.505      0.499      0.499      0.503      0.513
                 elj            0.486      0.483      0.483      0.492      0.486
           taumutauh            0.144      0.149      0.155      0.132      0.119
           taueltauh            0.098      0.136      0.086      0.122      0.131
              taumuj            0.191      0.189      0.192      0.199      0.193
              tauelj            0.160      0.172      0.166      0.168      0.170
               other            0.028      0.028      0.028      0.030      0.030



python proc/print_acceptances.py temp/nominal.root temp/init/*HDAMPDown* temp/init/*HDAMPUp*
INFO:root:import ROOT
INFO:root:done
               mutau            0.322      0.302      0.336      0.337      0.328
               eltau            0.294      0.306      0.288      0.303      0.327
                 muj            0.505      0.499      0.503      0.510      0.507
                 elj            0.486      0.484      0.480      0.464      0.485
           taumutauh            0.144      0.139      0.154      0.076      0.135
           taueltauh            0.098      0.138      0.057      0.167      0.113
              taumuj            0.191      0.188      0.194      0.194      0.186
              tauelj            0.160      0.178      0.155      0.170      0.150
               other            0.028      0.025      0.028      0.030      0.029


python proc/print_acceptances.py temp/nominal.root temp/init/*TuneDown* temp/init/*TuneUp*
INFO:root:import ROOT
INFO:root:done
               mutau            0.322      0.327      0.334      0.325      0.308
               eltau            0.294      0.307      0.292      0.331      0.307
                 muj            0.505      0.503      0.508      0.511      0.507
                 elj            0.486      0.495      0.492      0.497      0.482
           taumutauh            0.144      0.136      0.132      0.073      0.113
           taueltauh            0.098      0.101      0.066      0.100      0.076
              taumuj            0.191      0.183      0.191      0.191      0.183
              tauelj            0.160      0.167      0.155      0.176      0.173
               other            0.028      0.028      0.027      0.030      0.030




python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*FSRDown*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*FSRUp*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*ISRDown*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*ISRUp*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*HDAMPDown*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*HDAMPUp*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*TuneDown*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*TuneUp*


FSR

               mutau       0.942866204619
               eltau       0.904832496014
                 muj       0.989867024467
                 elj       0.987626376095
           taumutauh       1.26952197002
           taueltauh       0.794519452559
              taumuj       0.952545290094
              tauelj       1.00932151419
               other       0.960638501667

               mutau       1.02270863374
               eltau       0.978752305853
                 muj       1.03305028026
                 elj       1.02787517806
           taumutauh       1.38979038245
           taueltauh       1.00813529447
              taumuj       1.021196958
              tauelj       1.03511748878
               other       1.03893634895

ISR

               mutau       0.969439993329
               eltau       0.962816353014
                 muj       1.01229346366
                 elj       1.00589450516
           taumutauh       0.946700623192
           taueltauh       0.884687918797
              taumuj       1.00079502107
              tauelj       0.944689165509
               other       1.00523958854

               mutau       1.05268377883
               eltau       0.954568837366
                 muj       0.994078810793
                 elj       0.994546897178
           taumutauh       1.14766291565
           taueltauh       0.773106238518
              taumuj       0.973559233887
              tauelj       0.944861104992
               other       0.952229026172

HDAMP

               mutau       1.00982009639
               eltau       0.98904717363
                 muj       1.00806668435
                 elj       1.00833128877
           taumutauh       0.978722128787
           taueltauh       1.00308679603
              taumuj       0.998311551561
              tauelj       0.96012282097
               other       1.04554624589

               mutau       0.967020783536
               eltau       0.933196123653
                 muj       0.993210779608
                 elj       1.02368791373
           taumutauh       1.36107953482
           taueltauh       0.702955720014
              taumuj       1.00474265151
              tauelj       1.00115091086
               other       0.9451016675

Tune

               mutau       0.973505498988
               eltau       0.980069401228
                 muj       0.998599918897
                 elj       0.984769512079
           taumutauh       1.07419894198
           taueltauh       1.17868224054
              taumuj       1.01979534213
              tauelj       0.993191192981
               other       1.02310781456

               mutau       1.01624297655
               eltau       0.92229220301
                 muj       0.992133811288
                 elj       0.993142123194
           taumutauh       1.5402070425
           taueltauh       1.11854729834
              taumuj       1.021249466
              tauelj       0.915446185028
               other       0.944953839721









trying to compare the acceptance variation to yield variation in the final selection

python yield_variations.py histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4

                   mu_sel_lj     mu_sel_lj     mu_sel_lj     mu_sel_lj     mu_sel_lj                      mu_sel_ljout  mu_sel_ljout  mu_sel_ljout  mu_sel_ljout  mu_sel_ljout
                    tt_mutau         tt_lj      tt_taulj   tt_taultauh      tt_other                          tt_mutau         tt_lj      tt_taulj   tt_taultauh      tt_other
FSR              1.042/0.923   1.468/0.524   1.449/0.528   1.063/0.932   1.272/0.664  - - - - - - - - -    1.058/0.930   1.460/0.565   1.382/0.590   1.049/0.945   1.307/0.670
ISR              1.001/0.986   1.000/0.946   1.008/0.963   1.002/1.028   0.935/1.029  - - - - - - - - -    1.017/0.976   1.025/0.970   0.980/0.862   1.006/0.979   1.009/1.024
HDAMP            0.984/0.995   0.980/1.009   0.972/0.958   1.040/1.078   0.985/1.028  - - - - - - - - -    0.993/0.983   1.005/0.999   0.990/0.987   1.007/1.014   1.056/1.173
TuneCUETP8M2T4   0.994/0.978   1.001/0.984   1.037/0.947   0.999/1.054   1.016/0.977  - - - - - - - - -    1.003/0.996   1.044/0.986   0.990/0.971   1.002/0.963   1.083/1.015

FSR             lnN            1.042/0.923   1.468/0.524   1.449/0.528   1.063/0.932   1.272/0.664  - - - - - - - - -    1.058/0.930   1.460/0.565   1.382/0.590   1.049/0.945   1.307/0.670  - - - - - - - - -
ISR             lnN            1.001/0.986   1.000/0.946   1.008/0.963   1.002/1.028   0.935/1.029  - - - - - - - - -    1.017/0.976   1.025/0.970   0.980/0.862   1.006/0.979   1.009/1.024  - - - - - - - - -
HDAMP           lnN            0.984/0.995   0.980/1.009   0.972/0.958   1.040/1.078   0.985/1.028  - - - - - - - - -    0.993/0.983   1.005/0.999   0.990/0.987   1.007/1.014   1.056/1.173  - - - - - - - - -
TuneCUETP8M2T4  lnN            0.994/0.978   1.001/0.984   1.037/0.947   0.999/1.054   1.016/0.977  - - - - - - - - -    1.003/0.996   1.044/0.986   0.990/0.971   1.002/0.963   1.083/1.015  - - - - - - - - -



FSR             lnN   1.060/0.940  1.474/0.526  1.465/0.535  1.066/0.934  1.314/0.686  - - - - - - - - -   1.065/0.935 1.442/0.558 1.402/0.598 1.052/0.948 1.322/0.678   -
ISR             lnN   1.007/0.993  1.028/0.972  1.023/0.977  0.987/1.013  0.952/1.048  - - - - - - - - -   1.021/0.979 1.028/0.972 1.064/0.936 1.013/0.987 0.993/1.007   -
HDAMP           lnN   0.994/1.006  0.985/1.015  1.007/0.993  0.982/1.018  0.978/1.022  - - - - - - - - -   1.005/0.995 1.003/0.997 1.002/0.998 0.997/1.003 0.948/1.052   -
TuneCUETP8M2T4  lnN   1.008/0.992  1.009/0.991  1.045/0.955  0.973/1.027  1.019/0.981  - - - - - - - - -   1.003/0.997 1.029/0.971 1.009/0.991 1.020/0.980 1.032/0.968   -  

variation 3% FSR lj

FSR             lnN   1.060/0.940  1.43/0.54  1.42/0.55  1.066/0.934  1.314/0.686  - - - - - - - - -   1.065/0.935 1.39/0.58 1.35/0.62 1.052/0.948 1.322/0.678   -




same for electrons

python yield_variations.py histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns.root -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout -p tt_eltau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4

                                 el_sel_lj             el_sel_lj             el_sel_lj             el_sel_lj             el_sel_lj          el_sel_ljout          el_sel_ljout          el_sel_ljout          el_sel_ljout          el_sel_ljout
                                  tt_eltau                 tt_lj              tt_taulj           tt_taultauh              tt_other              tt_eltau                 tt_lj              tt_taulj           tt_taultauh              tt_other
FSR            lnN 1.050/0.954  1.491/0.540  1.487/0.566  1.060/0.962  1.184/0.684  - - - - - - - - -  1.082/0.945  1.506/0.573  1.501/0.548  1.097/0.862  1.374/0.721   - - - - - - - - -
ISR            lnN 1.019/0.993  1.027/0.968  0.961/0.989  1.005/1.025  0.920/0.932  - - - - - - - - -  1.030/0.997  1.033/0.985  1.135/0.961  0.998/0.945  1.098/1.068   - - - - - - - - -
HDAMP          lnN 1.017/1.018  1.013/0.998  1.014/0.981  0.947/1.063  0.775/0.975  - - - - - - - - -  1.014/1.023  1.030/1.035  1.039/1.178  1.038/1.001  1.106/1.119   - - - - - - - - -
TuneCUETP8M2T4 lnN 1.034/1.005  1.041/0.978  1.022/1.129  0.947/0.970  0.900/0.906  - - - - - - - - -  1.017/1.004  1.030/1.013  0.977/1.014  0.957/0.952  1.231/1.180   - - - - - - - - -


python yield_variations.py histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns.root --to-average -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout -p tt_eltau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4

                                 el_sel_lj             el_sel_lj             el_sel_lj             el_sel_lj             el_sel_lj          el_sel_ljout          el_sel_ljout          el_sel_ljout          el_sel_ljout          el_sel_ljout
                                  tt_eltau                 tt_lj              tt_taulj           tt_taultauh              tt_other              tt_eltau                 tt_lj              tt_taulj           tt_taultauh              tt_other
FSR            lnN 1.048/0.952 1.468/0.532 1.449/0.551 1.048/0.952 1.268/0.732  - - - - - - - - -           1.067/0.933 1.449/0.551 1.465/0.535 1.120/0.880 1.311/0.689  - - - - - - - - -
ISR            lnN 1.013/0.987 1.029/0.971 0.986/1.014 0.990/1.010 0.994/1.006  - - - - - - - - -           1.016/0.984 1.024/0.976 1.083/0.917 1.027/0.973 1.014/0.986  - - - - - - - - -
HDAMP          lnN 0.999/1.001 1.008/0.992 1.017/0.983 0.942/1.058 0.886/1.114  - - - - - - - - -           0.996/1.004 0.998/1.002 0.937/1.063 1.018/0.982 0.994/1.006  - - - - - - - - -
TuneCUETP8M2T4 lnN 1.014/0.986 1.032/0.968 0.950/1.050 0.988/1.012 0.996/1.004  - - - - - - - - -           1.007/0.993 1.008/0.992 0.981/1.019 1.003/0.997 1.021/0.979  - - - - - - - - -

the smaller FSR variation in signal, normalized by jet-based acceptance, not tau:

FSR            lnN 1.024/0.976 1.42/0.58   1.35/0.75   1.028/0.972 1.268/0.732  - - - - - - - - -           1.033/0.967 1.35/0.75   1.42/0.58   1.06/0.94   1.311/0.689  - - - - - - - - -

-- very reasonable looking (with LEPel reduced to 0.8)

the compromise:

FSR            lnN 1.03/0.97   1.42/0.58   1.35/0.75   1.02/0.98   1.268/0.732  - - - - - - - - -           1.04/0.96   1.35/0.75   1.42/0.58   1.07/0.93   1.311/0.689  - - - - - - - - -


-- effect of fsr+fakes a vit higher

mc stat 3.3%






old selection IDs:

time make distrs_mc_nominal dtag=TT p=pStage2Run3                      cond="selection_stage==105"  chan="mu_sel"    &
time make distrs_mc_nominal dtag=TT p=pStage2Run3 options="--el-procs" cond="selection_stage==115"  chan="el_sel" &

time make distrs_mc_updowns p=r4                      cond="selection_stage==105" chan="mu_sel" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==115" chan="el_sel" &


hadd distrs/MC2016_Summer16_TTJets_powheg.root                distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*NOMINAL*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_isrup.root          distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*ISRUp*root               &
hadd distrs/MC2016_Summer16_TTJets_powheg_isrdown.root        distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*ISRDown*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_hdampUP.root        distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*HDAMPUp*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_hdampDOWN.root      distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*HDAMPDown*root           &
hadd distrs/MC2016_Summer16_TTJets_powheg_fsrup.root          distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*FSRUp*root               &
hadd distrs/MC2016_Summer16_TTJets_powheg_fsrdown.root        distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*FSRDown*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_CUETP8M2T4up.root   distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*TuneCUETP8M2T4Up*root    &
hadd distrs/MC2016_Summer16_TTJets_powheg_CUETP8M2T4down.root distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*TuneCUETP8M2T4Down*root  &

hadd distrs_v25_pStage2Run3_r4_sel.root v25_pStage2Run3_r4_sel/MC*

python yield_variations.py mc_norm/distrs_v25_pStage2Run3_r4_sel.root -d Mt_lep_met_f -c mu_sel -p tt_mutau,tt_lj,tt_taultauh,tt_taulj,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py mc_norm/distrs_v25_pStage2Run3_r4_sel.root -d Mt_lep_met_f -c el_sel -p tt_eltau,tt_lj,tt_taultauh,tt_taulj,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4

                                    mu_sel                mu_sel                mu_sel                mu_sel                mu_sel
                                  tt_mutau                 tt_lj           tt_taultauh              tt_taulj              tt_other
                 FSR           1.065/0.904           1.483/0.527           1.068/0.916           1.440/0.539           1.311/0.651
                 ISR           1.009/0.983           1.009/0.958           1.003/1.002           0.996/0.926           0.980/1.029
               HDAMP           0.975/0.988           0.976/1.006           1.005/1.039           0.965/0.971           1.015/1.121
      TuneCUETP8M2T4           0.998/0.987           1.017/0.982           1.000/0.996           1.017/0.955           1.057/0.999

                                    el_sel                el_sel                el_sel                el_sel                el_sel
                                  tt_eltau                 tt_lj           tt_taultauh              tt_taulj              tt_other
                 FSR           1.083/0.925           1.516/0.539           1.097/0.878           1.512/0.545           1.319/0.690
                 ISR           1.018/0.997           1.022/0.976           0.994/0.977           1.022/0.979           1.024/1.017
               HDAMP           1.003/1.021           1.008/1.013           0.992/1.025           1.012/1.059           0.970/1.065
      TuneCUETP8M2T4           1.021/1.002           1.034/0.990           0.951/0.957           1.002/1.082           1.103/1.075




more stats in Vloose:

time make distrs_mc_nominal dtag=TT nt=v26 p=r4                      cond="(selection_stage==105 || selection_stage==107)"  chan="mu_selVloose"    &
time make distrs_mc_nominal dtag=TT nt=v26 p=r4 options="--el-procs" cond="(selection_stage==115 || selection_stage==117)"  chan="el_selVloose" &

time make distrs_mc_updowns nt=v25 p=r4                      cond="(selection_stage==105 || selection_stage==107)" chan="mu_selVloose" &
time make distrs_mc_updowns nt=v25 p=r4 options="--el-procs" cond="(selection_stage==115 || selection_stage==117)" chan="el_selVloose" &

python yield_variations.py mc_norm/distrs_v25_pStage2Run3_r4_sel.root -d Mt_lep_met_f -c mu_selVloose -p tt_mutau,tt_lj,tt_taultauh,tt_taulj,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py mc_norm/distrs_v25_pStage2Run3_r4_sel.root -d Mt_lep_met_f -c el_selVloose -p tt_eltau,tt_lj,tt_taultauh,tt_taulj,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4


                              mu_selVloose          mu_selVloose          mu_selVloose          mu_selVloose          mu_selVloose
                                  tt_mutau                 tt_lj           tt_taultauh              tt_taulj              tt_other
                 FSR           1.051/0.914           1.421/0.564           1.058/0.923           1.416/0.562           1.292/0.650
                 ISR           1.004/0.987           1.004/0.977           0.998/1.008           1.002/0.964           0.978/1.026
               HDAMP           0.977/0.986           0.982/1.008           0.997/1.033           0.972/0.998           0.976/1.023
      TuneCUETP8M2T4           0.996/0.989           1.012/0.991           1.007/0.985           1.008/0.954           0.968/0.980

                              el_selVloose          el_selVloose          el_selVloose          el_selVloose          el_selVloose
                                  tt_eltau                 tt_lj           tt_taultauh              tt_taulj              tt_other
                 FSR           1.072/0.934           1.425/0.562           1.097/0.906           1.414/0.572           1.350/0.669
                 ISR           1.015/1.001           1.007/0.975           1.004/0.985           1.006/0.984           0.989/1.022
               HDAMP           1.002/1.020           0.988/0.998           0.980/1.032           0.979/1.008           0.977/1.021
      TuneCUETP8M2T4           1.014/1.003           1.005/0.985           0.976/0.971           0.980/1.031           1.077/1.009


python yield_variations.py mc_norm/distrs_v25_pStage2Run3_r4_sel.root -d Mt_lep_met_f -c mu_selVloose -p tt_mutau,tt_lj,tt_taultauh,tt_taulj,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4 --to-average
python yield_variations.py mc_norm/distrs_v25_pStage2Run3_r4_sel.root -d Mt_lep_met_f -c el_selVloose -p tt_eltau,tt_lj,tt_taultauh,tt_taulj,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4 --to-average


                              mu_selVloose          mu_selVloose          mu_selVloose          mu_selVloose          mu_selVloose
                                  tt_mutau                 tt_lj           tt_taultauh              tt_taulj              tt_other
                 FSR           1.070/0.930           1.432/0.568           1.068/0.932           1.431/0.569           1.331/0.669
                 ISR           1.009/0.991           1.014/0.986           0.995/1.005           1.019/0.981           0.976/1.024
               HDAMP           0.995/1.005           0.987/1.013           0.983/1.017           0.987/1.013           0.977/1.023
      TuneCUETP8M2T4           1.004/0.996           1.011/0.989           1.011/0.989           1.028/0.972           0.994/1.006

                              el_selVloose          el_selVloose          el_selVloose          el_selVloose          el_selVloose
                                  tt_eltau                 tt_lj           tt_taultauh              tt_taulj              tt_other
                 FSR           1.069/0.931           1.434/0.566           1.095/0.905           1.424/0.576           1.337/0.663
                 ISR           1.007/0.993           1.016/0.984           1.010/0.990           1.011/0.989           0.983/1.017
               HDAMP           0.991/1.009           0.995/1.005           0.975/1.025           0.986/1.014           0.978/1.022
      TuneCUETP8M2T4           1.005/0.995           1.010/0.990           1.002/0.998           0.975/1.025           1.033/0.967



lj out

FSR             lnN   1.060/0.940  1.474/0.526  1.465/0.535  1.066/0.934  1.314/0.686  - - - - - - - - -   1.065/0.935 1.442/0.558 1.402/0.598 1.052/0.948 1.322/0.678   -
ISR             lnN   1.007/0.993  1.028/0.972  1.023/0.977  0.987/1.013  0.952/1.048  - - - - - - - - -   1.021/0.979 1.028/0.972 1.064/0.936 1.013/0.987 0.993/1.007   -
HDAMP           lnN   0.994/1.006  0.985/1.015  1.007/0.993  0.982/1.018  0.978/1.022  - - - - - - - - -   1.005/0.995 1.003/0.997 1.002/0.998 0.997/1.003 0.948/1.052   -
TuneCUETP8M2T4  lnN   1.008/0.992  1.009/0.991  1.045/0.955  0.973/1.027  1.019/0.981  - - - - - - - - -   1.003/0.997 1.029/0.971 1.009/0.991 1.020/0.980 1.032/0.968   -  


Vloose copy

FSR             lnN   1.070/0.930  1.432/0.568  1.431/0.569  1.068/0.932  1.331/0.669  - - - - - - - - -     1.070/0.930  1.432/0.568  1.431/0.569  1.068/0.932  1.331/0.669 -        -     -     -        -     -        -     -        -
ISR             lnN   1.009/0.991  1.014/0.986  1.019/0.981  0.995/1.005  0.976/1.024  - - - - - - - - -     1.009/0.991  1.014/0.986  1.019/0.981  0.995/1.005  0.976/1.024 -        -     -     -        -     -        -     -        -
HDAMP           lnN   0.995/1.005  0.987/1.013  0.987/1.013  0.983/1.017  0.977/1.023  - - - - - - - - -     0.995/1.005  0.987/1.013  0.987/1.013  0.983/1.017  0.977/1.023 -        -     -     -        -     -        -     -        -
TuneCUETP8M2T4  lnN   1.004/0.996  1.011/0.989  1.028/0.972  1.011/0.989  0.994/1.006  - - - - - - - - -     1.004/0.996  1.011/0.989  1.028/0.972  1.011/0.989  0.994/1.006 -        -     -     -        -     -        -     -        -




Vloose lj out

python yield_variations.py distrs_v25pStage2Run3_2_updowns.root -d Mt_lep_met_f -c mu_selVloose_lj -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py distrs_v25pStage2Run3_2_updowns.root -d Mt_lep_met_f -c el_selVloose_lj -p tt_eltau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4




python yield_variations.py --to-average distrs_v25pStage2Run3_2_updowns.root -d Mt_lep_met_f -c mu_selVloose_lj,mu_selVloose_ljout -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py --to-average distrs_v25pStage2Run3_2_updowns.root -d Mt_lep_met_f -c el_selVloose_lj,el_selVloose_ljout -p tt_eltau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4

                           mu_selVloose_lj       mu_selVloose_lj       mu_selVloose_lj       mu_selVloose_lj       mu_selVloose_lj    mu_selVloose_ljout    mu_selVloose_ljout    mu_selVloose_ljout    mu_selVloose_ljout    mu_selVloose_ljout
                                  tt_mutau                 tt_lj              tt_taulj           tt_taultauh              tt_other              tt_mutau                 tt_lj              tt_taulj           tt_taultauh              tt_other
                 FSR           1.067/0.933           1.442/0.558           1.452/0.548           1.068/0.932           1.323/0.677           1.071/0.929           1.418/0.582           1.402/0.598           1.069/0.931           1.335/0.665
                 ISR           1.000/1.000           1.010/0.990           1.010/0.990           0.981/1.019           0.955/1.045           1.015/0.985           1.019/0.981           1.034/0.966           1.004/0.996           0.987/1.013
               HDAMP           0.984/1.016           0.987/1.013           0.982/1.018           0.978/1.022           0.965/1.035           1.002/0.998           0.987/1.013           0.994/1.006           0.986/1.014           0.983/1.017
      TuneCUETP8M2T4           1.004/0.996           1.006/0.994           1.043/0.957           0.984/1.016           0.994/1.006           1.004/0.996           1.017/0.983           1.005/0.995           1.029/0.971           0.994/1.006


[olek@fermi05 jobsums]$ python yield_variations.py --to-average distrs_v25pStage2Run3_2_updowns.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4

                                 mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout
                                  tt_mutau                 tt_lj              tt_taulj           tt_taultauh              tt_other              tt_mutau                 tt_lj              tt_taulj           tt_taultauh              tt_other
                 FSR           1.079/0.921           1.489/0.511           1.480/0.520           1.085/0.915           1.331/0.669           1.084/0.916           1.457/0.543           1.417/0.583           1.071/0.929           1.339/0.661
                 ISR           1.005/0.995           1.025/0.975           1.021/0.979           0.985/1.015           0.950/1.050           1.018/0.982           1.025/0.975           1.062/0.938           1.011/0.989           0.990/1.010
               HDAMP           0.986/1.014           0.978/1.022           0.999/1.001           0.975/1.025           0.971/1.029           0.997/1.003           0.995/1.005           0.994/1.006           0.989/1.011           0.940/1.060
      TuneCUETP8M2T4           1.009/0.991           1.010/0.990           1.046/0.954           0.974/1.026           1.020/0.980           1.004/0.996           1.029/0.971           1.010/0.990           1.021/0.979           1.033/0.967




## test the old normalization

python yield_variations.py --to-average distrs_v25pStage2Run3_2_updowns.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout -p tt_mutau -s FSR
python yield_variations.py --to-average histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout -p tt_mutau -s FSR






## full signal acecptances

















# download fsr up file

/store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/50000/A2858033-C4D6-E611-BB70-0CC47AA989C4.root

xrdcp root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/50000/A2858033-C4D6-E611-BB70-0CC47AA989C4.root  /eos/user/o/otoldaie/TT_FSRUp_50000_A2858033-C4D6-E611-BB70-0CC47AA989C4.root




# adding the updowns normalized to acceptance

time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_updowns p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_updowns p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_updowns p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_updowns p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &

time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_updowns p=r4 cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_updowns p=r4 cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_updowns p=r4 cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_updowns p=r4 cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &

hadd distrs/MC2016_Summer16_TTJets_powheg_isrup.root          distrs/v25r4/*MC2016_Summer16_TTJets_powheg*ISRUp*root               &
hadd distrs/MC2016_Summer16_TTJets_powheg_isrdown.root        distrs/v25r4/*MC2016_Summer16_TTJets_powheg*ISRDown*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_hdampUP.root        distrs/v25r4/*MC2016_Summer16_TTJets_powheg*HDAMPUp*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_hdampDOWN.root      distrs/v25r4/*MC2016_Summer16_TTJets_powheg*HDAMPDown*root           &
hadd distrs/MC2016_Summer16_TTJets_powheg_fsrup.root          distrs/v25r4/*MC2016_Summer16_TTJets_powheg*FSRUp*root               &
hadd distrs/MC2016_Summer16_TTJets_powheg_fsrdown.root        distrs/v25r4/*MC2016_Summer16_TTJets_powheg*FSRDown*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_CUETP8M2T4up.root   distrs/v25r4/*MC2016_Summer16_TTJets_powheg*TuneCUETP8M2T4Up*root    &
hadd distrs/MC2016_Summer16_TTJets_powheg_CUETP8M2T4down.root distrs/v25r4/*MC2016_Summer16_TTJets_powheg*TuneCUETP8M2T4Down*root  &

debuging:
the same yield in Vloose and main sel

time make distrs_mc_updowns p=r4 cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_updowns p=r4 cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &

python selections.py  --out-dir distrs/  "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." --distr Mt_lep_met_f --chan mu_selVloose_lj --custom-range 0,20,40,60,80,100,130,160,200,250 --weight event_weight --sys ISRUp merge-sets/v25/r4/MC*TT*isrup*.root
python selections.py  --out-dir distrs/  "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "(selection_stage == 107) && event_jets_lj_var <= 60." --distr Mt_lep_met_f --chan mu_sel_lj --custom-range 0,20,40,60,80,100,130,160,200,250 --weight event_weight --sys ISRUp merge-sets/v25/r4/MC*TT*isrup*.root


root -l test1_lep_pt_MC2016_Summer16_TTJets_powheg_mu_selVloose_lj_tt_mutau_ISRUp_Mt_lep_met_f.root
mu_selVloose_lj->Get("tt_mutau/ISRUp/mu_selVloose_lj_tt_mutau_ISRUp_Mt_lep_met_f")->Print()

root -l test1_lep_pt_MC2016_Summer16_TTJets_powheg_mu_sel_lj_tt_mutau_ISRUp_Mt_lep_met_f.root
mu_sel_lj->Get("tt_mutau/ISRUp/mu_sel_lj_tt_mutau_ISRUp_Mt_lep_met_f")->Print()

--- update the selection sages 105 -> 107
vloose = 105+107 etc




signal acceptance normalization:
1. the acceptance study is done for signal process only -- for this only signal events were recorded
2. the kinematics and the acceptance probably changes for other processes too
   -- the best would be to normalize all of them separately?
      then each process would have the same number of events passing the kinematics
      (acceptance of each process = the same as nominal)
      and only the internals of jets, taus etc would be different, i.e. the effects on the efficiency
3. run test with normalization to signal



test normalization:

python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_ljout --qcd 1.05 -x mu_selVloose_ljout
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_ljout --qcd 1.05 -x mu_selVloose_ljout -s FSRUp
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_ljout --qcd 1.05 -x mu_selVloose_ljout -s FSRDown


nominal
INFO:root:data   = 13558.000000
INFO:root:mc sum = 13379.059960 13379.059960

no accept norm:
INFO:root:mc sum = 11345.496707 11345.496707

all processes norm to signal:
INFO:root:mc sum = 11582.610917 11582.610917

and down:
INFO:root:mc sum = 15132.745839 15132.745839


qcd is taken from nominal ss:
DEBUG:root:data qcd for (Mt_lep_met_f, mu_sel_ljout_ss) Integral = 214.365973


acceptances per channel found in 1 file of nominal and 1 fsrdown:

cut_ev_elj->Divide( all_ev_elj )
cut_ev_taumuj->Divide( all_ev_taumuj )
cut_ev_eltau->Divide( all_ev_eltau )
cut_ev_tauelj->Divide( all_ev_tauelj )
cut_ev_mutau->Divide( all_ev_mutau )
cut_ev_taumutauh->Divide( all_ev_taumutauh )
cut_ev_other->Divide( all_ev_other )
cut_ev_taueltauh->Divide( all_ev_taueltauh )
cut_ev_muj->Divide( all_ev_muj )


cut_ev_eltau->GetBinContent(1)
cut_ev_elj->GetBinContent(1)
cut_ev_taueltauh->GetBinContent(1)
cut_ev_tauelj->GetBinContent(1)

cut_ev_mutau->GetBinContent(1)
cut_ev_muj->GetBinContent(1)
cut_ev_taumutauh->GetBinContent(1)
cut_ev_taumuj->GetBinContent(1)

cut_ev_other->GetBinContent(1)

nominal file (without tau requirement)

root [10] cut_ev_eltau->GetBinContent(1)
(Double_t) 0.315486
root [11] cut_ev_elj->GetBinContent(1)
(Double_t) 0.489868
root [12] cut_ev_taueltauh->GetBinContent(1)
(Double_t) 0.0902917
root [13] cut_ev_tauelj->GetBinContent(1)
(Double_t) 0.160139
root [14] 
root [14] cut_ev_mutau->GetBinContent(1)
(Double_t) 0.329758
root [15] cut_ev_muj->GetBinContent(1)
(Double_t) 0.506262
root [16] cut_ev_taumutauh->GetBinContent(1)
(Double_t) 0.150445
root [17] cut_ev_taumuj->GetBinContent(1)
(Double_t) 0.190607
root [18] 
root [18] cut_ev_other->GetBinContent(1)
(Double_t) 0.0273355

fsr down:

root [10] cut_ev_eltau->GetBinContent(1)
(Double_t) 0.316088
root [11] cut_ev_elj->GetBinContent(1)
(Double_t) 0.494020
root [12] cut_ev_taueltauh->GetBinContent(1)
(Double_t) 0.121670
root [13] cut_ev_tauelj->GetBinContent(1)
(Double_t) 0.141373
root [14] 
root [14] cut_ev_mutau->GetBinContent(1)
(Double_t) 0.337093
root [15] cut_ev_muj->GetBinContent(1)
(Double_t) 0.512832
root [16] cut_ev_taumutauh->GetBinContent(1)
(Double_t) 0.115956
root [17] cut_ev_taumuj->GetBinContent(1)
(Double_t) 0.195480
root [18] 
root [18] cut_ev_other->GetBinContent(1)
(Double_t) 0.0304838

tauel-tauh probably depend more on statistics

no significant difference between processes here


source histosel_stage2_run3_VlooseShapes_el_sel_ljs_updowns2 &
source histosel_stage2_run3_VlooseShapes_mu_sel_ljs_updowns2 &


hadd histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns.root histosel-roots/v25pStage2Run3_el_ljs/distr*root histosel-roots/v25pStage2Run3_mu_ljs/distr*root histosel-roots/v25pStage2Run3_el_ljs_updowns/distr*root histosel-roots/v25pStage2Run3_mu_ljs_updowns/distr*root

and add updowns to datacard
and test fit NLL and impacts

NLL ok
impact from HRAMP is strangely large in both
it is large in el but not in mu
also in el jes is pulled and is 1st by impact, a little large than tau ID thanks to assymetry
top is not as much pulled and not so much impacts as without updowns

overall uncertainty:
el   11   % 
mu    9.2 %
both  8.6 %

python new_impact_table.py --merge-pdfs latest_el_impacts.json 
python new_impact_table.py --merge-pdfs latest_mu_impacts.json 
python new_impact_table.py --merge-pdfs latest_both_impacts.json 

mc stats jumps much higher than before! 5% el 3% mu and 2.5% both!


test hdamp:

fit without hdamp

el   r :    +1.037   -0.103/+0.110 (68%)

mu   r :    +1.020   -0.095/+0.089 (68%)

python new_impact_table.py --merge-pdfs latest_el_impacts_noHDAMP.json 
python new_impact_table.py --merge-pdfs latest_mu_impacts_noHDAMP.json 

MC stat el 3.1% mu 4% ???

[olek@fermi01 CombinedLimit]$ python new_impact_table.py --merge-pdfs latest_el_impacts_noHDAMP.json                                                                                                                                                            
        Tau ID efficiency  &  5.3 \\
         Jet Energy Scale  &  4.4 \\
        top quark $p_{T}$  &  4.2 \\
        QCD normalization  &  2.9 \\
      Pile-Up uncertainty  &  2.7 \\
     b-tagging efficiency  &  2.0 \\
    Jet Energy Resolution  &  1.7 \\
   Tau mis-ID probability  &  0.8 \\
 Single Top normalization  &  0.4 \\
         DY normalization  &  0.3 \\
   Dibosons normalization  &  0.0 \\
         Tau Energy Scale  &  0.0 \\
               Luminosity  &  0.0 \\
     W+jets normalization  &  0.0 \\
                    LEPel  &  4.7 \\
          b fragmentation  &  3.3 \\
Underlying event (Pythia tune)  &  1.1 \\
  Initial State Radiation  &  0.9 \\
b decay tables, Semileptonic BR  &  0.7 \\
    Final State Radiation  &  0.4 \\
   ME-PS matching (hdamp)  &  0.0 \\
                      PDF  &  0.0 \\
            MC statistics  &  3.1 \\
[olek@fermi01 CombinedLimit]$ python new_impact_table.py --merge-pdfs latest_mu_impacts_noHDAMP.json
        Tau ID efficiency  &  5.4 \\
     b-tagging efficiency  &  4.5 \\
         Jet Energy Scale  &  4.3 \\
        top quark $p_{T}$  &  3.3 \\
      Pile-Up uncertainty  &  2.3 \\
   Tau mis-ID probability  &  2.1 \\
    Jet Energy Resolution  &  0.9 \\
 Single Top normalization  &  0.8 \\
     W+jets normalization  &  0.6 \\
         DY normalization  &  0.0 \\
   Dibosons normalization  &  0.0 \\
        QCD normalization  &  0.0 \\
               Luminosity  &  0.0 \\
         Tau Energy Scale  &  0.0 \\
          b fragmentation  &  2.2 \\
    Final State Radiation  &  1.6 \\
  Initial State Radiation  &  1.5 \\
                    LEPmu  &  0.5 \\
b decay tables, Semileptonic BR  &  0.5 \\
Underlying event (Pythia tune)  &  0.4 \\
   ME-PS matching (hdamp)  &  0.0 \\
                      PDF  &  0.0 \\
            MC statistics  &  4.0 \\



freeze all updowns

el    r :    +1.022   -0.123/+0.107 (68%)
mu    r :    +1.016   -0.086/+0.087 (68%)

python new_impact_table.py --merge-pdfs latest_el_impacts_noUpDowns.json 
python new_impact_table.py --merge-pdfs latest_mu_impacts_noUpDowns.json 

[olek@fermi01 CombinedLimit]$ python new_impact_table.py --merge-pdfs latest_el_impacts_noUpDowns.json                                                                                                                                                                                                
        Tau ID efficiency  &  5.2 \\
         Jet Energy Scale  &  4.3 \\
      Pile-Up uncertainty  &  3.3 \\
        top quark $p_{T}$  &  3.3 \\
     b-tagging efficiency  &  2.3 \\
    Jet Energy Resolution  &  2.1 \\
   Tau mis-ID probability  &  2.0 \\
        QCD normalization  &  1.6 \\
 Single Top normalization  &  0.6 \\
         DY normalization  &  0.2 \\
     W+jets normalization  &  0.1 \\
   Dibosons normalization  &  0.0 \\
               Luminosity  &  0.0 \\
         Tau Energy Scale  &  0.0 \\
                    LEPel  &  5.1 \\
          b fragmentation  &  2.8 \\
b decay tables, Semileptonic BR  &  0.7 \\
  Initial State Radiation  &  0.0 \\
    Final State Radiation  &  0.0 \\
   ME-PS matching (hdamp)  &  0.0 \\
Underlying event (Pythia tune)  &  0.0 \\
                      PDF  &  0.0 \\
            MC statistics  &  3.7 \\
[olek@fermi01 CombinedLimit]$ python new_impact_table.py --merge-pdfs latest_mu_impacts_noUpDowns.json
        Tau ID efficiency  &  5.8 \\
        top quark $p_{T}$  &  3.4 \\
     b-tagging efficiency  &  3.3 \\
   Tau mis-ID probability  &  3.2 \\
         Jet Energy Scale  &  2.6 \\
      Pile-Up uncertainty  &  2.2 \\
    Jet Energy Resolution  &  1.0 \\
 Single Top normalization  &  0.9 \\
     W+jets normalization  &  0.7 \\
         DY normalization  &  0.2 \\
   Dibosons normalization  &  0.0 \\
        QCD normalization  &  0.0 \\
               Luminosity  &  0.0 \\
         Tau Energy Scale  &  0.0 \\
          b fragmentation  &  2.1 \\
                    LEPmu  &  0.7 \\
b decay tables, Semileptonic BR  &  0.2 \\
  Initial State Radiation  &  0.0 \\
   ME-PS matching (hdamp)  &  0.0 \\
Underlying event (Pythia tune)  &  0.0 \\
    Final State Radiation  &  0.0 \\
                      PDF  &  0.0 \\
            MC statistics  &  3.0 \\

-- also JES  too large?




and distrs:

python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_ljout --qcd 1.05 -x mu_selVloose_ljout -s HDAMPUp
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_ljout --qcd 1.05 -x mu_selVloose_ljout -s HDAMPDown

python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_lj    --qcd 1.05 -x mu_selVloose_lj
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_lj    --qcd 1.05 -x mu_selVloose_lj    -s HDAMPUp
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_lj    --qcd 1.05 -x mu_selVloose_lj    -s HDAMPDown

python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -o plots/ -p -r --lumi 31300 -d Mt_lep_met_f -c el_sel_ljout --qcd 1.05 -x el_selVloose_ljout
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -o plots/ -p -r --lumi 31300 -d Mt_lep_met_f -c el_sel_ljout --qcd 1.05 -x el_selVloose_ljout -s HDAMPUp
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -o plots/ -p -r --lumi 31300 -d Mt_lep_met_f -c el_sel_ljout --qcd 1.05 -x el_selVloose_ljout -s HDAMPDown

python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -o plots/ -p -r --lumi 31300 -d Mt_lep_met_f -c el_sel_lj    --qcd 1.05 -x el_selVloose_lj   
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -o plots/ -p -r --lumi 31300 -d Mt_lep_met_f -c el_sel_lj    --qcd 1.05 -x el_selVloose_lj    -s HDAMPUp
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -o plots/ -p -r --lumi 31300 -d Mt_lep_met_f -c el_sel_lj    --qcd 1.05 -x el_selVloose_lj    -s HDAMPDown

 -- as usual nothing is clear from the distrs




and the renorm-refact and pdf weights:

time make distrs_mc_tt_weights     p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &

time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &

time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &


time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &

time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &



time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &

time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &






# baseline check

warning: tau sorting is broken!

make merge_proc dtags=merge-sets/jobs_hadd.dtags.small nt=v25 proc=pStage2Run3
make merge_proc dtags=merge-sets/jobs_hadd.dtags.large_aa nt=v25 proc=pStage2Run3
make merge_proc dtags=merge-sets/jobs_hadd.dtags.large_ab nt=v25 proc=pStage2Run3

hadd merge-sets/v25/pStage2Run3/MC2016_Summer16_TTJets_powheg.root lstore_outdirs/v25/pStage2Run3/MC2016_Summer16_TTJets_powheg/*root


time make distrs_data_nominal      p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var > 60."  chan="mu_sel_ljout"    &
time make distrs_data_nominal      p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss" &
time make distrs_data_nominal      p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj"       &
time make distrs_data_nominal      p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss"    &

time make distrs_mc_nominal        p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var > 60."  chan="mu_sel_ljout"    &
time make distrs_mc_nominal        p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss" &
time make distrs_mc_nominal        p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj"       &
time make distrs_mc_nominal        p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss"    &

time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60."  chan="el_sel_ljout" dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" dtag=SingleEle &

time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60."  chan="el_sel_ljout" &
time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" &
time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &





time make distrs_mc_common_weights p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_objects        p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &

time make distrs_mc_common_weights p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_objects        p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &

time make distrs_mc_common_weights p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_objects        p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &

time make distrs_mc_common_weights p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_objects        p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &



time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &

time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &

time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &

time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &


VLoose shapes:

time make distrs_data_nominal      p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout"    &
time make distrs_data_nominal      p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout_ss" &
time make distrs_data_nominal      p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj"       &
time make distrs_data_nominal      p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss"    &

time make distrs_mc_nominal        p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout"    &
time make distrs_mc_nominal        p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout_ss" &
time make distrs_mc_nominal        p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj"       &
time make distrs_mc_nominal        p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss"    &

time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var > 60."  chan="el_selVloose_ljout" dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var > 60."  chan="el_selVloose_ljout_ss" dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" dtag=SingleEle &

time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var > 60."  chan="el_selVloose_ljout" &
time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var > 60."  chan="el_selVloose_ljout_ss" &
time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &


time make distrs_mc_common_weights p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &
time make distrs_mc_objects        p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &

time make distrs_mc_common_weights p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_objects        p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &

time make distrs_mc_common_weights p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_objects        p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &

time make distrs_mc_common_weights p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_objects        p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &



time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &

time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &

time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &

time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &



remake LEP systematics under different names

time make distrs_mc_lep_weights p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout"    sysname=LEPmu  &
time make distrs_mc_lep_weights p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout_ss" sysname=LEPmu  &
time make distrs_mc_lep_weights p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj"       sysname=LEPmu  &
time make distrs_mc_lep_weights p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss"    sysname=LEPmu  &


time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var > 60."  chan="el_selVloose_ljout"   sysname=LEPel  &
time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var > 60."  chan="el_selVloose_ljout_ss"sysname=LEPel  &
time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var <= 60." chan="el_selVloose_lj"      sysname=LEPel  &
time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss"   sysname=LEPel  &


time make distrs_mc_lep_weights p=pStage2Run3  cond="selection_stage == 107 && event_jets_lj_var > 60."  chan="mu_sel_ljout"    sysname=LEPmu  &
time make distrs_mc_lep_weights p=pStage2Run3  cond="selection_stage == 106 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss" sysname=LEPmu  &
time make distrs_mc_lep_weights p=pStage2Run3  cond="selection_stage == 107 && event_jets_lj_var <= 60." chan="mu_sel_lj"       sysname=LEPmu  &
time make distrs_mc_lep_weights p=pStage2Run3  cond="selection_stage == 106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss"    sysname=LEPmu  &


time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="selection_stage == 117 && event_jets_lj_var > 60."  chan="el_sel_ljout"   sysname=LEPel  &
time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="selection_stage == 116 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss"sysname=LEPel  &
time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="selection_stage == 117 && event_jets_lj_var <= 60." chan="el_sel_lj"      sysname=LEPel  &
time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="selection_stage == 116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss"   sysname=LEPel  &




the updowns:

time make distrs_mc_updowns p=r4  cond="selection_stage==105 && event_jets_lj_var > 60."  chan="mu_sel_ljout"    &
time make distrs_mc_updowns p=r4  cond="selection_stage==104 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss" &
time make distrs_mc_updowns p=r4  cond="selection_stage==105 && event_jets_lj_var <= 60." chan="mu_sel_lj"       &
time make distrs_mc_updowns p=r4  cond="selection_stage==104 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss"    &

time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==115 && event_jets_lj_var > 60."  chan="el_sel_ljout" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==114 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==115 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==114 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &

time make distrs_mc_updowns p=r4  cond="(selection_stage == 105 || selection_stage == 103) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout"    &
time make distrs_mc_updowns p=r4  cond="(selection_stage == 104 || selection_stage == 102) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout_ss" &
time make distrs_mc_updowns p=r4  cond="(selection_stage == 105 || selection_stage == 103) && event_jets_lj_var <= 60." chan="mu_selVloose_lj"       &
time make distrs_mc_updowns p=r4  cond="(selection_stage == 104 || selection_stage == 102) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss"    &

time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 113) && event_jets_lj_var > 60."  chan="el_selVloose_ljout" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 112) && event_jets_lj_var > 60."  chan="el_selVloose_ljout_ss" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 113) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 112) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &




foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v25pStage2Run3/*$d*root &
end

python stack_plot.py distrs_v25pStage2Run3.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_lj --qcd 1.05

python stack_plot.py distrs_v25pStage2Run3_2.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_lj --qcd 1.05 -x mu_selVloose_lj


source histosel_stage2_run3_VlooseShapes_el_sel_ljs &
source histosel_stage2_run3_VlooseShapes_mu_sel_ljs &


hadd histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs.root histosel-roots/v25pStage2Run3_el_ljs/distr*root histosel-roots/v25pStage2Run3_mu_ljs/distr*root


python numbers_for_datacard.py histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout --skip-procs wjets_tauh
python numbers_for_datacard.py histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs.root -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout --skip-procs wjets_tauh








# check if there are enough events in alliso QCD

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4." nt=v27 p=pStage2Run2ElMu  cond="selection_stage_tt_alliso==503" chan="alliso_mu_sel" dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5" nt=v27 p=pStage2Run2ElMu  cond="selection_stage_tt_alliso==513" chan="alliso_el_sel" dtag="QCD" &

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4."   nt=v27 p=pStage2Run2ElMu  cond="selection_stage_tt_alliso==502" chan="alliso_mu_sel_ss" dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5" nt=v27 p=pStage2Run2ElMu  cond="selection_stage_tt_alliso==512" chan="alliso_el_sel_ss" dtag="QCD" &


foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v27pStage2Run2ElMu/*$d*root &
end


and the fixed version 2:

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4." nt=v27 p=pStage2Run2ElMu2  cond="selection_stage_tt_alliso==503" chan="alliso_mu_sel" dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5" nt=v27 p=pStage2Run2ElMu2  cond="selection_stage_tt_alliso==513" chan="alliso_el_sel" dtag="QCD" &

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4."   nt=v27 p=pStage2Run2ElMu2  cond="selection_stage_tt_alliso==502" chan="alliso_mu_sel_ss" dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5" nt=v27 p=pStage2Run2ElMu2  cond="selection_stage_tt_alliso==512" chan="alliso_el_sel_ss" dtag="QCD" &

foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v27pStage2Run2ElMu2/*$d*root &
end





TH1D* h_mu    = (TH1D*) alliso_mu_sel   ->Get("qcd/NOMINAL/alliso_mu_sel_qcd_NOMINAL_relIso")
TH1D* h_mu_ss = (TH1D*) alliso_mu_sel_ss->Get("qcd/NOMINAL/alliso_mu_sel_ss_qcd_NOMINAL_relIso")

TH1D* h_el    = (TH1D*) alliso_el_sel   ->Get("qcd/NOMINAL/alliso_el_sel_qcd_NOMINAL_relIso")
TH1D* h_el_ss = (TH1D*) alliso_el_sel_ss->Get("qcd/NOMINAL/alliso_el_sel_ss_qcd_NOMINAL_relIso")

h_mu->Divide(h_mu_ss)
h_el->Divide(h_el_ss)

h_mu->Draw()
h_el->Draw()





and with no b-tau matching:

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4." nt=v35 p=pStage2Run3   cond="selection_stage_tt_alliso==503" chan="alliso_mu_sel"    dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4." nt=v35 p=pStage2Run3   cond="selection_stage_tt_alliso==502" chan="alliso_mu_sel_ss" dtag="QCD" &

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5" nt=v35 p=pStage2Run3  cond="selection_stage_tt_alliso==513" chan="alliso_el_sel"    dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5" nt=v35 p=pStage2Run3  cond="selection_stage_tt_alliso==512" chan="alliso_el_sel_ss" dtag="QCD" &

foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v35pStage2Run3/*$d*root &
end





# pOld1 VS p2 comparison

git diff v20v21p2..HEAD -M -- support_channel_distrs.py proc/full_selection.py

seems like the only difference is counting b-taged jets without tau-matched jets
the result is ok in el-tau -- in pOld1 both data and MC have less events (weighted)
but in mu-tau pOld1 MC has _more_ events than p2 -- not clear how and in old framework cannot go through them one by one





# Run2 with WP and lj categories

time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_common_weights p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_objects        p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_tt_weights     p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var > 60." chan="mu_sel_ljout" &

time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_common_weights p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_objects        p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights     p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &

time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_common_weights p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_objects        p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights     p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var <= 60." chan="mu_sel_lj" &

time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_common_weights p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_objects        p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights     p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &



time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var > 60." chan="el_sel_ljout" dtag=SingleEle &
time make distrs_mc_common_weights p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_objects        p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights     p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var > 60." chan="el_sel_ljout" &

time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" dtag=SingleEle &
time make distrs_mc_common_weights p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_objects        p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights     p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &

time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var <= 60." chan="el_sel_lj" dtag=SingleEle &
time make distrs_mc_common_weights p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_objects        p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights     p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var <= 60." chan="el_sel_lj" &

time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" dtag=SingleEle &
time make distrs_mc_common_weights p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_objects        p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights     p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &


lost data sel:

time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==5" chan="mu_sel"    &
time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==4" chan="mu_sel_ss" &

time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==15" chan="el_sel"    dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==14" chan="el_sel_ss" dtag=SingleEle &



foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v25pStage2Run2/*$d*root &
end

test:

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleMuon.root     -p -r --lumi 35800 --wjet 0.8 -c mu_sel    -d Mt_lep_met_f -p -r --qcd 1.05
python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel    -d Mt_lep_met_f -p -r --qcd 1.05

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_lj    -d Mt_lep_met_f --qcd 1.05 --bin-norm -p -r
python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_ljout -d Mt_lep_met_f --qcd 1.05 --bin-norm -p -r

muon

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleMuon.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel_lj    -d Mt_lep_met_f --qcd 1.05 --bin-norm
python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleMuon.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel_ljout -d Mt_lep_met_f --qcd 1.05 --bin-norm

electron

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_lj    -d Mt_lep_met_f --qcd 1.05 --bin-norm
python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_ljout -d Mt_lep_met_f --qcd 1.05 --bin-norm




source histosel-mu_stage2_mu_sel_ljs &
source histosel-el_stage2_el_sel_ljs &



hadd distrs_v25pStage2Run2_histosel_ljs.root histosel-roots/v25pStage2Run2_el_ljs/*root histosel-roots/v25pStage2Run2_mu_ljs/*root



python new_impact_table.py --merge-pdfs latest_el_impacts.json 
python new_impact_table.py --merge-pdfs latest_mu_impacts.json 




very high MC stat uncertainty in electron+tau









# running it on Test5 to compare with Old1 distrs

time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==5 && event_jets_lj_var > 60."  chan="mu_sel_ljout"     &
time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==4 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss"  &
time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==5 && event_jets_lj_var <= 60." chan="mu_sel_lj"        &
time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==4 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss"     &

time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var > 60."  chan="el_sel_ljout"    dtag=SingleEle &
time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" dtag=SingleEle &
time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var <= 60." chan="el_sel_lj"       dtag=SingleEle &
time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var <= 60." chan="el_sel_lj_ss"    dtag=SingleEle &

time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==5 && event_jets_lj_var > 60."  chan="mu_sel_ljout"     &
time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==4 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss"  &
time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==5 && event_jets_lj_var <= 60." chan="mu_sel_lj"        &
time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==4 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss"     &

time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var > 60."  chan="el_sel_ljout"    &
time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" &
time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var <= 60." chan="el_sel_lj"       &
time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var <= 60." chan="el_sel_lj_ss"    &


foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v25pStage2Test5_ljs/*$d*root &
end


python stack_plot.py distrs_v25pStage2Test5_ljs.root ../distrs/v25pStage2Test5_ljs_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_lj    -d Mt_lep_met_f --qcd 1.05 --bin-norm
python stack_plot.py distrs_v25pStage2Test5_ljs.root ../distrs/v25pStage2Test5_ljs_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_ljout -d Mt_lep_met_f --qcd 1.05 --bin-norm

python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleElectron.root --lumi 31300 -c ctr_old_el_sel_lj    --qcd 1.05 --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --legend-shift "0.02"
python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleElectron.root --lumi 31300 -c ctr_old_el_sel_ljout --qcd 1.05 --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --legend-shift "0.02"

-- very few differences between the two, practically the same distributions

what's the reason problem? new b WP, custom bins, this smal divergence with Old1?


and muons:

python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleMuon.root --lumi 35800 -c ctr_old_mu_sel_lj    --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --legend-shift "0.02" --qcd 1.05
python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleMuon.root --lumi 35800 -c ctr_old_mu_sel_ljout --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --legend-shift "0.02" --qcd 1.05



old test

python stack_plot.py distrs_v25pStage2Test5.root ../distrs/pStage2Test5/test1_lep_pt_SingleMuon_data_NOMINAL_Mt_lep_met_f.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel    -d Mt_lep_met_f 1.05 --bin-norm


again somewhere lost the data for test5_2 with linear bins

time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==5"  chan="mu_sel"  &

time make distrs_data_nominal bins="--histo-range 20,0,250" options="--el-procs" p=pStage2Test5  cond="selection_stage==15 && event_jets_lj_var > 60."  chan="el_sel_ljout"    dtag=SingleElectron &
time make distrs_data_nominal bins="--histo-range 20,0,250" options="--el-procs" p=pStage2Test5  cond="selection_stage==14 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" dtag=SingleElectron &
time make distrs_data_nominal bins="--histo-range 20,0,250" options="--el-procs" p=pStage2Test5  cond="selection_stage==15 && event_jets_lj_var <= 60."  chan="el_sel_lj"      dtag=SingleElectron &
time make distrs_data_nominal bins="--histo-range 20,0,250" options="--el-procs" p=pStage2Test5  cond="selection_stage==14 && event_jets_lj_var <= 60."  chan="el_sel_lj_ss"   dtag=SingleElectron &

finally:

python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleMuon.root --lumi 35800 -c ctr_old_mu_sel    --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --legend-shift "0.02"
python stack_plot.py distrs_v25pStage2Test5_2.root ../distrs/pStage2Test5_2_linear-bins/SingleMuon.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel    -d Mt_lep_met_f

-- kind of ok


el ljout in old1:

python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleElectron.root --lumi 31300 -c ctr_old_el_sel_ljout    --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(e, MET)" -d Mt_lep_met_f --legend-shift "0.02"

and test5 2

python stack_plot.py distrs_v25pStage2Test5_ljs.root ../distrs/v25pStage2Test5_ljs_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_ljout -d Mt_lep_met_f



# Run2 with updated b WP

1. custom bins?
2. muon and electron?
3. lj and ljout?
4. OS and SS

-- no lj and lj_out for now

muon:

time make distrs_data_nominal      p=pStage2Run2  &
time make distrs_mc_common_weights p=pStage2Run2  &
time make distrs_mc_objects        p=pStage2Run2  &
time make distrs_mc_tt_weights     p=pStage2Run2  &

time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_common_weights p=pStage2Run2  cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_objects        p=pStage2Run2  cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_tt_weights     p=pStage2Run2  cond="selection_stage==4" chan="mu_sel_ss" &

electron:

time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==15" chan="el_sel" dtag=SingleEle &
time make distrs_mc_common_weights p=pStage2Run2 options="--el-procs" cond="selection_stage==15" chan="el_sel" &
time make distrs_mc_objects        p=pStage2Run2 options="--el-procs" cond="selection_stage==15" chan="el_sel" &
time make distrs_mc_tt_weights     p=pStage2Run2 options="--el-procs" cond="selection_stage==15" chan="el_sel" &
time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==14" chan="el_sel_ss" dtag=SingleEle &
time make distrs_mc_common_weights p=pStage2Run2 options="--el-procs" cond="selection_stage==14" chan="el_sel_ss" &
time make distrs_mc_objects        p=pStage2Run2 options="--el-procs" cond="selection_stage==14" chan="el_sel_ss" &
time make distrs_mc_tt_weights     p=pStage2Run2 options="--el-procs" cond="selection_stage==14" chan="el_sel_ss" &



time make distrs_mc_common_weights dtag="TTJet" p=pStage2Run2  &
time make distrs_mc_common_weights dtag="TTJet" p=pStage2Run2  cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_common_weights dtag="TTJet" p=pStage2Run2 options="--el-procs" cond="selection_stage==15" chan="el_sel" &
time make distrs_mc_common_weights dtag="TTJet" p=pStage2Run2 options="--el-procs" cond="selection_stage==14" chan="el_sel_ss" &


foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v25pStage2Run2/*$d*root &
end

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2/test1_lep_pt_SingleMuon_mu_sel_data_NOMINAL_Mt_lep_met_f.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel -d Mt_lep_met_f

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleMuon.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel -d Mt_lep_met_f --qcd 1.05 --bin-norm

electron

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel -d Mt_lep_met_f --qcd 1.05 --bin-norm




all distrs for test fit

source histosel-mu_stage2_mu_sel &
source histosel-el_stage2_el_sel &


./scripts/text2workspace.py ttxsec/fit-stuff/latest_datacard_mu.txt

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root --algo grid --points 100 --rMin 0.5 --rMax 1.5 --name MuShapes --freezeParameters lumi_13TeV

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit         --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5  --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 -o latest_mu_impacts.json            --name MuImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts.json -o postfit_mu_impacts

table of systematics:

python new_impact_table.py --merge-pdfs latest_mu_impacts.json 








# All sys for MC and data in script files

time source all-distrs-from-stage2_data-nominals &
time source all-distrs-from-stage2_w-common-weight-variations &
time source all-distrs-from-stage2_w-common-weight-variations_tt-specific &
time source all-distrs-from-stage2_w-object-variations &


foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/Run1/*$d*root
end


time make distrs_mc_common_weights &
time make distrs_mc_objects        &
time make distrs_mc_tt_weights     &

time make distrs_mc_common_weights dtag=QCD  &
time make distrs_mc_common_weights dtag=WZ   &
time make distrs_mc_common_weights dtag=WW   &
time make distrs_mc_common_weights dtag=ZZ   &

time make distrs_mc_objects dtag=QCD  &
time make distrs_mc_objects dtag=WZ   &
time make distrs_mc_objects dtag=WW   &
time make distrs_mc_objects dtag=ZZ   &


compare Old1 to v25 pOld1
pStage2Test5

time make distrs_data_nominal      p=pStage2Test5 &
time make distrs_mc_common_weights p=pStage2Test5 &
time make distrs_mc_objects        p=pStage2Test5 &
time make distrs_mc_tt_weights     p=pStage2Test5 &

time make distrs_data_nominal      p=pStage2Test5 bins="--histo-range 20,0,250" &
time make distrs_mc_common_weights p=pStage2Test5 bins="--histo-range 20,0,250" &
time make distrs_mc_objects        p=pStage2Test5 bins="--histo-range 20,0,250" &
time make distrs_mc_tt_weights     p=pStage2Test5 bins="--histo-range 20,0,250" &

foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/pStage2Test5/*$d*root &
end

python stack_plot.py distrs_v25pStage2Test5_2.root ../distrs/pStage2Test5/test1_lep_pt_SingleMuon_data_NOMINAL_Mt_lep_met_f.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel -d Mt_lep_met_f

VS

python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleMuon.root --lumi 35800 -c ctr_old_mu_sel --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --legend-shift "0.02"

the stage2test5-2 files contain the same amount of events as Old1
but there are less after distrs
test nominal tt distrs

python selections.py --out-dir distrs/ "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --distr Mt_lep_met_f --chan mu_sel --histo-range 20,0,250             --weight event_weight      merge-sets/v25/pStage2Test5/MC2016_Summer16_TTJets_powheg.root

python sumup_ttree_distrs.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --histo-range 20,0,250 --cond-com "event_weight * (selection_stage == 5 && (gen_proc_id == 31 || gen_proc_id == 32))" --output distrs//test1_lep_pt_MC2016_Summer16_TTJets_powheg_tt_mutau_NOMINAL_Mt_lep_met_f.root  --histo-name mu_sel/tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f  --save-weight --per-weight merge-sets/v25/pStage2Test5/MC2016_Summer16_TTJets_powheg.root







SS selection

time make distrs_data_nominal      p=pStage2Test5 bins="--histo-range 20,0,250" cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_common_weights p=pStage2Test5 bins="--histo-range 20,0,250" cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_objects        p=pStage2Test5 bins="--histo-range 20,0,250" cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_tt_weights     p=pStage2Test5 bins="--histo-range 20,0,250" cond="selection_stage==4" chan="mu_sel_ss" &







issue with large error in dibosons

python selections.py --debug --out-dir distrs/ "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --distr Mt_lep_met_f --chan mu_sel --histo-range 20,0,250             --weight event_weight      merge-sets/v25/pStage2Test5/MC2016_Summer16_WWTo2L2Nu_powheg.root

-- fine
time make distrs_mc_common_weights p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WWTo2L2Nu*" &
time make distrs_mc_objects        p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WWTo2L2Nu*" &

time make distrs_mc_objects p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WWTo2L2Nu*" &

and hadd are fine

time make distrs_mc_common_weights p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WW*" &
time make distrs_mc_objects        p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WW*" &
time make distrs_mc_common_weights p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WZ*" &
time make distrs_mc_objects        p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WZ*" &
time make distrs_mc_common_weights p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*ZZ*" &
time make distrs_mc_objects        p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*ZZ*" &


foreach d ( `cat all-dtags_dibosons` )
hadd distrs/$d.root distrs/pStage2Test5/*$d*root &
end


TH1D* h = (TH1D*) mu_sel->Get("dibosons/NOMINAL/mu_sel_dibosons_NOMINAL_Mt_lep_met_f")
h->GetBinError(2)
h->GetBinContent(2)

root -l distrs/pStage2Test5/test1_lep_pt_MC2016_Summer16_WWToLNuQQ_powheg_dibosons_NOMINAL_Mt_lep_met_f.root 

-- ok

root -l distrs/pStage2Test5_2_linear-bins/MC2016_Summer16_WWTo2L2Nu_powheg.root
root -l distrs/pStage2Test5_2_linear-bins/MC2016_Summer16_WWToLNuQQ_powheg.root

-- not ok

hadd dibosons1.root pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_[TJ]E[RS]* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_LEP* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_bSF* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_PU*

-- no NOMINAL here

TH1D* h = (TH1D*) mu_sel->Get("dibosons/PUUp/mu_sel_dibosons_PUUp_Mt_lep_met_f")
h->GetBinError(2)
h->GetBinContent(2)

-- ok

hadd dibosons1.root pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_[TJ]E[RS]* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_LEP* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_bSF* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_PU* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_NOMINAL_Mt_lep_met_f.root

-- ok


-- there were MC*[WW|WZ|ZZ] in the pStage5 dir














Mt of full run with stage

time python sumup_ttree_distrs.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --custom-range 1,20,40,60,80,100,130,160,200,250 --cond-com "selection_stage == 5" --ttree ttree_out --histo-name  tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt   --output tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt.root merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

-- 14 seconds

time python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --histo-range 50,0,200 merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

-- 1m13s

custom bins for selections
all selections in loop?

time python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

-- 1m20s

all MC:

time python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 merge-sets/v25/pStage2Run1/MC*.root

and data:

-- data failed, fixed, reran 1 job in 1m33s

also some QCD and WZ failed

MC2016_Summer16_WWToLNuQQ_powheg
MC2016_Summer16_WZTo3LNu_powheg

MC2016_Summer16_QCD_HT-1000-1500.root
MC2016_Summer16_QCD_HT-2000-Inf.root
MC2016_Summer16_QCD_HT-700-1000.root

source remaining_jobs_aa &
source remaining_jobs_ab &
source remaining_jobs_ac &
source remaining_jobs_ad &
source remaining_jobs_ae &
source remaining_jobs_af &
source remaining_jobs_ag &
source remaining_jobs_ah &
source remaining_jobs_ai &
source remaining_jobs_aj &
source remaining_jobs_ak &
source remaining_jobs_al &
source remaining_jobs_am &


# runs for tt systematics

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys TOPPTDown merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys TOPPTUp   --weight event_weight_toppt merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys LEPUp --weight event_weight_LEPUp merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys LEPDown --weight event_weight_LEPDown merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys PUUp --weight event_weight_PUUp merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys PUDown --weight event_weight_PUDown merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root


python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys FragUp --weight event_weight_FragUp merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys FragDown --weight event_weight_FragDown merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root


python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys SemilepBRUp --weight event_weight_SemilepBRUp merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys SemilepBRDown --weight event_weight_SemilepBRDown merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root


python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys PetersonUp --weight event_weight_PetersonUp merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys PetersonDown merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

-- in separate file, timed full run 19m14s, ok for now












the rebinning to 1 bin for cut-n-count MC statistics test

python rebin_to_one.py Mt_lep_met_f fit-stuff/histosels_mc_v25p2_v26p2_updowns2_el_w-qcd-prop_bin1.root
















redo electron osss

python stack_plot.py v23p1_mc.root ../merge-sets/v23/p1_data/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --osss -c ctr_old_el_presel_alliso -p -d lep_relIso_el

python stack_plot.py mc_v27p1.root ../merge-sets/v27/p1/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 30000 --osss -c ctr_old_el_presel_alliso -p -d lep_relIso_el --wjets 0.8 --factor-dy 1.05 


final with all wjet/dy factors:

python stack_plot.py v23p1_mc.root ../merge-sets/v23/p1_data/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 30000 --osss -c ctr_old_el_presel_alliso -p -d lep_relIso_el --lumi 30000 --wjets 0.8 --factor-dy 1.05 --lumi-label 31300 --title "" --title-x "relative Isolation of electron" --y-range 0,1.2



muons

python stack_plot.py v23p1_mc.root ../merge-sets/v23/p1_data/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 32800 --osss -c ctr_old_mu_presel_alliso -p -d lep_relIso --wjets 0.8 --factor-dy 1.05 --lumi-label 35800 --title "" --title-x "relative Isolation of muon" --y-range 0,1.2


and in v27

python stack_plot.py mc_v27p1.root ../merge-sets/v27/p1/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --osss -c ctr_old_el_presel_alliso -p -d lep_relIso_el --wjets 0.8 --factor-dy 1.05 --y-range 0,1.4

-- last bin is a bit off

python stack_plot.py mc_v27p1.root ../merge-sets/v27/p1/SingleMuon.root          -o plots/paper-draft-1_an-version-3/ --lumi 34800 --osss -c ctr_old_mu_presel_alliso -p -d lep_relIso --wjets 0.8 --factor-dy 1.05 --lumi-label 35800 --title "" --title-x "relative Isolation of muon" --y-range 0,1.2

-- flat










python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 -c ctr_old_el_sel --qcd 1.05 --wjet 0.85 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "tau p_{T}"       -d tau_pt       --draw-overflows 2 --legend-shift "0.01"
python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 -c ctr_old_el_sel --qcd 1.05 --wjet 0.85 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(e, MET)"   -d Mt_lep_met_f --draw-overflows 5 --legend-shift "0.02"
python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel --qcd 1.05 --wjet 0.8  -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "tau p_{T}"       -d tau_pt       --draw-overflows 2 --legend-shift "0.01"
python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel --qcd 1.05 --wjet 0.8  -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --draw-overflows 5 --legend-shift "0.02"










tau

python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --wjet 0.85 --factor-dy 1.05 -p -r -c ctr_old_el_sel --qcd 1.05 --title "" --title-x "tau p_{T}" -d tau_pt
python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --wjet 0.85 --factor-dy 1.05 -p -r -c ctr_old_el_sel --qcd 1.05 --title "" --title-x "tau #eta"  -d tau_eta

python stack_plot.py mc_v25v26pR5.root ../merge-sets/v25/pR5/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel   --qcd 1.05 --wjet 0.8  -x ctr_old_mu_selVloose    -s NOMINAL --title "" -p -r --title-x "tau p_{T}"  -d tau_pt
python stack_plot.py mc_v25v26pR5.root ../merge-sets/v25/pR5/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel   --qcd 1.05 --wjet 0.8  -x ctr_old_mu_selVloose    -s NOMINAL --title "" -p -r --title-x "tau #eta"   -d tau_eta

leptons

python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --wjet 0.85 --factor-dy 1.05 -p -r -c ctr_old_el_sel --qcd 1.05 --title "" --title-x "electron p_{T}" -d lep_pt
python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --wjet 0.85 --factor-dy 1.05 -p -r -c ctr_old_el_sel --qcd 1.05 --title "" --title-x "electron #eta"  -d lep_eta

python stack_plot.py mc_v25v26pR5.root ../merge-sets/v25/pR5/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel   --qcd 1.05 --wjet 0.8  -x ctr_old_mu_selVloose    -s NOMINAL --title "" -p -r --title-x "muon p_{T}"  -d lep_pt
python stack_plot.py mc_v25v26pR5.root ../merge-sets/v25/pR5/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel   --qcd 1.05 --wjet 0.8  -x ctr_old_mu_selVloose    -s NOMINAL --title "" -p -r --title-x "muon #eta"   -d lep_eta

Mt

python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --wjet 0.85 --factor-dy 1.05 -p -r -c ctr_old_el_sel -x ctr_old_el_selVloose --qcd 1.05 --title "" --title-x "transverse mass M_{T}"  -d Mt_lep_met_f

python stack_plot.py mc_v25v26pR5.root ../merge-sets/v25/pR5/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel   --qcd 1.05 --wjet 0.8  -x ctr_old_mu_selVloose    -s NOMINAL --title "" -p -r --title-x "transverse mass M_{T}"  -d Mt_lep_met_f

cp /home/alex/Documents/lip_phd/scrap/AN-v3_paper-draft-1/mc_v25v26pR5_..,merge-sets,v25,pR5,SingleMuon_lep_pt_ctr_old_mu_sel_NOMINAL_stack_ratio_x_ctr_old_mu_selVloose_dataqcd.png  mu_sel_lep_pt.png
cp /home/alex/Documents/lip_phd/scrap/AN-v3_paper-draft-1/mc_v25v26pR5_..,merge-sets,v25,pR5,SingleMuon_lep_eta_ctr_old_mu_sel_NOMINAL_stack_ratio_x_ctr_old_mu_selVloose_dataqcd.png mu_sel_lep_eta.png
cp /home/alex/Documents/lip_phd/scrap/AN-v3_paper-draft-1/mc_v25p2_v26p2_updowns2_..,merge-sets,v25,p2,SingleElectron_lep_pt_ctr_old_el_sel_NOMINAL_stack_ratio_dataqcd.png  el_sel_lep_pt.png
cp /home/alex/Documents/lip_phd/scrap/AN-v3_paper-draft-1/mc_v25p2_v26p2_updowns2_..,merge-sets,v25,p2,SingleElectron_lep_eta_ctr_old_el_sel_NOMINAL_stack_ratio_dataqcd.png el_sel_lep_eta.png

cp /home/alex/Documents/lip_phd/scrap/AN-v3_paper-draft-1/mc_v25p2_v26p2_updowns2_..,merge-sets,v25,p2,SingleElectron_Mt_lep_met_f_ctr_old_el_sel_NOMINAL_stack_ratio_x_ctr_old_el_selVloose_dataqcd.png el_sel_Mt.png
cp /home/alex/Documents/lip_phd/scrap/AN-v3_paper-draft-1/mc_v25v26pR5_..,merge-sets,v25,pR5,SingleMuon_Mt_lep_met_f_ctr_old_mu_sel_NOMINAL_stack_ratio_x_ctr_old_mu_selVloose_dataqcd.png mu_sel_Mt.png








# Mt VS eta and Mt with tau

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --custom-range 1,20,40,60,80,100,130,160,200,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) > 15*15) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) > 15*15)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0" --histo-name  tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt   --output tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root


python sumup_ttree_distrs.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py()))):event_leptons[0].eta()" --cond-com "selection_stage == 5 && gen_proc_id > 30" --histo-range 10,-2.5,2.5,20,0,250 --ttree ttree_out --output test_shapes_mutau.root --histo-name mt_lepeta_tt_mutau merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py()))):event_leptons[0].eta()" --cond-com "selection_stage == 5 && gen_proc_id < 30" --histo-range 10,-2.5,2.5,20,0,250 --ttree ttree_out --output test_shapes_notmutau.root --histo-name mt_lepeta_tt_notmutau merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &


with tau

python sumup_ttree_distrs.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py()))):sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_taus[0].Px()*event_taus[0].Px() + event_taus[0].Py()*event_taus[0].Py())) - (event_met.Px()*event_taus[0].Px() + event_met.Py()*event_taus[0].Py())))" --cond-com "selection_stage == 5 && gen_proc_id > 30" --histo-range 20,0,250,20,0,250    --ttree ttree_out --output test_shapes_mutau_mttau.root    --histo-name mt_lepeta_tt_mutau_mttau    merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py()))):sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_taus[0].Px()*event_taus[0].Px() + event_taus[0].Py()*event_taus[0].Py())) - (event_met.Px()*event_taus[0].Px() + event_met.Py()*event_taus[0].Py())))" --cond-com "selection_stage == 5 && gen_proc_id < 30" --histo-range 20,0,250,20,0,250 --ttree ttree_out --output test_shapes_notmutau_mttau.root --histo-name mt_lepeta_tt_notmutau_mttau merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &


-- no clear distinction
maybe some correlation in mt-lep - mt-tau







# test of custom bins

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --custom-range 1,20,40,60,80,100,130,160,200,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) > 15*15) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) > 15*15)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0" --histo-name  tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt   --output tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root





# test of nominal with full event weight

lep pt and Mt

python selections.py --debug "event_leptons[0].pt()" --cond-com "selection_stage == 5" --histo-range 50,0,200 merge-sets/v25/pStage2Test2/MC2016_Summer16_*root
python selections.py --debug "event_leptons[0].pt()" --cond-com "selection_stage == 5" --histo-range 50,0,200 merge-sets/v25/pStage2Test3/MC2016_Summer16_*root

python selections.py --debug "event_leptons[0].pt()" --weight "event_weight" --cond-com "selection_stage == 5" --histo-range 50,0,200 merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root

dalitzes in mutau, ljb and ljw

python sumup_ttree_distrs.py "event_taus_sv_dalitz_m1:event_taus_sv_dalitz_m2" --ttree ttree_out --histo-range 20,0,2,20,0,2 --cond-com "selection_stage == 5 && gen_proc_id == 24" --output test2_dalitzes_tt_ljb.root  --histo-name dalitzes_tt_ljb  --save-weight --per-weight merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &
python sumup_ttree_distrs.py "event_taus_sv_dalitz_m1:event_taus_sv_dalitz_m2" --ttree ttree_out --histo-range 20,0,2,20,0,2 --cond-com "selection_stage == 5 && gen_proc_id == 23" --output test2_dalitzes_tt_ljw.root  --histo-name dalitzes_tt_ljw  --save-weight --per-weight merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &
python sumup_ttree_distrs.py "event_taus_sv_dalitz_m1:event_taus_sv_dalitz_m2" --ttree ttree_out --histo-range 20,0,2,20,0,2 --cond-com "selection_stage == 5 && gen_proc_id == 22" --output test2_dalitzes_tt_ljo.root  --histo-name dalitzes_tt_ljo  --save-weight --per-weight merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &
python sumup_ttree_distrs.py "event_taus_sv_dalitz_m1:event_taus_sv_dalitz_m2" --ttree ttree_out --histo-range 20,0,2,20,0,2 --cond-com "selection_stage == 5 && gen_proc_id == 32" --output test2_dalitzes_tt_mutau3ch.root  --histo-name dalitzes_tt_mutau3ch  --save-weight --per-weight merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &



























# again event yields disagreement in pStage2Test3 (false alarm)

comparison with v25pF4 fails
in mu_sel TT lj

comparison betweeen Test2 (Tight tau ID) and v25pCheckTight3 worked

compare Test3 to both

lstore_outdirs/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_61.root

lstore_outdirs/v25/pCheckTight3/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_61.root
lstore_outdirs/v26/pF4/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_61.root

ctr_old_mu_sel->Get("tt_lj/NOMINAL/ctr_old_mu_sel_tt_lj_NOMINAL_yield")->Print()

v26pF4
TH1.Print Name  = ctr_old_mu_sel_tt_lj_NOMINAL_yield, Entries= 189, Total sum= 172.785

v25pCheckTight3
TH1.Print Name  = ctr_old_mu_sel_tt_lj_NOMINAL_yield, Entries= 120, Total sum= 109.168


Test3:
ttree_out->Draw("selection_stage", "selection_stage==5")
668

(none)
ttree_out->Draw("selection_stage", "selection_stage==5 && (gen_proc_id == 21)")
42

(other = both w and b)
ttree_out->Draw("selection_stage", "selection_stage==5 && (gen_proc_id == 22)")
0
(w)
ttree_out->Draw("selection_stage", "selection_stage==5 && (gen_proc_id == 23)")
114
(b)
ttree_out->Draw("selection_stage", "selection_stage==5 && (gen_proc_id == 24)")
33

ttree_out->Draw("selection_stage", "selection_stage==5 && (gen_proc_id == 24 || gen_proc_id == 23 || gen_proc_id == 22 || gen_proc_id == 21)")
189


-- exact with v26pF4!


compare hadd-s
-- forgot Test3 TT hadd!

   [ hadd takes about 30 seconds ]

19784 events
19784 in v26pF4

all ok!

-- run selections on TT
   and lep_pt in lj:

root [2] ctr_old_mu_sel->Get("tt_lj/NOMINAL/ctr_old_mu_sel_tt_lj_NOMINAL_lep_pt")->Print()
TH1.Print Name  = ctr_old_mu_sel_tt_lj_NOMINAL_lep_pt, Entries= 19784, Total sum= 0.000251543

root [3] 0.000251543 * 831 * 35800
(double) 7483.35

all ok!





























shape of lep_pt and second lepton pt

python get_shapes.py --formula "ltaul : elmu " -d lep_pt -p tt_mutau -c ctr_mu_tt_em_close elmu:mc_v31v27_pAllElMu.root:,tt_elmu,NOMINAL ltaul:mc_v31v27_pAllElMu.root:,tt_ltaul,NOMINAL 

-- indeed slight difference even here


sumup and subleading lepton:

python sumup_ttree_distrs.py "lep_p4[0].pt()" --histo-range 50,0.,200. --cond-com "((abs(gen_t_w_decay_id) == 11 && abs(gen_tb_w_decay_id) == 13) || (abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 11)) && leps_ID == -13*11 && HLT_mu && lep_matched_HLT[0] && no_iso_veto_leps && lep_p4[0].pt() > 30 && abs(lep_p4[0].eta()) < 2.4 && lep_p4[1].pt() > 30 && abs(lep_p4[1].eta()) < 2.4 && lep_p4[0].pt() < lep_p4[1].pt()" --histo-name subleadlep_elmu_tt_elmu_lep0_pt --output subleadlep_elmu_tt_elmu_lep0_pt.root gstore_outdirs/v31v27/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v31v27_MC2016_Summer16_TTJets_powheg/180522_225221/0000/*root &

python sumup_ttree_distrs.py "lep_p4[1].pt()" --histo-range 50,0.,200. --cond-com "((abs(gen_t_w_decay_id) == 11 && abs(gen_tb_w_decay_id) == 13) || (abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 11)) && leps_ID == -13*11 && HLT_mu && lep_matched_HLT[0] && no_iso_veto_leps && lep_p4[0].pt() > 30 && abs(lep_p4[0].eta()) < 2.4 && lep_p4[1].pt() > 30 && abs(lep_p4[1].eta()) < 2.4 && lep_p4[0].pt() > lep_p4[1].pt()" --histo-name subleadlep_elmu_tt_elmu_lep1_pt --output subleadlep_elmu_tt_elmu_lep1_pt.root gstore_outdirs/v31v27/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v31v27_MC2016_Summer16_TTJets_powheg/180522_225221/0000/*root &


python sumup_ttree_distrs.py "lep_p4[0].pt()" --histo-range 50,0.,200. --cond-com "((abs(gen_t_w_decay_id) == 11 && abs(gen_tb_w_decay_id) == 13*15) || (abs(gen_t_w_decay_id) == 13*15 && abs(gen_tb_w_decay_id) == 11) || (abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 11*15) || (abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 11*15)) && leps_ID == -13*11 && HLT_mu && lep_matched_HLT[0] && no_iso_veto_leps && lep_p4[0].pt() > 30 && abs(lep_p4[0].eta()) < 2.4 && lep_p4[1].pt() > 30 && abs(lep_p4[1].eta()) < 2.4 && lep_p4[0].pt() < lep_p4[1].pt()" --histo-name subleadlep_elmu_tt_ltaul_lep0_pt --output subleadlep_elmu_tt_ltaul_lep0_pt.root gstore_outdirs/v31v27/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v31v27_MC2016_Summer16_TTJets_powheg/180522_225221/0000/*root &

python sumup_ttree_distrs.py "lep_p4[1].pt()" --histo-range 50,0.,200. --cond-com "((abs(gen_t_w_decay_id) == 11 && abs(gen_tb_w_decay_id) == 13*15) || (abs(gen_t_w_decay_id) == 13*15 && abs(gen_tb_w_decay_id) == 11) || (abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 11*15) || (abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 11*15)) && leps_ID == -13*11 && HLT_mu && lep_matched_HLT[0] && no_iso_veto_leps && lep_p4[0].pt() > 30 && abs(lep_p4[0].eta()) < 2.4 && lep_p4[1].pt() > 30 && abs(lep_p4[1].eta()) < 2.4 && lep_p4[0].pt() > lep_p4[1].pt()" --histo-name subleadlep_elmu_tt_ltaul_lep1_pt --output subleadlep_elmu_tt_ltaul_lep1_pt.root gstore_outdirs/v31v27/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v31v27_MC2016_Summer16_TTJets_powheg/180522_225221/0000/*root &

subleadlep_elmu_tt_elmu_lep0_pt->Scale(1./subleadlep_elmu_tt_elmu_lep0_pt->Integral())
subleadlep_elmu_tt_elmu_lep1_pt->Scale(1./subleadlep_elmu_tt_elmu_lep1_pt->Integral())

subleadlep_elmu_tt_ltaul_lep0_pt->Scale(1./subleadlep_elmu_tt_ltaul_lep0_pt->Integral())
subleadlep_elmu_tt_ltaul_lep1_pt->Scale(1./subleadlep_elmu_tt_ltaul_lep1_pt->Integral())



subleadlep_elmu_tt_ltaul_lep0_pt->SetLineColor(kRed)
subleadlep_elmu_tt_ltaul_lep1_pt->SetLineColor(kRed)


subleadlep_elmu_tt_ltaul_lep0_pt->Draw()
subleadlep_elmu_tt_ltaul_lep1_pt->Draw("same")

subleadlep_elmu_tt_ltaul_lep0_pt->Draw()
subleadlep_elmu_tt_elmu_lep0_pt ->Draw("same")

subleadlep_elmu_tt_ltaul_lep1_pt->Draw()
subleadlep_elmu_tt_elmu_lep1_pt ->Draw("same")


















shape of Mt with lep-jet

in TT

python jobsums/get_shapes.py --formula "reNOM : lepJet " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL lepJet:merge-sets/v25/pCheckTight4SubLep/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL 

-- pract no difference


run in Data
























testing autoMC 0 for MC stat uncertainty

produce post-fit distrs
check the uncertainties in bins

./scripts/text2workspace.py ttxsec/fit-stuff/v25p2_mu_2_recor.txt
./scripts/text2workspace.py ttxsec/fit-stuff/v25p2_mu_2_recor_no_autoMC.txt

combine -M FitDiagnostics ttxsec/fit-stuff/v25p2_mu_2_recor.root --saveShapes --saveWithUncertainties --name MuShapesTestWithAutoMC --freezeParameters lumi_13TeV

Best fit r: 0.959184  -0.0719329/+0.0876966  (68% CL)
Done in 0.24 min (cpu), 0.24 min (real)

combine -M FitDiagnostics ttxsec/fit-stuff/v25p2_mu_2_recor_no_autoMC.root --saveShapes --saveWithUncertainties --name MuShapesTestNoAutoMC --freezeParameters lumi_13TeV

Best fit r: 0.959184  -0.0719329/+0.0876966  (68% CL)


python stack_postfit.py fitDiagnosticsMuShapesTestWithAutoMC.root ctr_old_mu_sel_lj    --mu --ratio 
python stack_postfit.py fitDiagnosticsMuShapesTestWithAutoMC.root ctr_old_mu_sel_ljout --mu --ratio 
python stack_postfit.py fitDiagnosticsMuShapesTestNoAutoMC.root   ctr_old_mu_sel_lj    --mu --ratio 
python stack_postfit.py fitDiagnosticsMuShapesTestNoAutoMC.root   ctr_old_mu_sel_ljout --mu --ratio 

root -l fitDiagnosticsMuShapesTestWithAutoMC.root

((TH1D*) shapes_fit_s->Get("ctr_old_mu_sel_lj/wjets"))->GetBinContent(7)
(Double_t) 54.8818
((TH1D*) shapes_fit_s->Get("ctr_old_mu_sel_lj/wjets"))->GetBinError(7)
(Double_t) 7.46415

root -l fitDiagnosticsMuShapesTestNoAutoMC.root
((TH1D*) shapes_fit_s->Get("ctr_old_mu_sel_lj/wjets"))->GetBinContent(7)
(Double_t) 54.8818
((TH1D*) shapes_fit_s->Get("ctr_old_mu_sel_lj/wjets"))->GetBinError(7)
(Double_t) 7.46415



































continueing met phis

python jobsums/get_shapes.py --formula "reNOM : shifted " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL shifted:merge-sets/v26/pF9/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL,Mt_lep_met_shifted 

python jobsums/get_shapes.py --formula "reNOM : shifted " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL shifted:merge-sets/v26/pF9/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL,Mt_lep_met_shifted 

python jobsums/get_shapes.py --formula "reNOM : shifted " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_mutau,NOMINAL shifted:merge-sets/v26/pF9/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_mutau,NOMINAL,Mt_lep_met_shifted 

python jobsums/get_shapes.py --formula "reNOM : shifted " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_mutau,NOMINAL shifted:merge-sets/v26/pF9/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_mutau,NOMINAL,Mt_lep_met_shifted 


python jobsums/get_shapes.py --formula "reNOM : shifted_reNOM " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_mutau,NOMINAL shifted_reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_mutau,NOMINAL,Mt_lep_met_shifted 

the shifts seem to correct bin 130,but not 120 (and not 140, which is not significant)
although not sure if the shift is large enough etc
(judging by the means of met x/y distrs it should be enough, but visually not sure)

finally the test of phi difference

!!! rev_met_phi !!!
-- did not work?
-- it just flips + to -

python stack_plot.py mc_v25v26pR5_updowns.root ../merge-sets/v25/pR5/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_sel -d regMt_phi
python stack_plot.py mc_v25v26pR5_updowns.root ../merge-sets/v25/pR5/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_sel -d met_phi


merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root

./mc_v25v26pR5_updowns_HISTOSEL_regMt_phi_ctr_old_mu_sel_NOMINAL.root
./mc_v25v26pR5_updowns_HISTOSEL_met_phi_ctr_old_mu_sel_NOMINAL.root

ctr_old_mu_sel->Get("data/NOMINAL/ctr_old_mu_sel_data_NOMINAL_met_phi")
ctr_old_mu_sel->Get("sums_NOMINAL/mc_sum2_NOMINAL")

python flip_met_phi.py ./mc_v25v26pR5_updowns_HISTOSEL_met_phi_ctr_old_mu_sel_NOMINAL.root   output_met_phi.root
python flip_met_phi.py ./mc_v25v26pR5_updowns_HISTOSEL_regMt_phi_ctr_old_mu_sel_NOMINAL.root output_regMt_phi.root -d regMt_phi

flipped_mc->SetLineColor(kRed)
flipped_mc_2->SetLineColor(kRed)
flipped_mc_3->SetLineColor(kRed)
flipped_data->SetLineColor(kRed)


ctr_old_mu_sel_data_NOMINAL_met_phi->Draw()
flipped_mc->Draw("same")

ctr_old_mu_sel_data_NOMINAL_met_phi->Draw()
flipped_mc_2->Draw("same")

ctr_old_mu_sel_data_NOMINAL_met_phi->Draw()
flipped_data->Draw("same")

mc_sum2_NOMINAL->Draw()
flipped_mc_3->Draw("same")


ctr_old_mu_sel_data_NOMINAL_regMt_phi->Draw()
flipped_mc->Draw("same")

ctr_old_mu_sel_data_NOMINAL_regMt_phi->Draw()
flipped_mc_2->Draw("same")

ctr_old_mu_sel_data_NOMINAL_regMt_phi->Draw()
flipped_data->Draw("same")

-- seems like there is slight disagreement at positive phis in the sel (data>mc),
but in regMt it is leveled out, but slight disagreement (mc>data) apears at negative phis
as if data just moved down

there is slight asymetry in phi in data: more on positive side
no assymetry in mc

are there 2 minima in MC and omly 1 in data?

python stack_plot.py mc_v25v26pR4.root ../merge-sets/v25/pR4/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_presel -d met_phi -p -r --exp-leg

-- no, the #2 in MC is confusion due to zoomed scale and fluctuations and shift

the magnitude of the shift, the width seem equal in mc and data


python stack_plot.py mc_v25v26pR4.root ../merge-sets/v25/pR4/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_presel -d met_phi

python stack_plot.py mc_v25v26pR4.root ../merge-sets/v25/pR4/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_presel -d Mt_lep_met_shifted -p -r --exp-leg
-- the shift barely changes Mt in presel

python jobsums/get_shapes.py --formula "reNOM : shiftedMt" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL shiftedMt:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL,Mt_lep_met_shifted 

jet -> lep sub
Mt_lep_met_sublep

python stack_plot.py mc_v25v26pR5_updowns.root ../merge-sets/v25/pR5/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_sel -d Mt_lep_met_sublep -p -r --exp-leg

-- same divergence in 120-130, but couple percent smaller

python get_shapes.py --formula "dataOut : dataVlooseOut" -d Mt_lep_met_f -p data -c ctr_old_mu_sel dataOut:../merge-sets/v25/pR5/SingleMuon.root:ctr_old_mu_sel_ljout,data,NOMINAL dataVlooseOut:../merge-sets/v25/pR5/SingleMuon.root:ctr_old_mu_selVloose_ljout,data,NOMINAL

-- data shape is from sel, but it should be right

-- in Vloose the bins seem to agree well, but data-qcd spoils the agreement a bit...
   and regMt_lep_pt seems much better, close to error bars and only 95 events more in MC
   in sel MC has 190 more events


compare shape to tight:

merge-sets/v25/pCheckTight/MC2016_Summer16_TTJets_powheg.root

python get_shapes.py --formula "mediumTau : tight : Vloose" -d regMt_lep_pt -p tt_mutau -c ctr_old_mu_sel mediumTau:mc_v25v26pR5_updowns.root:ctr_old_mu_sel,tt_mutau,NOMINAL Vloose:mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL tight:mc_norm/v25pCheckTight/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL

-- same distr in all three selections





side check of nominal TES:

python stack_plot.py mc_v25v26pR5_updowns.root ../merge-sets/v25/pR5/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_sel -d tau_cor_control -p -r --exp-leg

merge-sets/v25/pCheckNomTES/MC2016_Summer16_TTJets_powheg.root

python jobsums/get_shapes.py --formula "reNOM : nomTES" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL nomTES:merge-sets/v25/pCheckNomTES/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL 

python jobsums/get_shapes.py --formula "reNOM : nomTES" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL nomTES:merge-sets/v25/pCheckNomTES/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL 

-- no difference
regMt_tau_pt has peak at 30 and fall by hyperbola










 compare to jet-tau substituted tt

python jobsums/get_shapes.py --formula "norm : subst" -d regMt_lep_pt -p tt_mutau -c ctr_old_mu_sel norm:merge-sets/v25/pCheckTight2/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL subst:merge-sets/v25/pCheckTight3/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL

python jobsums/get_shapes.py --formula "norm : subst" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel norm:merge-sets/v25/pCheckTight2/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL subst:merge-sets/v25/pCheckTight3/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL

compare data distr

python jobsums/get_shapes.py --formula "norm : subst" -d regMt_lep_pt -p data -c ctr_old_mu_sel norm:merge-sets/v25/pCheckTight2/SingleMuon.root:ctr_old_mu_sel,data,NOMINAL subst:merge-sets/v25/pCheckTight3/SingleMuon.root:ctr_old_mu_sel,data,NOMINAL

python jobsums/get_shapes.py --formula "norm : subst" -d Mt_lep_met_f -p data -c ctr_old_mu_sel norm:merge-sets/v25/pCheckTight2/SingleMuon.root:ctr_old_mu_sel,data,NOMINAL subst:merge-sets/v25/pCheckTight3/SingleMuon.root:ctr_old_mu_sel,data,NOMINAL





python jobsums/get_shapes.py --formula "data : 0.921 tt_mutau + 0.079 tt_lj" -d regMt_tau_jet_scale -p tt_mutau -c ctr_old_mu_sel data:merge-sets/v25/pCheckTight2/SingleMuon.root:ctr_old_mu_sel,data,NOMINAL tt_mutau:merge-sets/v25/pCheckTight2/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL tt_lj:merge-sets/v25/pCheckTight2/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_lj,NOMINAL








met phi stuff

python distr_ratios.py mc_v25v26pR5_updowns.root -c ctr_old_mu_sel -d met -p tt_mutau --var-distr met_pt_smallphi:met_pt_largephi

 --y-range 0.8,1.1 --add-x-line 40,130

python stack_plot.py mc_v25v26pR5_updowns.root ../merge-sets/v25/pR5/SingleMuon.root --lumi 35800 --qcd 1.05 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_sel -p -r --exp-leg -d lep1_phi

python stack_plot.py mc_v25v26pR5_updowns.root ../merge-sets/v25/pR5/SingleMuon.root --lumi 35800 --qcd 1.05 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_sel -p -r --exp-leg -d met_phi









Fit only ljout

./scripts/text2workspace.py ttxsec/fit-stuff/v25p2_mu_2_recor_ljoutonly.txt

combine -M MultiDimFit ttxsec/fit-stuff/v25p2_mu_2_recor_ljoutonly.txt --algo grid --points 100 --freezeNuisanceGroup tt_th_pdf --rMin 0.5 --rMax 1.5 --name MuShapesOnlyOut

-- 

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/v25p2_mu_2_recor_ljoutonly.root --freezeNuisanceGroup tt_th_pdf  -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/v25p2_mu_2_recor_ljoutonly.root --freezeNuisanceGroup tt_th_pdf  -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/v25p2_mu_2_recor_ljoutonly.root --freezeNuisanceGroup tt_th_pdf  -m 125 -o v25p2_mu_2_recor_ljoutonly.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i v25p2_mu_2_recor_ljoutonly.json -o v25p2_mu_2_recor_ljoutonly








event weight fluctuations

python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_sel_lj -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f --y-range 0.8,1.1 --add-x-line 40,130
python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_sel -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f --y-range 0.8,1.1 --add-x-line 40,130
python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_selVloose -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f --y-range 0.8,1.1 --add-x-line 40,130
python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_selVloose_lj -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f --y-range 0.8,1.1 --add-x-line 40,130

python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_sel_ljout       -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f --y-range 0.8,1.1 --add-x-line 40,130
python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_selVloose_ljout -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f --y-range 0.8,1.1 --add-x-line 40,130


b weight fluctuations -- the fluctuations of b efficiencies are different in updown

python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_sel_ljout       -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f:Mt_lep_met_f_w_in:Mt_lep_met_f_w_bf:Mt_lep_met_f_w_pu --y-range 0.8,1.1 --add-x-line 40,130
python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_selVloose_ljout -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f:Mt_lep_met_f_w_in:Mt_lep_met_f_w_bf:Mt_lep_met_f_w_pu --y-range 0.8,1.1 --add-x-line 40,130

python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_sel       -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f:Mt_lep_met_f_w_in:Mt_lep_met_f_w_bf:Mt_lep_met_f_w_pu --y-range 0.8,1.1 --add-x-line 40,130
python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_selVloose -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f:Mt_lep_met_f_w_in:Mt_lep_met_f_w_bf:Mt_lep_met_f_w_pu --y-range 0.8,1.1 --add-x-line 40,130















check norm and shapes of all proc in NOM VS FSR

results:
the yields are ok in all processes for FSR
this process did change them a little, maybe the shapes got shifted a bit,
but main issue with couple bins in mu selection is still there
(Vloose and main sel, in lj category and inclusive)

v25/pCheckNomFSR

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRDown



python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_ljout,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_ljout,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_lj,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_lj,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_lj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_ljout,tt_lj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_ljout,tt_lj,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_sel_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_lj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_lj,tt_lj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_lj,tt_lj,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taultauh -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_taultauh,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_ljout,tt_taultauh,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_ljout,tt_taultauh,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taultauh -c ctr_old_mu_sel_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_taultauh,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_lj,tt_taultauh,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_lj,tt_taultauh,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taulj -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_taulj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_ljout,tt_taulj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_ljout,tt_taulj,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taulj -c ctr_old_mu_sel_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_taulj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_lj,tt_taulj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_lj,tt_taulj,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_other -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_other,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_ljout,tt_other,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_ljout,tt_other,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_other -c ctr_old_mu_sel_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_other,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_lj,tt_other,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_lj,tt_other,FSRDown





problematic bins in inclusive sel and Vloose

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_mutau,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_lj,tt_mutau,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_lj,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose,tt_mutau,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel,tt_mutau,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel,tt_mutau,FSRDown


no norm all chan in Vloose

python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRDown

python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRDown


python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_ljout reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_lj,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_lj,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_lj,FSRDown

python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_lj,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_lj,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_lj,FSRDown


python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taultauh -c ctr_old_mu_selVloose_ljout reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_taultauh,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_taultauh,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_taultauh,FSRDown

python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taultauh -c ctr_old_mu_selVloose_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_taultauh,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_taultauh,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_taultauh,FSRDown


python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taulj -c ctr_old_mu_selVloose_ljout reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_taulj,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_taulj,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_taulj,FSRDown

python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taulj -c ctr_old_mu_selVloose_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_taulj,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_taulj,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_taulj,FSRDown


python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_other -c ctr_old_mu_selVloose_ljout reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_other,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_other,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_other,FSRDown

python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_other -c ctr_old_mu_selVloose_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_other,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_other,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_other,FSRDown














rateParams for ratio

dilep_norm              lnU         -              -              -              -              -              -              -              -              -              -              -              -              -              -     


rate_mutau              rateParam  mu   tt_mutau 13609.554

tau_ratio               param                    1.         0.1

./scripts/text2workspace.py ttxsec/fit-stuff/ratio_both_0.txt

combine -M MultiDimFit ttxsec/fit-stuff/ratio_both_0.txt --algo grid --points 100 --redefineSignalPOIs tau_ratio --freezeParameters r --saveSpecifiedNuis dilep_norm --rMin 0.5 --rMax 1.5 --name RatioElMuShapes

--expectSignal 1

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 -o latest_ratio_toys_asimov_impacts.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratio_toys_asimov_impacts.json -o latest_ratio_toys_asimov_impacts


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --freezeNuisanceGroup tt_updowns -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --freezeNuisanceGroup tt_updowns -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --freezeNuisanceGroup tt_updowns -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 -o latest_ratio_toys_asimov_impacts_no_updowns.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratio_toys_asimov_impacts_no_updowns.json -o latest_ratio_toys_asimov_impacts_no_updowns

--setParameters tt_elmu=1.0,tt_mutau=1.0











../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeNuisanceGroup tt_th_pdf  -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeNuisanceGroup tt_th_pdf  -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeNuisanceGroup tt_th_pdf  -m 125 -o latest_mu_impacts.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts.json -o latest_mu_impacts

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeNuisanceGroup tt_th_pdf --freezeParameters FSR -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeNuisanceGroup tt_th_pdf --freezeParameters FSR -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeNuisanceGroup tt_th_pdf --freezeParameters FSR -m 125 -o latest_mu_impacts.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts.json -o latest_mu_impacts


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeNuisanceGroup tt_th_pdf -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeNuisanceGroup tt_th_pdf -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeNuisanceGroup tt_th_pdf -m 125 -o latest_el_impacts.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts.json -o latest_el_impacts

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeNuisanceGroup tt_th_pdf --freezeParameters FSR -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeNuisanceGroup tt_th_pdf --freezeParameters FSR -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeNuisanceGroup tt_th_pdf --freezeParameters FSR -m 125 -o latest_el_impacts.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts.json -o latest_el_impacts



python yield_variations.py -p tt_taultauh,tt_lj,tt_other,tt_mutau,tt_taulj mc_v25v26pR5_updowns_with_data.root -c ctr_old_mu_sel_lj,ctr_old_mu_sel_ljout -d Mt_lep_met_f -s TuneCUETP8M2T4,FSR,ISR,HDAMP --to-average
INFO:root:import ROOT
                         ctr_old_mu_sel_lj     ctr_old_mu_sel_lj     ctr_old_mu_sel_lj     ctr_old_mu_sel_lj     ctr_old_mu_sel_lj  ctr_old_mu_sel_ljout  ctr_old_mu_sel_ljout  ctr_old_mu_sel_ljout  ctr_old_mu_sel_ljout  ctr_old_mu_sel_ljout
                               tt_taultauh                 tt_lj              tt_other              tt_mutau              tt_taulj           tt_taultauh                 tt_lj              tt_other              tt_mutau              tt_taulj
      TuneCUETP8M2T4           0.965/1.035           1.009/0.991           1.060/0.940           1.009/0.991           1.032/0.968           1.030/0.970           1.032/0.968           1.015/0.985           1.004/0.996           1.033/0.967
                 FSR           1.095/0.905           1.486/0.514           1.341/0.659           1.079/0.921           1.483/0.517           1.067/0.933           1.457/0.543           1.323/0.677           1.081/0.919           1.419/0.581
                 ISR           0.976/1.024           1.023/0.977           0.949/1.051           1.003/0.997           1.019/0.981           1.016/0.984           1.027/0.973           1.000/1.000           1.018/0.982           1.054/0.946
               HDAMP           0.963/1.037           0.981/1.019           0.955/1.045           0.979/1.021           1.007/0.993           0.994/1.006           0.992/1.008           0.933/1.067           1.001/0.999           0.969/1.031


python yield_variations.py -p tt_taultauh,tt_lj,tt_other,tt_eltau,tt_taulj mc_v25p2_v26p2_updowns2_with_data.root -c ctr_old_el_sel_lj,ctr_old_el_sel_ljout -d Mt_lep_met_f -s TuneCUETP8M2T4,FSR,ISR,HDAMP --to-average
INFO:root:import ROOT
                         ctr_old_el_sel_lj     ctr_old_el_sel_lj     ctr_old_el_sel_lj     ctr_old_el_sel_lj     ctr_old_el_sel_lj  ctr_old_el_sel_ljout  ctr_old_el_sel_ljout  ctr_old_el_sel_ljout  ctr_old_el_sel_ljout  ctr_old_el_sel_ljout
                               tt_taultauh                 tt_lj              tt_other              tt_eltau              tt_taulj           tt_taultauh                 tt_lj              tt_other              tt_eltau              tt_taulj
      TuneCUETP8M2T4           1.015/0.985           1.036/0.964           1.009/0.991           1.013/0.987           0.963/1.037           0.986/1.014           1.006/0.994           1.014/0.986           1.005/0.995           0.974/1.026
                 FSR           1.077/0.923           1.480/0.520           1.325/0.675           1.065/0.935           1.456/0.544           1.119/0.881           1.461/0.539           1.318/0.682           1.084/0.916           1.478/0.522
                 ISR           0.999/1.001           1.026/0.974           0.969/1.031           1.002/0.998           0.996/1.004           1.023/0.977           1.022/0.978           1.010/0.990           1.013/0.987           1.053/0.947
               HDAMP           0.931/1.069           1.000/1.000           0.872/1.128           1.004/0.996           0.981/1.019           1.008/0.992           0.996/1.004           0.973/1.027           0.987/1.013           0.958/1.042






rate nuisances for updowns

muons

nominals

ctr_old_mu_sel_lj        ctr_old_mu_sel_lj        ctr_old_mu_sel_lj        ctr_old_mu_sel_lj        ctr_old_mu_sel_lj
tt_taultauh              tt_lj                    tt_other                 tt_mutau                 tt_taulj         
3                        1                        4                        0                        2                
0.009                    0.107                    0.003                    0.147                    0.007            

ctr_old_mu_sel_ljout     ctr_old_mu_sel_ljout     ctr_old_mu_sel_ljout     ctr_old_mu_sel_ljout     ctr_old_mu_sel_ljout     
tt_taultauh              tt_lj                    tt_other                 tt_mutau                 tt_taulj                 
3                        1                        4                        0                        2                        
0.017                    0.081                    0.006                    0.273                    0.005                    









testing the full selection of tt_mutau process

1) repeate the sumup in pyroot

python mu_sel_test.py mu_sel_test_nom.root      gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python mu_sel_test.py mu_sel_test_fsr_down.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &
python mu_sel_test.py mu_sel_test_fsr_up.root   gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrup_ext2/*/0000/*root &

2) add propper jets and tau selection (with anti-lepmatch)

3) add main weights (LEP, PU, bSF)




sumup mutau only
and compare with selection

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) > 15*15) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) > 15*15)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0" --histo-name  tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt   --output tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) > 15*15) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) > 15*15)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_mutau_mu1t3j1b_leptaucuts_ttfsr_Mt   --output tt_mutau_mu1t3j1b_leptaucuts_ttfsr_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) > 15*15) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) > 15*15)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_mutau_mu1t3j1b_leptaucuts_ttfsrup_Mt --output tt_mutau_mu1t3j1b_leptaucuts_ttfsrup_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrup_ext2/*/0000/*root &

-- the fsr variations are weak

and in mujets (it should have larger effect from fsr)

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 1) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) == 1)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0" --histo-name  tt_muj_mu1t3j1b_leptaucuts_ttnom_Mt   --output tt_muj_mu1t3j1b_leptaucuts_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 1) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) == 1)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_muj_mu1t3j1b_leptaucuts_ttfsr_Mt   --output tt_muj_mu1t3j1b_leptaucuts_ttfsr_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 1) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) == 1)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_muj_mu1t3j1b_leptaucuts_ttfsrup_Mt --output tt_muj_mu1t3j1b_leptaucuts_ttfsrup_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrup_ext2/*/0000/*root &




rerun selection on nominal TT and FSR up-down
v25 pCheckNomFSR

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_lj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_lj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_lj,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_lj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_lj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_lj,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRDown



python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose,tt_lj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose,tt_lj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose,tt_lj,FSRDown &

compare nominal to the fit one:

python jobsums/get_shapes.py --formula "reNOM : NOMold " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL NOMold:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL 






same stuff with electrons

get_shapes:

python jobsums/get_shapes.py --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_eltau -c ctr_old_el_selVloose NOM:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose,tt_eltau,NOMINAL FSRUp:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose,tt_eltau,FSRUp FSRDown:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose,tt_eltau,FSRDown

python jobsums/get_shapes.py --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_eltau -c ctr_old_el_selVloose_lj NOM:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_lj,tt_eltau,NOMINAL FSRUp:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_lj,tt_eltau,FSRUp FSRDown:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_lj,tt_eltau,FSRDown

python jobsums/get_shapes.py --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_eltau -c ctr_old_el_selVloose_ljout NOM:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,NOMINAL FSRUp:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,FSRUp FSRDown:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,FSRDown

python jobsums/get_shapes.py --formula "NOM : ISRUp : ISRDown" -d Mt_lep_met_f -p tt_eltau -c ctr_old_el_selVloose_ljout NOM:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,NOMINAL ISRUp:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,ISRUp ISRDown:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,ISRDown

python jobsums/get_shapes.py --no-norm --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_eltau -c ctr_old_el_selVloose_ljout NOM:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,NOMINAL FSRUp:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,FSRUp FSRDown:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,FSRDown

compare with full plot:

python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root --lumi 31300 -p -r --qcd 1.05 --wjet 0.85 --factor-dy 1.05 -c ctr_old_el_selVloose -d Mt_lep_met_f

python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root --lumi 31300 -p -r --qcd 1.05 --wjet 0.85 --factor-dy 1.05 -c ctr_old_el_sel_lj    -x ctr_old_el_selVloose_lj    -d Mt_lep_met_f
python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root --lumi 31300 -p -r --qcd 1.05 --wjet 0.85 --factor-dy 1.05 -c ctr_old_el_sel_ljout -x ctr_old_el_selVloose_ljout -d Mt_lep_met_f

full plot from fitting file:

../../fit-stuff/histosels_mc_v25p2_v26p2_updowns2_el_w-qcd-prop.root

python stack_plot.py ../../fit-stuff/histosels_mc_v25p2_v26p2_updowns2_el_w-qcd-prop.root ../../fit-stuff/histosels_mc_v25p2_v26p2_updowns2_el_w-qcd-prop.root -p -r -c ctr_old_el_sel_lj    -d Mt_lep_met_f
python stack_plot.py ../../fit-stuff/histosels_mc_v25p2_v26p2_updowns2_el_w-qcd-prop.root ../../fit-stuff/histosels_mc_v25p2_v26p2_updowns2_el_w-qcd-prop.root -p -r -c ctr_old_el_sel_ljout -d Mt_lep_met_f


and sumup:

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "abs(leps_ID) == 11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0" --histo-name tt_el1t3j1b_leptaucuts_ttnom_Mt --output tt_el1t3j1b_leptaucuts_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "abs(leps_ID) == 11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_el1t3j1b_leptaucuts_ttfsr_Mt --output tt_el1t3j1b_leptaucuts_ttfsr_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "abs(leps_ID) == 11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_el1t3j1b_leptaucuts_ttfsrup_Mt --output tt_el1t3j1b_leptaucuts_ttfsrup_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrup_ext2/*/0000/*root &






add lep and tau pt cut:

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0" --histo-name tt_mu1t3j1b_leptaucuts_ttnom_Mt --output tt_mu1t3j1b_leptaucuts_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_mu1t3j1b_leptaucuts_ttfsr_Mt --output tt_mu1t3j1b_leptaucuts_ttfsr_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_mu1t3j1b_leptaucuts_ttfsrup_Mt --output tt_mu1t3j1b_leptaucuts_ttfsrup_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrup_ext2/*/0000/*root &







python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 250,0,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && njets > 2 && nbjets > 0" --histo-name tt_mu1t3j1b_ttnom_Mt --output tt_mu1t3j1b_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 250,0,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && njets > 2 && nbjets > 0 " --histo-name tt_mu1t3j1b_ttfsr_Mt --output tt_mu1t3j1b_ttfsr_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 250,0,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && njets > 2 && nbjets > 0 " --histo-name tt_mu1t3j1b_ttfsrup_Mt --output tt_mu1t3j1b_ttfsrup_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrup_ext2/*/0000/*root &








python sumup_ttree_distrs.py "lep_p4[0].pt()" --histo-range 200,0,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && njets > 2 && nbjets > 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) > 110" --histo-name tt_mu1t3j1b_ttnom_leppt --output tt_mu1t3j1b_ttnom_leppt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python sumup_ttree_distrs.py "lep_p4[0].pt()" --histo-range 200,0,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && njets > 2 && nbjets > 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) > 110" --histo-name tt_mu1t3j1b_ttfsr_leppt --output tt_mu1t3j1b_ttfsr_leppt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &














python jobsums/get_shapes.py --no-norm --formula "NOM : FSRUp : FSRDown" -d regMt_lep_pt -p tt_mutau -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL FSRUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRUp FSRDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRDown






python jobsums/get_shapes.py --no-norm --formula "NOM : ISRUp : ISRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL ISRUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,ISRUp ISRDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,ISRDown





python jobsums/get_shapes.py --no-norm --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL FSRUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRUp FSRDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRDown

python jobsums/get_shapes.py --no-norm --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL FSRUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRUp FSRDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRDown

python jobsums/get_shapes.py --no-norm --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_lj NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,NOMINAL FSRUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,FSRUp FSRDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,FSRDown

python jobsums/get_shapes.py --no-norm --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,NOMINAL FSRUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,FSRUp FSRDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,FSRDown







python jobsums/get_shapes.py --no-norm --formula "NOM : HDAMPUp : HDAMPDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL HDAMPUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,HDAMPUp HDAMPDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,HDAMPDown

python jobsums/get_shapes.py --no-norm --formula "NOM : HDAMPUp : HDAMPDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL HDAMPUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,HDAMPUp HDAMPDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,HDAMPDown

python jobsums/get_shapes.py --no-norm --formula "NOM : HDAMPUp : HDAMPDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_lj NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,NOMINAL HDAMPUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,HDAMPUp HDAMPDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,HDAMPDown

python jobsums/get_shapes.py --no-norm --formula "NOM : HDAMPUp : HDAMPDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,NOMINAL HDAMPUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,HDAMPUp HDAMPDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,HDAMPDown








python jobsums/get_shapes.py --no-norm --formula "NOM : TuneCUETP8M2T4Up : TuneCUETP8M2T4Down" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL TuneCUETP8M2T4Up:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,TuneCUETP8M2T4Up TuneCUETP8M2T4Down:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,TuneCUETP8M2T4Down

python jobsums/get_shapes.py --no-norm --formula "NOM : TuneCUETP8M2T4Up : TuneCUETP8M2T4Down" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL TuneCUETP8M2T4Up:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,TuneCUETP8M2T4Up TuneCUETP8M2T4Down:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,TuneCUETP8M2T4Down

python jobsums/get_shapes.py --no-norm --formula "NOM : TuneCUETP8M2T4Up : TuneCUETP8M2T4Down" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_lj NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,NOMINAL TuneCUETP8M2T4Up:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,TuneCUETP8M2T4Up TuneCUETP8M2T4Down:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,TuneCUETP8M2T4Down

python jobsums/get_shapes.py --no-norm --formula "NOM : TuneCUETP8M2T4Up : TuneCUETP8M2T4Down" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,NOMINAL TuneCUETP8M2T4Up:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,TuneCUETP8M2T4Up TuneCUETP8M2T4Down:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,TuneCUETP8M2T4Down




